import{S as Ur,F as yi,P as as,W as ss,a as ot,A as wi,O as bi,T as is,V as A,b as mt,G as cs,c as io,C as sn,M as ht,d as or,e as Ye,f as dt,B as Tt,g as Ln,L as Lr,h as _i,i as De,j as wt,Q as Ne,k as cn,l as oe,m as xi,H as ls,D as us,n as Dr,R as fs,o as ds,p as Rr,q as hs,r as ps,s as Je,t as gs,u as Si,v as Mi,w as Bt,x as Pr,N as Ci,y as Ai,I as on,z as Ti,E as ki,J as Fi,K as Ui,U as Li,X as Di,Y as ms,Z as Ri,_ as Pi,$ as Ei,a0 as co,a1 as vs,a2 as sa,a3 as ia,a4 as Bi,a5 as Ii,a6 as ca,a7 as Oi,a8 as zi,a9 as Gi,aa as Wi,ab as Vi,ac as Hi,ad as Ni,ae as ji,af as la,ag as qi,ah as Yi,ai as Xi}from"./three-B_POVWff.js";function Qi(o){const t=new Ur;t.background=null,t.fog=new yi(988187,180,900);const r=new as(55,2,.1,200);r.position.set(0,8,0),t.add(r);const l=new ss({antialias:!1,alpha:!0});l.outputColorSpace=ot,l.toneMapping=wi,l.toneMappingExposure=1,l.setPixelRatio(window.devicePixelRatio),l.setSize(window.innerWidth,window.innerHeight),l.autoClear=!1,o.appendChild(l.domElement);const n=l.domElement;n.style.width="100%",n.style.height="100%",n.style.display="block";const e=new bi(r,l.domElement);e.enableDamping=!0,e.dampingFactor=.08,e.target.set(0,0,0),e.zoom0=200;const a=o.clientWidth||window.innerWidth,i=o.clientHeight||window.innerHeight;return l.setSize(a,i,!0),r.aspect=a/Math.max(1,i),r.updateProjectionMatrix(),{THREE:is,scene:t,camera:r,renderer:l,controls:e,container:o}}const Ki=new A(0,-9.8,0),Vo=.12,ua=.02,rr=new A(0,.1,0),ys=240,Zi=9e-4,Ji=4e-4,$i=25e-6,ec=3.5,Er="/assets/back-CkvHV39y.avif",fa=new Map,tc=o=>Math.max(.05,Math.round((o||1)*1e3)/1e3);function ws(o){const t=tc(o);let r=fa.get(t);return r||(r=new mt($e*t,$e,1,1),fa.set(t,r)),r}const da=new Map;function bs(o,t){const r=`${o.uuid}:${t?"r90":"r0"}`;let l=da.get(r);return l||(l=o.clone(),l.needsUpdate=!0,l.center.set(.5,.5),l.rotation=t?Math.PI*.5:0,"colorSpace"in l?l.colorSpace=ot:l.encoding=void 0,da.set(r,l)),l}const $e=.88*1.6,ar=.0025;let Ho=null;function nc(){if(Ho)return Ho;const t=new io().load(Er);return t.anisotropy=8,"colorSpace"in t?t.colorSpace=ot:t.encoding=void 0,t.wrapS=sn,t.wrapT=sn,Ho=t,t}nc();function oc(o,t=1,r){const l=$e*Math.max(t,.05),n=$e,e=ws(t);"colorSpace"in o?o.colorSpace=ot:o.encoding=void 0,o.anisotropy=Math.max(o.anisotropy??1,8);const a=new ht({map:o,side:or,fog:!1,toneMapped:!1,transparent:!1,opacity:1}),i=new Ye(e,a);i.name="card_front";let s=r;s||(s=new io().load(Er),"colorSpace"in s?s.colorSpace=ot:s.encoding=void 0,s.anisotropy=8);const c=t>1,u=bs(s,c),f=new ht({map:u,side:or,fog:!1,toneMapped:!1,transparent:!0,opacity:1}),d=new Ye(e,f);d.rotateY(Math.PI),d.position.z=-ar,d.name="card_back",i.position.z=ar;const h=new dt;return h.add(i,d),{group:h,width:l,height:n}}new cs;function rc(o=65280,t=40){const r=new Tt,l=new Float32Array(t*3);r.setAttribute("position",new Ln(l,3)),r.setDrawRange(0,0);const n=new Lr({color:o,transparent:!0,opacity:.65,fog:!0}),e=new _i(r,n);return e.userData={positions:l,max:t,count:0,decayPtsPerSec:24,minMoveSq:6e-4},e}function _s(o,t){const r=ar*.9,l=new A().subVectors(t.position,o.group.position).normalize();return new A().copy(o.group.position).addScaledVector(l,r)}function to(o,t,r,l){const n=o.trail,e=n.userData,{positions:a,max:i}=e,s=_s(o,l);if(r){const c=Math.min(e.count+1,i);for(let u=c-1;u>0;u--)a[u*3+0]=a[(u-1)*3+0],a[u*3+1]=a[(u-1)*3+1],a[u*3+2]=a[(u-1)*3+2];a[0]=s.x,a[1]=s.y,a[2]=s.z,e.count=c,n.geometry.setDrawRange(0,c),n.geometry.attributes.position.needsUpdate=!0;return}if(e.count>0){a[0]=s.x,a[1]=s.y,a[2]=s.z;const c=Math.max(1,Math.floor(e.decayPtsPerSec*t)),u=Math.max(0,e.count-c);e.count=u,n.geometry.setDrawRange(0,u),n.geometry.attributes.position.needsUpdate=!0}}function ac(o){const t=o.trail,r=t.userData;r.count=0,t.geometry.setDrawRange(0,0),t.geometry.attributes.position.needsUpdate=!0}function sc(o,t,r){const l=[];let n=r?.fronts??[],e=r?.back??null,a=-1;const i={cards:l,getHeartBoundsWorld:null,getHeartBottomWorld:null};function s(c,u){const f=c.group,d=f.getObjectByName("card_front"),h=f.getObjectByName("card_back"),g=Math.max(u?.aspect??1,.05),v=d.material;v.map=u.texture,"colorSpace"in u.texture?u.texture.colorSpace=ot:u.texture.encoding=void 0,u.texture.anisotropy=Math.max(u.texture.anisotropy??1,8);const b=h.material;b.map=bs(e,g>1);const m=ws(g);d.geometry!==m&&(d.geometry=m),h.geometry!==m&&(h.geometry=m),c.cardWidth=$e*g;const p=f.getObjectByName("card_overlay_glb");p&&f.remove(p)}return{scene:o,trailsGroup:t,cards:l,publicAPI:i,deck:n,backBase:e,_lastCount:a,_targetsDirty:!0,makeCard(c){const u=n[c%Math.max(n.length,1)],f=oc(u?.texture,u?.aspect??1,e??void 0),d=rc(65280,20);return t.add(d),o.add(f.group),{group:f.group,trail:d,velocity:new A,angular:new A,age:0,alive:!1,opacity:1,state:"flying",mode:"normal",targetLocal:new A,homingDelay:1,prevPos:new A,prevHead:null,cardWidth:f.width||$e*(u?.aspect??1)}},setDeck(c){n=c.fronts??[],e=c.back??null,this.deck=n,this.backBase=e;for(let u=0;u<l.length;u++){const f=n[u%Math.max(n.length,1)];f&&s(l[u],f)}this._targetsDirty=!0},updateTrail:to,clearTrail:ac}}const lo=.05,uo=50;let wo=1,Vt=1,bo=1,Ht=1,Br=!1;const ha=1e-4;function ic(){return Vt}function ft(){return Ht}function xs(){return Br}function Tn(o){Br=o,o&&(wo=Vt,bo=Ht)}function cc(o){wo=De.clamp(o,lo,uo)}function lc(o){bo=De.clamp(o,lo,uo)}function uc(o){if(Br)return{layoutChanged:!1,cardChanged:!1};const t=1-Math.exp(-6*Math.max(0,o)),r=1-Math.exp(-8*Math.max(0,o)),l=Vt,n=Ht;Vt+=(wo-Vt)*t,Ht+=(bo-Ht)*r;const e=Math.abs(Vt-l)>ha,a=Math.abs(Ht-n)>ha;return{layoutChanged:e,cardChanged:a}}function fc(o,t){o!==void 0&&(wo=Vt=De.clamp(o,lo,uo)),t!==void 0&&(bo=Ht=De.clamp(t,lo,uo))}const ut=(o,t)=>o+Math.random()*(t-o);let Ss="flying",Ms=!1;const Cn=new A(0,0,1),sr=new A(1,0,0),Cs=new A(0,0,0);let As=9,ir=6.5,cr=10,lr=.35,ur=.15,fr=.8,Ts=1.4;function dc(o){const{camera:t}=o;Cn.copy(t.position).sub(rr).normalize();const r=new A(0,1,0);sr.copy(new A().crossVectors(Cn,r)).normalize(),Cs.copy(new A().crossVectors(sr,Cn)).normalize(),lr=o.spreadRight??lr,ur=o.spreadUp??ur,ir=o.upMin??ir,cr=o.upMax??cr,o.homingDelay&&(fr=o.homingDelay[0],Ts=o.homingDelay[1]);const l=Math.max(.25,o.forwardTimeToCamera),n=new A().subVectors(t.position,rr).dot(Cn);As=Math.max(2e3,n/l),Ms=!0}function ks(o){Ss=o}function dr(o,t,r=50){let l=500,n=!1;typeof r=="number"?l=r:r&&(l=r.power??50,n=!!r.quiet);const e=o?.scene;if(e&&t.group.parent!==e)e.add(t.group);else if(!t.group.parent){const a=o?.trailsGroup?.parent;a&&a.add&&a.add(t.group)}if(t.group.position.copy(rr).add({x:ut(-.05,.05),y:0,z:ut(-.05,.05)}),n)t.velocity.set(0,0,0),t.angular.set(0,0,0),t.state="homing",t.homingDelay=0;else if(Ss==="flying"){if(Ms){const a=ut(ir,cr)*(.8+l/70),i=As*(.6+l/100)*ut(.95,1.05),s=i*lr*ut(-1,1),c=a*ur*ut(-1,1);t.velocity.copy(Cn).multiplyScalar(i).addScaledVector(Cs,a+c).addScaledVector(sr,s)}else t.velocity.set(ut(-.6,.6)*(.6+l/100),ut(6.5,10)*(.8+l/70),ut(-.6,.6)*(.6+l/100));t.angular.set(ut(-2,2),ut(-2,2),ut(-2,2)),t.state="flying",t.homingDelay=fr+Math.random()*(Ts-fr)}else t.velocity.set(0,0,0),t.angular.set(0,0,0),t.state="homing",t.homingDelay=0;t.age=0,t.alive=!0,t.opacity=0,t.trail?.userData&&(t.trail.userData.count=0),t.trail?.geometry?.setDrawRange&&t.trail.geometry.setDrawRange(0,0),t.group.scale.setScalar(.05*ft()),t.prevPos.copy(t.group.position),t.prevHead=null}function hc(o,t,r={}){const l=r.power??50,n=!!r.quiet,e=Math.max(0,t|0);for(;o.cards.length<e;){const s=o.makeCard(o.cards.length);dr(o,s,{power:l,quiet:n}),o.cards.push(s),o._targetsDirty=!0}const a=s=>s==="focus_in"||s==="focused"||s==="focus_out"||s==="transition",i=s=>!!s?.isOverlay||a(s?.mode);for(;o.cards.length>e;){let s=o.cards.length-1;for(;s>=0&&i(o.cards[s]);)s--;if(s<0)break;const[c]=o.cards.splice(s,1);try{c.group?.parent?.remove(c.group)}catch{}try{o.trailsGroup?.remove(c.trail)}catch{}o._targetsDirty=!0}o._lastCount!==e&&(o._lastCount=e,o._targetsDirty=!0)}function pc(o,t){o.age+=t;const r=-Vo*o.velocity.x,l=Ki.y-Vo*o.velocity.y,n=-Vo*o.velocity.z;o.velocity.x+=r*t,o.velocity.y+=l*t,o.velocity.z+=n*t,o.group.position.x+=o.velocity.x*t,o.group.position.y+=o.velocity.y*t,o.group.position.z+=o.velocity.z*t}function gc(o,t,r){const l=1-Math.exp(-r*ec);o.group.position.lerp(t,l),o.velocity.multiplyScalar(.85),o.angular.multiplyScalar(.85)}let mc=-.5;function Fs(o,t,r,l=new A){l.copy(o).sub(t);const n=new A(0,1,0).applyQuaternion(r).normalize();return l.length()<1e-6?l.set(0,1,0).applyQuaternion(r):(l.clone().normalize().dot(n)<mc&&l.multiplyScalar(-1),l)}function Us(o,t,r){const l=o.clone().normalize(),n=l.clone(),e=new A(0,1,0).applyQuaternion(r).normalize(),a=(()=>{const f=t.clone();if(f.addScaledVector(l,-f.dot(l)).normalize(),f.lengthSq()>1e-8)return f;const d=e.clone().addScaledVector(l,-e.dot(l)).normalize();return d.lengthSq()>1e-8?d:e.clone()})(),i=new A().crossVectors(a,n).normalize(),s=new A().crossVectors(n,i).normalize(),c=new wt().makeBasis(i,s,n);return new Ne().setFromRotationMatrix(c)}function pa(o,t,r,l,n){const e=o.group.getWorldPosition(new A),i=t.getWorldPosition(new A).sub(e).normalize(),s=Fs(e,l,n),c=Us(i,s,n),u=o.group.quaternion,f=De.clamp(u.dot(c),-1,1),d=2*Math.acos(Math.abs(f));if(d<1e-4){o.group.quaternion.copy(c);return}const h=ys*Math.PI/180*r,g=Math.min(1,h/d);o.group.quaternion.slerp(c,g)}function ga(o,t,r,l){const n=new A(0,0,1).applyQuaternion(t).normalize(),e=o.group.getWorldPosition(new A),a=Fs(e,l,t),i=Us(n,a,t),s=o.group.quaternion,c=De.clamp(s.dot(i),-1,1),u=2*Math.acos(Math.abs(c));if(u<1e-4){o.group.quaternion.copy(i);return}const f=ys*Math.PI/180*r,d=Math.min(1,f/u);o.group.quaternion.slerp(i,d)}function ma(o,t,r,l){let n=l;if(o.state!=="flying"){const e=_s(o,t);o.prevHead||(o.prevHead=e.clone()),o.prevHead.distanceToSquared(e)>$i&&(n=!0),o.prevHead.copy(e)}if(o.state!=="flying"){const e=o.velocity.lengthSq();n=n||e>Ji}return n}const nt=new A(0,0,0),vt=new cn;function fo(o){return o.clone().applyQuaternion(vt.quaternion).add(vt.position)}const va=[new oe(1.5,2.5),new oe(-1.5,2.5),new oe(0,-2.5),new oe(0,1),new oe(.5,2),new oe(-.5,2),new oe(2.3,2),new oe(2.5,1),new oe(1.8,0),new oe(1,-1),new oe(.5,-1.7),new oe(-.5,-1.8),new oe(-1,-1),new oe(-2,0),new oe(-2.5,1),new oe(-2.2,2)],vc={fixedCount:va.length,sample(){return{positions:va.map(t=>new A(t.x,t.y,0))}}},yc=Object.freeze(Object.defineProperty({__proto__:null,default:vc},Symbol.toStringTag,{value:"Module"})),ya=[new oe(1.5,1),new oe(2.5,.7),new oe(3.5,.4),new oe(4.5,0),new oe(3.5,-.5),new oe(2.5,-.7),new oe(-2.3,-.7),new oe(-3.3,-.4),new oe(-4.3,0),new oe(-3.3,.5),new oe(-2.3,.7),new oe(0,-2.5),new oe(-1,-2.9),new oe(-1.9,-3.3),new oe(-2.9,-3.7),new oe(-2.5,-2.7),new oe(-1.9,-1.9),new oe(-1.3,-1),new oe(1.5,-1),new oe(2,-1.9),new oe(2.5,-2.9),new oe(2.9,-3.9),new oe(1.8,-3.5),new oe(1,-2.9),new oe(1.3,-2),new oe(0,2.5),new oe(1,2.9),new oe(1.9,3.3),new oe(2.9,3.7),new oe(2.5,2.7),new oe(1.9,1.9),new oe(-1.5,1),new oe(-2,1.9),new oe(-2.5,2.9),new oe(-2.9,3.9),new oe(-1.8,3.5),new oe(-1,2.9)],wc={fixedCount:ya.length,sample(){return{positions:ya.map(t=>new A(t.x,t.y,0))}}},bc=Object.freeze(Object.defineProperty({__proto__:null,default:wc},Symbol.toStringTag,{value:"Module"})),wa=[new oe(-2,0),new oe(0,0),new oe(2,0)],_c={fixedCount:wa.length,sample(){return{positions:wa.map(t=>new A(t.x,t.y,0))}}},xc=Object.freeze(Object.defineProperty({__proto__:null,default:_c},Symbol.toStringTag,{value:"Module"})),ba=[new oe(0,.2),new oe(-1.2,0),new oe(-1.8,-.4),new oe(-2.3,-.8),new oe(2.3,-.8),new oe(1.8,-.4),new oe(3.5,-1.8),new oe(3.2,-.8),new oe(2.6,.2),new oe(-.6,1.7),new oe(-1.2,1.5),new oe(-2.6,.2),new oe(-1.7,1.1),new oe(-3.2,-.8),new oe(-3.5,-1.8),new oe(-2.2,.7),new oe(2.3,.7),new oe(.7,.1),new oe(-.7,.1),new oe(1.2,0),new oe(1.8,1.1),new oe(1.2,1.5),new oe(0,1.8),new oe(.6,1.7)],Sc={fixedCount:ba.length,sample(){return{positions:ba.map(t=>new A(t.x,t.y,0))}}},Mc=Object.freeze(Object.defineProperty({__proto__:null,default:Sc},Symbol.toStringTag,{value:"Module"})),Lt=[];let kn=0;const hr=new Set,Cc={id:"fallback:ring",label:"Ring",sample(o){const t=Math.max(1,o|0),r=1;return{positions:Array.from({length:t},(n,e)=>{const a=e/t*Math.PI*2;return new A(Math.cos(a)*r,Math.sin(a)*r,0)})}}};function Ir(o){return hr.add(o),()=>hr.delete(o)}function pr(){const o=qt();for(const t of hr)t(o)}function qt(){return Lt.length?Lt[kn]:Cc}function Dn(){return qt().id??"fallback:ring"}function Ls(o){return(o.includes(":")?o.split(":")[1]:o).replace(/[_-]+/g," ").replace(/\s+/g," ").trim().replace(/\b\w/g,r=>r.toUpperCase())}let Ac=0;function Tc(o){const t=o.id??`manual:${Ac++}`,r=o.label??Ls(t);return Lt.push({...o,id:t,label:r}),Lt.length===1&&(kn=0,pr()),{...o,id:t,label:r}}function kc(){return Lt.length?Lt.map(o=>({id:o.id,label:o.label})):[{id:"fallback:ring",label:"Ring"}]}function Ds(o){const r=(qt().fixedCount??o)|0;return Math.max(0,Math.min(r,o|0))}function Fc(o){if(!Lt.length){const l=Dn()===o;return pr(),{changed:!l,pattern:qt()}}const t=Lt.findIndex(l=>l.id===o);if(t===-1)return{changed:!1,pattern:qt()};const r=t!==kn;return kn=t,pr(),{changed:r,pattern:Lt[kn]}}function Uc(o){const t=qt(),r=Math.max(0,o|0),{positions:l}=t.sample(r);for(const n of l)n.z=0;return{positions:l}}function Lc(o){return o&&typeof o=="object"&&typeof o.sample=="function"}function Dc(o){return`custom:${o.split("/").pop().replace(/\.\w+$/,"")}`}const Rc=Object.assign({"/src/features/cardGroup/patterns/custom/test0.ts":yc,"/src/features/cardGroup/patterns/custom/test1.ts":bc,"/src/features/cardGroup/patterns/custom/test2.ts":xc,"/src/features/cardGroup/patterns/custom/test3.ts":Mc}),_a=new Set;Object.entries(Rc).sort(([o],[t])=>o.localeCompare(t)).forEach(([o,t])=>{const r=t.default??t.pattern;if(!Lc(r))return;const l=Dc(o),n=r.id??l;if(_a.has(n))return;const e=r.label??Ls(n);Tc({...r,id:n,label:e}),_a.add(n)});function Qn(o){const t=o.cards.length;if(!t){o._targets=[];return}const r=ic(),{positions:l}=Uc(t);for(let n=0;n<t;n++){const e=l[n%l.length]||new A;o.cards[n].targetLocal=new A(e.x*r,e.y*r,0)}o.publicAPI.getHeartBoundsWorld=function(){if(!l.length)return null;const n={x:1/0,y:1/0,z:1/0},e={x:-1/0,y:-1/0,z:-1/0};for(let s=0;s<t;s++){const c=fo(o.cards[s].targetLocal);c.x<n.x&&(n.x=c.x),c.y<n.y&&(n.y=c.y),c.z<n.z&&(n.z=c.z),c.x>e.x&&(e.x=c.x),c.y>e.y&&(e.y=c.y),c.z>e.z&&(e.z=c.z)}const a=new A((n.x+e.x)/2,(n.y+e.y)/2,(n.z+e.z)/2),i=new A(e.x-n.x,e.y-n.y,e.z-n.z);return{center:a,size:i,minY:n.y,maxY:e.y,min:n,max:e}},o.publicAPI.getHeartBottomWorld=function(){if(!l.length)return null;let n=null,e=1/0;for(let a=0;a<t;a++){const i=fo(o.cards[a].targetLocal);i.y<e&&(e=i.y,n=i)}return n?n.clone():null}}const gr=fo;function xa(o){return o==="focus_in"||o==="focused"||o==="focus_out"}function Pc(o,t,r){const l=sc(o,t,r);function n(f,d){let h=50,g=!1;typeof d=="number"?h=d:d&&(h=d.power??50,g=!!d.quiet),hc(l,Math.max(0,f|0),{power:h,quiet:g}),l._targetsDirty&&l.cards.length&&(Qn(l),l._targetsDirty=!1)}function e(){l._targetsDirty=!0,l.cards.length&&(Qn(l),l._targetsDirty=!1)}function a(f,d,h,g){const v=g?.billboard??"camera",b=vt.quaternion;n(d.count,d.power);const m=ft();for(const p of l.cards){if(p.mode==="transition"){const M=p.prevPos.distanceToSquared(p.group.position)>1e-8;if(d.showPaths){p.trail.visible=!0,p.trail.material.opacity=.9;const w=ma(p,h,f,M);l.updateTrail(p,f,w,h)}else p.trail.visible&&(l.clearTrail(p),p.trail.visible=!1);p.prevPos.copy(p.group.position);continue}if(p.mode==="morph"&&p._morph){p._morph.t+=f;const M=Math.min(1,p._morph.t/Math.max(1e-6,p._morph.dur)),w=M<.5?4*M*M*M:1-Math.pow(-2*M+2,3)/2,C=new A,F=1-w;C.set(0,0,0).addScaledVector(p._morph.p0,F*F*F).addScaledVector(p._morph.p1,3*F*F*w).addScaledVector(p._morph.p2,3*F*w*w).addScaledVector(p._morph.p3,w*w*w),p.group.position.copy(C),v==="camera"?pa(p,h,f,nt,b):ga(p,b,f,nt);const k=De.degToRad(360)*w;p.group.rotateY(k-(p._morph.prevSpin||0)),p._morph.prevSpin=k;const D=1+.08*Math.sin(Math.PI*w);p.group.scale.setScalar(m*D),p.trail.material.opacity=.85,l.updateTrail(p,f,!0,h),M>=1&&(p.mode="normal",p._morph=null,p.group.scale.setScalar(m),p.trail.material.opacity=.65);continue}if(xa(p.mode)){const M=p.prevPos.distanceToSquared(p.group.position)>1e-8;d.showPaths?(p.trail.visible=!0,l.updateTrail(p,f,M,h)):p.trail.visible&&(l.clearTrail(p),p.trail.visible=!1),p.prevPos.copy(p.group.position);continue}p.alive||dr(l,p,d.power),p.opacity<1&&(p.opacity=Math.min(1,p.opacity+f*2.5));const x=De.lerp(.05,1,p.opacity);p.group.scale.setScalar(m*x);let y=!1;if(p.state==="flying"){if(pc(p,f),p.group.position.y<ua){p.group.position.y=ua,p.velocity.y=Math.max(0,p.velocity.y),p.state="initialHoming";const M=p.group?.uuid??p.group?.id??"?";console.debug(`[card ${M}] flying -> initialHoming (floor)`)}if(p.group.rotation.x+=p.angular.x*f,p.group.rotation.y+=p.angular.y*f,p.group.rotation.z+=p.angular.z*f,p.age-3>p.homingDelay){p.state="initialHoming";const M=p.group?.uuid??p.group?.id??"?";console.debug(`[card ${M}] flying -> initialHoming (delay=${p.homingDelay?.toFixed?p.homingDelay.toFixed(2):p.homingDelay})`)}y=!0}else{const M=gr(p.targetLocal),C=p.group.position.clone().distanceToSquared(M);if(gc(p,M,f),v==="camera"?pa(p,h,f,nt,b):ga(p,b,f,nt),p.state==="initialHoming"&&C<=Zi){p.state="homing";const F=p.group?.uuid??p.group?.id??"?";console.debug(`[card ${F}] initialHoming -> homing (dist2=${C.toFixed(5)})`)}y=!0}const _=ma(p,h,f,y);d.showPaths?(p.trail.visible=!0,l.updateTrail(p,f,_,h)):p.trail.visible&&(l.clearTrail(p),p.trail.visible=!1),p.prevPos.copy(p.group.position)}}function i(f){l._targetsDirty=!0;for(const d of l.cards)d.mode="normal",d.state="flying",d.opacity=0,d.alive=!0,d._morph=null,l.clearTrail(d),d.trail.visible=!0,d.group.parent!==o&&o.add(d.group),d.group.quaternion.identity(),d.prevPos.copy(d.group.position),d.prevHead=null,d.group.scale.setScalar(ft()),dr(l,d,f),d.trail.material.opacity=.65}function s(f,d){l._targetsDirty=!0,Qn(l),l._targetsDirty=!1;const h=Math.max(.25,Math.min(6,d?.duration??1.6));for(const g of l.cards){if(xa(g.mode))continue;const v=g.group.getWorldPosition(new A),b=gr(g.targetLocal),m=new A().addVectors(v,b).multiplyScalar(.5),p=Math.max(.5,v.distanceTo(b)*.25),x=Math.max(.3,v.distanceTo(b)*.15),y=new A(m.x,m.y+p,m.z),_=new A(b.x,b.y-x,b.z);g.mode="morph",g.state="homing",g.velocity.set(0,0,0),g.angular.set(0,0,0),g._morph={t:0,dur:h,p0:v,p1:y,p2:_,p3:b,prevSpin:0},g.trail.visible=!0,g.trail.material.opacity=.9}}function c(f,d){l.setDeck({fronts:f,back:d}),l.cards.length&&(Qn(l),l._targetsDirty=!1)}function u(){return Math.max(0,l.deck?.length|0||0)}return{...l.publicAPI,scene:l.scene,step:a,reset:i,ensureCardCount:n,prepareHeartTargets:e,morphToNewTargets:s,setImageDeck:c,getDeckLength:u}}function Ec(o,t){t.shadowMap.enabled=!1;let r=o.getObjectByName("FlatAmbient");r?r.intensity=.35:(r=new xi(16777215,.35),r.name="FlatAmbient",o.add(r));let l=o.getObjectByName("FlatHemi");l?l.intensity=.35:(l=new ls(12575743,2109476,.35),l.name="FlatHemi",o.add(l));let n=o.getObjectByName("FlatKey");n?(n.intensity=.8,n.position.set(3,4,2)):(n=new us(16777215,.8),n.position.set(3,4,2),n.name="FlatKey",o.add(n))}const Bc="/assets/103_converted-CCKUNFTe.avif",Ic="/assets/106_converted-fa5jghwL.avif",Oc="/assets/108_converted-CppO2GS5.avif",zc="/assets/asdf-DuOLjb0-.avif",Gc="/assets/2_converted-BXNtAhVS.avif",Wc="/assets/32_converted-YjMYFBEP.avif",Vc="/assets/21888-CaRacCkE.avif",Hc="/assets/44_converted-CnQUlqwR.avif",Nc="/assets/55_converted-fbfd0Qdp.avif",jc="/assets/61_converted-DHmHUAJg.avif",qc="/assets/65_converted-_w8fvoP6.avif",Yc="/assets/66_converted-InZBsrHX.avif",Xc="/assets/67_converted-B15ZrYUZ.avif",Qc="/assets/82_converted-BYKiW5zc.avif",Kc="/assets/90_converted-DiBONRl4.avif",Zc="/assets/97_converted-D55DAdUG.avif",Rs="/assets/back-BMQaBRDs.avif",Jc="/assets/asdf-DuOLjb0-.avif",$c="/assets/asdf-DuOLjb0-.avif",el="/assets/asdf-DuOLjb0-.avif",tl="/assets/909394-o4btXReT.avif",nl="/assets/909394-o4btXReT.avif",ol="/assets/909394-o4btXReT.avif",rl="/assets/55544-CwEbS-e9.avif",al="/assets/55544-CwEbS-e9.avif",sl="/assets/55544-CwEbS-e9.avif",il="/assets/3_converted-4SJ-8_Bi.avif",cl="/assets/3_converted-4SJ-8_Bi.avif",ll="/assets/3_converted-4SJ-8_Bi.avif",ul="/assets/40_converted-DwFDT5b-.avif",fl="/assets/40_converted-DwFDT5b-.avif",dl="/assets/40_converted-DwFDT5b-.avif",hl="/assets/54_converted-C6gsDuDG.avif",pl="/assets/54_converted-C6gsDuDG.avif",gl="/assets/54_converted-C6gsDuDG.avif",ml="/assets/57_converted-BM1TG-qq.avif",vl="/assets/57_converted-BM1TG-qq.avif",yl="/assets/57_converted-BM1TG-qq.avif",wl="/assets/59_converted-RIQhhz8d.avif",bl="/assets/59_converted-RIQhhz8d.avif",_l="/assets/59_converted-RIQhhz8d.avif",xl="/assets/5_converted-B7aoQaEb.avif",Sl="/assets/5_converted-B7aoQaEb.avif",Ml="/assets/5_converted-B7aoQaEb.avif",Cl="/assets/73_converted-D7IqHcDL.avif",Al="/assets/73_converted-D7IqHcDL.avif",Tl="/assets/73_converted-D7IqHcDL.avif",kl="/assets/88_converted-CJAusi-M.avif",Fl="/assets/88_converted-CJAusi-M.avif",Ul="/assets/88_converted-CJAusi-M.avif",Ll="/assets/89_converted-qRCxcDod.avif",Dl="/assets/89_converted-qRCxcDod.avif",Rl="/assets/89_converted-qRCxcDod.avif",Pl="/assets/93_converted-BBJOPPF3.avif",El="/assets/93_converted-BBJOPPF3.avif",Bl="/assets/93_converted-BBJOPPF3.avif",Il="/assets/9_converted-CFAV1elD.avif",Ol="/assets/9_converted-CFAV1elD.avif",zl="/assets/9_converted-CFAV1elD.avif",Ps="/assets/back-CkvHV39y.avif",Gl="/assets/102_converted-Ch_C-71B.avif",Wl="/assets/23_converted-BvFqQVZE.avif",Vl="/assets/94_converted-AceOW8jK.avif",Es="/assets/back-CkvHV39y.avif",Hl="/assets/11233-Ba-FPQCp.avif",Nl="/assets/11233-Ba-FPQCp.avif",jl="/assets/12300-DfsZGI5m.avif",ql="/assets/12300-DfsZGI5m.avif",Yl="/assets/123001-DuM6nCxT.avif",Xl="/assets/123001-DuM6nCxT.avif",Ql="/assets/21888-CaRacCkE.avif",Kl="/assets/21888-CaRacCkE.avif",Zl="/assets/44422-Bmv9pLdb.avif",Jl="/assets/44422-Bmv9pLdb.avif",$l="/assets/444334-D1xZviLq.avif",eu="/assets/444334-D1xZviLq.avif",tu="/assets/444411-B_2QgAis.avif",nu="/assets/444411-B_2QgAis.avif",ou="/assets/55111-zSUA8aUX.avif",ru="/assets/55111-zSUA8aUX.avif",au="/assets/55544-CwEbS-e9.avif",su="/assets/55544-CwEbS-e9.avif",iu="/assets/88189-qVFOIBwK.avif",cu="/assets/88189-qVFOIBwK.avif",lu="/assets/909394-o4btXReT.avif",uu="/assets/909394-o4btXReT.avif",fu="/assets/923999-ClSxhF8r.avif",du="/assets/923999-ClSxhF8r.avif",hu="/assets/9995-zNxxyCvB.avif",pu="/assets/9995-zNxxyCvB.avif",gu="/assets/asdf-DuOLjb0-.avif",Bs="/assets/back-CkvHV39y.avif";function mu(o){return(o.includes(":")?o.split(":")[1]:o).trim()}function Sa(o){const t=new Dr(o);return t.needsUpdate=!0,"colorSpace"in t?t.colorSpace=ot:t.encoding=void 0,t.anisotropy=8,t.wrapS=sn,t.wrapT=sn,t}function Ma(o){return new Promise((t,r)=>{const l=new Image;l.crossOrigin="anonymous",l.onload=()=>t(l),l.onerror=n=>r(n),l.src=o})}const vu=Object.assign({"/src/assets/image/test0/103_converted.avif":Bc,"/src/assets/image/test0/106_converted.avif":Ic,"/src/assets/image/test0/108_converted.avif":Oc,"/src/assets/image/test0/1_converted.avif":zc,"/src/assets/image/test0/2_converted.avif":Gc,"/src/assets/image/test0/32_converted.avif":Wc,"/src/assets/image/test0/35_converted.avif":Vc,"/src/assets/image/test0/44_converted.avif":Hc,"/src/assets/image/test0/55_converted.avif":Nc,"/src/assets/image/test0/61_converted.avif":jc,"/src/assets/image/test0/65_converted.avif":qc,"/src/assets/image/test0/66_converted.avif":Yc,"/src/assets/image/test0/67_converted.avif":Xc,"/src/assets/image/test0/82_converted.avif":Qc,"/src/assets/image/test0/90_converted.avif":Kc,"/src/assets/image/test0/97_converted.avif":Zc,"/src/assets/image/test0/back.avif":Rs,"/src/assets/image/test1/1_converted copy 2.avif":Jc,"/src/assets/image/test1/1_converted copy.avif":$c,"/src/assets/image/test1/1_converted.avif":el,"/src/assets/image/test1/26_converted copy 2.avif":tl,"/src/assets/image/test1/26_converted copy.avif":nl,"/src/assets/image/test1/26_converted.avif":ol,"/src/assets/image/test1/33_converted copy 2.avif":rl,"/src/assets/image/test1/33_converted copy.avif":al,"/src/assets/image/test1/33_converted.avif":sl,"/src/assets/image/test1/3_converted copy 2.avif":il,"/src/assets/image/test1/3_converted copy.avif":cl,"/src/assets/image/test1/3_converted.avif":ll,"/src/assets/image/test1/40_converted copy 2.avif":ul,"/src/assets/image/test1/40_converted copy.avif":fl,"/src/assets/image/test1/40_converted.avif":dl,"/src/assets/image/test1/54_converted copy 2.avif":hl,"/src/assets/image/test1/54_converted copy.avif":pl,"/src/assets/image/test1/54_converted.avif":gl,"/src/assets/image/test1/57_converted copy 2.avif":ml,"/src/assets/image/test1/57_converted copy.avif":vl,"/src/assets/image/test1/57_converted.avif":yl,"/src/assets/image/test1/59_converted copy 2.avif":wl,"/src/assets/image/test1/59_converted copy.avif":bl,"/src/assets/image/test1/59_converted.avif":_l,"/src/assets/image/test1/5_converted copy 2.avif":xl,"/src/assets/image/test1/5_converted copy.avif":Sl,"/src/assets/image/test1/5_converted.avif":Ml,"/src/assets/image/test1/73_converted copy 2.avif":Cl,"/src/assets/image/test1/73_converted copy.avif":Al,"/src/assets/image/test1/73_converted.avif":Tl,"/src/assets/image/test1/88_converted copy 2.avif":kl,"/src/assets/image/test1/88_converted copy.avif":Fl,"/src/assets/image/test1/88_converted.avif":Ul,"/src/assets/image/test1/89_converted copy 2.avif":Ll,"/src/assets/image/test1/89_converted copy.avif":Dl,"/src/assets/image/test1/89_converted.avif":Rl,"/src/assets/image/test1/93_converted copy 2.avif":Pl,"/src/assets/image/test1/93_converted copy.avif":El,"/src/assets/image/test1/93_converted.avif":Bl,"/src/assets/image/test1/9_converted copy 2.avif":Il,"/src/assets/image/test1/9_converted copy.avif":Ol,"/src/assets/image/test1/9_converted.avif":zl,"/src/assets/image/test1/back.avif":Ps,"/src/assets/image/test2/102_converted.avif":Gl,"/src/assets/image/test2/23_converted.avif":Wl,"/src/assets/image/test2/94_converted.avif":Vl,"/src/assets/image/test2/back.avif":Es,"/src/assets/image/test3/11233 copy.avif":Hl,"/src/assets/image/test3/11233.avif":Nl,"/src/assets/image/test3/12300 copy.avif":jl,"/src/assets/image/test3/12300.avif":ql,"/src/assets/image/test3/123001 copy.avif":Yl,"/src/assets/image/test3/123001.avif":Xl,"/src/assets/image/test3/21888 copy.avif":Ql,"/src/assets/image/test3/21888.avif":Kl,"/src/assets/image/test3/44422 copy.avif":Zl,"/src/assets/image/test3/44422.avif":Jl,"/src/assets/image/test3/444334 copy.avif":$l,"/src/assets/image/test3/444334.avif":eu,"/src/assets/image/test3/444411 copy.avif":tu,"/src/assets/image/test3/444411.avif":nu,"/src/assets/image/test3/55111 copy.avif":ou,"/src/assets/image/test3/55111.avif":ru,"/src/assets/image/test3/55544 copy.avif":au,"/src/assets/image/test3/55544.avif":su,"/src/assets/image/test3/88189 copy.avif":iu,"/src/assets/image/test3/88189.avif":cu,"/src/assets/image/test3/909394 copy.avif":lu,"/src/assets/image/test3/909394.avif":uu,"/src/assets/image/test3/923999 copy.avif":fu,"/src/assets/image/test3/923999.avif":du,"/src/assets/image/test3/9995 copy.avif":hu,"/src/assets/image/test3/9995.avif":pu,"/src/assets/image/test3/asdf.avif":gu,"/src/assets/image/test3/back.avif":Bs}),yu=Object.assign({"/src/assets/image/test0/back.avif":Rs,"/src/assets/image/test1/back.avif":Ps,"/src/assets/image/test2/back.avif":Es,"/src/assets/image/test3/back.avif":Bs}),Ca=new Map;async function Rn(o,t){const r=Ca.get(o);if(r)return r;const l=mu(o),n=[];for(const[h,g]of Object.entries(vu)){const v=h.split("/"),b=v[v.length-2],m=v[v.length-1].toLowerCase();b===l&&!m.startsWith("back.")&&n.push(g)}n.sort((h,g)=>{const v=h.split("/").pop()??h,b=g.split("/").pop()??g;return v.localeCompare(b,void 0,{numeric:!0,sensitivity:"base"})});let e=null;for(const[h,g]of Object.entries(yu)){const v=h.split("/");if(v[v.length-2]===l){e=g;break}}e||(e=Er);const a=n.length+1;let i=0;const s=()=>t?.(++i,a),c=await Ma(e).catch(()=>null);s();const u=c?Sa(c):new Dr,f=[];for(const h of n)try{const g=await Ma(h),v=Math.max((g.naturalWidth||1)/Math.max(g.naturalHeight||1,1),.05);f.push({url:h,texture:Sa(g),aspect:v,widthPx:g.naturalWidth||0,heightPx:g.naturalHeight||0})}catch{}finally{s()}const d={id:o,folder:l,fronts:f,back:u};return Ca.set(o,d),d}async function wu(o,t={}){const{THREE:r,scene:l}=o,n=t.autoReveal!==!1,e=t.startButtonId??"boot-start",a=document.getElementById("boot"),i=document.getElementById("viewport"),s=document.getElementById("bootPercent"),c=document.getElementById(e);!n&&c&&(c.disabled=!0,c.setAttribute("aria-disabled","true"));const u=M=>{const w=Math.max(0,Math.min(100,Math.round(M)));s.textContent=String(w)+"%"};let f=0,d=0;const h=r.DefaultLoadingManager;h.onStart=(M,w,C)=>{d=C||0,f=w||0},h.onProgress=(M,w,C)=>{f=w||0,d=C||0,b()},h.onLoad=()=>{f=d,b()},h.onError=M=>console.warn("[loader] error:",M);let g=0,v=0;function b(){const M=d>0?f/Math.max(1,d):0,w=v>0?g/Math.max(1,v):0,F=100*(d>0&&v>0?.5*M+.5*w:Math.max(M,w));u(F)}const m=Dn?.()??"fallback:ring",p=(async()=>Rn(m,(M,w)=>{g=M,v=w,b()}))(),[x]=await Promise.all([p]),y={};if(t.extras?.length){const M=await Promise.all(t.extras.map(async w=>await w(o)||{}));for(const w of M)Object.assign(y,w)}s.classList.add("hidden"),u(100);const _=()=>{a.classList.contains("hidden")||(a.classList.add("hidden"),i.classList.remove("hidden"),window.__APP_READY__=!0,document.dispatchEvent(new Event("appready")))};if(n)_();else if(c){(()=>{c.disabled=!1,c.removeAttribute("aria-disabled"),c.focus?.()})();const w=()=>{c.removeEventListener("click",w),c.removeEventListener("keydown",C),_()},C=F=>{(F.key==="Enter"||F.key===" ")&&(F.preventDefault(),w())};c.addEventListener("click",w,{once:!0}),c.addEventListener("keydown",C)}else console.warn(`[boot] start button id "${e}" not found; revealing automatically.`),_();return{deck:x,extras:y,reveal:_}}function mr(o,t){const r=new A().copy(nt),l=o.distanceTo(r),n=t.distanceTo(r),e=new A().subVectors(r,o).normalize(),a=new A().subVectors(r,t).normalize(),i=Math.min(1,.45*l),s=Math.min(1,.15*n),c=new A().copy(o).addScaledVector(e,i),u=new A().copy(t).addScaledVector(a,s),f=.12*(l+n);return c.y+=f*.25,u.y+=f*.1,{p0:o.clone(),p1:c,p2:u,p3:t.clone()}}function Is(o,t){const r=new cn;return r.position.set(0,0,-t),o.add(r),r}function Os(o,t){o.updateWorldMatrix(!0,!1),o.attach(t),t.position.set(0,0,0),t.quaternion.identity()}function Or(o,t){const r=De.degToRad(o.fov),l=2*Math.tan(r/2)*t;return{viewW:l*o.aspect,viewH:l}}function bu(o){return Math.max(.05,(o.cardWidth??$e)/$e)}function Aa(o,t,r,l,n){const{viewW:e,viewH:a}=Or(t,r),i=bu(o),s=a*l/$e,c=e*l/($e*i);return n==="height"?s:Math.min(s,c)}const zs=o=>o<.5?4*o*o*o:1-Math.pow(-2*o+2,3)/2;function _u(o,t,r,l,n,e=new A){const a=1-n,i=a*a*a,s=3*a*a*n,c=3*a*n*n,u=n*n*n;return e.set(0,0,0).addScaledVector(o,i).addScaledVector(t,s).addScaledVector(r,c).addScaledVector(l,u)}function Gs(o,t,r){t.t+=r;const l=Math.min(1,t.t/Math.max(1e-6,t.dur)),n=zs(l),e=_u(t.curve.p0,t.curve.p1,t.curve.p2,t.curve.p3,n),a=new Ne().copy(t.fromQuat).slerp(t.toQuat,n),i=De.lerp(t.fromScale,t.toScale,n);return o.position.copy(e),o.quaternion.copy(a),o.scale.setScalar(i),l>=1}const vr=new Set,xu=new Set;function Su(o){for(const t of vr)t(o)}function Mu(o){for(const t of xu)t(o)}function Cu(o){return vr.add(o),()=>vr.delete(o)}function Au({camera:o,scene:t,renderer:r,system:l,options:n={}}){const e={distance:n.distance??.8,margin:n.margin??1,fitMode:n.fitMode??"contain",animDur:n.animDur??1.2},a=new Set,i=Is(o,e.distance),s=m=>m.getWorldPosition(new A),c=m=>m.getWorldQuaternion(new Ne);function u(m,p,x,y,_,M){const w=c(m.group),C=m.group.scale.x;m._anim={t:0,dur:_,curve:p,fromQuat:w,toQuat:x.clone(),fromScale:C,toScale:y},m._onAnimDone=M,a.add(m)}function f(m){if(a.size)for(const p of Array.from(a)){const x=p._anim;if(!x){a.delete(p);continue}p.group.parent!==t&&t.add(p.group);const y=Gs(p.group,x,m);if(p.trail.visible=!0,to(p,m,!0,o),y){a.delete(p),p._anim=void 0;const _=p._onAnimDone;p._onAnimDone=void 0,_?.()}}}function d(m){if(yt.isModalActive())return;Su(m),m._preFocusQuat=c(m.group).clone(),m.velocity.set(0,0,0),m.angular.set(0,0,0),m.state="homing",m.opacity=1,m.mode="focus_in";const p=s(m.group),x=o.getWorldPosition(new A),y=o.getWorldDirection(new A),_=x.clone().add(y.multiplyScalar(e.distance)),M=o.getWorldQuaternion(new Ne),w=Aa(m,o,e.distance,e.margin,e.fitMode),C=mr(p,_);m.trail.visible=!0,u(m,C,M,w,e.animDur,()=>{Os(i,m.group),m.group.scale.setScalar(w),m.mode="focused",to(m,0,!1,o)})}function h(m){Mu(m);const p=s(m.group),x=c(m.group),y=m.group.scale.x;m.group.parent!==t&&(t.add(m.group),m.group.position.copy(p),m.group.quaternion.copy(x),m.group.scale.setScalar(y));const _=fo(m.targetLocal);m.mode="focus_out",m.trail.visible=!0;const M=mr(p,_),w=m._preFocusQuat?.clone()??x.clone();u(m,M,w,ft(),e.animDur,()=>{m.mode="normal",m.state="homing",m.velocity.set(0,0,0),m.angular.set(0,0,0)})}function g(m){if(!yt.isModalActive())if(m.mode==="focused"||m.mode==="focus_in")h(m);else{for(const p of l.cards)p!==m&&(p.mode==="focused"||p.mode==="focus_in")&&h(p);d(m)}}function v(){for(const m of l.cards)if(m._anim=void 0,m._onAnimDone=void 0,m.mode&&m.mode!=="normal"){const p=s(m.group),x=c(m.group),y=m.group.scale.x;m.group.parent!==t&&t.add(m.group),m.group.position.copy(p),m.group.quaternion.copy(x),m.group.scale.setScalar(y),m.mode="normal",m.state="homing",m.velocity.set(0,0,0),m.angular.set(0,0,0)}}const b=()=>{for(const m of l.cards)if(m.mode==="focused"&&!m._anim){const p=Aa(m,o,e.distance,e.margin,e.fitMode);m.group.scale.setScalar(p)}};return window.addEventListener("resize",b),{update(m){for(const p of l.cards)p.mode==="focused"&&!p._anim&&p.trail.visible&&to(p,m,!1,o);f(m)},clear:v,dispose(){window.removeEventListener("resize",b),v(),i.parent&&i.parent.remove(i)},focus:d,release:h,toggle:g}}function Tu({camera:o,renderer:t,system:r,onCardClick:l}){const n=new fs,e=new oe,a=new Map;let i=null;function s(x,y,_=0){return a.set(x,{onClick:y,priority:_}),()=>a.delete(x)}function c(x,y){i={root:x,onOutsideClick:y}}function u(x){i&&(!x||i.root===x)&&(i=null)}function f(x){let y=x;for(;y;){const _=r.cards.find(M=>M.group===y);if(_)return _;y=y.parent}return null}function d(x,y){const _=t.domElement.getBoundingClientRect();e.set((x-_.left)/_.width*2-1,-((y-_.top)/_.height)*2+1)}function h(x,y){d(x,y),n.setFromCamera(e,o);const _=Array.from(a.keys()),M=r.cards.map(w=>w.group);return n.intersectObjects([..._,...M],!0)}function g(x){let y=null;for(const _ of x){let M=_.object;for(;M;){const w=a.get(M);if(w){const C={entry:w,hit:_,distance:_.distance};(!y||w.priority>y.entry.priority||w.priority===y.entry.priority&&_.distance<y.distance)&&(y=C);break}M=M.parent}}return y?(y.entry.onClick(y.hit),!0):!1}function v(x){for(const y of x){const _=f(y.object);if(_)return l(_),!0}return!1}function b(x){const y=h(x.clientX,x.clientY);if(!y.length){yt.isModalActive()&&i&&i.onOutsideClick();return}if(yt.isModalActive()&&i){if(y.find(M=>{let w=M.object;for(;w;){if(w===i.root)return!0;w=w.parent}return!1})){g(y);return}i.onOutsideClick();return}g(y)||v(y)}t.domElement.addEventListener("click",b);function m(){t.domElement.removeEventListener("click",b),a.clear(),i=null}function p(x,y){const _=h(x,y);if(!_.length)return null;let M=null;for(const w of _){let C=w.object;for(;C;){const F=a.get(C);if(F){const k={entry:F,hit:w,distance:w.distance};(!M||F.priority>M.entry.priority||F.priority===M.entry.priority&&w.distance<M.distance)&&(M=k);break}C=C.parent}}if(M)return{type:"registered",hit:M.hit,handler:M.entry.onClick};for(const w of _){const C=f(w.object);if(C)return{type:"card",hit:w,card:C}}return null}return{register:s,dispose:m,pick:p,setModalOverlay:c,clearModalOverlay:u}}const yt=(()=>{let o=null;return{enableModal(t){o=t},disableModal(t){o===t&&(o=null)},isModalActive(){return o!==null},who(){return o}}})();function ku({camera:o,scene:t,renderer:r,system:l}){const n=Au({camera:o,scene:t,renderer:r,system:l,options:{distance:.8,margin:.65,fitMode:"contain",animDur:.75}}),e=Tu({camera:o,renderer:r,system:l,onCardClick:s=>{yt.isModalActive()||n.toggle(s)}});function a(s,c){n.clear?.(),yt.enableModal("infoCard"),e.setModalOverlay?.(s,c)}function i(s){e.clearModalOverlay?.(s),yt.disableModal("infoCard")}return{update(s){n.update(s)},clear(){n.clear()},dispose(){e.dispose(),n.dispose()},registerObject(s,c,u=0){return e.register(s,()=>c(),u)},startModal:a,endModal:i,_focus:n}}function Fu(o,t=200){let r=null;return{system:{id:"io.interactions",priority:t,init(n){const e=ku({camera:n.camera,scene:n.scene,renderer:n.renderer,system:o?.getSystem?.()});r={update:i=>e.update?.(i),registerObject:(i,s)=>e.registerObject?.(i,s)??(()=>{}),startModal:e.startModal?(i,s)=>e.startModal(i,s):()=>{},endModal:e.endModal?i=>e.endModal(i):()=>{},clear:e.clear?()=>e.clear():()=>{}}},update(n){r?.update(n)},dispose(){r=null}},get:()=>r}}function Uu(o){const{system:t,getDeckLength:r,camera:l,morphDuration:n=.75}=o;let e=null;function a(){const u=Math.max(0,r()|0),f=Ds(u),d=e??f??t.cards.length;return Math.max(0,Math.min(d|0,u|0))}function i(){const u=a(),f=t.cards.length|0;return u===f?!1:(t.ensureCardCount(u),!0)}function s(){t.prepareHeartTargets?.()}function c(){t.morphToNewTargets?.(l,{duration:n})}return{sync(u){const f=i();return s(),u?.morph&&c(),f},setManualCount(u){e=u,i(),s(),c()},onPatternChanged(){i(),s(),c()},getManualCount(){return e},getDesiredCount(){return a()}}}function Kn(o){return o<.5?4*o*o*o:1-Math.pow(-2*o+2,3)/2}function Ta(o,t,r,l){return o<=t?0:o>=r?1:l((o-t)/Math.max(1e-9,r-t))}class Lu{N=0;u;v;theta0;R;omega;gP0;gV0;gP1;gV1;gDur;dP0;dV0;dP1;dV1;dDur;alpha;isNew;isRemove;seedR;seedSp;seedWag;seedBank;seedPulse;pulsePhase;center=new A;tGather=0;tOrbit=0;tDeal=0;alloc(t){const r=l=>new Float32Array(l*3);this.N=t,this.u=r(t),this.v=r(t),this.theta0=new Float32Array(t),this.R=new Float32Array(t),this.omega=new Float32Array(t),this.gP0=r(t),this.gV0=r(t),this.gP1=r(t),this.gV1=r(t),this.gDur=new Float32Array(t),this.dP0=r(t),this.dV0=r(t),this.dP1=r(t),this.dV1=r(t),this.dDur=new Float32Array(t),this.alpha=new Float32Array(t),this.isNew=new Uint8Array(t),this.isRemove=new Uint8Array(t),this.seedR=new Float32Array(t),this.seedSp=new Float32Array(t),this.seedWag=new Float32Array(t),this.seedBank=new Float32Array(t),this.seedPulse=new Float32Array(t),this.pulsePhase=new Float32Array(t),this.tGather=0,this.tOrbit=0,this.tDeal=0}ensure(t){this.alloc(t),this.isNew.fill(0),this.isRemove.fill(0),this.alpha.fill(1),this.tGather=0,this.tOrbit=0,this.tDeal=0}get3(t,r,l=new A){const n=r*3;return l.set(t[n],t[n+1],t[n+2])}set3(t,r,l){const n=r*3;t[n]=l.x,t[n+1]=l.y,t[n+2]=l.z}}const Ws=.2,Vs=.015,ka=300,Du=500,Ru=50,It=.1,Fa=.5,Pu=.3,Eu=.1,Bu=1,_t={rAmp:.8,rFreq:.18,speedAmp:.15,speedFreq:.12,wagAmp:.08,wagFreq:.27,bankAmp:.25,bankFreq:.2,pulseAmp:.035,pulseFreq:.35},No=o=>Math.max(0,Math.min(1,o)),qe={v0:new A,v1:new A,v2:new A,v3:new A,v4:new A,v5:new A,q0:new Ne,q1:new Ne},Iu=.5*(Math.sqrt(3)-1),Sn=(3-Math.sqrt(3))/6,Ou=1/3,xt=1/6,zu=(Math.sqrt(5)-1)/4,et=(5-Math.sqrt(5))/20,Ze=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),Qe=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);class _o{constructor(t=Math.random){const r=typeof t=="function"?t:Wu(t);this.p=Gu(r),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let l=0;l<512;l++)this.perm[l]=this.p[l&255],this.permMod12[l]=this.perm[l]%12}noise2D(t,r){const l=this.permMod12,n=this.perm;let e=0,a=0,i=0;const s=(t+r)*Iu,c=Math.floor(t+s),u=Math.floor(r+s),f=(c+u)*Sn,d=c-f,h=u-f,g=t-d,v=r-h;let b,m;g>v?(b=1,m=0):(b=0,m=1);const p=g-b+Sn,x=v-m+Sn,y=g-1+2*Sn,_=v-1+2*Sn,M=c&255,w=u&255;let C=.5-g*g-v*v;if(C>=0){const D=l[M+n[w]]*3;C*=C,e=C*C*(Ze[D]*g+Ze[D+1]*v)}let F=.5-p*p-x*x;if(F>=0){const D=l[M+b+n[w+m]]*3;F*=F,a=F*F*(Ze[D]*p+Ze[D+1]*x)}let k=.5-y*y-_*_;if(k>=0){const D=l[M+1+n[w+1]]*3;k*=k,i=k*k*(Ze[D]*y+Ze[D+1]*_)}return 70*(e+a+i)}noise3D(t,r,l){const n=this.permMod12,e=this.perm;let a,i,s,c;const u=(t+r+l)*Ou,f=Math.floor(t+u),d=Math.floor(r+u),h=Math.floor(l+u),g=(f+d+h)*xt,v=f-g,b=d-g,m=h-g,p=t-v,x=r-b,y=l-m;let _,M,w,C,F,k;p>=x?x>=y?(_=1,M=0,w=0,C=1,F=1,k=0):p>=y?(_=1,M=0,w=0,C=1,F=0,k=1):(_=0,M=0,w=1,C=1,F=0,k=1):x<y?(_=0,M=0,w=1,C=0,F=1,k=1):p<y?(_=0,M=1,w=0,C=0,F=1,k=1):(_=0,M=1,w=0,C=1,F=1,k=0);const D=p-_+xt,T=x-M+xt,R=y-w+xt,U=p-C+2*xt,j=x-F+2*xt,z=y-k+2*xt,X=p-1+3*xt,V=x-1+3*xt,P=y-1+3*xt,O=f&255,S=d&255,L=h&255;let E=.6-p*p-x*x-y*y;if(E<0)a=0;else{const G=n[O+e[S+e[L]]]*3;E*=E,a=E*E*(Ze[G]*p+Ze[G+1]*x+Ze[G+2]*y)}let I=.6-D*D-T*T-R*R;if(I<0)i=0;else{const G=n[O+_+e[S+M+e[L+w]]]*3;I*=I,i=I*I*(Ze[G]*D+Ze[G+1]*T+Ze[G+2]*R)}let B=.6-U*U-j*j-z*z;if(B<0)s=0;else{const G=n[O+C+e[S+F+e[L+k]]]*3;B*=B,s=B*B*(Ze[G]*U+Ze[G+1]*j+Ze[G+2]*z)}let Q=.6-X*X-V*V-P*P;if(Q<0)c=0;else{const G=n[O+1+e[S+1+e[L+1]]]*3;Q*=Q,c=Q*Q*(Ze[G]*X+Ze[G+1]*V+Ze[G+2]*P)}return 32*(a+i+s+c)}noise4D(t,r,l,n){const e=this.perm;let a,i,s,c,u;const f=(t+r+l+n)*zu,d=Math.floor(t+f),h=Math.floor(r+f),g=Math.floor(l+f),v=Math.floor(n+f),b=(d+h+g+v)*et,m=d-b,p=h-b,x=g-b,y=v-b,_=t-m,M=r-p,w=l-x,C=n-y;let F=0,k=0,D=0,T=0;_>M?F++:k++,_>w?F++:D++,_>C?F++:T++,M>w?k++:D++,M>C?k++:T++,w>C?D++:T++;const R=F>=3?1:0,U=k>=3?1:0,j=D>=3?1:0,z=T>=3?1:0,X=F>=2?1:0,V=k>=2?1:0,P=D>=2?1:0,O=T>=2?1:0,S=F>=1?1:0,L=k>=1?1:0,E=D>=1?1:0,I=T>=1?1:0,B=_-R+et,Q=M-U+et,G=w-j+et,q=C-z+et,le=_-X+2*et,re=M-V+2*et,Z=w-P+2*et,ee=C-O+2*et,Me=_-S+3*et,Se=M-L+3*et,de=w-E+3*et,ce=C-I+3*et,fe=_-1+4*et,te=M-1+4*et,se=w-1+4*et,W=C-1+4*et,Y=d&255,N=h&255,ne=g&255,J=v&255;let K=.6-_*_-M*M-w*w-C*C;if(K<0)a=0;else{const pe=e[Y+e[N+e[ne+e[J]]]]%32*4;K*=K,a=K*K*(Qe[pe]*_+Qe[pe+1]*M+Qe[pe+2]*w+Qe[pe+3]*C)}let we=.6-B*B-Q*Q-G*G-q*q;if(we<0)i=0;else{const pe=e[Y+R+e[N+U+e[ne+j+e[J+z]]]]%32*4;we*=we,i=we*we*(Qe[pe]*B+Qe[pe+1]*Q+Qe[pe+2]*G+Qe[pe+3]*q)}let me=.6-le*le-re*re-Z*Z-ee*ee;if(me<0)s=0;else{const pe=e[Y+X+e[N+V+e[ne+P+e[J+O]]]]%32*4;me*=me,s=me*me*(Qe[pe]*le+Qe[pe+1]*re+Qe[pe+2]*Z+Qe[pe+3]*ee)}let ge=.6-Me*Me-Se*Se-de*de-ce*ce;if(ge<0)c=0;else{const pe=e[Y+S+e[N+L+e[ne+E+e[J+I]]]]%32*4;ge*=ge,c=ge*ge*(Qe[pe]*Me+Qe[pe+1]*Se+Qe[pe+2]*de+Qe[pe+3]*ce)}let he=.6-fe*fe-te*te-se*se-W*W;if(he<0)u=0;else{const pe=e[Y+1+e[N+1+e[ne+1+e[J+1]]]]%32*4;he*=he,u=he*he*(Qe[pe]*fe+Qe[pe+1]*te+Qe[pe+2]*se+Qe[pe+3]*W)}return 27*(a+i+s+c+u)}}function Gu(o){const t=new Uint8Array(256);for(let r=0;r<256;r++)t[r]=r;for(let r=0;r<255;r++){const l=r+~~(o()*(256-r)),n=t[r];t[r]=t[l],t[l]=n}return t}function Wu(o){let t=0,r=0,l=0,n=1;const e=Vu();return t=e(" "),r=e(" "),l=e(" "),t-=e(o),t<0&&(t+=1),r-=e(o),r<0&&(r+=1),l-=e(o),l<0&&(l+=1),function(){const a=2091639*t+n*23283064365386963e-26;return t=r,r=l,l=a-(n=a|0)}}function Vu(){let o=4022871197;return function(t){t=t.toString();for(let r=0;r<t.length;r++){o+=t.charCodeAt(r);let l=.02519603282416938*o;o=l>>>0,l-=o,l*=o,o=l>>>0,l-=o,o+=l*4294967296}return(o>>>0)*23283064365386963e-26}}const Hu=new _o("orbit-2595");function no(o,t){return Hu.noise2D(o,t)}function Nu(o,t){return .5+.5*no(o,t)}function kt(o){let t=(o>>>0)*2654435761;return t^=t<<13,t^=t>>>17,t^=t<<5,(t>>>0)%268435455/268435455}function ju(o,t){const r=(1+Math.sqrt(5))*.5,l=2*Math.PI*(o/r),n=1-(2*o+1)/t,e=Math.sqrt(Math.max(0,1-n*n));return new A(e*Math.cos(l),n,e*Math.sin(l)).normalize()}function Hs(o){const t=Math.abs(o.y)<.9?new A(0,1,0):new A(1,0,0),r=new A().crossVectors(t,o).normalize(),l=new A().crossVectors(o,r).normalize();return{u:r,v:l}}function ho(o,t,r){const l=new Ne().setFromAxisAngle(t,r);return o.clone().applyQuaternion(l)}function qu(o,t){if(!(o.length<2))for(let r=0;r<Bu;r++)for(let l=0;l<o.length;l++)for(let n=l+1;n<o.length;n++){const e=o[l],a=o[n],i=De.clamp(e.dot(a),-1,1),s=Math.acos(i);if(s<t){const c=new A().crossVectors(e,a);if(c.lengthSq()<1e-8){const f=Hs(e).u;c.copy(f)}else c.normalize();const u=(t-s)*.5;o[l].copy(ho(e,c,-u)).normalize(),o[n].copy(ho(a,c,+u)).normalize()}}}function Ua(o){const t=[];for(let s=0;s<o;s++)t.push(ju(s,Math.max(1,o)));qu(t,De.degToRad(Eu));const r=new Array(o),l=new Array(o),n=new Array(o),e=new Float32Array(o),a=new Float32Array(o),i=new Float32Array(o);for(let s=0;s<o;s++){const c=t[s],{u,v:f}=Hs(c),d=(kt(s+71)-.5)*Math.PI,h=ho(u,c,d),g=ho(f,c,d),v=c.dot(h),b=c.dot(g),m=Math.atan2(b,v),p=kt(s)<.5?-1:1,x=(19+3*(kt(s+17)-.5))*p,y=Ws+Vs+Pu*(kt(s+33)-.5),M=g.clone().multiplyScalar(Math.cos(m)).addScaledVector(h,-Math.sin(m)).normalize().multiplyScalar(Math.sign(x)||1);r[s]=h,l[s]=g,e[s]=m,a[s]=y,i[s]=x,n[s]=M}return{u:r,v:l,theta0:e,R:a,omega:i,tMoveDir:n}}function jo(o,t){const l=o.clone().normalize(),n=new A().crossVectors(t,l).normalize(),e=new A().crossVectors(l,n).normalize(),a=new wt().makeBasis(n,e,l);return new Ne().setFromRotationMatrix(a)}function en(o,t){const r=De.clamp(t,0,1);o.traverse(l=>{if(!l?.isMesh)return;const n=Array.isArray(l.material)?l.material:[l.material];for(const e of n)e&&typeof e.opacity=="number"&&(e.opacity=r,"depthWrite"in e&&(e.depthWrite=r>=.999),e.needsUpdate=!1)})}function La(o,t,r,l,n,e=new A){const a=n*n,i=a*n,s=2*i-3*a+1,c=i-2*a+n,u=-2*i+3*a,f=i-a;return e.copy(o).multiplyScalar(s).addScaledVector(t,c).addScaledVector(r,u).addScaledVector(l,f)}function qo(o,t){return Math.min(o.N,t.length)}function Yu(o){const t=Math.max(200,Ru),r=new Lu;let l=new Set,n=new Set;function e(a){r.seedR[a]=kt(a+101)*100+2,r.seedSp[a]=kt(a+102)*100+3,r.seedWag[a]=kt(a+103)*100+4,r.seedBank[a]=kt(a+104)*100+5,r.seedPulse[a]=kt(a+105)*Math.PI*2,r.pulsePhase[a]=r.seedPulse[a]}return{name:"orbit-sphere-SoA",preallocate(a){r.ensure(Math.max(0,a|0))},beginGather(a){Tn(!0);const i=a.cards(),s=i.length;r.ensure(s),r.center.copy(nt);const c=Ua(s);for(let u=0;u<s;u++){const f=i[u];if(!f)continue;f.mode="transition",f.trail.visible=!1,r.u.set([c.u[u].x,c.u[u].y,c.u[u].z],u*3),r.v.set([c.v[u].x,c.v[u].y,c.v[u].z],u*3),r.theta0[u]=c.theta0[u],r.R[u]=c.R[u],r.omega[u]=c.omega[u];const d=c.u[u],h=c.v[u],g=c.theta0[u],v=c.R[u],b=new A().copy(r.center).addScaledVector(d,Math.cos(g)*v).addScaledVector(h,Math.sin(g)*v),p=h.clone().multiplyScalar(Math.cos(g)).addScaledVector(d,-Math.sin(g)).normalize().multiplyScalar(Math.sign(c.omega[u])||1),x=f.group.getWorldPosition(new A),y=x.distanceTo(b),_=De.clamp(.35*y,.15*v,.6*v),C=b.clone().addScaledVector(p,-_).clone().sub(x).normalize().lerp(p,.6).normalize(),F=p.clone().multiplyScalar(Math.abs(c.omega[u])*v),k=C.multiplyScalar(F.length()*.9);r.gDur[u]=ka/1e3,r.set3(r.gP0,u,x),r.set3(r.gP1,u,b),r.set3(r.gV0,u,k),r.set3(r.gV1,u,F),f.group.scale.setScalar(ft()),en(f.group,1),e(u),r.isNew[u]=0,r.isRemove[u]=0,r.alpha[u]=1}l.clear(),n.clear(),r.tGather=0},updateGather(a,i){r.tGather+=i;const s=a.cards(),c=qo(r,s);if(c===0)return!0;for(let u=0;u<c;u++){const f=s[u];if(!f)continue;const d=Math.max(1e-6,r.gDur[u]),h=No(Math.min(1,r.tGather/d)),g=r.get3(r.gP0,u,qe.v0),v=r.get3(r.gP1,u,qe.v1),b=r.get3(r.gV0,u,qe.v2),m=r.get3(r.gV1,u,qe.v3),p=La(g,b,v,m,h,qe.v0);f.group.position.copy(p);const x=m.clone().normalize();qe.q0.copy(f.group.quaternion),qe.q1.copy(jo(new A().subVectors(r.center,p),x)),f.group.quaternion.copy(qe.q0.slerp(qe.q1,h)),f.group.scale.setScalar(ft());const y=De.lerp(1,It,Kn(h));Math.abs(y-r.alpha[u])>.001&&(en(f.group,y),r.alpha[u]=y)}return r.tGather>=ka/1e3},beginShuffle(a){const i=a.cards().length|0,s=Math.max(0,a.targetCount|0);if(l.clear(),n.clear(),s<i){const d=i-s,h=a.cards();for(let g=0;g<d;g++){const v=h[h.length-1-g];v&&l.add(v)}}else s>i&&a.system.ensureCardCount(s,{quiet:!0});const c=a.cards(),u=c.length,f=Ua(u);for(let d=i;d<u;d++){const h=c[d];h&&n.add(h)}r.ensure(u),r.center.copy(nt);for(let d=0;d<u;d++){const h=c[d];h&&(h.mode="transition",h.trail.visible=!1,r.u.set([f.u[d].x,f.u[d].y,f.u[d].z],d*3),r.v.set([f.v[d].x,f.v[d].y,f.v[d].z],d*3),r.theta0[d]=f.theta0[d],r.R[d]=f.R[d],r.omega[d]=f.omega[d],e(d),n.has(h)?(r.isNew[d]=1,r.alpha[d]=0,en(h.group,0)):(r.isNew[d]=0,r.alpha[d]=It,en(h.group,It)),r.isRemove[d]=l.has(h)?1:0,h.group.scale.setScalar(ft()))}r.tOrbit=0},updateShuffle(a,i){r.tOrbit+=i;const s=t/1e3,c=No(r.tOrbit/s),u=a.cards(),f=qo(r,u);if(f===0)return!0;for(let h=0;h<f;h++){const g=u[h];if(!g)continue;const v=r.get3(r.u,h,qe.v0),b=r.get3(r.v,h,qe.v1),m=qe.v4.copy(v).cross(b).normalize(),p=r.R[h],x=r.theta0[h],y=r.omega[h],_=r.tOrbit,M=_t.rAmp*no(r.seedR[h],_t.rFreq*_),w=Math.max(Ws+Vs*.5,p*(1+M)),C=1+_t.speedAmp*no(r.seedSp[h],_t.speedFreq*_),F=x+y*C*_,k=new A().copy(r.center).addScaledVector(v,Math.cos(F)*w).addScaledVector(b,Math.sin(F)*w),D=_t.wagAmp*no(r.seedWag[h],_t.wagFreq*_);k.addScaledVector(m,D);const R=qe.v5.copy(b).multiplyScalar(Math.cos(F)).addScaledVector(v,-Math.sin(F)).normalize().multiplyScalar(Math.sign(y)||1),U=_t.bankAmp*Nu(r.seedBank[h],_t.bankFreq*_),j=R.clone().multiplyScalar(1-U).addScaledVector(m,U).normalize();g.group.position.copy(k),g.group.quaternion.copy(jo(new A().subVectors(r.center,k),j));const z=1+_t.pulseAmp*Math.sin(2*Math.PI*_t.pulseFreq*_+r.pulsePhase[h]);g.group.scale.setScalar(ft()*z);let X=It;if(r.isRemove[h]){const V=Ta(c,1-Fa,1,Kn);X=It*(1-V)}else if(r.isNew[h]){const V=Ta(c,0,Fa,Kn);X=It*V}Math.abs(X-r.alpha[h])>.001&&(en(g.group,X),r.alpha[h]=X)}const d=c>=1;return d&&l.size&&a.system.ensureCardCount(a.targetCount,{quiet:!0}),d},beginDeal(a){const i=a.cards(),s=i.length;r.tDeal=0,a.system.prepareHeartTargets?.(),a.applyImmediateFit?.(),a.system.prepareHeartTargets?.(),r.N;for(let c=0;c<s;c++){const u=i[c];if(!u)continue;const f=r.get3(r.u,c,qe.v0),d=r.get3(r.v,c,qe.v1),h=r.omega[c],g=r.R[c],v=u.group.getWorldPosition(qe.v0),b=v.clone().sub(r.center).normalize(),m=b.dot(f),p=b.dot(d),x=Math.atan2(p,m),M=d.clone().multiplyScalar(Math.cos(x)).addScaledVector(f,-Math.sin(x)).normalize().multiplyScalar(Math.sign(h)||1).clone().multiplyScalar(Math.abs(h)*g),w=gr(u.targetLocal.clone());r.set3(r.dP0,c,v),r.set3(r.dV0,c,M),r.set3(r.dP1,c,w),r.set3(r.dV1,c,new A(0,0,0)),r.dDur[c]=Du/1e3,u.trail.visible=!0,u.trail.material.opacity=.85}},updateDeal(a,i){r.tDeal+=i;const s=a.cards(),c=qo(r,s);if(c===0)return Tn(!1),!0;let u=!0;for(let f=0;f<c;f++){const d=s[f];if(!d)continue;const h=No(r.tDeal/Math.max(1e-6,r.dDur[f])),g=h,v=r.get3(r.dP0,f,qe.v0),b=r.get3(r.dV0,f,qe.v1),m=r.get3(r.dP1,f,qe.v2),p=r.get3(r.dV1,f,qe.v3),x=La(v,b,m,p,g,qe.v0);d.group.position.copy(x),qe.q0.copy(d.group.quaternion),qe.q1.copy(jo(new A().subVectors(nt,x),new A(0,1,0))),d.group.quaternion.copy(qe.q0.slerp(qe.q1,g)),d.group.scale.setScalar(ft());const y=De.lerp(It,1,Kn(h));Math.abs(y-r.alpha[f])>.001&&(en(d.group,y),r.alpha[f]=y),h<1&&(u=!1)}if(u){for(const f of a.cards())f.mode="normal",f.trail.material.opacity=.65,f.trail.visible=!0;Tn(!1)}return u}}}function Xu(o){const{system:t,camera:r,getDeckLength:l,applyImmediateFit:n}=o,e=o.strategy??Yu();let a="idle",i=new WeakMap,s=null;const c=new A,u=new Ne;function f(){c.copy(nt);const g=new Ne().setFromAxisAngle(new A(0,1,0),Math.PI);u.copy(r.quaternion).multiply(g)}function d(g){return{system:t,camera:r,deckLen:Math.max(0,l()|0),targetCount:g,deckAnchor:c,deckQuat:u,cards:()=>t.cards,markRemoving:()=>{},addNewlyAdded:()=>{},scratch:i,applyImmediateFit:n}}function h(){i=new WeakMap,s=null,a="idle"}return{isActive(){return a!=="idle"},preallocate(g){e.preallocate?.(g)},start(){if(a!=="idle")return;f();const g=Math.max(0,l()|0),v=Math.max(0,Math.min(Ds(g),g));s=d(v),Tn(!0),e.beginGather(s),a="gather"},update(g){if(s)switch(f(),a){case"gather":e.updateGather(s,g)&&(e.beginShuffle(s),a="shuffle");break;case"shuffle":e.updateShuffle(s,g)&&(e.beginDeal(s),a="deal");break;case"deal":if(e.updateDeal(s,g)){for(const v of t.cards)v.mode="normal";Tn(!1),h()}break}}}}const Qu=["TL","TR","BR","BL"],Zn=new ht({colorWrite:!1,depthWrite:!0,depthTest:!0});function Ku(o){const{radius:t=.2,tubularSegments:r=96,radialSegments:l=14,ropeSegments:n=20,gravity:e=1,damping:a=.1,stiffness:i=2,solverIters:s=6}=o||{},c=new dt;c.name="CornerConduits",c.matrixAutoUpdate=!1;const u=new ds({color:19878,transparent:!0,opacity:0,roughness:.85,metalness:.05,depthTest:!0,depthWrite:!1,side:Rr}),f={TL:new Ye(new Tt,u),TR:new Ye(new Tt,u),BR:new Ye(new Tt,u),BL:new Ye(new Tt,u)},d={TL:new Ye(f.TL.geometry,Zn),TR:new Ye(f.TR.geometry,Zn),BR:new Ye(f.BR.geometry,Zn),BL:new Ye(f.BL.geometry,Zn)};Object.values(d).forEach(w=>{w.frustumCulled=!1,c.add(w)}),Object.values(f).forEach(w=>{w.frustumCulled=!1,c.add(w)});const h={TL:{nodes:[],prev:[],rest:0,segments:n,alive:!1},TR:{nodes:[],prev:[],rest:0,segments:n,alive:!1},BR:{nodes:[],prev:[],rest:0,segments:n,alive:!1},BL:{nodes:[],prev:[],rest:0,segments:n,alive:!1}},g={TL:null,TR:null,BR:null,BL:null},v={camPos:new A,fwd:new A,up:new A,right:new A,center:new A,gVec:new A};function b(w,C,F){const k=h[w];k.nodes=[],k.prev=[],k.segments=n,k.alive=!0;for(let D=0;D<=k.segments;D++){const T=D/k.segments,R=new A().lerpVectors(C,F,T);k.nodes.push(R),k.prev.push(R.clone())}k.rest=C.distanceTo(F)/k.segments}function m(w,C,F,k,D){if(!w.alive)return;const T=w.nodes.length;if(T<2)return;w.rest=Math.max(1e-4,k.distanceTo(D)/w.segments);const R=F.x*e*C*C,U=F.y*e*C*C,j=F.z*e*C*C;for(let z=1;z<T-1;z++){const X=w.nodes[z],V=w.prev[z];if(!X||!V)continue;const P=(X.x-V.x)*(1-a),O=(X.y-V.y)*(1-a),S=(X.z-V.z)*(1-a);w.prev[z]!==void 0&&X!==void 0&&w.prev[z].copy(X),X.x+=P+R,X.y+=O+U,X.z+=S+j}w.nodes[0]!==void 0&&w.nodes[0].copy(k),w.nodes[T-1]!==void 0&&w.nodes[T-1].copy(D);for(let z=0;z<s;z++){for(let X=0;X<T-1;X++){const V=w.nodes[X],P=w.nodes[X+1];if(!V||!P)continue;const O=P.x-V.x,S=P.y-V.y,L=P.z-V.z,E=Math.sqrt(O*O+S*S+L*L)||1e-6,I=(E-w.rest)/E,B=O*.5*I*i,Q=S*.5*I*i,G=L*.5*I*i;X>0&&V&&(V.x+=B,V.y+=Q,V.z+=G),X+1<T-1&&P&&(P.x-=B,P.y-=Q,P.z-=G)}w.nodes[0]!==void 0&&w.nodes[0].copy(k),w.nodes[T-1]!==void 0&&w.nodes[T-1].copy(D)}}function p(w,C,F){const k=w.nodes,D=new hs(k,!1,"centripetal",.5),T=new ps(D,r,F,l,!1),R=f[C],U=d[C],j=R.geometry;R.geometry=T,U.geometry=T,j.dispose()}function x(w,C){const F=r,k=l;let D=g[w];if(!D||D.tubular!==F||D.radial!==k){if(D?.lines&&(c.remove(D.lines),D.lines.geometry.dispose(),D.lines.material.dispose()),!C)return;const R=Math.max(1,Math.floor(F/(C.countU??3e4))),U=Math.max(1,Math.floor(k/(C.countV??20))),j=[];for(let I=0;I<=F;I+=R)for(let B=0;B<=k;B+=U)j.push({u:I,v:B,len:(C.length??.07)*(.85+.3*Math.random())});const z=j.length,X=new Float32Array(z*2*3),V=new Je(C.baseColor??16731558),P=new Je(C.tipColor??16777215),O=new Float32Array(z*2*3);for(let I=0;I<z;I++){const B=(I*2+0)*3,Q=(I*2+1)*3;O.set([V.r,V.g,V.b],B),O.set([P.r,P.g,P.b],Q)}const S=new Tt;S.setAttribute("position",new Ln(X,3)),S.setAttribute("color",new Ln(O,3)),S.setDrawRange(0,z*2);const L=new Lr({vertexColors:!0,transparent:!0,opacity:.2,depthTest:!0,depthWrite:!1}),E=new gs(S,L);E.frustumCulled=!1,c.add(E),D={lines:E,positions:X,anchors:j,tubular:F,radial:k,simplex:new _o(String(C.seed??2595)),params:{countU:C.countU??3e4,countV:C.countV??20,length:C.length??.07,sway:C.sway??.4,speed:C.speed??.3,baseColor:V,tipColor:P,onTop:!1,opacity:.9,seed:C.seed??2595}},g[w]=D}else{const R=D.lines.material;R.opacity=.9}}function y(w,C){const F=g[w];if(!F||!F.lines||!F.positions)return;const D=f[w].geometry,T=D.getAttribute("position"),R=D.getAttribute("normal");if(!T||!R)return;const U=F.tubular,j=F.radial,z=F.positions,X=performance.now()*.001*(C?.speed??F.params.speed),V=new A(0,0,1),P=new A(1,0,0);for(let S=0;S<F.anchors.length;S++){const L=F.anchors[S];if(!L)continue;const{u:E,v:I,len:B}=L,Q=Math.min(E,U),G=Math.min(I,j),q=Q*(j+1)+G,le=T.getX(q),re=T.getY(q),Z=T.getZ(q),ee=R.getX(q),Me=R.getY(q),Se=R.getZ(q),de=new A(le,re,Z),ce=new A(ee,Me,Se).normalize();let fe=new A().crossVectors(ce,V);fe.lengthSq()<1e-6&&fe.crossVectors(ce,P),fe.normalize();const te=new A().crossVectors(ce,fe).normalize(),se=F.simplex.noise4D(de.x,de.y,de.z,X),W=Math.cos(se),Y=Math.sin(se),N=C?.sway??F.params.sway,ne=new A().addScaledVector(fe,W*N).addScaledVector(te,Y*N),J=new A().copy(de).addScaledVector(ce,B).add(ne),K=(S*2+0)*3,we=(S*2+1)*3;z[K+0]=de.x,z[K+1]=de.y,z[K+2]=de.z,z[we+0]=J.x,z[we+1]=J.y,z[we+2]=J.z}const O=F.lines.geometry;O.getAttribute("position").needsUpdate=!0}function _(w,C,F){const k=C?.cfg;k&&(k.color!==void 0&&f.TL.material.color.set(k.color),k.opacity!==void 0&&Object.values(f).forEach(S=>S.material.opacity=k.opacity));const T=k?.tubeRadius??t;v.up.set(0,1,0).applyQuaternion(w.quaternion).normalize(),v.gVec.copy(v.up).multiplyScalar(-1);let R=[];if(typeof C.getRingWorldSnapshot=="function"){const S=C.getRingWorldSnapshot();S&&Array.isArray(S.ringWorld)&&(R=S.ringWorld)}let U=1/0,j=-1/0;for(const S of R)S.x<U&&(U=S.x),S.x>j&&(j=S.x);const z=.2,X=1,V=U*1.2,P=j*1.2,O={TL:{start:new A(V-z,-2,-1),end:C.getAttachPointForCorner("TL")},TR:{start:new A(P+z,-2,-1),end:C.getAttachPointForCorner("BR")},BR:{start:new A(P,-1,X),end:C.getAttachPointForCorner("TR")},BL:{start:new A(V,-1,X),end:C.getAttachPointForCorner("BL")}};for(const S of Qu){const L=O[S],E=f[S],I=d[S];if(!L.end){const q=new Tt,le=E.geometry;E.geometry=q,I.geometry=q,le.dispose();const re=g[S];re?.lines&&(re.lines.visible=!1),h[S].alive=!1;continue}(!h[S].alive||h[S].nodes.length!==n+1)&&b(S,L.start,L.end);const B=Math.max(.001,Math.min(.033,F||.016));m(h[S],B,v.gVec,L.start,L.end),p(h[S],S,T);const Q={countU:k?.fur?.countU??3e4,countV:k?.fur?.countV??20,length:k?.fur?.length??.07,sway:k?.fur?.sway??.4,speed:k?.fur?.speed??.3,baseColor:k?.fur?.baseColor??16731558,tipColor:k?.fur?.tipColor??16777215,seed:k?.fur?.seed??2595};x(S,Q);const G=g[S];G?.lines&&(G.lines.visible=!0),y(S,Q)}c.updateMatrix()}function M(){Object.values(f).forEach(w=>w.geometry.dispose()),Object.values(d).forEach(w=>w.geometry.dispose()),Object.values(g).forEach(w=>{w?.lines&&(w.lines.geometry.dispose(),w.lines.material.dispose())})}return{group:c,update:_,dispose:M}}function Zu(){const o=new cs,r=new Si().setDecoderPath("/draco/").setDecoderConfig({type:"wasm"});return o.setDRACOLoader(r),o.setMeshoptDecoder(Mi),o}async function Pn(o){const t=Zu(),r=o.substring(0,o.lastIndexOf("/")+1);t.setResourcePath(r),t.setPath("");const l=await t.loadAsync(o),n=l.scene||l.scenes?.[0];if(!n)throw new Error(`GLTF/GLB had no scene: ${o}`);return n}function yr(o,t={}){const{frustumCulled:r=!1}=t;o.traverse(l=>{l.isMesh&&(l.frustumCulled=r)})}function wr(o){const t=new cn;t.name="CenteredPivot",t.add(o);const l=new Bt().setFromObject(o).getCenter(new A);o.position.sub(new A(l.x,l.y,0)),t.updateMatrixWorld(!0);const n=new Bt().setFromObject(t),e=new A;n.getSize(e);const a=Math.max(e.x,1e-6),i=Math.max(e.y,1e-6);return{pivot:t,baseWidth:a,baseHeight:i}}function Ju(o){o&&(o.map&&"colorSpace"in o.map&&(o.map.colorSpace=ot),o.emissiveMap&&"colorSpace"in o.emissiveMap&&(o.emissiveMap.colorSpace=ot),[o.metalnessMap,o.roughnessMap,o.normalMap,o.aoMap].forEach(t=>{t&&"colorSpace"in t&&(t.colorSpace=Ci)}))}function Ns(o,t){return o.depthTest=!t,o.depthWrite=t?!1:o.depthWrite??!0,o}function $u(o,t,r){const l=new ht({color:o?.color?o.color.clone():new Je(16777215),map:o?.map??null,transparent:t<1||!!o?.transparent,opacity:t,side:o?.side??or,alphaTest:o?.alphaTest??0,fog:!1,toneMapped:!1,vertexColors:!!o?.vertexColors});return l.map&&"colorSpace"in l.map&&(l.map.colorSpace=ot),Ns(l,r)}function ef(o,t,r,l){const n=new Pr({uniforms:{map:{value:o},useMap:{value:!!o},mixStrength:{value:De.clamp(t,0,1)},opacity:{value:r}},vertexShader:`
      varying vec3 vNormal; varying vec2 vUv;
      void main(){
        vNormal = normalize(normalMatrix * normal);
        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
      }
    `,fragmentShader:`
      uniform sampler2D map; uniform bool useMap; uniform float mixStrength; uniform float opacity;
      varying vec3 vNormal; varying vec2 vUv;
      void main(){
        vec3 n = normalize(vNormal) * 0.5 + 0.5;
        vec3 tex = useMap ? texture2D(map, vUv).rgb : vec3(1.0);
        gl_FragColor = vec4(mix(tex, n, mixStrength), opacity);
      }
    `,transparent:!0});return Ns(n,l)}function tf(o,t,r,l){if(!o)return;o.transparent=t<1||!!o.transparent,o.opacity=t,r&&(o.depthTest=!1,o.depthWrite=!1,o.fog=!1,"toneMapped"in o&&(o.toneMapped=!0)),Ju(o),(o.isMeshStandardMaterial||o.isMeshPhysicalMaterial)&&l&&l.envMap&&(o.envMap=l.envMap,o.envMapIntensity=l.intensity??1),o.needsUpdate=!0}function Da(o,t,{renderOnTop:r=!1,opacity:l=1,mixStrength:n=.5,pbrEnv:e}){o.traverse(a=>{if(!a.isMesh)return;if(t==="unlit"){a.material=$u(a.material,l,r);return}if(t==="normals"){const s=a.material?.map??null;s&&"colorSpace"in s&&(s.colorSpace=ot),a.material=ef(s,n,l,r);return}const i=Array.isArray(a.material)?a.material:[a.material];i.forEach(s=>tf(s,l,r,e)),a.material=Array.isArray(a.material)?i:i[0]})}function nf(o,t){o.traverse(r=>{const l=r.material;l.depthTest=!1,l.depthWrite=!1,l&&(Array.isArray(l)?l.forEach(n=>{typeof n.opacity=="number"&&(n.transparent=!0,n.opacity=t),n.uniforms&&"opacity"in n.uniforms&&(n.uniforms.opacity.value=t)}):(typeof l.opacity=="number"&&(l.transparent=!0,l.opacity=t),l.uniforms&&"opacity"in l.uniforms&&(l.uniforms.opacity.value=t)))})}class br{constructor(t){this.alpha=t}y;initialized=!1;reset(t){this.y=t,this.initialized=!0}update(t,r){return this.initialized||this.reset(r),this.alpha=t,this.y=this.y+this.alpha*(r-this.y),this.y}}function po(o,t){return 1/(1+1/(2*Math.PI*Math.max(1e-6,t))/Math.max(1e-6,o))}class Yo{constructor(t,r,l){this.minCutoff=t,this.beta=r,this.dCutoff=l}dxLP=new br(1);xLP=new br(1);initialized=!1;xPrev=0;update(t,r){if(!this.initialized)return this.xPrev=r,this.dxLP.reset(0),this.xLP.reset(r),this.initialized=!0,r;const l=(r-this.xPrev)/Math.max(1e-6,t);this.xPrev=r;const n=po(t,this.dCutoff),e=this.dxLP.update(n,l),a=this.minCutoff+this.beta*Math.abs(e),i=po(t,a);return this.xLP.update(i,r)}}class js{constructor(t,r,l){this.minCutoff=t,this.beta=r,this.dCutoff=l,this.fx=new Yo(t,r,l),this.fy=new Yo(t,r,l),this.fz=new Yo(t,r,l)}fx;fy;fz;update(t,r,l=new A){return l.set(this.fx.update(t,r.x),this.fy.update(t,r.y),this.fz.update(t,r.z)),l}}class _r{constructor(t,r,l){this.minCutoff=t,this.beta=r,this.dCutoff=l}dLP=new br(1);initialized=!1;qFilt=new Ne;update(t,r,l=new Ne){if(!this.initialized)return this.qFilt.copy(r),this.dLP.reset(0),this.initialized=!0,l.copy(this.qFilt);const a=this.qFilt.dot(r)>=0?r:new Ne(-r.x,-r.y,-r.z,-r.w),i=this.qFilt.dot(a),c=2*Math.acos(De.clamp(i,-1,1))/Math.max(1e-6,t),u=po(t,this.dCutoff),f=this.dLP.update(u,c),d=this.minCutoff+this.beta*Math.abs(f),h=po(t,d);return this.qFilt.slerp(a,De.clamp(h,0,1)),l.copy(this.qFilt)}}function xr(o,t){const r=t.clone();return o&&o.dot(r)<0&&r.set(-r.x,-r.y,-r.z,-r.w),r}function Sr(o){const t=new A(1,0,0).applyQuaternion(o).normalize(),r=new A(0,1,0).applyQuaternion(o).normalize(),l=new A(0,0,1).applyQuaternion(o).normalize();return{right:t,up:r,z:l}}function Ra(o){const t=new A;if(!o.length)return t;for(const r of o)t.add(r);return t.multiplyScalar(1/o.length)}function Mr(o,t,r){let l=0;const n=o.length;for(let e=0;e<n;e++){const a=o[e],i=o[(e+1)%n],s=a.dot(t),c=a.dot(r),u=i.dot(t),f=i.dot(r);l+=s*f-u*c}return .5*l}function Xo(o,t,r){return new A().crossVectors(t,o).multiplyScalar(r>0?-1:1).normalize()}function Qo(o){let t=0;for(let r=0;r<o.length;r++)t+=o[r].distanceTo(o[(r+1)%o.length]);return t}function Ko(o,t){const r=o.length,l=o[(t-1+r)%r],n=o[(t+1)%r],e=new A().subVectors(n,l);return e.lengthSq()<1e-10?new A(1,0,0):e.normalize()}function tn(o,t){let r=0,l=1/0;for(let n=0;n<o.length;n++){const e=o[n].distanceToSquared(t);e<l&&(l=e,r=n)}return r}function of(o,t,r,l){const n=o.length;if(n===0)return 0;if(l<=0)return(t%n+n)%n;const e=c=>(c%n+n)%n,i=((c,u)=>{const f=((u-c)%n+n)%n;return f>n/2?f-n:f})(r,t),s=De.clamp(i,-l,l);return e(r+s)}const rf=function(){const t=typeof document<"u"&&document.createElement("link").relList;return t&&t.supports&&t.supports("modulepreload")?"modulepreload":"preload"}(),af=function(o){return"/"+o},Pa={},Zo=function(t,r,l){let n=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),i=a?.nonce||a?.getAttribute("nonce");n=Promise.allSettled(r.map(s=>{if(s=af(s),s in Pa)return;Pa[s]=!0;const c=s.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${u}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":rf,c||(f.as="script"),f.crossOrigin="",f.href=s,i&&f.setAttribute("nonce",i),document.head.appendChild(f),c)return new Promise((d,h)=>{f.addEventListener("load",d),f.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${s}`)))})}))}function e(a){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=a,window.dispatchEvent(i),!i.defaultPrevented)throw a}return n.then(a=>{for(const i of a||[])i.status==="rejected"&&e(i.reason);return t().catch(e)})};function sf(o){const t=o.index?o.toNonIndexed():o.clone(),r=t.attributes.position.array;let l=0;for(let n=0;n<r.length;n+=9){const e=r[n],a=r[n+1],i=r[n+2],s=r[n+3],c=r[n+4],u=r[n+5],f=r[n+6],d=r[n+7],h=r[n+8],g=s-e,v=c-a,b=u-i,m=f-e,p=d-a,x=h-i,y=v*x-b*p,_=b*m-g*x,M=g*p-v*m,w=.5*Math.sqrt(y*y+_*_+M*M);l+=w}return t.dispose(),l}async function cf(o,t,r={}){const{density:l=140,length:n,color:e=16731558,tipColor:a=16777215,intensity:i,speed:s=.5,seed:c=1337,onTop:u=!0,opacity:f=1,maxSkinnedHairs:d=3e3,mode:h="gpu"}=r,[{LineSegmentsGeometry:g},{LineSegments2:v},{LineMaterial:b}]=await Promise.all([Zo(()=>import("./three-B_POVWff.js").then(W=>W.aj),[]),Zo(()=>import("./three-B_POVWff.js").then(W=>W.al),[]),Zo(()=>import("./three-B_POVWff.js").then(W=>W.ak),[])]),m=new Je(e),p=new Je(a),x=[],y=[];t.traverse(W=>{W?.isSkinnedMesh?y.push(W):W?.isMesh&&W.geometry&&x.push(W)});const _=[],M=[];for(const W of x){const Y=sf(W.geometry),N=Math.round(Y*l);if(N<=0)continue;const ne=new Ai(W).setWeightAttribute(null).build(),J=n??.12*Math.min(new Bt().setFromObject(t).getSize(new A).x,new Bt().setFromObject(t).getSize(new A).y),K=new A,we=new A,me=new A,ge=new A,he=new A,pe=new A;for(let Ie=0;Ie<N;Ie++){ne.sample(K,we),me.copy(K).addScaledVector(we,J),ge.copy(K),o.worldToLocal(ge),he.copy(me),o.worldToLocal(he),pe.copy(he).sub(ge).normalize();const Oe=new A(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),$=new A().crossVectors(pe,Oe);$.lengthSq()<1e-6&&$.set(1,0,0).cross(pe),$.normalize();const ue=new A().crossVectors(pe,$).normalize();_.push({rootLocal:ge.clone(),axisLocal:pe.clone(),length:J,u:$,v:ue,rootRGB:[m.r,m.g,m.b],tipRGB:[p.r,p.g,p.b]})}}const w=new Bt().setFromObject(t),C=n??.12*Math.min(w.getSize(new A).x,w.getSize(new A).y);for(const W of y){const Y=W.geometry,N=Y.getAttribute("position"),ne=Y.getAttribute("normal"),J=Y.getAttribute("skinIndex"),K=Y.getAttribute("skinWeight");if(!J||!K||!N)continue;const we=N.count;if(we<=0)continue;const me=Math.max(1,Math.floor(d/Math.max(1,y.length))),ge=Math.max(1,Math.floor(we/me));for(let he=0;he<we;he+=ge){const pe=K.getX(he),Ie=K.getY(he),Oe=K.getZ(he),$=K.getW(he),ue=[pe,Ie,Oe,$];let ie=0;for(let ye=1;ye<4;ye++)ue[ye]>ue[ie]&&(ie=ye);const _e=[J.getX(he),J.getY(he),J.getZ(he),J.getW(he)][ie]|0,ke=new A().fromBufferAttribute(N,he),ze=ke.clone().applyMatrix4(W.bindMatrix),be=ne?new A().fromBufferAttribute(ne,he):new A(0,0,1),Te=ke.clone().add(be).applyMatrix4(W.bindMatrix).sub(ze),Ee=be.clone().normalize(),H=new A(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),ae=new A().crossVectors(Ee,H);ae.lengthSq()<1e-6&&ae.set(1,0,0).cross(Ee),ae.normalize();const ve=new A().crossVectors(Ee,ae).normalize();M.push({mesh:W,boneIndex:_e,pLocalPre:ze,nLocalPre:Te,length:C,u:ae,v:ve,rootRGB:[m.r,m.g,m.b],tipRGB:[p.r,p.g,p.b]})}}const F=_.length+M.length;if(F<=0)return{object:new cn,update:()=>{},setOpacity:()=>{}};const k=new Float32Array(F*2*3),D=new Float32Array(F*2*3),T=new Float32Array(F*3),R=new Float32Array(F*3),U=new Float32Array(F*3),j=new Float32Array(F*3),z=new Float32Array(F*3),X=(W,Y,N)=>{const ne=typeof c=="number"?c:(c+"").length,J=Math.sin(W*12.9898+Y*78.233+(N+1)*37.719+ne*.11)*43758.5453;return(J-Math.floor(J))*Math.PI*2};let V=0;for(const W of _){const Y=W.rootLocal.clone().addScaledVector(W.axisLocal,W.length),N=V*6;k[N+0]=W.rootLocal.x,k[N+1]=W.rootLocal.y,k[N+2]=W.rootLocal.z,k[N+3]=Y.x,k[N+4]=Y.y,k[N+5]=Y.z;const ne=V*6;D[ne+0]=W.rootRGB[0],D[ne+1]=W.rootRGB[1],D[ne+2]=W.rootRGB[2],D[ne+3]=W.tipRGB[0],D[ne+4]=W.tipRGB[1],D[ne+5]=W.tipRGB[2];const J=V*3;T[J+0]=W.rootLocal.x,T[J+1]=W.rootLocal.y,T[J+2]=W.rootLocal.z,R[J+0]=W.axisLocal.x,R[J+1]=W.axisLocal.y,R[J+2]=W.axisLocal.z,U[J+0]=W.u.x,U[J+1]=W.u.y,U[J+2]=W.u.z,j[J+0]=W.v.x,j[J+1]=W.v.y,j[J+2]=W.v.z,z[J+0]=W.length,z[J+1]=i??.5*W.length,z[J+2]=X(W.rootLocal.x,W.rootLocal.y,V),V++}for(const W of M){const Y=new A,N=new A(0,0,W.length),ne=V*6;k[ne+0]=Y.x,k[ne+1]=Y.y,k[ne+2]=Y.z,k[ne+3]=N.x,k[ne+4]=N.y,k[ne+5]=N.z;const J=V*6;D[J+0]=W.rootRGB[0],D[J+1]=W.rootRGB[1],D[J+2]=W.rootRGB[2],D[J+3]=W.tipRGB[0],D[J+4]=W.tipRGB[1],D[J+5]=W.tipRGB[2];const K=V*3;T[K+0]=Y.x,T[K+1]=Y.y,T[K+2]=Y.z,R[K+0]=0,R[K+1]=0,R[K+2]=1,U[K+0]=1,U[K+1]=0,U[K+2]=0,j[K+0]=0,j[K+1]=1,j[K+2]=0,z[K+0]=W.length,z[K+1]=i??.45*W.length,z[K+2]=X(V,W.length,V),V++}const P=new g;P.setPositions(k),P.setColors(D),h==="gpu"&&(P.setAttribute("aRoot",new on(T,3)),P.setAttribute("aAxis",new on(R,3)),P.setAttribute("aU",new on(U,3)),P.setAttribute("aV",new on(j,3)),P.setAttribute("aLenAmpPhase",new on(z,3)));const O=new b({color:16777215,vertexColors:!0,transparent:!0,depthTest:!u,depthWrite:!u,linewidth:1,opacity:f,stencilWrite:!0,stencilFunc:Ti,stencilRef:1});h==="gpu"&&(O.userData=O.userData||{},O.userData.uTime={value:0},O.userData.uSpeed={value:s},O.onBeforeCompile=W=>{W.uniforms.uTime=O.userData.uTime,W.uniforms.uSpeed=O.userData.uSpeed,W.vertexShader=W.vertexShader.replace("#include <common>",`#include <common>
attribute vec3 aRoot;
attribute vec3 aAxis;
attribute vec3 aU;
attribute vec3 aV;
attribute vec3 aLenAmpPhase;
uniform float uTime;
uniform float uSpeed;`).replace("vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );","vec3 _root = aRoot; vec3 _axis = normalize(aAxis); float _len = aLenAmpPhase.x; float _amp = aLenAmpPhase.y; float _ph = aLenAmpPhase.z; float _t = uTime * uSpeed + _ph; vec3 _sw = aU * cos(_t) + aV * sin(_t); vec3 _endL = _root + _axis * _len + _sw * _amp; vec4 start = modelViewMatrix * vec4( _root, 1.0 ); vec4 end = modelViewMatrix * vec4( _endL, 1.0 );").replace("vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );","")});const S=new v(P,O);S.frustumCulled=!1;const L=new _o(String(c)),E=W=>i??.5*W,I=W=>i??.45*W,B=P.attributes.instanceStart.array,Q=P.attributes.instanceEnd.array,G=new wt,q=new A,le=new A,re=new A,Z=new A,ee=new A,Me=new wt,Se=new A,de=new A,ce=new A,fe=new A;function te(W){h==="gpu"&&(O.userData.uTime.value=W),Me.copy(o.matrixWorld).invert();let Y=0;if(h==="cpu")for(const N of _){const ne=L.noise4D(N.rootLocal.x,N.rootLocal.y,N.rootLocal.z,W*s),J=Math.cos(ne),K=Math.sin(ne),we=E(N.length),me=N.u.x*J*we+N.v.x*K*we,ge=N.u.y*J*we+N.v.y*K*we,he=N.u.z*J*we+N.v.z*K*we,pe=N.rootLocal.x+N.axisLocal.x*N.length+me,Ie=N.rootLocal.y+N.axisLocal.y*N.length+ge,Oe=N.rootLocal.z+N.axisLocal.z*N.length+he,$=Y*6;B[$+0]=N.rootLocal.x,B[$+1]=N.rootLocal.y,B[$+2]=N.rootLocal.z,Q[$+3]=pe,Q[$+4]=Ie,Q[$+5]=Oe,Y++}else Y+=_.length;for(const N of M){const ne=Y,J=ne*3,K=ne*6,we=N.mesh.skeleton;if(G.fromArray(we.boneMatrices,N.boneIndex*16),q.copy(N.pLocalPre).applyMatrix4(G).applyMatrix4(N.mesh.bindMatrixInverse),q.applyMatrix4(N.mesh.matrixWorld),le.copy(N.pLocalPre).add(N.nLocalPre).applyMatrix4(G).applyMatrix4(N.mesh.bindMatrixInverse),le.applyMatrix4(N.mesh.matrixWorld),re.copy(q).applyMatrix4(Me),Z.copy(le).applyMatrix4(Me),ee.copy(Z).sub(re).normalize(),Se.copy(N.pLocalPre).add(N.u).applyMatrix4(G).applyMatrix4(N.mesh.bindMatrixInverse).applyMatrix4(N.mesh.matrixWorld).sub(q),de.copy(N.pLocalPre).add(N.v).applyMatrix4(G).applyMatrix4(N.mesh.bindMatrixInverse).applyMatrix4(N.mesh.matrixWorld).sub(q),ce.copy(Se).add(q).applyMatrix4(Me).sub(re).normalize(),fe.copy(de).add(q).applyMatrix4(Me).sub(re).normalize(),h==="cpu"){const me=L.noise4D(re.x,re.y,re.z,W*s),ge=Math.cos(me),he=Math.sin(me),pe=I(N.length),Ie=ce.x*ge*pe+fe.x*he*pe,Oe=ce.y*ge*pe+fe.y*he*pe,$=ce.z*ge*pe+fe.z*he*pe,ue=re.x+ee.x*N.length+Ie,ie=re.y+ee.y*N.length+Oe,_e=re.z+ee.z*N.length+$;B[K+0]=re.x,B[K+1]=re.y,B[K+2]=re.z,Q[K+3]=ue,Q[K+4]=ie,Q[K+5]=_e}else T[J+0]=re.x,T[J+1]=re.y,T[J+2]=re.z,R[J+0]=ee.x,R[J+1]=ee.y,R[J+2]=ee.z,U[J+0]=ce.x,U[J+1]=ce.y,U[J+2]=ce.z,j[J+0]=fe.x,j[J+1]=fe.y,j[J+2]=fe.z;Y++}if(h==="cpu")P.attributes.instanceStart.needsUpdate=!0,P.attributes.instanceEnd.needsUpdate=!0;else{const N=P;M.length>0&&(N.attributes.aRoot.needsUpdate=!0,N.attributes.aAxis.needsUpdate=!0,N.attributes.aU.needsUpdate=!0,N.attributes.aV.needsUpdate=!0)}}function se(W){S.material.transparent=!0,S.material.opacity=W}return{object:S,update:te,setOpacity:se}}async function qs(o,t,r={}){const l=await cf(o,t,{density:r.density??140,length:r.length,color:r.color??16731558,tipColor:r.tipColor??16777215,intensity:r.intensity,speed:r.speed??.5,seed:r.seed??1337,onTop:r.onTop??!0,opacity:r.opacity??1});return{object:l.object,update:l.update,setOpacity:l.setOpacity,dispose(){}}}async function lf(o){const{scene:t,camera:r,ring:l}=o,n=l.cfg?.tubeRadius??.4,e=De.clamp(o.faceCameraBias??.85,0,1),a={posMinCutoff:o.smoothing?.posMinCutoff??2,rotMinCutoff:o.smoothing?.rotMinCutoff??3,beta:o.smoothing?.beta??.4,dCutoff:o.smoothing?.derivativeCutoff??1,anchorRadius:Math.max(0,Math.floor(o.smoothing?.anchorSearchRadius??6))},i=new dt;i.name="TopBottomOverlay",t.add(i);function s(f,d){const h=new cn;h.name=f==="top"?"OverlayTopRoot":"OverlayBottomRoot";const g=new cn;g.name=f==="top"?"OverlayTopPivot":"OverlayBottomPivot",h.add(g),i.add(h);let v=null,b=1,m=1,p=null,x=null,y=null;const _=new js(a.posMinCutoff,a.beta,a.dCutoff),M=new _r(a.rotMinCutoff,a.beta,a.dCutoff);let w=0,C=1;const F=d.attachPadding??.06,k=d.fur===!1?!1:d.fur??o.fur;let D=null,T=performance.now()*.001;const R=(async()=>{v=await Pn(d.glbUrl),v.name=d.name,yr(v,{frustumCulled:!1}),Da(v,d.lighting??"normals",{renderOnTop:!1,opacity:d.initialOpacity??.3,mixStrength:.5});const V=wr(v);if(b=V.baseWidth,m=V.baseHeight,g.add(V.pivot),k)try{D=await qs(g,v,{...k}),g.add(D.object)}catch(P){console.warn(`[TopBottomOverlay:${f}] attachFurToSurface failed:`,P)}})();async function U(V){await R;const P=await Pn(V.url);P.name=V.name??"OverlayCompanion",yr(P,{frustumCulled:!1}),Da(P,V.lighting??"material",{renderOnTop:!!V.renderOnTop,opacity:V.opacity??d.initialOpacity??.3});const{pivot:O,baseWidth:S,baseHeight:L}=wr(P);if(V.fitToBase!==!1){const E=Math.min(b/S,m/L);P.scale.setScalar(E)}if(g.add(O),V.layout==="edgeRow"){const E=V.gap??.06*b,I=g.children.filter(q=>q!==v&&q!==O&&q!==D?.object),B=I.length+1,Q=(B-1)*E;let G=0;V.align==="left"?G=0:V.align==="right"?G=-Q:G=-Q/2,I.forEach((q,le)=>{q.position.x=G+le*E}),O.position.x=G+(B-1)*E}return P}function j(V){nf(h,V),D&&D.setOpacity(V)}function z(){const V=l.getRingWorldSnapshot(),P=V.ringWorld;if(P.length<2)return;const O=xr(p,V.planeQuat);p=O.clone();let{right:S,up:L}=Sr(O);x&&y&&x.dot(S)+y.dot(L)<0&&(S.multiplyScalar(-1),L.multiplyScalar(-1)),x=S.clone(),y=L.clone();const E=Mr(P,S,L)>=0?1:-1;P.length,w=P.length,C=E;const I=V.centerWorld;let B=-1/0,Q=1/0;for(let se=0;se<P.length;se++){const W=P[se];if(W!=null){const N=W.clone().sub(I).dot(L);N>B&&(B=N),N<Q&&(Q=N)}}const G=f==="top",q=G?B:Q,le=G?1:-1,re=n+F,Z=I.clone().addScaledVector(L,q+le*re),ee=1/60,Me=_.update(ee,Z,new A);h.position.copy(Me);const de=r.quaternion.clone(),ce=O,fe=new Ne().slerpQuaternions(ce,de,e),te=M.update(ee,fe);if(h.quaternion.copy(te),h.updateMatrixWorld(!0),D){const se=performance.now()*.001-T;D.update(se)}}function X(){D&&(D.dispose(),D=null),i.remove(h)}return{root:h,pivot:g,addCompanion:U,setOpacity:j,update:z,dispose:X}}const c=s("top",o.top),u=s("bottom",o.bottom);return{group:i,top:c,bottom:u,update(){c.update(),u.update()},setOpacity(f){c.setOpacity(f),u.setOpacity(f)},dispose(){c.dispose(),u.dispose(),t.remove(i)}}}const uf="/assets/overlayTop-aA_s40gC.glb",ff="/assets/overlayBottom-C9Z4NtbS.glb",df="/assets/bandaid--W6OFC-Q.glb",hf="/assets/clasp_top_middle-CKkc2Pbh.glb",pf="/assets/deck_btn_0-CVQPhlAj.glb",gf="/assets/deck_btn_1-CR67j6MH.glb",mf="/assets/deck_btn_2-CMun63dg.glb",vf="/assets/info_btn-B34vGzmO.glb";async function yf(o,t,r){const l=await lf({scene:o,camera:t,ring:r,fur:{enabled:!0,density:3e4,color:14626182,tipColor:16777215,length:.02,speed:0,onTop:!1,opacity:.2,seed:2595},top:{glbUrl:uf,name:"overlayTop",lighting:"normals",initialOpacity:.3,attachPadding:-.31},bottom:{glbUrl:ff,name:"overlayBottom",lighting:"normals",initialOpacity:.3,attachPadding:-.31},faceCameraBias:.85,smoothing:{posMinCutoff:2,rotMinCutoff:3,beta:.4,derivativeCutoff:1,anchorSearchRadius:6}});return await l.top.addCompanion({url:df,name:"bandaid",lighting:"material",fitToBase:!1,opacity:.5}),await l.top.addCompanion({url:pf,name:"deck_btn_0",lighting:"material",opacity:.6}),await l.top.addCompanion({url:gf,name:"deck_btn_1",lighting:"material",opacity:.6}),await l.bottom.addCompanion({url:mf,name:"info_btn",lighting:"material",opacity:.6}),await l.top.addCompanion({url:hf,name:"clasp_top_middle",lighting:"material",opacity:.6}),await l.top.addCompanion({url:vf,name:"deck_btn_2",lighting:"material",opacity:.6}),l}function Ea(o,t){const r=[];return o.traverse(l=>{l?.isBone&&typeof l.name=="string"&&l.name.startsWith(t)&&r.push(l)}),r.sort((l,n)=>l.name.localeCompare(n.name,void 0,{numeric:!0})),r}function Ba(o){if(o.length<=1)return o.length?[1]:[];const t=new Array(o.length).fill(1),r=new A,l=new A;for(let n=0;n<o.length-1;n++)o[n]&&o[n+1]&&(o[n].getWorldPosition(r),o[n+1].getWorldPosition(l),t[n]=Math.max(1e-4,r.distanceTo(l)));return t[o.length-1]=t[o.length-2]??1,t}function Ut(o,t,r,l){const n=o.length;if(n<2)return(o[0]??new A).clone();let e=(t%n+n)%n,a=Math.max(0,l);for(;a>0;){const i=(e+r+n)%n,s=o[i]&&o[e]?o[i].distanceTo(o[e]):0;if(s>=a){const c=s>1e-6?a/s:0;return new A().copy(o[e]??new A).lerp(o[i]??new A,c)}a-=s,e=i}return(o[e]??new A).clone()}function wf(o,t,r,l,n,e){const a=Ut(o,t,r,l);let i=l,s=l+Math.max(n*1.25,.001);const c=l+e;for(;s-l<e&&!(Ut(o,t,r,s).distanceTo(a)>=n||(s=Math.min(c,s+Math.max(n,.02)),s>=c)););for(let u=0;u<12;u++){const f=(i+s)*.5;Ut(o,t,r,f).distanceTo(a)>=n?s=f:i=f}return(i+s)*.5}function Ia(o,t){const r=o.length,l=o[(t-1+r)%r],n=o[t],e=o[(t+1)%r];if(!l||!n||!e)return 0;const a=new A().subVectors(n,l).normalize(),i=new A().subVectors(e,n).normalize();return Math.acos(De.clamp(a.dot(i),-1,1))}function Jo(o){const t=o.startsWith("-");return{axis:t?o.slice(1):o,sign:t?-1:1}}function Oa(o,t,r){switch(o){case"BL":return{axisH:t.clone(),axisV:r.clone()};case"TL":return{axisH:t.clone(),axisV:r.clone().negate()};case"TR":return{axisH:t.clone().negate(),axisV:r.clone().negate()};case"BR":return{axisH:t.clone().negate(),axisV:r.clone()}}}function za(o,t,r){switch(o){case"RIGHT":return{axisH:r.clone(),axisV:r.clone().negate()};case"LEFT":return{axisH:r.clone(),axisV:r.clone().negate()};case"TOP":return{axisH:t.clone(),axisV:t.clone().negate()};case"BOTTOM":return{axisH:t.clone(),axisV:t.clone().negate()}}}function Ga(o,t,r,l,n){const e=(a,i)=>{const s=Ut(o,t,a,0),c=Ut(o,t,a,n),u=new A().subVectors(c,s).normalize(),f=Ut(o,t,i,0),d=Ut(o,t,i,n),h=new A().subVectors(d,f).normalize();return u.dot(r)+h.dot(l)};return[e(1,-1),e(-1,1)]}function bf(o,t,r,l,n,e){const a=o.clone().normalize(),i=t.clone().normalize(),s=r.clone().normalize(),c={},u=(p,x,y)=>{c[p]=x.clone().multiplyScalar(y)},f=Jo(l),d=Jo(n),h=Jo(e);u(f.axis,a,f.sign),u(d.axis,i,d.sign),u(h.axis,s,h.sign);const g=c.x??new A().crossVectors(c.y,c.z).normalize(),v=c.y??new A().crossVectors(c.z,c.x).normalize(),b=c.z??new A().crossVectors(c.x,c.y).normalize(),m=new wt().makeBasis(g,v,b);return new Ne().setFromRotationMatrix(m)}function Wa(o,t){let r=o;for(let l=0;l<Math.max(0,t|0);l++){const n=r.length;if(n<3)break;const e=[];for(let a=0;a<n;a++){const i=r[a]??new A,s=r[(a+1)%n]??new A;e.push(new A().lerpVectors(i,s,.25)),e.push(new A().lerpVectors(i,s,.75))}r=e}return r}const Xe={v1:new A,v2:new A,v3:new A,v4:new A,v5:new A,q1:new Ne,q2:new Ne};async function _f(o){const{scene:t,tube:r,cornerUrl:l,shadow:n=!1}=o,e=o.anchor??{mode:"corner",corner:o.corner??"BL"},a=(o.assetToOurBasis??new Ne).clone(),i=o.faceAxisLocal??"z",s=o.thicknessAxisLocal??"x",c=De.clamp(o.cameraFaceBias??.85,0,1),u=o.faceAxisLocalH??i,f=o.thicknessAxisLocalH??s,d=o.faceAxisLocalV??i,h=o.thicknessAxisLocalV??s,g=r?.cfg?.tubeRadius??.4,v=Math.max(0,o.attachDepth??g),b=Math.max(0,o.attachPadding??.02),m=v+b,p=e.mode==="sideMid",x=De.clamp(p?Math.max(o.cornerSoftness??.6,.7):o.cornerSoftness??.6,0,1),y=De.clamp(p?Math.max(o.minAttachFactor??.6,.68):o.minAttachFactor??.6,.1,1);let _=Math.max(0,o.smoothPasses??1);const M=De.clamp(o.normalSmooth??.02,0,1),w=De.clamp(o.arcBlendStrength??.65,0,1),C=o.arcBlendCurvLo??.35,F=o.arcBlendCurvHi??1.2,k=De.clamp(o.minArcFrac??.35,0,.95),D={posMinCutoff:o.smoothing?.posMinCutoff??2,rotMinCutoff:o.smoothing?.rotMinCutoff??3,beta:o.smoothing?.beta??.4,dCutoff:o.smoothing?.derivativeCutoff??1,dirMargin:o.smoothing?.dirHysteresisMargin??.12,dirFrames:o.smoothing?.dirHysteresisFrames??0,anchorRadius:Math.max(0,Math.floor(o.smoothing?.anchorSearchRadius??6))},T=await Pn(l);let R=null;if(T.traverse($=>{$?.isSkinnedMesh&&!R&&(R=$.parent??null)}),!R)throw new Error("tubeOverlay: Could not find a SkinnedMesh in the GLB.");const U=ki(R);U.name=e.mode==="corner"?`Corner_${e.corner}`:`Side_${e.side}`,U.visible=!1,n&&U.traverse($=>{const ue=$;ue?.isMesh&&(ue.castShadow=!0,ue.receiveShadow=!0)}),t.add(U);let j=null;o.fur&&o.fur.enabled!==!1&&(j=await qs(U,U,o.fur),U.add(j.object));function z($,ue){const ie=$;"opacity"in ie&&(ie.opacity=De.clamp(ue,0,1),ie.transparent=ie.opacity<1||ie.transparent===!0,ie.depthTest=!0,ie.depthWrite=!0,ie.needsUpdate=!0)}function X($){U.traverse(ue=>{const ie=ue;if(ie?.isMesh){const _e=ie.material;Array.isArray(_e)?_e.forEach(ke=>z(ke,$)):_e&&z(_e,$)}})}o.initialOpacity!==void 0&&X(o.initialOpacity);const V=Ea(U,"H_"),P=Ea(U,"V_"),O=$=>{if($.length<2)return"x";const ue=new A(0,0,0);for(let _e=0;_e<Math.min($.length-1,4);_e++){const ke=$[_e+1]?.position?.clone?.()??new A;ue.x+=Math.abs(ke.x),ue.y+=Math.abs(ke.y),ue.z+=Math.abs(ke.z)}const ie=Math.max(ue.x,ue.y,ue.z);return ie===ue.x?"x":ie===ue.y?"y":"z"},S=Ba(V),L=Ba(P),E=O(V),I=O(P);new A,new A,new A;function B($,ue){const ie=$.parent,_e=Xe.q1;ie.getWorldQuaternion(_e),_e.invert(),$.quaternion.copy(_e.multiply(ue))}function Q($,ue){const _e=$.parent.worldToLocal(ue.clone());$.position.copy(_e)}function G($,ue,ie,_e){const ke=_e.length,ze=new Array(ke),be=new Array(ke),Ce=Qo($),Te=Math.max(Ce*.28,_e.reduce((H,ae)=>H+ae,0)*1.25);let Ee=0;ze[0]=Ut($,ue,ie,Ee),be[0]=tn($,ze[0]);for(let H=0;H<ke-1;H++){const ae=_e[H]??1,ve=be[H]??0,ye=Ia($,ve),xe=w*xf(C,F,ye),Fe=wf($,ue,ie,Ee,ae,Te),Ve=Ee+ae;let We=De.lerp(Fe,Ve,xe);const Be=k*ae;We-Ee<Be&&(We=Math.min(Ee+Be,Ee+Te)),Ee=We;const je=Ut($,ue,ie,Ee);ze[H+1]=je,be[H+1]=tn($,je)}return{P:ze,K:be}}function q($,ue,ie,_e,ke,ze,be,Ce,Te,Ee,H,ae,ve,ye,xe,Fe){if($.length===0||ie.length<2)return;const{P:Ve,K:We}=G(ie,_e,ke,ue),Be=new Array($.length),je=new Array($.length);for(let Ae=0;Ae<$.length;Ae++){const Le=We[Ae]??0,Re=Ko(ie,Le);let Pe=Xo(Re,H,ae);const He=Xe.v1.copy(Ve[Ae]??new A).sub(ye);Pe.dot(He)<0&&Pe.multiplyScalar(-1),Ae>0&&(Pe=Xe.v2.copy(je[Ae-1]??new A).lerp(Pe,M).normalize()),je[Ae]=Pe;const Ge=Ia(ie,Le),it=De.clamp(Ge/(Math.PI/2),0,1),St=1-x*it,ct=De.clamp(St,y,1),Yt=ve*ct;Be[Ae]=Xe.v3.copy(Ve[Ae]??new A).addScaledVector(Pe,Yt).clone()}for(let Ae=0;Ae<$.length;Ae++){$[Ae]&&Be[Ae]&&Q($[Ae],Be[Ae]);const Le=Xe.v4.set(0,0,0);Ae<$.length-1&&Be[Ae+1]&&Be[Ae]?Le.copy(Be[Ae+1]).sub(Be[Ae]):Be[Ae]&&Be[Ae-1]?Le.copy(Be[Ae]).sub(Be[Ae-1]):Be[Ae]&&Le.copy(Be[Ae]);const Re=Xe.v5.copy(Le);Re.lengthSq()<=1e-12?Re.set(1,0,0):Re.normalize();let Pe=Xe.v1.copy(H).addScaledVector(Re,-H.dot(Re));if(Pe.lengthSq()<1e-8){const ct=Math.abs(Re.dot(Ee))<Math.abs(Re.dot(Te))?Ee:Te;Pe.copy(ct).addScaledVector(Re,-ct.dot(Re))}Pe.normalize();let He=Xe.v2.copy(new A().crossVectors(je[Ae]??new A,Re)).normalize();He.multiplyScalar(1-c).add(Xe.v3.copy(Pe).multiplyScalar(c)),He.lengthSq()<1e-10&&He.copy(Pe),He.normalize();let Ge=Xe.v1.copy(new A().crossVectors(Re,He)).normalize();const it=Xe.v2.copy(Be[Ae]??new A).sub(ye);Ge.dot(it)<0&&Ge.multiplyScalar(-1),He.copy(new A().crossVectors(Ge,Re)).normalize();const St=bf(Re,He,Ge,ze,be,Ce);if(xe&&xe[Ae]){const ct=xe[Ae].update(Fe,St,Xe.q2);$[Ae]&&B($[Ae],ct)}else $[Ae]&&B($[Ae],St);$[Ae]&&$[Ae].scale.set(1,1,1)}}let le=performance.now()*.001,re=null,Z=null,ee=null;const Me=new js(D.posMinCutoff,D.beta,D.dCutoff),Se=V.map(()=>new _r(D.rotMinCutoff,D.beta,D.dCutoff)),de=P.map(()=>new _r(D.rotMinCutoff,D.beta,D.dCutoff));let ce=0,fe=null,te=0,se=0;const W=(o.tube?.cfg?.tubeRadius??.4)*100,Y=.1,N=new A;let ne=0,J=0,K=1,we=!1;function me(){const $=r.getRingWorldSnapshot?.();if(!$)return!1;const ue=$.ringWorld;if(!ue||ue.length<2)return!1;const ie=xr(re,$.planeQuat);re=ie.clone();const{right:_e,up:ke,z:ze}=Sr(ie);Z=_e.clone(),ee=ke.clone();const be=_>0?Wa(ue,_):ue,Ce=Ra(be),Te=Mr(be,_e,ke)>=0?1:-1;J=be.length,K=Te;let Ee=0,H,ae;if(e.mode==="corner"){const Pe=r.getCornerAnchorIndex(e.corner),He=Pe>=0?Pe%ue.length:0;Ee=tn(be,ue[He]??new A);const Ge=Oa(e.corner,_e,ke);H=Ge.axisH,ae=Ge.axisV}else{const Pe=e.side==="RIGHT"?_e.clone():e.side==="LEFT"?_e.clone().negate():e.side==="TOP"?ke.clone():ke.clone().negate();Ee=ge(be,Ce,Pe);const He=za(e.side,_e,ke);H=He.axisH,ae=He.axisV}se=Ee,N.copy(be[se]??new A);const ve=Math.max(1e-4,Qo(be)),ye=Math.min(ve*.01,.05),[xe,Fe]=Ga(be,se,H,ae,ye);ce=xe>=Fe?0:1,fe=null,te=0;const Ve=Ko(be,se);let We=Xo(Ve,ze,Te);const Be=Xe.v1.copy(be[se]??new A).sub(Ce);We.dot(Be)<0&&We.multiplyScalar(-1);const je=Xe.v2.copy(be[se]??new A).addScaledVector(We,m);U.position.copy(je),U.quaternion.copy(ie).multiply(a);const Ae=ce===0?1:-1,Le=ce===0?-1:1;q(V,S,be,se,Ae,E,u,f,_e,ke,ze,Te,m,Ce,null,1/60),q(P,L,be,se,Le,I,d,h,_e,ke,ze,Te,m,Ce,null,1/60),Me.update(1/60,je,Xe.v3);const Re=Xe.q1;for(let Pe=0;Pe<V.length;Pe++)V[Pe]&&Se[Pe]&&(V[Pe].getWorldQuaternion(Re),Se[Pe].update(1/60,Re,Xe.q2));for(let Pe=0;Pe<P.length;Pe++)P[Pe]&&de[Pe]&&(P[Pe].getWorldQuaternion(Re),de[Pe].update(1/60,Re,Xe.q2));return U.updateMatrixWorld(!0),we=!0,U.visible=!0,le=performance.now()*.001,!0}function ge($,ue,ie){let _e=0,ke=-1/0;const ze=ie.clone().normalize();for(let be=0;be<$.length;be++){const Te=($[be]??new A).clone().sub(ue).normalize().dot(ze);Te>ke&&(ke=Te,_e=be)}return _e}function he($){_=Math.max(0,$|0)}function pe(){if(!we)return me(),void 0;const $=performance.now()*.001,ue=De.clamp($-le,1/240,1/20);le=$;const ie=r.getRingWorldSnapshot(),_e=ie.ringWorld;if(_e.length<2)return;const ke=xr(re,ie.planeQuat);re=ke.clone();let{right:ze,up:be,z:Ce}=Sr(ke),Te=ze.clone(),Ee=be.clone();Z&&ee&&Z.dot(ze)+ee.dot(be)<0&&(Te.multiplyScalar(-1),Ee.multiplyScalar(-1)),Z=Te.clone(),ee=Ee.clone();const H=_>0?Wa(_e,_):_e,ae=Ra(H),ve=Mr(H,Te,Ee)>=0?1:-1;(H.length!==J||ve!==K)&&(se=tn(H,N)),J=H.length,K=ve;let xe=0,Fe,Ve;if(e.mode==="corner"){const Rt=r.getCornerAnchorIndex(e.corner),Ct=Rt>=0?Rt%_e.length:0;xe=tn(H,_e[Ct]??new A);const Qt=Oa(e.corner,Te,Ee);Fe=Qt.axisH,Ve=Qt.axisV}else{const Rt=e.side==="RIGHT"?Te.clone():e.side==="LEFT"?Te.clone().negate():e.side==="TOP"?Ee.clone():Ee.clone().negate();xe=ge(H,ae,Rt);const Ct=za(e.side,Te,Ee);Fe=Ct.axisH,Ve=Ct.axisV}const We=H[xe]??H[0];(We?We.distanceTo(N):0)>W?(ne++,ne<Y?xe=tn(H,N):ne=0):ne=0;const Ae=of(H,xe,se,D.anchorRadius);se=Ae,N.copy(H[Ae]??new A);const Le=Ko(H,Ae);let Re=Xo(Le,Ce,ve);const Pe=Xe.v1.copy(H[Ae]??new A).sub(ae);Re.dot(Pe)<0&&Re.multiplyScalar(-1);const He=Xe.v2.copy(H[Ae]??new A).addScaledVector(Re,m),Ge=Me.update(ue,He,Xe.v3);U.position.copy(Ge),U.quaternion.copy(ke).multiply(a);const it=Math.max(1e-4,Qo(H)),St=Math.min(it*.01,.05),[ct,Yt]=Ga(H,Ae,Fe,Ve,St);let Mt=ct>=Yt?0:1;const Xt=Math.abs(ct-Yt);Mt!==ce?Xt>=D.dirMargin?D.dirFrames<=0?(ce=Mt,fe=null,te=0):fe===Mt?(te++,te>=D.dirFrames&&(ce=Mt,fe=null,te=0)):(fe=Mt,te=1):(fe=null,te=0,Mt=ce):(fe=null,te=0);const dn=ce===0?1:-1,Mo=ce===0?-1:1;q(V,S,H,Ae,dn,E,u,f,Te,Ee,Ce,ve,m,ae,Se,ue),q(P,L,H,Ae,Mo,I,d,h,Te,Ee,Ce,ve,m,ae,de,ue),j&&j.update(performance.now()*.001),U.updateMatrixWorld(!0)}function Ie($){U.visible=$}function Oe(){U.traverse($=>{const ue=$;if(ue?.isMesh){const ie=ue.material;Array.isArray(ie)?ie.forEach(_e=>_e.dispose?.()):ie?.dispose?.(),ue.geometry?.dispose?.()}}),t.remove(U),j?.dispose()}return{root:U,update:pe,show:Ie,setOpacity:X,setSmoothPasses:he,dispose:Oe}}function xf(o,t,r){const l=De.clamp((r-o)/Math.max(1e-6,t-o),0,1);return l*l*(3-2*l)}const Sf="/assets/cornerTR-DZyV4bvD.glb",Mf="/assets/cornerTL-D8k8UNsS.glb",Cf="/assets/cornerBM-BZaANnLg.glb";async function Af(o,t,r,l){const n=[{side:"RIGHT",url:Sf},{side:"LEFT",url:Mf},{side:"BOTTOM",url:Cf}],a=(await Promise.all(n.map(({side:c,url:u})=>_f({scene:o,tube:r,cornerUrl:u,anchor:{mode:"sideMid",side:c},fur:{enabled:!0,density:180,length:.095,intensity:.02,speed:.6,color:14626182,tipColor:16777215,onTop:!1,opacity:.15,seed:2595},...l})))).filter(Boolean);let i=typeof l?.smoothPasses=="number"?l.smoothPasses:1;const s=c=>{i=Math.max(0,c|0);for(const u of a)u.setSmoothPasses?.(i)};return s(i),{rigs:a,updateAll(){for(const c of a)c.update()},showAll(c){for(const u of a)u.show(c)},setSmoothPasses:s,dispose(){for(const c of a)c.dispose()}}}function Tf(o,t,r){if(r<=1e-9)return Math.min(o,t);const l=Math.max(r-Math.abs(o-t),0)/r;return Math.min(o,t)-l*l*l*(r/6)}function kf(o,t,r,l,n,e){const a=new oe().subVectors(o,t),i=a.dot(r),s=a.dot(l),c=Math.abs(i)-n,u=Math.abs(s)-e,f=Math.max(c,0),d=Math.max(u,0),h=Math.hypot(f,d),g=Math.min(Math.max(c,u),0);return h+g}function Ff(o,t,r,l){const n=[],e=Math.max(160,Math.floor(l)),a=r/64;for(let i=0;i<e;i++){const s=i/e*Math.PI*2,c=new oe(Math.cos(s),Math.sin(s));let u=r,f=o(new oe(t.x+c.x*u,t.y+c.y*u)),d=u,h=f;for(;d>0&&(d-=a,h=o(new oe(t.x+c.x*d,t.y+c.y*d)),!(h<=0)););if(d<=0&&h>0)continue;for(;f<=0&&u<r;)u+=a,f=o(new oe(t.x+c.x*u,t.y+c.y*u));let g=Math.max(0,d),v=Math.min(r,u);for(let m=0;m<18;m++){const p=.5*(g+v);o(new oe(t.x+c.x*p,t.y+c.y*p))>0?v=p:g=p}const b=.5*(g+v);n.push(new A(t.x+c.x*b,t.y+c.y*b,0))}return n}function Uf(o,t){if(o.length<4)return o;let r=o.slice();for(let l=0;l<t;l++){const n=[];for(let e=0;e<r.length;e++){const a=r[e]??new A,i=r[(e+1)%r.length]??new A;n.push(new A().lerpVectors(a,i,.35),new A().lerpVectors(a,i,.65))}r=n}return r}function Lf(o={}){const t={color:o.color??16731558,opacity:Math.max(0,Math.min(1,o.opacity??.25)),tubeRadius:Math.max(.001,o.tubeRadius??.4),margin:Math.max(0,o.margin??.5),smoothUnionRadius:Math.max(0,o.smoothUnionRadius??2.5),pathSegments:Math.max(120,Math.floor(o.pathSegments??280)),radialSegments:Math.max(6,Math.floor(o.radialSegments??10)),closed:o.closed??!0,fur:{enabled:o.fur?.enabled??!0,countU:Math.max(12,Math.floor(o.fur?.countU??80)),countV:Math.max(3,Math.floor(o.fur?.countV??6)),length:Math.max(.001,o.fur?.length??.1),sway:Math.max(0,o.fur?.sway??.5*(o.fur?.length??.1)),speed:Math.max(0,o.fur?.speed??.6),baseColor:o.fur?.baseColor??16731558,tipColor:o.fur?.tipColor??16777215,onTop:o.fur?.onTop??!0,seed:o.fur?.seed??1337,opacity:o.fur?.opacity??.2}},r=new dt;r.name="TubeOutline",r.matrixAutoUpdate=!1;const l=new ds({color:t.color,transparent:!0,opacity:t.opacity,roughness:.85,metalness:.05,depthTest:!0,depthWrite:!1,side:Rr}),n=new Ye(new Tt,l);n.frustumCulled=!1,r.add(n);const e=new ht({colorWrite:!1,depthWrite:!0,depthTest:!0}),a=new Ye(n.geometry,e);a.frustumCulled=!1,r.add(a);const i={enabled:t.fur.enabled,simplex:new _o(String(t.fur.seed)),lines:null,positions:null,colors:null,anchors:[],tubular:t.pathSegments,radial:t.radialSegments};if(i.enabled){const R=Math.max(1,Math.floor(t.pathSegments/t.fur.countU)),U=Math.max(1,Math.floor(t.radialSegments/t.fur.countV));for(let E=0;E<=t.pathSegments;E+=R)for(let I=0;I<=t.radialSegments;I+=U)i.anchors.push({u:E,v:I,len:t.fur.length*(.85+.3*Math.random())});const j=i.anchors.length,z=new Float32Array(j*2*3),X=new Float32Array(j*2*3),V=new Je(t.fur.baseColor),P=new Je(t.fur.tipColor);for(let E=0;E<j;E++){const I=(E*2+0)*3,B=(E*2+1)*3;X[I+0]=V.r,X[I+1]=V.g,X[I+2]=V.b,X[B+0]=P.r,X[B+1]=P.g,X[B+2]=P.b}const O=new Tt;O.setAttribute("position",new Ln(z,3)),O.setAttribute("color",new Ln(X,3)),O.setDrawRange(0,j*2);const S=new Lr({vertexColors:!0,transparent:!0,opacity:t.fur.opacity,depthTest:!0,depthWrite:!1}),L=new gs(O,S);L.frustumCulled=!1,r.add(L),i.lines=L,i.positions=z,i.colors=X}const s=new A,c=new A,u=new A,f=new A,d=new A,h=new A;let g=null,v=null,b=null;function m(R,U,j,z,X=new A){const V=h.copy(R).sub(U),P=z.dot(V);if(Math.abs(P)<1e-6){const S=d.copy(R).sub(j),L=z.dot(S);return X.copy(R).sub(d.copy(z).multiplyScalar(L))}const O=z.dot(d.copy(j).sub(U))/P;return X.copy(U).addScaledVector(V,O)}function p(R,U){const j=R.cards.length;if(!j){v=null,b=null,g=null;return}const z=new A().copy(nt);U.getWorldDirection(u).normalize(),c.set(0,1,0).applyQuaternion(U.quaternion).normalize();const X=new Ne().setFromRotationMatrix(new wt().lookAt(z,z.clone().add(u.multiplyScalar(1)),c)),V=new wt().compose(z,X,new A(1,1,1)).invert();U.getWorldPosition(f);const P=[],O=[],S=[],L=[],E=[];let I=1/0,B=1/0,Q=-1/0,G=-1/0;const q=ft(),le=t.margin+t.tubeRadius;for(let fe=0;fe<j;fe++){const te=R.cards[fe];if(te.mode==="focused"||te.mode==="focus_in")continue;const se=Math.max(1e-4,(te.cardWidth??$e)*q),W=$e*q,Y=[new A(-se/2,-W/2,0),new A(se/2,-W/2,0),new A(se/2,W/2,0),new A(-se/2,W/2,0)],N=[];let ne=1/0,J=1/0,K=-1/0,we=-1/0;for(let H=0;H<4;H++){const ae=te.group?.matrixWorld?te.group:void 0;if(!ae)continue;const ve=Y[H];if(!ve)continue;const ye=ve.clone().applyMatrix4(ae.matrixWorld),Fe=m(ye,f,z,u,s).applyMatrix4(V);N.push(new oe(Fe.x,Fe.y)),Fe.x<ne&&(ne=Fe.x),Fe.x>K&&(K=Fe.x),Fe.y<J&&(J=Fe.y),Fe.y>we&&(we=Fe.y)}const me=ne-t.margin,ge=J-t.margin,he=K+t.margin,pe=we+t.margin;me<I&&(I=me),he>Q&&(Q=he),ge<B&&(B=ge),pe>G&&(G=pe);const Ie=new oe(.25*((N[0]?.x??0)+(N[1]?.x??0)+(N[2]?.x??0)+(N[3]?.x??0)),.25*((N[0]?.y??0)+(N[1]?.y??0)+(N[2]?.y??0)+(N[3]?.y??0)));let Oe=0,$=0,ue=0;for(let H=0;H<4;H++){const ae=(N[H]?.x??0)-Ie.x,ve=(N[H]?.y??0)-Ie.y;Oe+=ae*ae,$+=ae*ve,ue+=ve*ve}const ie=Oe+ue,_e=Oe*ue-$*$,ke=Math.sqrt(Math.max(0,ie*ie*.25-_e)),ze=ie*.5+ke;let be=new oe($,ze-Oe);be.lengthSq()<1e-10&&be.set(ze-ue,$),be.lengthSq()<1e-10&&be.set(1,0),be.normalize();const Ce=new oe(-be.y,be.x);let Te=0,Ee=0;for(let H=0;H<4;H++){const ae=new oe().subVectors(N[H]??new oe,Ie);Te=Math.max(Te,Math.abs(ae.dot(be))),Ee=Math.max(Ee,Math.abs(ae.dot(Ce)))}Te+=le,Ee+=le,P.push(Ie),L.push(be),E.push(Ce),O.push(Te),S.push(Ee)}isFinite(I)&&isFinite(Q)&&isFinite(B)&&isFinite(G)?g={w:Math.max(0,Q-I),h:Math.max(0,G-B)}:g=null;const re=fe=>{let te=1/0;for(let se=0;se<P.length;se++){const W=kf(fe,P[se]??new oe,L[se]??new oe(1,0),E[se]??new oe(0,1),O[se]??0,S[se]??0);te=Tf(te,W,t.smoothUnionRadius)}return te},Z=new oe((I+Q)*.5,(B+G)*.5),ee=Math.hypot(Q-Z.x,G-Z.y)*1.35||1,Me=Uf(Ff(re,Z,ee,t.pathSegments),1);v=Me.map(fe=>fe.clone()),b=Z.clone();const Se=new hs(Me,!0,"centripetal",.5),de=new ps(Se,t.pathSegments,t.tubeRadius,t.radialSegments,t.closed),ce=n.geometry;n.geometry=de,a.geometry=de,ce.dispose(),i.tubular=t.pathSegments,i.radial=t.radialSegments,r.position.copy(z),r.quaternion.copy(X),r.updateMatrix()}function x(R){if(!i.enabled||!i.lines||!i.positions)return;const U=n.geometry,j=U.getAttribute("position"),z=U.getAttribute("normal");if(!j||!z)return;const X=i.tubular,V=i.radial,P=i.positions,O=performance.now()*.001*t.fur.speed,S=new A(0,0,1),L=new A(1,0,0);for(let I=0;I<i.anchors.length;I++){const B=i.anchors[I];if(!B)continue;const{u:Q,v:G,len:q}=B,le=Math.min(Q,X),re=Math.min(G,V),Z=le*(V+1)+re,ee=j.getX(Z),Me=j.getY(Z),Se=j.getZ(Z),de=z.getX(Z),ce=z.getY(Z),fe=z.getZ(Z),te=new A(ee,Me,Se),se=new A(de,ce,fe).normalize();let W=new A().crossVectors(se,S);W.lengthSq()<1e-6&&W.crossVectors(se,L),W.normalize();const Y=new A().crossVectors(se,W).normalize(),N=i.simplex.noise4D(te.x,te.y,te.z,O),ne=Math.cos(N),J=Math.sin(N),K=t.fur.sway,we=new A().addScaledVector(W,ne*K).addScaledVector(Y,J*K),me=new A().copy(te).addScaledVector(se,q).add(we),ge=(I*2+0)*3,he=(I*2+1)*3;P[ge+0]=te.x,P[ge+1]=te.y,P[ge+2]=te.z,P[he+0]=me.x,P[he+1]=me.y,P[he+2]=me.z}const E=i.lines.geometry;E.getAttribute("position").needsUpdate=!0}function y(R,U,j){p(R,U),x()}function _(R){t.margin=Math.max(0,R)}function M(){return g?{...g}:null}function w(R){if(!v||!b||!v.length)return-1;const U=R.clone().normalize();let j=0,z=-1/0;for(let X=0;X<v.length;X++){const V=v[X];if(!V)continue;const P=new oe(V.x-b.x,V.y-b.y).normalize(),O=P.x*U.x+P.y*U.y;O>z&&(z=O,j=X)}return j}function C(R,U,j){let z=(R+U)%j;return z<0&&(z+=j),z}function F(R){if(!v||!b||!v.length)return null;const U=v.length,j=new oe(-1,0),z=new oe(1,0),X=w(j),V=w(z);if(X<0||V<0)return null;const P=Math.max(1,Math.round(U*.01));let O=0,S=5,L=5;R==="TL"?O=C(X,-P*S,U):R==="BL"?O=C(X,+P*L,U):R==="TR"?O=C(V,-P*L,U):O=C(V,+P*S,U);const E=v[O];return E?E.clone().applyQuaternion(r.quaternion).add(r.position):null}function k(){return{TL:F("TL"),TR:F("TR"),BR:F("BR"),BL:F("BL")}}function D(){if(!v||!v.length||!b)return{ringWorld:[],centerWorld:new A,planeQuat:r.quaternion.clone()};const R=v.map(j=>j.clone().applyQuaternion(r.quaternion).add(r.position)),U=new A(b.x,b.y,0).applyQuaternion(r.quaternion).add(r.position);return{ringWorld:R,centerWorld:U,planeQuat:r.quaternion.clone()}}function T(R){if(!v||!b||!v.length)return-1;const U={TL:new oe(-1,1).normalize(),TR:new oe(1,1).normalize(),BR:new oe(1,-1).normalize(),BL:new oe(-1,-1).normalize()}[R];let j=0,z=-1/0;for(let X=0;X<v.length;X++){const V=v[X];if(!V)continue;const P=new oe(V.x-b.x,V.y-b.y).normalize(),O=P.x*U.x+P.y*U.y;O>z&&(z=O,j=X)}return j}return{group:r,update:y,setInnerMargin:_,getLastPlaneBounds:M,cfg:t,getAttachPointForCorner:F,getAttachPointsAll:k,getRingWorldSnapshot:D,getCornerAnchorIndex:T}}function Ot(o){if(o==null)return;const t=Number(o);return Number.isFinite(t)?t:void 0}function Df(){const o=new URLSearchParams(typeof window<"u"?window.location.search:""),t={},r={};return t.gapNarrowPx=Ot(o.get("ovGapNarrow")),t.gapWidePx=Ot(o.get("ovGapWide")),t.breakpointPx=Ot(o.get("ovBreak")),t.worldGap=Ot(o.get("ovWorldGap")),r.outerMarginX=Ot(o.get("vpMarginX")),r.outerMarginY=Ot(o.get("vpMarginY")),r.padFudge=Ot(o.get("vpPadFudge")),{overlay:t,viewport:r}}function Ys(){const o={overlay:{gapNarrowPx:25,gapWidePx:5,breakpointPx:1200,worldGap:NaN},viewport:{outerMarginX:.15,outerMarginY:.22,padFudge:.3}},r=(typeof window<"u"?window:{ArcanaConfig:void 0}).ArcanaConfig||{},l=Df();return{overlay:{gapNarrowPx:zt(l.overlay?.gapNarrowPx,r.overlay?.gapNarrowPx,o.overlay.gapNarrowPx),gapWidePx:zt(l.overlay?.gapWidePx,r.overlay?.gapWidePx,o.overlay.gapWidePx),breakpointPx:zt(l.overlay?.breakpointPx,r.overlay?.breakpointPx,o.overlay.breakpointPx),worldGap:zt(l.overlay?.worldGap,r.overlay?.worldGap,o.overlay.worldGap)},viewport:{outerMarginX:zt(l.viewport?.outerMarginX,r.viewport?.outerMarginX,o.viewport.outerMarginX),outerMarginY:zt(l.viewport?.outerMarginY,r.viewport?.outerMarginY,o.viewport.outerMarginY),padFudge:zt(l.viewport?.padFudge,r.viewport?.padFudge,o.viewport.padFudge)}}}function zt(o,t,r){return o!==void 0?o:t!==void 0?t:r}function Rf(o,t=800){let r=null,l=null,n=null,e=null,a=2;const i=Ys(),s=i.overlay.gapNarrowPx??25,c=i.overlay.gapWidePx??5,u=i.overlay.breakpointPx??1200,f=i.overlay.worldGap;function d(g,v,b){const m=(()=>{const _=new A,M=new A;g.getWorldPosition(_),g.getWorldDirection(M).normalize();const C=nt.clone().sub(_);return Math.abs(M.dot(C))})(),p=De.degToRad(g.fov),x=2*Math.tan(p/2)*m,y=v.getSize(new oe);return x*(b/Math.max(1,y.y))}return{system:{id:"ui.overlay",priority:t,async init(g){a=g.renderer.getSize(new oe).x<u?s:c,r||(r=Lf({color:19878,opacity:0,tubeRadius:.1615,margin:1,smoothUnionRadius:.38,pathSegments:100,radialSegments:20,closed:!0,fur:{enabled:!0,countU:250,countV:30,length:.091,sway:.08,speed:1,baseColor:16731558,tipColor:16777215,onTop:!0,opacity:.6,seed:2595}}));const b=g.scene;r?.group&&b.children.indexOf(r.group)===-1&&b.add(r.group),l||(l=Ku({tubularSegments:30,radialSegments:20}),l?.group&&b.children.indexOf(l.group)===-1&&b.add(l.group)),n||(n=await yf(b,g.camera,r)),e||(e=await Af(b,g.camera,r,{smoothPasses:1,normalSmooth:.45,cornerSoftness:.7,minAttachFactor:.55,arcBlendStrength:.75,minArcFrac:.4,attachPadding:.2,faceAxisLocal:"-z",thicknessAxisLocalH:"-z",thicknessAxisLocalV:"-x",initialOpacity:.32,smoothing:{posMinCutoff:2,rotMinCutoff:3,beta:.4,derivativeCutoff:1,dirHysteresisMargin:.12,dirHysteresisFrames:0,anchorSearchRadius:6}}))},onResize(g,v){a=g<u?s:c},update(g,v){if(!r||!l)return;const b=o.getSystem(),m=v.camera,p=a;Number.isNaN(f)?r.setInnerMargin(d(m,v.renderer,p)):r.setInnerMargin(f),r.update(b,m,g);const x=o.isMoving?.()??!1;e&&(e.setSmoothPasses(x?0:1),e.updateAll()),l.update(m,r,g),n?.update?.()},dispose(){}},get:()=>({tubeOutline:r,cornerConduits:l,overlayTB:n,sideMids:e})}}const Pf={redDur:1.17647,redPeak:.9,pauseAfterRed:.18,greenIntensity:.9,greenFadeDur:.35,redHex:16711680,greenHex:1572718,yellowHex:16776960};function go(o){if(!o)return[];const t=[];return o.traverse(r=>{r?.isMesh&&t.push(r)}),t}class Xs{meshes;cfg;state="idle";t=0;wantActive=!1;afterFade=null;colorRed;colorGreen;colorYellow;listeners=new Set;onStateChange(t){return this.listeners.add(t),()=>this.listeners.delete(t)}emit(){for(const t of this.listeners)t(this.state)}setState(t){this.state!==t&&(this.state=t,this.emit())}getState(){return this.state}waitUntil(t){return this.state===t?Promise.resolve():new Promise(r=>{const l=this.onStateChange(n=>{n===t&&(l(),r())})})}constructor(t,r){this.meshes=t,this.cfg={...Pf,...r||{}},this.colorRed=new Je(this.cfg.redHex),this.colorGreen=new Je(this.cfg.greenHex),this.colorYellow=new Je(this.cfg.yellowHex);for(const l of this.meshes){const n=l.material,e=a=>{const i=a.clone?.()??a;return i.isMeshStandardMaterial||i.isMeshPhysicalMaterial?(i.emissive||(i.emissive=new Je(0)),typeof i.emissiveIntensity!="number"&&(i.emissiveIntensity=0),i.map&&"colorSpace"in i.map&&(i.map.colorSpace=ot),i.emissiveMap&&"colorSpace"in i.emissiveMap&&(i.emissiveMap.colorSpace=ot)):i.emissive||(i.emissive=new Je(0)),i.needsUpdate=!0,i};Array.isArray(n)?l.material=n.map(e):l.material=e(n)}this.setColor(this.colorYellow),this.setIntensity(0),this.setState("yellowFadeIn"),this.t=0}pulseRed(){this.setState("redPulse"),this.t=0,this.afterFade=null,this.setColor(this.colorRed),this.setIntensity(0)}setActive(t){this.wantActive=t,t?this.state==="yellowHold"||this.state==="yellowFadeIn"?(this.setState("yellowFadeOut"),this.t=0,this.afterFade="greenFadeIn"):(this.state==="idle"||this.state==="greenFadeOut"||this.state==="yellowFadeOut")&&(this.state==="greenFadeOut"||this.state==="yellowFadeOut"?this.afterFade="greenFadeIn":(this.setState("greenFadeIn"),this.t=0,this.afterFade=null,this.setColor(this.colorGreen),this.setIntensity(0))):(this.state==="greenHold"||this.state==="greenFadeIn")&&(this.setState("greenFadeOut"),this.t=0,this.afterFade="yellowFadeIn")}tick(t){switch(this.state){case"redPulse":{const r=Math.min(1,this.t/this.cfg.redDur),l=Math.sin(Math.PI*r);this.setColor(this.colorRed),this.setIntensity(this.cfg.redPeak*l),this.t+=t,r>=1&&(this.setIntensity(0),this.wantActive?(this.setState("pauseAfterRed"),this.t=0):(this.setState("yellowFadeIn"),this.t=0,this.setColor(this.colorYellow),this.setIntensity(0)));break}case"pauseAfterRed":{if(this.t+=t,!this.wantActive){this.setState("yellowFadeIn"),this.t=0,this.setColor(this.colorYellow),this.setIntensity(0);break}this.t>=this.cfg.pauseAfterRed&&(this.setState("greenFadeIn"),this.t=0,this.afterFade=null,this.setColor(this.colorGreen),this.setIntensity(0));break}case"greenFadeIn":{const r=Math.min(1,this.t/this.cfg.greenFadeDur),l=r*r*(3-2*r);this.setColor(this.colorGreen),this.setIntensity(this.cfg.greenIntensity*l),this.t+=t,r>=1&&(this.setState("greenHold"),this.setIntensity(this.cfg.greenIntensity));break}case"greenHold":{this.wantActive?this.setIntensity(this.cfg.greenIntensity):(this.setState("greenFadeOut"),this.t=0,this.afterFade="yellowFadeIn");break}case"greenFadeOut":{const r=Math.min(1,this.t/this.cfg.greenFadeDur),l=1-r;if(this.setColor(this.colorGreen),this.setIntensity(this.cfg.greenIntensity*l),this.t+=t,r>=1){const n=this.afterFade;this.afterFade=null,n?(this.setState(n),this.t=0,n==="yellowFadeIn"?(this.setColor(this.colorYellow),this.setIntensity(0)):n==="greenFadeIn"&&(this.setColor(this.colorGreen),this.setIntensity(0))):(this.setState("idle"),this.setIntensity(0))}break}case"yellowFadeIn":{const r=Math.min(1,this.t/this.cfg.greenFadeDur),l=r*r*(3-2*r);this.setColor(this.colorYellow),this.setIntensity(this.cfg.greenIntensity*l),this.t+=t,r>=1&&(this.setState("yellowHold"),this.setIntensity(this.cfg.greenIntensity));break}case"yellowHold":{this.wantActive?(this.setState("yellowFadeOut"),this.t=0,this.afterFade="greenFadeIn"):this.setIntensity(this.cfg.greenIntensity);break}case"yellowFadeOut":{const r=Math.min(1,this.t/this.cfg.greenFadeDur),l=1-r;if(this.setColor(this.colorYellow),this.setIntensity(this.cfg.greenIntensity*l),this.t+=t,r>=1){const n=this.afterFade;this.afterFade=null,n?(this.setState(n),this.t=0,n==="greenFadeIn"?(this.setColor(this.colorGreen),this.setIntensity(0)):n==="yellowFadeIn"&&(this.setColor(this.colorYellow),this.setIntensity(0))):(this.setState("idle"),this.setIntensity(0))}break}case"idle":default:{this.setIntensity(0);break}}}setColor(t){const r=l=>{l&&(l.emissive?l.emissive.copy(t):l.emissive=new Je(t),l.needsUpdate=!0)};for(const l of this.meshes){const n=l.material;Array.isArray(n)?n.forEach(r):r(n)}}setIntensity(t){const r=l=>{l&&(l.isMeshStandardMaterial||l.isMeshPhysicalMaterial?l.emissiveIntensity=t:l.emissive&&(l.__baseEmissive||(l.__baseEmissive=l.emissive.clone()),l.emissive.copy(l.__baseEmissive).multiplyScalar(t/Math.max(1e-6,this.cfg.greenIntensity))),l.needsUpdate=!0)};for(const l of this.meshes){const n=l.material;Array.isArray(n)?n.forEach(r):r(n)}}}async function mo(o,t){const r=new Ur,l=new as(60,1,.1,10);l.position.z=2;const n=new dt;r.add(n);const e=t.fronts.slice(0,Math.min(6,t.fronts.length));for(const u of e){const f=new mt($e*Math.max(.05,u.aspect||1),$e,1,1),d=new ht({map:u.texture,toneMapped:!1,fog:!1}),h=new Ye(f,d);n.add(h)}const a=new Ye(new mt($e,$e,1,1),new ht({map:t.back,toneMapped:!1,fog:!1})),i=a.clone();a.material.map&&(a.material.map.center.set(.5,.5),a.material.map.rotation=0),i.material.map&&(i.material.map=t.back,i.material.map.center.set(.5,.5),i.material.map.rotation=Math.PI/2),n.add(a,i),o.compile(r,l);const s=o.getRenderTarget(),c=new Fi(2,2,{depthBuffer:!1,stencilBuffer:!1});o.setRenderTarget(c),o.render(r,l),o.setRenderTarget(s);for(const u of n.children){const f=u;f.geometry.dispose();const d=f.material;d.map&&(d.map=null),d.dispose()}c.dispose()}function Ef(o,t=810){const r=[{rootName:"deck_btn_0",patternId:"custom:test0"},{rootName:"deck_btn_1",patternId:"custom:test1"},{rootName:"deck_btn_2",patternId:"custom:test3"},{rootName:"clasp_top_middle",patternId:"custom:test2"}],l=[];let n=null,e=!1;function a(){if(e)return;const i=qt()?.id??"";for(const s of l){const c=s.patternId===i;n&&s===n?s.rig.setActive(!0):s.rig.setActive(c)}}return{id:"ui.buttons",priority:t,async init(i){const s=o.getOverlayTB();if(!s?.group)return;const c=o.getInteractions(),u=o.getCardsSystem();if(!c||!u)return;function f(d,h){if(!d)return;const g=o.getInteractions();g&&d.traverse(v=>{v.isMesh&&g.registerObject(v,h)})}for(const d of r){const h=s.group.getObjectByName(d.rootName),g=h?.getObjectByName("mech");(y=>{const _=y?.material,M=w=>{w.depthWrite=!0,w.depthTest=!0,w.transparent=!0,w.needsUpdate=!0};Array.isArray(_)?_.forEach(w=>M(w)):_&&M(_)})(g);const b=new Xs(go(g),d.pulse??o.pulse),m={root:h,mech:g,rig:b,patternId:d.patternId},p=go(g);for(const y of p)y.layers.enable(1);l.push(m),f(h,async()=>{const y=Dn(),_=l.find(T=>T.patternId===y)||null;e=!0,b.pulseRed(),b.setActive(!0),_&&_!==l.find(T=>T.rig===b)&&_.rig.setActive(!0),vt.quaternion.set(0,0,0,1);const M=i.camera,w=new A(0,1,0).applyQuaternion(M.quaternion).normalize(),C=new wt().lookAt(nt,M.getWorldPosition(new A),w);vt.setRotationFromMatrix(C);const F=new Ne().setFromAxisAngle(new A(0,1,0),Math.PI);vt.quaternion.multiply(F),vt.position.copy(nt),vt.updateMatrixWorld();const k=d.patternId,D=await Rn(k).catch(()=>null);D&&(await mo(i.renderer,D),u.setImageDeck(D.fronts,D.back)),n=l.find(T=>T.rig===b)??null,Fc(k),a(),b.waitUntil("greenHold").then(()=>{_&&_!==n&&_.rig.setActive(!1),n=null,e=!1,a()})})}Ir(a),a()},update(i){for(const s of l)s.rig.tick(i)},dispose(){}}}const Qs="/assets/info_split_card-CET3QmFT.glb";function Bf(){var o=Object.create(null);function t(n,e){var a=n.id,i=n.name,s=n.dependencies;s===void 0&&(s=[]);var c=n.init;c===void 0&&(c=function(){});var u=n.getTransferables;if(u===void 0&&(u=null),!o[a])try{s=s.map(function(d){return d&&d.isWorkerModule&&(t(d,function(h){if(h instanceof Error)throw h}),d=o[d.id].value),d}),c=l("<"+i+">.init",c),u&&(u=l("<"+i+">.getTransferables",u));var f=null;typeof c=="function"?f=c.apply(void 0,s):console.error("worker module init function failed to rehydrate"),o[a]={id:a,value:f,getTransferables:u},e(f)}catch(d){d&&d.noLog||console.error(d),e(d)}}function r(n,e){var a,i=n.id,s=n.args;(!o[i]||typeof o[i].value!="function")&&e(new Error("Worker module "+i+": not found or its 'init' did not return a function"));try{var c=(a=o[i]).value.apply(a,s);c&&typeof c.then=="function"?c.then(u,function(f){return e(f instanceof Error?f:new Error(""+f))}):u(c)}catch(f){e(f)}function u(f){try{var d=o[i].getTransferables&&o[i].getTransferables(f);(!d||!Array.isArray(d)||!d.length)&&(d=void 0),e(f,d)}catch(h){console.error(h),e(h)}}}function l(n,e){var a=void 0;self.troikaDefine=function(s){return a=s};var i=URL.createObjectURL(new Blob(["/** "+n.replace(/\*/g,"")+` **/

troikaDefine(
`+e+`
)`],{type:"application/javascript"}));try{importScripts(i)}catch(s){console.error(s)}return URL.revokeObjectURL(i),delete self.troikaDefine,a}self.addEventListener("message",function(n){var e=n.data,a=e.messageId,i=e.action,s=e.data;try{i==="registerModule"&&t(s,function(c){c instanceof Error?postMessage({messageId:a,success:!1,error:c.message}):postMessage({messageId:a,success:!0,result:{isCallable:typeof c=="function"}})}),i==="callModule"&&r(s,function(c,u){c instanceof Error?postMessage({messageId:a,success:!1,error:c.message}):postMessage({messageId:a,success:!0,result:c},u||void 0)})}catch(c){postMessage({messageId:a,success:!1,error:c.stack})}})}function If(o){var t=function(){for(var r=[],l=arguments.length;l--;)r[l]=arguments[l];return t._getInitResult().then(function(n){if(typeof n=="function")return n.apply(void 0,r);throw new Error("Worker module function was called but `init` did not return a callable function")})};return t._getInitResult=function(){var r=o.dependencies,l=o.init;r=Array.isArray(r)?r.map(function(e){return e&&(e=e.onMainThread||e,e._getInitResult&&(e=e._getInitResult())),e}):[];var n=Promise.all(r).then(function(e){return l.apply(null,e)});return t._getInitResult=function(){return n},n},t}var Ks=function(){var o=!1;if(typeof window<"u"&&typeof window.document<"u")try{var t=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));t.terminate(),o=!0}catch(r){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+r.message+"]")}return Ks=function(){return o},o},Of=0,zf=0,$o=!1,Fn=Object.create(null),Un=Object.create(null),Cr=Object.create(null);function un(o){if((!o||typeof o.init!="function")&&!$o)throw new Error("requires `options.init` function");var t=o.dependencies,r=o.init,l=o.getTransferables,n=o.workerId,e=If(o);n==null&&(n="#default");var a="workerModule"+ ++Of,i=o.name||a,s=null;t=t&&t.map(function(u){return typeof u=="function"&&!u.workerModuleData&&($o=!0,u=un({workerId:n,name:"<"+i+"> function dependency: "+u.name,init:`function(){return (
`+oo(u)+`
)}`}),$o=!1),u&&u.workerModuleData&&(u=u.workerModuleData),u});function c(){for(var u=[],f=arguments.length;f--;)u[f]=arguments[f];if(!Ks())return e.apply(void 0,u);if(!s){s=Va(n,"registerModule",c.workerModuleData);var d=function(){s=null,Un[n].delete(d)};(Un[n]||(Un[n]=new Set)).add(d)}return s.then(function(h){var g=h.isCallable;if(g)return Va(n,"callModule",{id:a,args:u});throw new Error("Worker module function was called but `init` did not return a callable function")})}return c.workerModuleData={isWorkerModule:!0,id:a,name:i,dependencies:t,init:oo(r),getTransferables:l&&oo(l)},c.onMainThread=e,c}function Gf(o){Un[o]&&Un[o].forEach(function(t){t()}),Fn[o]&&(Fn[o].terminate(),delete Fn[o])}function oo(o){var t=o.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function Wf(o){var t=Fn[o];if(!t){var r=oo(Bf);t=Fn[o]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+o.replace(/\*/g,"")+` **/

;(`+r+")()"],{type:"application/javascript"}))),t.onmessage=function(l){var n=l.data,e=n.messageId,a=Cr[e];if(!a)throw new Error("WorkerModule response with empty or unknown messageId");delete Cr[e],a(n)}}return t}function Va(o,t,r){return new Promise(function(l,n){var e=++zf;Cr[e]=function(a){a.success?l(a.result):n(new Error("Error in worker "+t+" call: "+a.error))},Wf(o).postMessage({messageId:e,action:t,data:r})})}function Zs(){var o=function(t){function r(P,O,S,L,E,I,B,Q){var G=1-B;Q.x=G*G*P+2*G*B*S+B*B*E,Q.y=G*G*O+2*G*B*L+B*B*I}function l(P,O,S,L,E,I,B,Q,G,q){var le=1-G;q.x=le*le*le*P+3*le*le*G*S+3*le*G*G*E+G*G*G*B,q.y=le*le*le*O+3*le*le*G*L+3*le*G*G*I+G*G*G*Q}function n(P,O){for(var S=/([MLQCZ])([^MLQCZ]*)/g,L,E,I,B,Q;L=S.exec(P);){var G=L[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(q){return parseFloat(q)});switch(L[1]){case"M":B=E=G[0],Q=I=G[1];break;case"L":(G[0]!==B||G[1]!==Q)&&O("L",B,Q,B=G[0],Q=G[1]);break;case"Q":{O("Q",B,Q,B=G[2],Q=G[3],G[0],G[1]);break}case"C":{O("C",B,Q,B=G[4],Q=G[5],G[0],G[1],G[2],G[3]);break}case"Z":(B!==E||Q!==I)&&O("L",B,Q,E,I);break}}}function e(P,O,S){S===void 0&&(S=16);var L={x:0,y:0};n(P,function(E,I,B,Q,G,q,le,re,Z){switch(E){case"L":O(I,B,Q,G);break;case"Q":{for(var ee=I,Me=B,Se=1;Se<S;Se++)r(I,B,q,le,Q,G,Se/(S-1),L),O(ee,Me,L.x,L.y),ee=L.x,Me=L.y;break}case"C":{for(var de=I,ce=B,fe=1;fe<S;fe++)l(I,B,q,le,re,Z,Q,G,fe/(S-1),L),O(de,ce,L.x,L.y),de=L.x,ce=L.y;break}}})}var a="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",i="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",s=new WeakMap,c={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function u(P,O){var S=P.getContext?P.getContext("webgl",c):P,L=s.get(S);if(!L){let le=function(de){var ce=I[de];if(!ce&&(ce=I[de]=S.getExtension(de),!ce))throw new Error(de+" not supported");return ce},re=function(de,ce){var fe=S.createShader(ce);return S.shaderSource(fe,de),S.compileShader(fe),fe},Z=function(de,ce,fe,te){if(!B[de]){var se={},W={},Y=S.createProgram();S.attachShader(Y,re(ce,S.VERTEX_SHADER)),S.attachShader(Y,re(fe,S.FRAGMENT_SHADER)),S.linkProgram(Y),B[de]={program:Y,transaction:function(ne){S.useProgram(Y),ne({setUniform:function(K,we){for(var me=[],ge=arguments.length-2;ge-- >0;)me[ge]=arguments[ge+2];var he=W[we]||(W[we]=S.getUniformLocation(Y,we));S["uniform"+K].apply(S,[he].concat(me))},setAttribute:function(K,we,me,ge,he){var pe=se[K];pe||(pe=se[K]={buf:S.createBuffer(),loc:S.getAttribLocation(Y,K),data:null}),S.bindBuffer(S.ARRAY_BUFFER,pe.buf),S.vertexAttribPointer(pe.loc,we,S.FLOAT,!1,0,0),S.enableVertexAttribArray(pe.loc),E?S.vertexAttribDivisor(pe.loc,ge):le("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(pe.loc,ge),he!==pe.data&&(S.bufferData(S.ARRAY_BUFFER,he,me),pe.data=he)}})}}}B[de].transaction(te)},ee=function(de,ce){G++;try{S.activeTexture(S.TEXTURE0+G);var fe=Q[de];fe||(fe=Q[de]=S.createTexture(),S.bindTexture(S.TEXTURE_2D,fe),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,S.NEAREST),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,S.NEAREST)),S.bindTexture(S.TEXTURE_2D,fe),ce(fe,G)}finally{G--}},Me=function(de,ce,fe){var te=S.createFramebuffer();q.push(te),S.bindFramebuffer(S.FRAMEBUFFER,te),S.activeTexture(S.TEXTURE0+ce),S.bindTexture(S.TEXTURE_2D,de),S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_2D,de,0);try{fe(te)}finally{S.deleteFramebuffer(te),S.bindFramebuffer(S.FRAMEBUFFER,q[--q.length-1]||null)}},Se=function(){I={},B={},Q={},G=-1,q.length=0};var E=typeof WebGL2RenderingContext<"u"&&S instanceof WebGL2RenderingContext,I={},B={},Q={},G=-1,q=[];S.canvas.addEventListener("webglcontextlost",function(de){Se(),de.preventDefault()},!1),s.set(S,L={gl:S,isWebGL2:E,getExtension:le,withProgram:Z,withTexture:ee,withTextureFramebuffer:Me,handleContextLoss:Se})}O(L)}function f(P,O,S,L,E,I,B,Q){B===void 0&&(B=15),Q===void 0&&(Q=null),u(P,function(G){var q=G.gl,le=G.withProgram,re=G.withTexture;re("copy",function(Z,ee){q.texImage2D(q.TEXTURE_2D,0,q.RGBA,E,I,0,q.RGBA,q.UNSIGNED_BYTE,O),le("copy",a,i,function(Me){var Se=Me.setUniform,de=Me.setAttribute;de("aUV",2,q.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),Se("1i","image",ee),q.bindFramebuffer(q.FRAMEBUFFER,Q||null),q.disable(q.BLEND),q.colorMask(B&8,B&4,B&2,B&1),q.viewport(S,L,E,I),q.scissor(S,L,E,I),q.drawArrays(q.TRIANGLES,0,3)})})})}function d(P,O,S){var L=P.width,E=P.height;u(P,function(I){var B=I.gl,Q=new Uint8Array(L*E*4);B.readPixels(0,0,L,E,B.RGBA,B.UNSIGNED_BYTE,Q),P.width=O,P.height=S,f(B,Q,0,0,L,E)})}var h=Object.freeze({__proto__:null,withWebGLContext:u,renderImageData:f,resizeWebGLCanvasWithoutClearing:d});function g(P,O,S,L,E,I){I===void 0&&(I=1);var B=new Uint8Array(P*O),Q=L[2]-L[0],G=L[3]-L[1],q=[];e(S,function(de,ce,fe,te){q.push({x1:de,y1:ce,x2:fe,y2:te,minX:Math.min(de,fe),minY:Math.min(ce,te),maxX:Math.max(de,fe),maxY:Math.max(ce,te)})}),q.sort(function(de,ce){return de.maxX-ce.maxX});for(var le=0;le<P;le++)for(var re=0;re<O;re++){var Z=Me(L[0]+Q*(le+.5)/P,L[1]+G*(re+.5)/O),ee=Math.pow(1-Math.abs(Z)/E,I)/2;Z<0&&(ee=1-ee),ee=Math.max(0,Math.min(255,Math.round(ee*255))),B[re*P+le]=ee}return B;function Me(de,ce){for(var fe=1/0,te=1/0,se=q.length;se--;){var W=q[se];if(W.maxX+te<=de)break;if(de+te>W.minX&&ce-te<W.maxY&&ce+te>W.minY){var Y=m(de,ce,W.x1,W.y1,W.x2,W.y2);Y<fe&&(fe=Y,te=Math.sqrt(fe))}}return Se(de,ce)&&(te=-te),te}function Se(de,ce){for(var fe=0,te=q.length;te--;){var se=q[te];if(se.maxX<=de)break;var W=se.y1>ce!=se.y2>ce&&de<(se.x2-se.x1)*(ce-se.y1)/(se.y2-se.y1)+se.x1;W&&(fe+=se.y1<se.y2?1:-1)}return fe!==0}}function v(P,O,S,L,E,I,B,Q,G,q){I===void 0&&(I=1),Q===void 0&&(Q=0),G===void 0&&(G=0),q===void 0&&(q=0),b(P,O,S,L,E,I,B,null,Q,G,q)}function b(P,O,S,L,E,I,B,Q,G,q,le){I===void 0&&(I=1),G===void 0&&(G=0),q===void 0&&(q=0),le===void 0&&(le=0);for(var re=g(P,O,S,L,E,I),Z=new Uint8Array(re.length*4),ee=0;ee<re.length;ee++)Z[ee*4+le]=re[ee];f(B,Z,G,q,P,O,1<<3-le,Q)}function m(P,O,S,L,E,I){var B=E-S,Q=I-L,G=B*B+Q*Q,q=G?Math.max(0,Math.min(1,((P-S)*B+(O-L)*Q)/G)):0,le=P-(S+q*B),re=O-(L+q*Q);return le*le+re*re}var p=Object.freeze({__proto__:null,generate:g,generateIntoCanvas:v,generateIntoFramebuffer:b}),x="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",y="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",_="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",M=new Float32Array([0,0,2,0,0,2]),w=null,C=!1,F={},k=new WeakMap;function D(P){if(!C&&!j(P))throw new Error("WebGL generation not supported")}function T(P,O,S,L,E,I,B){if(I===void 0&&(I=1),B===void 0&&(B=null),!B&&(B=w,!B)){var Q=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!Q)throw new Error("OffscreenCanvas or DOM canvas not supported");B=w=Q.getContext("webgl",{depth:!1})}D(B);var G=new Uint8Array(P*O*4);u(B,function(Z){var ee=Z.gl,Me=Z.withTexture,Se=Z.withTextureFramebuffer;Me("readable",function(de,ce){ee.texImage2D(ee.TEXTURE_2D,0,ee.RGBA,P,O,0,ee.RGBA,ee.UNSIGNED_BYTE,null),Se(de,ce,function(fe){U(P,O,S,L,E,I,ee,fe,0,0,0),ee.readPixels(0,0,P,O,ee.RGBA,ee.UNSIGNED_BYTE,G)})})});for(var q=new Uint8Array(P*O),le=0,re=0;le<G.length;le+=4)q[re++]=G[le];return q}function R(P,O,S,L,E,I,B,Q,G,q){I===void 0&&(I=1),Q===void 0&&(Q=0),G===void 0&&(G=0),q===void 0&&(q=0),U(P,O,S,L,E,I,B,null,Q,G,q)}function U(P,O,S,L,E,I,B,Q,G,q,le){I===void 0&&(I=1),G===void 0&&(G=0),q===void 0&&(q=0),le===void 0&&(le=0),D(B);var re=[];e(S,function(Z,ee,Me,Se){re.push(Z,ee,Me,Se)}),re=new Float32Array(re),u(B,function(Z){var ee=Z.gl,Me=Z.isWebGL2,Se=Z.getExtension,de=Z.withProgram,ce=Z.withTexture,fe=Z.withTextureFramebuffer,te=Z.handleContextLoss;if(ce("rawDistances",function(se,W){(P!==se._lastWidth||O!==se._lastHeight)&&ee.texImage2D(ee.TEXTURE_2D,0,ee.RGBA,se._lastWidth=P,se._lastHeight=O,0,ee.RGBA,ee.UNSIGNED_BYTE,null),de("main",x,y,function(Y){var N=Y.setAttribute,ne=Y.setUniform,J=!Me&&Se("ANGLE_instanced_arrays"),K=!Me&&Se("EXT_blend_minmax");N("aUV",2,ee.STATIC_DRAW,0,M),N("aLineSegment",4,ee.DYNAMIC_DRAW,1,re),ne.apply(void 0,["4f","uGlyphBounds"].concat(L)),ne("1f","uMaxDistance",E),ne("1f","uExponent",I),fe(se,W,function(we){ee.enable(ee.BLEND),ee.colorMask(!0,!0,!0,!0),ee.viewport(0,0,P,O),ee.scissor(0,0,P,O),ee.blendFunc(ee.ONE,ee.ONE),ee.blendEquationSeparate(ee.FUNC_ADD,Me?ee.MAX:K.MAX_EXT),ee.clear(ee.COLOR_BUFFER_BIT),Me?ee.drawArraysInstanced(ee.TRIANGLES,0,3,re.length/4):J.drawArraysInstancedANGLE(ee.TRIANGLES,0,3,re.length/4)})}),de("post",a,_,function(Y){Y.setAttribute("aUV",2,ee.STATIC_DRAW,0,M),Y.setUniform("1i","tex",W),ee.bindFramebuffer(ee.FRAMEBUFFER,Q),ee.disable(ee.BLEND),ee.colorMask(le===0,le===1,le===2,le===3),ee.viewport(G,q,P,O),ee.scissor(G,q,P,O),ee.drawArrays(ee.TRIANGLES,0,3)})}),ee.isContextLost())throw te(),new Error("webgl context lost")})}function j(P){var O=!P||P===w?F:P.canvas||P,S=k.get(O);if(S===void 0){C=!0;var L=null;try{var E=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],I=T(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,P);S=I&&E.length===I.length&&I.every(function(B,Q){return B===E[Q]}),S||(L="bad trial run results",console.info(E,I))}catch(B){S=!1,L=B.message}L&&console.warn("WebGL SDF generation not supported:",L),C=!1,k.set(O,S)}return S}var z=Object.freeze({__proto__:null,generate:T,generateIntoCanvas:R,generateIntoFramebuffer:U,isSupported:j});function X(P,O,S,L,E,I){E===void 0&&(E=Math.max(L[2]-L[0],L[3]-L[1])/2),I===void 0&&(I=1);try{return T.apply(z,arguments)}catch(B){return console.info("WebGL SDF generation failed, falling back to JS",B),g.apply(p,arguments)}}function V(P,O,S,L,E,I,B,Q,G,q){E===void 0&&(E=Math.max(L[2]-L[0],L[3]-L[1])/2),I===void 0&&(I=1),Q===void 0&&(Q=0),G===void 0&&(G=0),q===void 0&&(q=0);try{return R.apply(z,arguments)}catch(le){return console.info("WebGL SDF generation failed, falling back to JS",le),v.apply(p,arguments)}}return t.forEachPathCommand=n,t.generate=X,t.generateIntoCanvas=V,t.javascript=p,t.pathToLineSegments=e,t.webgl=z,t.webglUtils=h,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return o}function Vf(){var o=function(t){var r={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},l={},n={};l.L=1,n[1]="L",Object.keys(r).forEach(function(te,se){l[te]=1<<se+1,n[l[te]]=te}),Object.freeze(l);var e=l.LRI|l.RLI|l.FSI,a=l.L|l.R|l.AL,i=l.B|l.S|l.WS|l.ON|l.FSI|l.LRI|l.RLI|l.PDI,s=l.BN|l.RLE|l.LRE|l.RLO|l.LRO|l.PDF,c=l.S|l.WS|l.B|e|l.PDI|s,u=null;function f(){if(!u){u=new Map;var te=function(W){if(r.hasOwnProperty(W)){var Y=0;r[W].split(",").forEach(function(N){var ne=N.split("+"),J=ne[0],K=ne[1];J=parseInt(J,36),K=K?parseInt(K,36):0,u.set(Y+=J,l[W]);for(var we=0;we<K;we++)u.set(++Y,l[W])})}};for(var se in r)te(se)}}function d(te){return f(),u.get(te.codePointAt(0))||l.L}function h(te){return n[d(te)]}var g={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function v(te,se){var W=36,Y=0,N=new Map,ne=se&&new Map,J;return te.split(",").forEach(function K(we){if(we.indexOf("+")!==-1)for(var me=+we;me--;)K(J);else{J=we;var ge=we.split(">"),he=ge[0],pe=ge[1];he=String.fromCodePoint(Y+=parseInt(he,W)),pe=String.fromCodePoint(Y+=parseInt(pe,W)),N.set(he,pe),se&&ne.set(pe,he)}}),{map:N,reverseMap:ne}}var b,m,p;function x(){if(!b){var te=v(g.pairs,!0),se=te.map,W=te.reverseMap;b=se,m=W,p=v(g.canonical,!1).map}}function y(te){return x(),b.get(te)||null}function _(te){return x(),m.get(te)||null}function M(te){return x(),p.get(te)||null}var w=l.L,C=l.R,F=l.EN,k=l.ES,D=l.ET,T=l.AN,R=l.CS,U=l.B,j=l.S,z=l.ON,X=l.BN,V=l.NSM,P=l.AL,O=l.LRO,S=l.RLO,L=l.LRE,E=l.RLE,I=l.PDF,B=l.LRI,Q=l.RLI,G=l.FSI,q=l.PDI;function le(te,se){for(var W=125,Y=new Uint32Array(te.length),N=0;N<te.length;N++)Y[N]=d(te[N]);var ne=new Map;function J(rt,gt){var at=Y[rt];Y[rt]=gt,ne.set(at,ne.get(at)-1),at&i&&ne.set(i,ne.get(i)-1),ne.set(gt,(ne.get(gt)||0)+1),gt&i&&ne.set(i,(ne.get(i)||0)+1)}for(var K=new Uint8Array(te.length),we=new Map,me=[],ge=null,he=0;he<te.length;he++)ge||me.push(ge={start:he,end:te.length-1,level:se==="rtl"?1:se==="ltr"?0:ra(he,!1)}),Y[he]&U&&(ge.end=he,ge=null);for(var pe=E|L|S|O|e|q|I|U,Ie=function(rt){return rt+(rt&1?1:2)},Oe=function(rt){return rt+(rt&1?2:1)},$=0;$<me.length;$++){ge=me[$];var ue=[{_level:ge.level,_override:0,_isolate:0}],ie=void 0,_e=0,ke=0,ze=0;ne.clear();for(var be=ge.start;be<=ge.end;be++){var Ce=Y[be];if(ie=ue[ue.length-1],ne.set(Ce,(ne.get(Ce)||0)+1),Ce&i&&ne.set(i,(ne.get(i)||0)+1),Ce&pe)if(Ce&(E|L)){K[be]=ie._level;var Te=(Ce===E?Oe:Ie)(ie._level);Te<=W&&!_e&&!ke?ue.push({_level:Te,_override:0,_isolate:0}):_e||ke++}else if(Ce&(S|O)){K[be]=ie._level;var Ee=(Ce===S?Oe:Ie)(ie._level);Ee<=W&&!_e&&!ke?ue.push({_level:Ee,_override:Ce&S?C:w,_isolate:0}):_e||ke++}else if(Ce&e){Ce&G&&(Ce=ra(be+1,!0)===1?Q:B),K[be]=ie._level,ie._override&&J(be,ie._override);var H=(Ce===Q?Oe:Ie)(ie._level);H<=W&&_e===0&&ke===0?(ze++,ue.push({_level:H,_override:0,_isolate:1,_isolInitIndex:be})):_e++}else if(Ce&q){if(_e>0)_e--;else if(ze>0){for(ke=0;!ue[ue.length-1]._isolate;)ue.pop();var ae=ue[ue.length-1]._isolInitIndex;ae!=null&&(we.set(ae,be),we.set(be,ae)),ue.pop(),ze--}ie=ue[ue.length-1],K[be]=ie._level,ie._override&&J(be,ie._override)}else Ce&I?(_e===0&&(ke>0?ke--:!ie._isolate&&ue.length>1&&(ue.pop(),ie=ue[ue.length-1])),K[be]=ie._level):Ce&U&&(K[be]=ge.level);else K[be]=ie._level,ie._override&&Ce!==X&&J(be,ie._override)}for(var ve=[],ye=null,xe=ge.start;xe<=ge.end;xe++){var Fe=Y[xe];if(!(Fe&s)){var Ve=K[xe],We=Fe&e,Be=Fe===q;ye&&Ve===ye._level?(ye._end=xe,ye._endsWithIsolInit=We):ve.push(ye={_start:xe,_end:xe,_level:Ve,_startsWithPDI:Be,_endsWithIsolInit:We})}}for(var je=[],Ae=0;Ae<ve.length;Ae++){var Le=ve[Ae];if(!Le._startsWithPDI||Le._startsWithPDI&&!we.has(Le._start)){for(var Re=[ye=Le],Pe=void 0;ye&&ye._endsWithIsolInit&&(Pe=we.get(ye._end))!=null;)for(var He=Ae+1;He<ve.length;He++)if(ve[He]._start===Pe){Re.push(ye=ve[He]);break}for(var Ge=[],it=0;it<Re.length;it++)for(var St=Re[it],ct=St._start;ct<=St._end;ct++)Ge.push(ct);for(var Yt=K[Ge[0]],Mt=ge.level,Xt=Ge[0]-1;Xt>=0;Xt--)if(!(Y[Xt]&s)){Mt=K[Xt];break}var dn=Ge[Ge.length-1],Mo=K[dn],Rt=ge.level;if(!(Y[dn]&e)){for(var Ct=dn+1;Ct<=ge.end;Ct++)if(!(Y[Ct]&s)){Rt=K[Ct];break}}je.push({_seqIndices:Ge,_sosType:Math.max(Mt,Yt)%2?C:w,_eosType:Math.max(Rt,Mo)%2?C:w})}}for(var Qt=0;Qt<je.length;Qt++){var Co=je[Qt],Ue=Co._seqIndices,hn=Co._sosType,pi=Co._eosType,Kt=K[Ue[0]]&1?C:w;if(ne.get(V))for(var On=0;On<Ue.length;On++){var Wr=Ue[On];if(Y[Wr]&V){for(var Ao=hn,zn=On-1;zn>=0;zn--)if(!(Y[Ue[zn]]&s)){Ao=Y[Ue[zn]];break}J(Wr,Ao&(e|q)?z:Ao)}}if(ne.get(F))for(var Gn=0;Gn<Ue.length;Gn++){var Vr=Ue[Gn];if(Y[Vr]&F)for(var Wn=Gn-1;Wn>=-1;Wn--){var Hr=Wn===-1?hn:Y[Ue[Wn]];if(Hr&a){Hr===P&&J(Vr,T);break}}}if(ne.get(P))for(var To=0;To<Ue.length;To++){var Nr=Ue[To];Y[Nr]&P&&J(Nr,C)}if(ne.get(k)||ne.get(R))for(var pn=1;pn<Ue.length-1;pn++){var ko=Ue[pn];if(Y[ko]&(k|R)){for(var Zt=0,Fo=0,Uo=pn-1;Uo>=0&&(Zt=Y[Ue[Uo]],!!(Zt&s));Uo--);for(var Lo=pn+1;Lo<Ue.length&&(Fo=Y[Ue[Lo]],!!(Fo&s));Lo++);Zt===Fo&&(Y[ko]===k?Zt===F:Zt&(F|T))&&J(ko,Zt)}}if(ne.get(F))for(var bt=0;bt<Ue.length;bt++){var gi=Ue[bt];if(Y[gi]&F){for(var Vn=bt-1;Vn>=0&&Y[Ue[Vn]]&(D|s);Vn--)J(Ue[Vn],F);for(bt++;bt<Ue.length&&Y[Ue[bt]]&(D|s|F);bt++)Y[Ue[bt]]!==F&&J(Ue[bt],F)}}if(ne.get(D)||ne.get(k)||ne.get(R))for(var gn=0;gn<Ue.length;gn++){var jr=Ue[gn];if(Y[jr]&(D|k|R)){J(jr,z);for(var Hn=gn-1;Hn>=0&&Y[Ue[Hn]]&s;Hn--)J(Ue[Hn],z);for(var Nn=gn+1;Nn<Ue.length&&Y[Ue[Nn]]&s;Nn++)J(Ue[Nn],z)}}if(ne.get(F))for(var Do=0,qr=hn;Do<Ue.length;Do++){var Yr=Ue[Do],Ro=Y[Yr];Ro&F?qr===w&&J(Yr,w):Ro&a&&(qr=Ro)}if(ne.get(i)){var mn=C|F|T,Xr=mn|w,jn=[];{for(var Jt=[],$t=0;$t<Ue.length;$t++)if(Y[Ue[$t]]&i){var vn=te[Ue[$t]],Qr=void 0;if(y(vn)!==null)if(Jt.length<63)Jt.push({char:vn,seqIndex:$t});else break;else if((Qr=_(vn))!==null)for(var yn=Jt.length-1;yn>=0;yn--){var Po=Jt[yn].char;if(Po===Qr||Po===_(M(vn))||y(M(Po))===vn){jn.push([Jt[yn].seqIndex,$t]),Jt.length=yn;break}}}jn.sort(function(rt,gt){return rt[0]-gt[0]})}for(var Eo=0;Eo<jn.length;Eo++){for(var Kr=jn[Eo],qn=Kr[0],Bo=Kr[1],Zr=!1,pt=0,Io=qn+1;Io<Bo;Io++){var Jr=Ue[Io];if(Y[Jr]&Xr){Zr=!0;var $r=Y[Jr]&mn?C:w;if($r===Kt){pt=$r;break}}}if(Zr&&!pt){pt=hn;for(var Oo=qn-1;Oo>=0;Oo--){var ea=Ue[Oo];if(Y[ea]&Xr){var ta=Y[ea]&mn?C:w;ta!==Kt?pt=ta:pt=Kt;break}}}if(pt){if(Y[Ue[qn]]=Y[Ue[Bo]]=pt,pt!==Kt){for(var wn=qn+1;wn<Ue.length;wn++)if(!(Y[Ue[wn]]&s)){d(te[Ue[wn]])&V&&(Y[Ue[wn]]=pt);break}}if(pt!==Kt){for(var bn=Bo+1;bn<Ue.length;bn++)if(!(Y[Ue[bn]]&s)){d(te[Ue[bn]])&V&&(Y[Ue[bn]]=pt);break}}}}for(var Pt=0;Pt<Ue.length;Pt++)if(Y[Ue[Pt]]&i){for(var na=Pt,zo=Pt,Go=hn,_n=Pt-1;_n>=0;_n--)if(Y[Ue[_n]]&s)na=_n;else{Go=Y[Ue[_n]]&mn?C:w;break}for(var oa=pi,xn=Pt+1;xn<Ue.length;xn++)if(Y[Ue[xn]]&(i|s))zo=xn;else{oa=Y[Ue[xn]]&mn?C:w;break}for(var Wo=na;Wo<=zo;Wo++)Y[Ue[Wo]]=Go===oa?Go:Kt;Pt=zo}}}for(var lt=ge.start;lt<=ge.end;lt++){var mi=K[lt],Yn=Y[lt];if(mi&1?Yn&(w|F|T)&&K[lt]++:Yn&C?K[lt]++:Yn&(T|F)&&(K[lt]+=2),Yn&s&&(K[lt]=lt===0?ge.level:K[lt-1]),lt===ge.end||d(te[lt])&(j|U))for(var Xn=lt;Xn>=0&&d(te[Xn])&c;Xn--)K[Xn]=ge.level}}return{levels:K,paragraphs:me};function ra(rt,gt){for(var at=rt;at<te.length;at++){var Et=Y[at];if(Et&(C|P))return 1;if(Et&(U|w)||gt&&Et===q)return 0;if(Et&e){var aa=vi(at);at=aa===-1?te.length:aa}}return 0}function vi(rt){for(var gt=1,at=rt+1;at<te.length;at++){var Et=Y[at];if(Et&U)break;if(Et&q){if(--gt===0)return at}else Et&e&&gt++}return-1}}var re="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",Z;function ee(){if(!Z){var te=v(re,!0),se=te.map,W=te.reverseMap;W.forEach(function(Y,N){se.set(N,Y)}),Z=se}}function Me(te){return ee(),Z.get(te)||null}function Se(te,se,W,Y){var N=te.length;W=Math.max(0,W==null?0:+W),Y=Math.min(N-1,Y==null?N-1:+Y);for(var ne=new Map,J=W;J<=Y;J++)if(se[J]&1){var K=Me(te[J]);K!==null&&ne.set(J,K)}return ne}function de(te,se,W,Y){var N=te.length;W=Math.max(0,W==null?0:+W),Y=Math.min(N-1,Y==null?N-1:+Y);var ne=[];return se.paragraphs.forEach(function(J){var K=Math.max(W,J.start),we=Math.min(Y,J.end);if(K<we){for(var me=se.levels.slice(K,we+1),ge=we;ge>=K&&d(te[ge])&c;ge--)me[ge]=J.level;for(var he=J.level,pe=1/0,Ie=0;Ie<me.length;Ie++){var Oe=me[Ie];Oe>he&&(he=Oe),Oe<pe&&(pe=Oe|1)}for(var $=he;$>=pe;$--)for(var ue=0;ue<me.length;ue++)if(me[ue]>=$){for(var ie=ue;ue+1<me.length&&me[ue+1]>=$;)ue++;ue>ie&&ne.push([ie+K,ue+K])}}}),ne}function ce(te,se,W,Y){var N=fe(te,se,W,Y),ne=[].concat(te);return N.forEach(function(J,K){ne[K]=(se.levels[J]&1?Me(te[J]):null)||te[J]}),ne.join("")}function fe(te,se,W,Y){for(var N=de(te,se,W,Y),ne=[],J=0;J<te.length;J++)ne[J]=J;return N.forEach(function(K){for(var we=K[0],me=K[1],ge=ne.slice(we,me+1),he=ge.length;he--;)ne[me-he]=ge[he]}),ne}return t.closingToOpeningBracket=_,t.getBidiCharType=d,t.getBidiCharTypeName=h,t.getCanonicalBracket=M,t.getEmbeddingLevels=le,t.getMirroredCharacter=Me,t.getMirroredCharactersMap=Se,t.getReorderSegments=de,t.getReorderedIndices=fe,t.getReorderedString=ce,t.openingToClosingBracket=y,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return o}const Js=/\bvoid\s+main\s*\(\s*\)\s*{/g;function Ar(o){const t=/^[ \t]*#include +<([\w\d./]+)>/gm;function r(l,n){let e=Ri[n];return e?Ar(e):l}return o.replace(t,r)}const tt=[];for(let o=0;o<256;o++)tt[o]=(o<16?"0":"")+o.toString(16);function Hf(){const o=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0,l=Math.random()*4294967295|0;return(tt[o&255]+tt[o>>8&255]+tt[o>>16&255]+tt[o>>24&255]+"-"+tt[t&255]+tt[t>>8&255]+"-"+tt[t>>16&15|64]+tt[t>>24&255]+"-"+tt[r&63|128]+tt[r>>8&255]+"-"+tt[r>>16&255]+tt[r>>24&255]+tt[l&255]+tt[l>>8&255]+tt[l>>16&255]+tt[l>>24&255]).toUpperCase()}const Gt=Object.assign||function(){let o=arguments[0];for(let t=1,r=arguments.length;t<r;t++){let l=arguments[t];if(l)for(let n in l)Object.prototype.hasOwnProperty.call(l,n)&&(o[n]=l[n])}return o},Nf=Date.now(),Ha=new WeakMap,Na=new Map;let jf=1e10;function Tr(o,t){const r=Qf(t);let l=Ha.get(o);if(l||Ha.set(o,l=Object.create(null)),l[r])return new l[r];const n=`_onBeforeCompile${r}`,e=function(c,u){o.onBeforeCompile.call(this,c,u);const f=this.customProgramCacheKey()+"|"+c.vertexShader+"|"+c.fragmentShader;let d=Na[f];if(!d){const h=qf(this,c,t,r);d=Na[f]=h}c.vertexShader=d.vertexShader,c.fragmentShader=d.fragmentShader,Gt(c.uniforms,this.uniforms),t.timeUniform&&(c.uniforms[t.timeUniform]={get value(){return Date.now()-Nf}}),this[n]&&this[n](c)},a=function(){return i(t.chained?o:o.clone())},i=function(c){const u=Object.create(c,s);return Object.defineProperty(u,"baseMaterial",{value:o}),Object.defineProperty(u,"id",{value:jf++}),u.uuid=Hf(),u.uniforms=Gt({},c.uniforms,t.uniforms),u.defines=Gt({},c.defines,t.defines),u.defines[`TROIKA_DERIVED_MATERIAL_${r}`]="",u.extensions=Gt({},c.extensions,t.extensions),u._listeners=void 0,u},s={constructor:{value:a},isDerivedMaterial:{value:!0},type:{get:()=>o.type,set:c=>{o.type=c}},isDerivedFrom:{writable:!0,configurable:!0,value:function(c){const u=this.baseMaterial;return c===u||u.isDerivedMaterial&&u.isDerivedFrom(c)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return o.customProgramCacheKey()+"|"+r}},onBeforeCompile:{get(){return e},set(c){this[n]=c}},copy:{writable:!0,configurable:!0,value:function(c){return o.copy.call(this,c),!o.isShaderMaterial&&!o.isDerivedMaterial&&(Gt(this.extensions,c.extensions),Gt(this.defines,c.defines),Gt(this.uniforms,ms.clone(c.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const c=new o.constructor;return i(c).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let c=this._depthMaterial;return c||(c=this._depthMaterial=Tr(o.isDerivedMaterial?o.getDepthMaterial():new Li({depthPacking:Di}),t),c.defines.IS_DEPTH_MATERIAL="",c.uniforms=this.uniforms),c}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let c=this._distanceMaterial;return c||(c=this._distanceMaterial=Tr(o.isDerivedMaterial?o.getDistanceMaterial():new Ui,t),c.defines.IS_DISTANCE_MATERIAL="",c.uniforms=this.uniforms),c}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:c,_distanceMaterial:u}=this;c&&c.dispose(),u&&u.dispose(),o.dispose.call(this)}}};return l[r]=a,new a}function qf(o,{vertexShader:t,fragmentShader:r},l,n){let{vertexDefs:e,vertexMainIntro:a,vertexMainOutro:i,vertexTransform:s,fragmentDefs:c,fragmentMainIntro:u,fragmentMainOutro:f,fragmentColorTransform:d,customRewriter:h,timeUniform:g}=l;if(e=e||"",a=a||"",i=i||"",c=c||"",u=u||"",f=f||"",(s||h)&&(t=Ar(t)),(d||h)&&(r=r.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),r=Ar(r)),h){let v=h({vertexShader:t,fragmentShader:r});t=v.vertexShader,r=v.fragmentShader}if(d){let v=[];r=r.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,b=>(v.push(b),"")),f=`${d}
${v.join(`
`)}
${f}`}if(g){const v=`
uniform float ${g};
`;e=v+e,c=v+c}return s&&(t=`vec3 troika_position_${n};
vec3 troika_normal_${n};
vec2 troika_uv_${n};
${t}
`,e=`${e}
void troikaVertexTransform${n}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${s}
}
`,a=`
troika_position_${n} = vec3(position);
troika_normal_${n} = vec3(normal);
troika_uv_${n} = vec2(uv);
troikaVertexTransform${n}(troika_position_${n}, troika_normal_${n}, troika_uv_${n});
${a}
`,t=t.replace(/\b(position|normal|uv)\b/g,(v,b,m,p)=>/\battribute\s+vec[23]\s+$/.test(p.substr(0,m))?b:`troika_${b}_${n}`),o.map&&o.map.channel>0||(t=t.replace(/\bMAP_UV\b/g,`troika_uv_${n}`))),t=ja(t,n,e,a,i),r=ja(r,n,c,u,f),{vertexShader:t,fragmentShader:r}}function ja(o,t,r,l,n){return(l||n||r)&&(o=o.replace(Js,`
${r}
void troikaOrigMain${t}() {`),o+=`
void main() {
  ${l}
  troikaOrigMain${t}();
  ${n}
}`),o}function Yf(o,t){return o==="uniforms"?void 0:typeof t=="function"?t.toString():t}let Xf=0;const qa=new Map;function Qf(o){const t=JSON.stringify(o,Yf);let r=qa.get(t);return r==null&&qa.set(t,r=++Xf),r}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function Kf(){return typeof window>"u"&&(self.window=self),function(o){var t={parse:function(n){var e=t._bin,a=new Uint8Array(n);if(e.readASCII(a,0,4)=="ttcf"){var i=4;e.readUshort(a,i),i+=2,e.readUshort(a,i),i+=2;var s=e.readUint(a,i);i+=4;for(var c=[],u=0;u<s;u++){var f=e.readUint(a,i);i+=4,c.push(t._readFont(a,f))}return c}return[t._readFont(a,0)]},_readFont:function(n,e){var a=t._bin,i=e;a.readFixed(n,e),e+=4;var s=a.readUshort(n,e);e+=2,a.readUshort(n,e),e+=2,a.readUshort(n,e),e+=2,a.readUshort(n,e),e+=2;for(var c=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],u={_data:n,_offset:i},f={},d=0;d<s;d++){var h=a.readASCII(n,e,4);e+=4,a.readUint(n,e),e+=4;var g=a.readUint(n,e);e+=4;var v=a.readUint(n,e);e+=4,f[h]={offset:g,length:v}}for(d=0;d<c.length;d++){var b=c[d];f[b]&&(u[b.trim()]=t[b.trim()].parse(n,f[b].offset,f[b].length,u))}return u},_tabOffset:function(n,e,a){for(var i=t._bin,s=i.readUshort(n,a+4),c=a+12,u=0;u<s;u++){var f=i.readASCII(n,c,4);c+=4,i.readUint(n,c),c+=4;var d=i.readUint(n,c);if(c+=4,i.readUint(n,c),c+=4,f==e)return d}return 0}};t._bin={readFixed:function(n,e){return(n[e]<<8|n[e+1])+(n[e+2]<<8|n[e+3])/65540},readF2dot14:function(n,e){return t._bin.readShort(n,e)/16384},readInt:function(n,e){return t._bin._view(n).getInt32(e)},readInt8:function(n,e){return t._bin._view(n).getInt8(e)},readShort:function(n,e){return t._bin._view(n).getInt16(e)},readUshort:function(n,e){return t._bin._view(n).getUint16(e)},readUshorts:function(n,e,a){for(var i=[],s=0;s<a;s++)i.push(t._bin.readUshort(n,e+2*s));return i},readUint:function(n,e){return t._bin._view(n).getUint32(e)},readUint64:function(n,e){return 4294967296*t._bin.readUint(n,e)+t._bin.readUint(n,e+4)},readASCII:function(n,e,a){for(var i="",s=0;s<a;s++)i+=String.fromCharCode(n[e+s]);return i},readUnicode:function(n,e,a){for(var i="",s=0;s<a;s++){var c=n[e++]<<8|n[e++];i+=String.fromCharCode(c)}return i},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(n,e,a){var i=t._bin._tdec;return i&&e==0&&a==n.length?i.decode(n):t._bin.readASCII(n,e,a)},readBytes:function(n,e,a){for(var i=[],s=0;s<a;s++)i.push(n[e+s]);return i},readASCIIArray:function(n,e,a){for(var i=[],s=0;s<a;s++)i.push(String.fromCharCode(n[e+s]));return i},_view:function(n){return n._dataView||(n._dataView=n.buffer?new DataView(n.buffer,n.byteOffset,n.byteLength):new DataView(new Uint8Array(n).buffer))}},t._lctf={},t._lctf.parse=function(n,e,a,i,s){var c=t._bin,u={},f=e;c.readFixed(n,e),e+=4;var d=c.readUshort(n,e);e+=2;var h=c.readUshort(n,e);e+=2;var g=c.readUshort(n,e);return e+=2,u.scriptList=t._lctf.readScriptList(n,f+d),u.featureList=t._lctf.readFeatureList(n,f+h),u.lookupList=t._lctf.readLookupList(n,f+g,s),u},t._lctf.readLookupList=function(n,e,a){var i=t._bin,s=e,c=[],u=i.readUshort(n,e);e+=2;for(var f=0;f<u;f++){var d=i.readUshort(n,e);e+=2;var h=t._lctf.readLookupTable(n,s+d,a);c.push(h)}return c},t._lctf.readLookupTable=function(n,e,a){var i=t._bin,s=e,c={tabs:[]};c.ltype=i.readUshort(n,e),e+=2,c.flag=i.readUshort(n,e),e+=2;var u=i.readUshort(n,e);e+=2;for(var f=c.ltype,d=0;d<u;d++){var h=i.readUshort(n,e);e+=2;var g=a(n,f,s+h,c);c.tabs.push(g)}return c},t._lctf.numOfOnes=function(n){for(var e=0,a=0;a<32;a++)n>>>a&1&&e++;return e},t._lctf.readClassDef=function(n,e){var a=t._bin,i=[],s=a.readUshort(n,e);if(e+=2,s==1){var c=a.readUshort(n,e);e+=2;var u=a.readUshort(n,e);e+=2;for(var f=0;f<u;f++)i.push(c+f),i.push(c+f),i.push(a.readUshort(n,e)),e+=2}if(s==2){var d=a.readUshort(n,e);for(e+=2,f=0;f<d;f++)i.push(a.readUshort(n,e)),e+=2,i.push(a.readUshort(n,e)),e+=2,i.push(a.readUshort(n,e)),e+=2}return i},t._lctf.getInterval=function(n,e){for(var a=0;a<n.length;a+=3){var i=n[a],s=n[a+1];if(n[a+2],i<=e&&e<=s)return a}return-1},t._lctf.readCoverage=function(n,e){var a=t._bin,i={};i.fmt=a.readUshort(n,e),e+=2;var s=a.readUshort(n,e);return e+=2,i.fmt==1&&(i.tab=a.readUshorts(n,e,s)),i.fmt==2&&(i.tab=a.readUshorts(n,e,3*s)),i},t._lctf.coverageIndex=function(n,e){var a=n.tab;if(n.fmt==1)return a.indexOf(e);if(n.fmt==2){var i=t._lctf.getInterval(a,e);if(i!=-1)return a[i+2]+(e-a[i])}return-1},t._lctf.readFeatureList=function(n,e){var a=t._bin,i=e,s=[],c=a.readUshort(n,e);e+=2;for(var u=0;u<c;u++){var f=a.readASCII(n,e,4);e+=4;var d=a.readUshort(n,e);e+=2;var h=t._lctf.readFeatureTable(n,i+d);h.tag=f.trim(),s.push(h)}return s},t._lctf.readFeatureTable=function(n,e){var a=t._bin,i=e,s={},c=a.readUshort(n,e);e+=2,c>0&&(s.featureParams=i+c);var u=a.readUshort(n,e);e+=2,s.tab=[];for(var f=0;f<u;f++)s.tab.push(a.readUshort(n,e+2*f));return s},t._lctf.readScriptList=function(n,e){var a=t._bin,i=e,s={},c=a.readUshort(n,e);e+=2;for(var u=0;u<c;u++){var f=a.readASCII(n,e,4);e+=4;var d=a.readUshort(n,e);e+=2,s[f.trim()]=t._lctf.readScriptTable(n,i+d)}return s},t._lctf.readScriptTable=function(n,e){var a=t._bin,i=e,s={},c=a.readUshort(n,e);e+=2,c>0&&(s.default=t._lctf.readLangSysTable(n,i+c));var u=a.readUshort(n,e);e+=2;for(var f=0;f<u;f++){var d=a.readASCII(n,e,4);e+=4;var h=a.readUshort(n,e);e+=2,s[d.trim()]=t._lctf.readLangSysTable(n,i+h)}return s},t._lctf.readLangSysTable=function(n,e){var a=t._bin,i={};a.readUshort(n,e),e+=2,i.reqFeature=a.readUshort(n,e),e+=2;var s=a.readUshort(n,e);return e+=2,i.features=a.readUshorts(n,e,s),i},t.CFF={},t.CFF.parse=function(n,e,a){var i=t._bin;(n=new Uint8Array(n.buffer,e,a))[e=0],n[++e],n[++e],n[++e],e++;var s=[];e=t.CFF.readIndex(n,e,s);for(var c=[],u=0;u<s.length-1;u++)c.push(i.readASCII(n,e+s[u],s[u+1]-s[u]));e+=s[s.length-1];var f=[];e=t.CFF.readIndex(n,e,f);var d=[];for(u=0;u<f.length-1;u++)d.push(t.CFF.readDict(n,e+f[u],e+f[u+1]));e+=f[f.length-1];var h=d[0],g=[];e=t.CFF.readIndex(n,e,g);var v=[];for(u=0;u<g.length-1;u++)v.push(i.readASCII(n,e+g[u],g[u+1]-g[u]));if(e+=g[g.length-1],t.CFF.readSubrs(n,e,h),h.CharStrings){e=h.CharStrings,g=[],e=t.CFF.readIndex(n,e,g);var b=[];for(u=0;u<g.length-1;u++)b.push(i.readBytes(n,e+g[u],g[u+1]-g[u]));h.CharStrings=b}if(h.ROS){e=h.FDArray;var m=[];for(e=t.CFF.readIndex(n,e,m),h.FDArray=[],u=0;u<m.length-1;u++){var p=t.CFF.readDict(n,e+m[u],e+m[u+1]);t.CFF._readFDict(n,p,v),h.FDArray.push(p)}e+=m[m.length-1],e=h.FDSelect,h.FDSelect=[];var x=n[e];if(e++,x!=3)throw x;var y=i.readUshort(n,e);for(e+=2,u=0;u<y+1;u++)h.FDSelect.push(i.readUshort(n,e),n[e+2]),e+=3}return h.Encoding&&(h.Encoding=t.CFF.readEncoding(n,h.Encoding,h.CharStrings.length)),h.charset&&(h.charset=t.CFF.readCharset(n,h.charset,h.CharStrings.length)),t.CFF._readFDict(n,h,v),h},t.CFF._readFDict=function(n,e,a){var i;for(var s in e.Private&&(i=e.Private[1],e.Private=t.CFF.readDict(n,i,i+e.Private[0]),e.Private.Subrs&&t.CFF.readSubrs(n,i+e.Private.Subrs,e.Private)),e)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(s)!=-1&&(e[s]=a[e[s]-426+35])},t.CFF.readSubrs=function(n,e,a){var i=t._bin,s=[];e=t.CFF.readIndex(n,e,s);var c,u=s.length;c=u<1240?107:u<33900?1131:32768,a.Bias=c,a.Subrs=[];for(var f=0;f<s.length-1;f++)a.Subrs.push(i.readBytes(n,e+s[f],s[f+1]-s[f]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(n,e){for(var a=0;a<n.charset.length;a++)if(n.charset[a]==e)return a;return-1},t.CFF.glyphBySE=function(n,e){return e<0||e>255?-1:t.CFF.glyphByUnicode(n,t.CFF.tableSE[e])},t.CFF.readEncoding=function(n,e,a){t._bin;var i=[".notdef"],s=n[e];if(e++,s!=0)throw"error: unknown encoding format: "+s;var c=n[e];e++;for(var u=0;u<c;u++)i.push(n[e+u]);return i},t.CFF.readCharset=function(n,e,a){var i=t._bin,s=[".notdef"],c=n[e];if(e++,c==0)for(var u=0;u<a;u++){var f=i.readUshort(n,e);e+=2,s.push(f)}else{if(c!=1&&c!=2)throw"error: format: "+c;for(;s.length<a;){f=i.readUshort(n,e),e+=2;var d=0;for(c==1?(d=n[e],e++):(d=i.readUshort(n,e),e+=2),u=0;u<=d;u++)s.push(f),f++}}return s},t.CFF.readIndex=function(n,e,a){var i=t._bin,s=i.readUshort(n,e)+1,c=n[e+=2];if(e++,c==1)for(var u=0;u<s;u++)a.push(n[e+u]);else if(c==2)for(u=0;u<s;u++)a.push(i.readUshort(n,e+2*u));else if(c==3)for(u=0;u<s;u++)a.push(16777215&i.readUint(n,e+3*u-1));else if(s!=1)throw"unsupported offset size: "+c+", count: "+s;return(e+=s*c)-1},t.CFF.getCharString=function(n,e,a){var i=t._bin,s=n[e],c=n[e+1];n[e+2],n[e+3],n[e+4];var u=1,f=null,d=null;s<=20&&(f=s,u=1),s==12&&(f=100*s+c,u=2),21<=s&&s<=27&&(f=s,u=1),s==28&&(d=i.readShort(n,e+1),u=3),29<=s&&s<=31&&(f=s,u=1),32<=s&&s<=246&&(d=s-139,u=1),247<=s&&s<=250&&(d=256*(s-247)+c+108,u=2),251<=s&&s<=254&&(d=256*-(s-251)-c-108,u=2),s==255&&(d=i.readInt(n,e+1)/65535,u=5),a.val=d??"o"+f,a.size=u},t.CFF.readCharString=function(n,e,a){for(var i=e+a,s=t._bin,c=[];e<i;){var u=n[e],f=n[e+1];n[e+2],n[e+3],n[e+4];var d=1,h=null,g=null;u<=20&&(h=u,d=1),u==12&&(h=100*u+f,d=2),u!=19&&u!=20||(h=u,d=2),21<=u&&u<=27&&(h=u,d=1),u==28&&(g=s.readShort(n,e+1),d=3),29<=u&&u<=31&&(h=u,d=1),32<=u&&u<=246&&(g=u-139,d=1),247<=u&&u<=250&&(g=256*(u-247)+f+108,d=2),251<=u&&u<=254&&(g=256*-(u-251)-f-108,d=2),u==255&&(g=s.readInt(n,e+1)/65535,d=5),c.push(g??"o"+h),e+=d}return c},t.CFF.readDict=function(n,e,a){for(var i=t._bin,s={},c=[];e<a;){var u=n[e],f=n[e+1];n[e+2],n[e+3],n[e+4];var d=1,h=null,g=null;if(u==28&&(g=i.readShort(n,e+1),d=3),u==29&&(g=i.readInt(n,e+1),d=5),32<=u&&u<=246&&(g=u-139,d=1),247<=u&&u<=250&&(g=256*(u-247)+f+108,d=2),251<=u&&u<=254&&(g=256*-(u-251)-f-108,d=2),u==255)throw g=i.readInt(n,e+1)/65535,d=5,"unknown number";if(u==30){var v=[];for(d=1;;){var b=n[e+d];d++;var m=b>>4,p=15&b;if(m!=15&&v.push(m),p!=15&&v.push(p),p==15)break}for(var x="",y=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],_=0;_<v.length;_++)x+=y[v[_]];g=parseFloat(x)}u<=21&&(h=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][u],d=1,u==12&&(h=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][f],d=2)),h!=null?(s[h]=c.length==1?c[0]:c,c=[]):c.push(g),e+=d}return s},t.cmap={},t.cmap.parse=function(n,e,a){n=new Uint8Array(n.buffer,e,a),e=0;var i=t._bin,s={};i.readUshort(n,e),e+=2;var c=i.readUshort(n,e);e+=2;var u=[];s.tables=[];for(var f=0;f<c;f++){var d=i.readUshort(n,e);e+=2;var h=i.readUshort(n,e);e+=2;var g=i.readUint(n,e);e+=4;var v="p"+d+"e"+h,b=u.indexOf(g);if(b==-1){var m;b=s.tables.length,u.push(g);var p=i.readUshort(n,g);p==0?m=t.cmap.parse0(n,g):p==4?m=t.cmap.parse4(n,g):p==6?m=t.cmap.parse6(n,g):p==12?m=t.cmap.parse12(n,g):console.debug("unknown format: "+p,d,h,g),s.tables.push(m)}if(s[v]!=null)throw"multiple tables for one platform+encoding";s[v]=b}return s},t.cmap.parse0=function(n,e){var a=t._bin,i={};i.format=a.readUshort(n,e),e+=2;var s=a.readUshort(n,e);e+=2,a.readUshort(n,e),e+=2,i.map=[];for(var c=0;c<s-6;c++)i.map.push(n[e+c]);return i},t.cmap.parse4=function(n,e){var a=t._bin,i=e,s={};s.format=a.readUshort(n,e),e+=2;var c=a.readUshort(n,e);e+=2,a.readUshort(n,e),e+=2;var u=a.readUshort(n,e);e+=2;var f=u/2;s.searchRange=a.readUshort(n,e),e+=2,s.entrySelector=a.readUshort(n,e),e+=2,s.rangeShift=a.readUshort(n,e),e+=2,s.endCount=a.readUshorts(n,e,f),e+=2*f,e+=2,s.startCount=a.readUshorts(n,e,f),e+=2*f,s.idDelta=[];for(var d=0;d<f;d++)s.idDelta.push(a.readShort(n,e)),e+=2;for(s.idRangeOffset=a.readUshorts(n,e,f),e+=2*f,s.glyphIdArray=[];e<i+c;)s.glyphIdArray.push(a.readUshort(n,e)),e+=2;return s},t.cmap.parse6=function(n,e){var a=t._bin,i={};i.format=a.readUshort(n,e),e+=2,a.readUshort(n,e),e+=2,a.readUshort(n,e),e+=2,i.firstCode=a.readUshort(n,e),e+=2;var s=a.readUshort(n,e);e+=2,i.glyphIdArray=[];for(var c=0;c<s;c++)i.glyphIdArray.push(a.readUshort(n,e)),e+=2;return i},t.cmap.parse12=function(n,e){var a=t._bin,i={};i.format=a.readUshort(n,e),e+=2,e+=2,a.readUint(n,e),e+=4,a.readUint(n,e),e+=4;var s=a.readUint(n,e);e+=4,i.groups=[];for(var c=0;c<s;c++){var u=e+12*c,f=a.readUint(n,u+0),d=a.readUint(n,u+4),h=a.readUint(n,u+8);i.groups.push([f,d,h])}return i},t.glyf={},t.glyf.parse=function(n,e,a,i){for(var s=[],c=0;c<i.maxp.numGlyphs;c++)s.push(null);return s},t.glyf._parseGlyf=function(n,e){var a=t._bin,i=n._data,s=t._tabOffset(i,"glyf",n._offset)+n.loca[e];if(n.loca[e]==n.loca[e+1])return null;var c={};if(c.noc=a.readShort(i,s),s+=2,c.xMin=a.readShort(i,s),s+=2,c.yMin=a.readShort(i,s),s+=2,c.xMax=a.readShort(i,s),s+=2,c.yMax=a.readShort(i,s),s+=2,c.xMin>=c.xMax||c.yMin>=c.yMax)return null;if(c.noc>0){c.endPts=[];for(var u=0;u<c.noc;u++)c.endPts.push(a.readUshort(i,s)),s+=2;var f=a.readUshort(i,s);if(s+=2,i.length-s<f)return null;c.instructions=a.readBytes(i,s,f),s+=f;var d=c.endPts[c.noc-1]+1;for(c.flags=[],u=0;u<d;u++){var h=i[s];if(s++,c.flags.push(h),(8&h)!=0){var g=i[s];s++;for(var v=0;v<g;v++)c.flags.push(h),u++}}for(c.xs=[],u=0;u<d;u++){var b=(2&c.flags[u])!=0,m=(16&c.flags[u])!=0;b?(c.xs.push(m?i[s]:-i[s]),s++):m?c.xs.push(0):(c.xs.push(a.readShort(i,s)),s+=2)}for(c.ys=[],u=0;u<d;u++)b=(4&c.flags[u])!=0,m=(32&c.flags[u])!=0,b?(c.ys.push(m?i[s]:-i[s]),s++):m?c.ys.push(0):(c.ys.push(a.readShort(i,s)),s+=2);var p=0,x=0;for(u=0;u<d;u++)p+=c.xs[u],x+=c.ys[u],c.xs[u]=p,c.ys[u]=x}else{var y;c.parts=[];do{y=a.readUshort(i,s),s+=2;var _={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(c.parts.push(_),_.glyphIndex=a.readUshort(i,s),s+=2,1&y){var M=a.readShort(i,s);s+=2;var w=a.readShort(i,s);s+=2}else M=a.readInt8(i,s),s++,w=a.readInt8(i,s),s++;2&y?(_.m.tx=M,_.m.ty=w):(_.p1=M,_.p2=w),8&y?(_.m.a=_.m.d=a.readF2dot14(i,s),s+=2):64&y?(_.m.a=a.readF2dot14(i,s),s+=2,_.m.d=a.readF2dot14(i,s),s+=2):128&y&&(_.m.a=a.readF2dot14(i,s),s+=2,_.m.b=a.readF2dot14(i,s),s+=2,_.m.c=a.readF2dot14(i,s),s+=2,_.m.d=a.readF2dot14(i,s),s+=2)}while(32&y);if(256&y){var C=a.readUshort(i,s);for(s+=2,c.instr=[],u=0;u<C;u++)c.instr.push(i[s]),s++}}return c},t.GDEF={},t.GDEF.parse=function(n,e,a,i){var s=e;e+=4;var c=t._bin.readUshort(n,e);return{glyphClassDef:c===0?null:t._lctf.readClassDef(n,s+c)}},t.GPOS={},t.GPOS.parse=function(n,e,a,i){return t._lctf.parse(n,e,a,i,t.GPOS.subt)},t.GPOS.subt=function(n,e,a,i){var s=t._bin,c=a,u={};if(u.fmt=s.readUshort(n,a),a+=2,e==1||e==2||e==3||e==7||e==8&&u.fmt<=2){var f=s.readUshort(n,a);a+=2,u.coverage=t._lctf.readCoverage(n,f+c)}if(e==1&&u.fmt==1){var d=s.readUshort(n,a);a+=2,d!=0&&(u.pos=t.GPOS.readValueRecord(n,a,d))}else if(e==2&&u.fmt>=1&&u.fmt<=2){d=s.readUshort(n,a),a+=2;var h=s.readUshort(n,a);a+=2;var g=t._lctf.numOfOnes(d),v=t._lctf.numOfOnes(h);if(u.fmt==1){u.pairsets=[];var b=s.readUshort(n,a);a+=2;for(var m=0;m<b;m++){var p=c+s.readUshort(n,a);a+=2;var x=s.readUshort(n,p);p+=2;for(var y=[],_=0;_<x;_++){var M=s.readUshort(n,p);p+=2,d!=0&&(T=t.GPOS.readValueRecord(n,p,d),p+=2*g),h!=0&&(R=t.GPOS.readValueRecord(n,p,h),p+=2*v),y.push({gid2:M,val1:T,val2:R})}u.pairsets.push(y)}}if(u.fmt==2){var w=s.readUshort(n,a);a+=2;var C=s.readUshort(n,a);a+=2;var F=s.readUshort(n,a);a+=2;var k=s.readUshort(n,a);for(a+=2,u.classDef1=t._lctf.readClassDef(n,c+w),u.classDef2=t._lctf.readClassDef(n,c+C),u.matrix=[],m=0;m<F;m++){var D=[];for(_=0;_<k;_++){var T=null,R=null;d!=0&&(T=t.GPOS.readValueRecord(n,a,d),a+=2*g),h!=0&&(R=t.GPOS.readValueRecord(n,a,h),a+=2*v),D.push({val1:T,val2:R})}u.matrix.push(D)}}}else if(e==4&&u.fmt==1)u.markCoverage=t._lctf.readCoverage(n,s.readUshort(n,a)+c),u.baseCoverage=t._lctf.readCoverage(n,s.readUshort(n,a+2)+c),u.markClassCount=s.readUshort(n,a+4),u.markArray=t.GPOS.readMarkArray(n,s.readUshort(n,a+6)+c),u.baseArray=t.GPOS.readBaseArray(n,s.readUshort(n,a+8)+c,u.markClassCount);else if(e==6&&u.fmt==1)u.mark1Coverage=t._lctf.readCoverage(n,s.readUshort(n,a)+c),u.mark2Coverage=t._lctf.readCoverage(n,s.readUshort(n,a+2)+c),u.markClassCount=s.readUshort(n,a+4),u.mark1Array=t.GPOS.readMarkArray(n,s.readUshort(n,a+6)+c),u.mark2Array=t.GPOS.readBaseArray(n,s.readUshort(n,a+8)+c,u.markClassCount);else{if(e==9&&u.fmt==1){var U=s.readUshort(n,a);a+=2;var j=s.readUint(n,a);if(a+=4,i.ltype==9)i.ltype=U;else if(i.ltype!=U)throw"invalid extension substitution";return t.GPOS.subt(n,i.ltype,c+j)}console.debug("unsupported GPOS table LookupType",e,"format",u.fmt)}return u},t.GPOS.readValueRecord=function(n,e,a){var i=t._bin,s=[];return s.push(1&a?i.readShort(n,e):0),e+=1&a?2:0,s.push(2&a?i.readShort(n,e):0),e+=2&a?2:0,s.push(4&a?i.readShort(n,e):0),e+=4&a?2:0,s.push(8&a?i.readShort(n,e):0),e+=8&a?2:0,s},t.GPOS.readBaseArray=function(n,e,a){var i=t._bin,s=[],c=e,u=i.readUshort(n,e);e+=2;for(var f=0;f<u;f++){for(var d=[],h=0;h<a;h++)d.push(t.GPOS.readAnchorRecord(n,c+i.readUshort(n,e))),e+=2;s.push(d)}return s},t.GPOS.readMarkArray=function(n,e){var a=t._bin,i=[],s=e,c=a.readUshort(n,e);e+=2;for(var u=0;u<c;u++){var f=t.GPOS.readAnchorRecord(n,a.readUshort(n,e+2)+s);f.markClass=a.readUshort(n,e),i.push(f),e+=4}return i},t.GPOS.readAnchorRecord=function(n,e){var a=t._bin,i={};return i.fmt=a.readUshort(n,e),i.x=a.readShort(n,e+2),i.y=a.readShort(n,e+4),i},t.GSUB={},t.GSUB.parse=function(n,e,a,i){return t._lctf.parse(n,e,a,i,t.GSUB.subt)},t.GSUB.subt=function(n,e,a,i){var s=t._bin,c=a,u={};if(u.fmt=s.readUshort(n,a),a+=2,e!=1&&e!=2&&e!=4&&e!=5&&e!=6)return null;if(e==1||e==2||e==4||e==5&&u.fmt<=2||e==6&&u.fmt<=2){var f=s.readUshort(n,a);a+=2,u.coverage=t._lctf.readCoverage(n,c+f)}if(e==1&&u.fmt>=1&&u.fmt<=2){if(u.fmt==1)u.delta=s.readShort(n,a),a+=2;else if(u.fmt==2){var d=s.readUshort(n,a);a+=2,u.newg=s.readUshorts(n,a,d),a+=2*u.newg.length}}else if(e==2&&u.fmt==1){d=s.readUshort(n,a),a+=2,u.seqs=[];for(var h=0;h<d;h++){var g=s.readUshort(n,a)+c;a+=2;var v=s.readUshort(n,g);u.seqs.push(s.readUshorts(n,g+2,v))}}else if(e==4)for(u.vals=[],d=s.readUshort(n,a),a+=2,h=0;h<d;h++){var b=s.readUshort(n,a);a+=2,u.vals.push(t.GSUB.readLigatureSet(n,c+b))}else if(e==5&&u.fmt==2){if(u.fmt==2){var m=s.readUshort(n,a);a+=2,u.cDef=t._lctf.readClassDef(n,c+m),u.scset=[];var p=s.readUshort(n,a);for(a+=2,h=0;h<p;h++){var x=s.readUshort(n,a);a+=2,u.scset.push(x==0?null:t.GSUB.readSubClassSet(n,c+x))}}}else if(e==6&&u.fmt==3){if(u.fmt==3){for(h=0;h<3;h++){d=s.readUshort(n,a),a+=2;for(var y=[],_=0;_<d;_++)y.push(t._lctf.readCoverage(n,c+s.readUshort(n,a+2*_)));a+=2*d,h==0&&(u.backCvg=y),h==1&&(u.inptCvg=y),h==2&&(u.ahedCvg=y)}d=s.readUshort(n,a),a+=2,u.lookupRec=t.GSUB.readSubstLookupRecords(n,a,d)}}else{if(e==7&&u.fmt==1){var M=s.readUshort(n,a);a+=2;var w=s.readUint(n,a);if(a+=4,i.ltype==9)i.ltype=M;else if(i.ltype!=M)throw"invalid extension substitution";return t.GSUB.subt(n,i.ltype,c+w)}console.debug("unsupported GSUB table LookupType",e,"format",u.fmt)}return u},t.GSUB.readSubClassSet=function(n,e){var a=t._bin.readUshort,i=e,s=[],c=a(n,e);e+=2;for(var u=0;u<c;u++){var f=a(n,e);e+=2,s.push(t.GSUB.readSubClassRule(n,i+f))}return s},t.GSUB.readSubClassRule=function(n,e){var a=t._bin.readUshort,i={},s=a(n,e),c=a(n,e+=2);e+=2,i.input=[];for(var u=0;u<s-1;u++)i.input.push(a(n,e)),e+=2;return i.substLookupRecords=t.GSUB.readSubstLookupRecords(n,e,c),i},t.GSUB.readSubstLookupRecords=function(n,e,a){for(var i=t._bin.readUshort,s=[],c=0;c<a;c++)s.push(i(n,e),i(n,e+2)),e+=4;return s},t.GSUB.readChainSubClassSet=function(n,e){var a=t._bin,i=e,s=[],c=a.readUshort(n,e);e+=2;for(var u=0;u<c;u++){var f=a.readUshort(n,e);e+=2,s.push(t.GSUB.readChainSubClassRule(n,i+f))}return s},t.GSUB.readChainSubClassRule=function(n,e){for(var a=t._bin,i={},s=["backtrack","input","lookahead"],c=0;c<s.length;c++){var u=a.readUshort(n,e);e+=2,c==1&&u--,i[s[c]]=a.readUshorts(n,e,u),e+=2*i[s[c]].length}return u=a.readUshort(n,e),e+=2,i.subst=a.readUshorts(n,e,2*u),e+=2*i.subst.length,i},t.GSUB.readLigatureSet=function(n,e){var a=t._bin,i=e,s=[],c=a.readUshort(n,e);e+=2;for(var u=0;u<c;u++){var f=a.readUshort(n,e);e+=2,s.push(t.GSUB.readLigature(n,i+f))}return s},t.GSUB.readLigature=function(n,e){var a=t._bin,i={chain:[]};i.nglyph=a.readUshort(n,e),e+=2;var s=a.readUshort(n,e);e+=2;for(var c=0;c<s-1;c++)i.chain.push(a.readUshort(n,e)),e+=2;return i},t.head={},t.head.parse=function(n,e,a){var i=t._bin,s={};return i.readFixed(n,e),e+=4,s.fontRevision=i.readFixed(n,e),e+=4,i.readUint(n,e),e+=4,i.readUint(n,e),e+=4,s.flags=i.readUshort(n,e),e+=2,s.unitsPerEm=i.readUshort(n,e),e+=2,s.created=i.readUint64(n,e),e+=8,s.modified=i.readUint64(n,e),e+=8,s.xMin=i.readShort(n,e),e+=2,s.yMin=i.readShort(n,e),e+=2,s.xMax=i.readShort(n,e),e+=2,s.yMax=i.readShort(n,e),e+=2,s.macStyle=i.readUshort(n,e),e+=2,s.lowestRecPPEM=i.readUshort(n,e),e+=2,s.fontDirectionHint=i.readShort(n,e),e+=2,s.indexToLocFormat=i.readShort(n,e),e+=2,s.glyphDataFormat=i.readShort(n,e),e+=2,s},t.hhea={},t.hhea.parse=function(n,e,a){var i=t._bin,s={};return i.readFixed(n,e),e+=4,s.ascender=i.readShort(n,e),e+=2,s.descender=i.readShort(n,e),e+=2,s.lineGap=i.readShort(n,e),e+=2,s.advanceWidthMax=i.readUshort(n,e),e+=2,s.minLeftSideBearing=i.readShort(n,e),e+=2,s.minRightSideBearing=i.readShort(n,e),e+=2,s.xMaxExtent=i.readShort(n,e),e+=2,s.caretSlopeRise=i.readShort(n,e),e+=2,s.caretSlopeRun=i.readShort(n,e),e+=2,s.caretOffset=i.readShort(n,e),e+=2,e+=8,s.metricDataFormat=i.readShort(n,e),e+=2,s.numberOfHMetrics=i.readUshort(n,e),e+=2,s},t.hmtx={},t.hmtx.parse=function(n,e,a,i){for(var s=t._bin,c={aWidth:[],lsBearing:[]},u=0,f=0,d=0;d<i.maxp.numGlyphs;d++)d<i.hhea.numberOfHMetrics&&(u=s.readUshort(n,e),e+=2,f=s.readShort(n,e),e+=2),c.aWidth.push(u),c.lsBearing.push(f);return c},t.kern={},t.kern.parse=function(n,e,a,i){var s=t._bin,c=s.readUshort(n,e);if(e+=2,c==1)return t.kern.parseV1(n,e-2,a,i);var u=s.readUshort(n,e);e+=2;for(var f={glyph1:[],rval:[]},d=0;d<u;d++){e+=2,a=s.readUshort(n,e),e+=2;var h=s.readUshort(n,e);e+=2;var g=h>>>8;if((g&=15)!=0)throw"unknown kern table format: "+g;e=t.kern.readFormat0(n,e,f)}return f},t.kern.parseV1=function(n,e,a,i){var s=t._bin;s.readFixed(n,e),e+=4;var c=s.readUint(n,e);e+=4;for(var u={glyph1:[],rval:[]},f=0;f<c;f++){s.readUint(n,e),e+=4;var d=s.readUshort(n,e);e+=2,s.readUshort(n,e),e+=2;var h=d>>>8;if((h&=15)!=0)throw"unknown kern table format: "+h;e=t.kern.readFormat0(n,e,u)}return u},t.kern.readFormat0=function(n,e,a){var i=t._bin,s=-1,c=i.readUshort(n,e);e+=2,i.readUshort(n,e),e+=2,i.readUshort(n,e),e+=2,i.readUshort(n,e),e+=2;for(var u=0;u<c;u++){var f=i.readUshort(n,e);e+=2;var d=i.readUshort(n,e);e+=2;var h=i.readShort(n,e);e+=2,f!=s&&(a.glyph1.push(f),a.rval.push({glyph2:[],vals:[]}));var g=a.rval[a.rval.length-1];g.glyph2.push(d),g.vals.push(h),s=f}return e},t.loca={},t.loca.parse=function(n,e,a,i){var s=t._bin,c=[],u=i.head.indexToLocFormat,f=i.maxp.numGlyphs+1;if(u==0)for(var d=0;d<f;d++)c.push(s.readUshort(n,e+(d<<1))<<1);if(u==1)for(d=0;d<f;d++)c.push(s.readUint(n,e+(d<<2)));return c},t.maxp={},t.maxp.parse=function(n,e,a){var i=t._bin,s={},c=i.readUint(n,e);return e+=4,s.numGlyphs=i.readUshort(n,e),e+=2,c==65536&&(s.maxPoints=i.readUshort(n,e),e+=2,s.maxContours=i.readUshort(n,e),e+=2,s.maxCompositePoints=i.readUshort(n,e),e+=2,s.maxCompositeContours=i.readUshort(n,e),e+=2,s.maxZones=i.readUshort(n,e),e+=2,s.maxTwilightPoints=i.readUshort(n,e),e+=2,s.maxStorage=i.readUshort(n,e),e+=2,s.maxFunctionDefs=i.readUshort(n,e),e+=2,s.maxInstructionDefs=i.readUshort(n,e),e+=2,s.maxStackElements=i.readUshort(n,e),e+=2,s.maxSizeOfInstructions=i.readUshort(n,e),e+=2,s.maxComponentElements=i.readUshort(n,e),e+=2,s.maxComponentDepth=i.readUshort(n,e),e+=2),s},t.name={},t.name.parse=function(n,e,a){var i=t._bin,s={};i.readUshort(n,e),e+=2;var c=i.readUshort(n,e);e+=2,i.readUshort(n,e);for(var u,f=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],d=e+=2,h=0;h<c;h++){var g=i.readUshort(n,e);e+=2;var v=i.readUshort(n,e);e+=2;var b=i.readUshort(n,e);e+=2;var m=i.readUshort(n,e);e+=2;var p=i.readUshort(n,e);e+=2;var x=i.readUshort(n,e);e+=2;var y,_=f[m],M=d+12*c+x;if(g==0)y=i.readUnicode(n,M,p/2);else if(g==3&&v==0)y=i.readUnicode(n,M,p/2);else if(v==0)y=i.readASCII(n,M,p);else if(v==1)y=i.readUnicode(n,M,p/2);else if(v==3)y=i.readUnicode(n,M,p/2);else{if(g!=1)throw"unknown encoding "+v+", platformID: "+g;y=i.readASCII(n,M,p),console.debug("reading unknown MAC encoding "+v+" as ASCII")}var w="p"+g+","+b.toString(16);s[w]==null&&(s[w]={}),s[w][_!==void 0?_:m]=y,s[w]._lang=b}for(var C in s)if(s[C].postScriptName!=null&&s[C]._lang==1033)return s[C];for(var C in s)if(s[C].postScriptName!=null&&s[C]._lang==0)return s[C];for(var C in s)if(s[C].postScriptName!=null&&s[C]._lang==3084)return s[C];for(var C in s)if(s[C].postScriptName!=null)return s[C];for(var C in s){u=C;break}return console.debug("returning name table with languageID "+s[u]._lang),s[u]},t["OS/2"]={},t["OS/2"].parse=function(n,e,a){var i=t._bin.readUshort(n,e);e+=2;var s={};if(i==0)t["OS/2"].version0(n,e,s);else if(i==1)t["OS/2"].version1(n,e,s);else if(i==2||i==3||i==4)t["OS/2"].version2(n,e,s);else{if(i!=5)throw"unknown OS/2 table version: "+i;t["OS/2"].version5(n,e,s)}return s},t["OS/2"].version0=function(n,e,a){var i=t._bin;return a.xAvgCharWidth=i.readShort(n,e),e+=2,a.usWeightClass=i.readUshort(n,e),e+=2,a.usWidthClass=i.readUshort(n,e),e+=2,a.fsType=i.readUshort(n,e),e+=2,a.ySubscriptXSize=i.readShort(n,e),e+=2,a.ySubscriptYSize=i.readShort(n,e),e+=2,a.ySubscriptXOffset=i.readShort(n,e),e+=2,a.ySubscriptYOffset=i.readShort(n,e),e+=2,a.ySuperscriptXSize=i.readShort(n,e),e+=2,a.ySuperscriptYSize=i.readShort(n,e),e+=2,a.ySuperscriptXOffset=i.readShort(n,e),e+=2,a.ySuperscriptYOffset=i.readShort(n,e),e+=2,a.yStrikeoutSize=i.readShort(n,e),e+=2,a.yStrikeoutPosition=i.readShort(n,e),e+=2,a.sFamilyClass=i.readShort(n,e),e+=2,a.panose=i.readBytes(n,e,10),e+=10,a.ulUnicodeRange1=i.readUint(n,e),e+=4,a.ulUnicodeRange2=i.readUint(n,e),e+=4,a.ulUnicodeRange3=i.readUint(n,e),e+=4,a.ulUnicodeRange4=i.readUint(n,e),e+=4,a.achVendID=[i.readInt8(n,e),i.readInt8(n,e+1),i.readInt8(n,e+2),i.readInt8(n,e+3)],e+=4,a.fsSelection=i.readUshort(n,e),e+=2,a.usFirstCharIndex=i.readUshort(n,e),e+=2,a.usLastCharIndex=i.readUshort(n,e),e+=2,a.sTypoAscender=i.readShort(n,e),e+=2,a.sTypoDescender=i.readShort(n,e),e+=2,a.sTypoLineGap=i.readShort(n,e),e+=2,a.usWinAscent=i.readUshort(n,e),e+=2,a.usWinDescent=i.readUshort(n,e),e+=2},t["OS/2"].version1=function(n,e,a){var i=t._bin;return e=t["OS/2"].version0(n,e,a),a.ulCodePageRange1=i.readUint(n,e),e+=4,a.ulCodePageRange2=i.readUint(n,e),e+=4},t["OS/2"].version2=function(n,e,a){var i=t._bin;return e=t["OS/2"].version1(n,e,a),a.sxHeight=i.readShort(n,e),e+=2,a.sCapHeight=i.readShort(n,e),e+=2,a.usDefault=i.readUshort(n,e),e+=2,a.usBreak=i.readUshort(n,e),e+=2,a.usMaxContext=i.readUshort(n,e),e+=2},t["OS/2"].version5=function(n,e,a){var i=t._bin;return e=t["OS/2"].version2(n,e,a),a.usLowerOpticalPointSize=i.readUshort(n,e),e+=2,a.usUpperOpticalPointSize=i.readUshort(n,e),e+=2},t.post={},t.post.parse=function(n,e,a){var i=t._bin,s={};return s.version=i.readFixed(n,e),e+=4,s.italicAngle=i.readFixed(n,e),e+=4,s.underlinePosition=i.readShort(n,e),e+=2,s.underlineThickness=i.readShort(n,e),e+=2,s},t==null&&(t={}),t.U==null&&(t.U={}),t.U.codeToGlyph=function(n,e){var a=n.cmap,i=-1;if(a.p0e4!=null?i=a.p0e4:a.p3e1!=null?i=a.p3e1:a.p1e0!=null?i=a.p1e0:a.p0e3!=null&&(i=a.p0e3),i==-1)throw"no familiar platform and encoding!";var s=a.tables[i];if(s.format==0)return e>=s.map.length?0:s.map[e];if(s.format==4){for(var c=-1,u=0;u<s.endCount.length;u++)if(e<=s.endCount[u]){c=u;break}return c==-1||s.startCount[c]>e?0:65535&(s.idRangeOffset[c]!=0?s.glyphIdArray[e-s.startCount[c]+(s.idRangeOffset[c]>>1)-(s.idRangeOffset.length-c)]:e+s.idDelta[c])}if(s.format==12){if(e>s.groups[s.groups.length-1][1])return 0;for(u=0;u<s.groups.length;u++){var f=s.groups[u];if(f[0]<=e&&e<=f[1])return f[2]+(e-f[0])}return 0}throw"unknown cmap table format "+s.format},t.U.glyphToPath=function(n,e){var a={cmds:[],crds:[]};if(n.SVG&&n.SVG.entries[e]){var i=n.SVG.entries[e];return i==null?a:(typeof i=="string"&&(i=t.SVG.toPath(i),n.SVG.entries[e]=i),i)}if(n.CFF){var s={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:n.CFF.Private?n.CFF.Private.defaultWidthX:0,open:!1},c=n.CFF,u=n.CFF.Private;if(c.ROS){for(var f=0;c.FDSelect[f+2]<=e;)f+=2;u=c.FDArray[c.FDSelect[f+1]].Private}t.U._drawCFF(n.CFF.CharStrings[e],s,c,u,a)}else n.glyf&&t.U._drawGlyf(e,n,a);return a},t.U._drawGlyf=function(n,e,a){var i=e.glyf[n];i==null&&(i=e.glyf[n]=t.glyf._parseGlyf(e,n)),i!=null&&(i.noc>-1?t.U._simpleGlyph(i,a):t.U._compoGlyph(i,e,a))},t.U._simpleGlyph=function(n,e){for(var a=0;a<n.noc;a++){for(var i=a==0?0:n.endPts[a-1]+1,s=n.endPts[a],c=i;c<=s;c++){var u=c==i?s:c-1,f=c==s?i:c+1,d=1&n.flags[c],h=1&n.flags[u],g=1&n.flags[f],v=n.xs[c],b=n.ys[c];if(c==i)if(d){if(!h){t.U.P.moveTo(e,v,b);continue}t.U.P.moveTo(e,n.xs[u],n.ys[u])}else h?t.U.P.moveTo(e,n.xs[u],n.ys[u]):t.U.P.moveTo(e,(n.xs[u]+v)/2,(n.ys[u]+b)/2);d?h&&t.U.P.lineTo(e,v,b):g?t.U.P.qcurveTo(e,v,b,n.xs[f],n.ys[f]):t.U.P.qcurveTo(e,v,b,(v+n.xs[f])/2,(b+n.ys[f])/2)}t.U.P.closePath(e)}},t.U._compoGlyph=function(n,e,a){for(var i=0;i<n.parts.length;i++){var s={cmds:[],crds:[]},c=n.parts[i];t.U._drawGlyf(c.glyphIndex,e,s);for(var u=c.m,f=0;f<s.crds.length;f+=2){var d=s.crds[f],h=s.crds[f+1];a.crds.push(d*u.a+h*u.b+u.tx),a.crds.push(d*u.c+h*u.d+u.ty)}for(f=0;f<s.cmds.length;f++)a.cmds.push(s.cmds[f])}},t.U._getGlyphClass=function(n,e){var a=t._lctf.getInterval(e,n);return a==-1?0:e[a+2]},t.U._applySubs=function(n,e,a,i){for(var s=n.length-e-1,c=0;c<a.tabs.length;c++)if(a.tabs[c]!=null){var u,f=a.tabs[c];if(!f.coverage||(u=t._lctf.coverageIndex(f.coverage,n[e]))!=-1){if(a.ltype==1)n[e],f.fmt==1?n[e]=n[e]+f.delta:n[e]=f.newg[u];else if(a.ltype==4)for(var d=f.vals[u],h=0;h<d.length;h++){var g=d[h],v=g.chain.length;if(!(v>s)){for(var b=!0,m=0,p=0;p<v;p++){for(;n[e+m+(1+p)]==-1;)m++;g.chain[p]!=n[e+m+(1+p)]&&(b=!1)}if(b){for(n[e]=g.nglyph,p=0;p<v+m;p++)n[e+p+1]=-1;break}}}else if(a.ltype==5&&f.fmt==2)for(var x=t._lctf.getInterval(f.cDef,n[e]),y=f.cDef[x+2],_=f.scset[y],M=0;M<_.length;M++){var w=_[M],C=w.input;if(!(C.length>s)){for(b=!0,p=0;p<C.length;p++){var F=t._lctf.getInterval(f.cDef,n[e+1+p]);if(x==-1&&f.cDef[F+2]!=C[p]){b=!1;break}}if(b){var k=w.substLookupRecords;for(h=0;h<k.length;h+=2)k[h],k[h+1]}}}else if(a.ltype==6&&f.fmt==3){if(!t.U._glsCovered(n,f.backCvg,e-f.backCvg.length)||!t.U._glsCovered(n,f.inptCvg,e)||!t.U._glsCovered(n,f.ahedCvg,e+f.inptCvg.length))continue;var D=f.lookupRec;for(M=0;M<D.length;M+=2){x=D[M];var T=i[D[M+1]];t.U._applySubs(n,e+x,T,i)}}}}},t.U._glsCovered=function(n,e,a){for(var i=0;i<e.length;i++)if(t._lctf.coverageIndex(e[i],n[a+i])==-1)return!1;return!0},t.U.glyphsToPath=function(n,e,a){for(var i={cmds:[],crds:[]},s=0,c=0;c<e.length;c++){var u=e[c];if(u!=-1){for(var f=c<e.length-1&&e[c+1]!=-1?e[c+1]:0,d=t.U.glyphToPath(n,u),h=0;h<d.crds.length;h+=2)i.crds.push(d.crds[h]+s),i.crds.push(d.crds[h+1]);for(a&&i.cmds.push(a),h=0;h<d.cmds.length;h++)i.cmds.push(d.cmds[h]);a&&i.cmds.push("X"),s+=n.hmtx.aWidth[u],c<e.length-1&&(s+=t.U.getPairAdjustment(n,u,f))}}return i},t.U.P={},t.U.P.moveTo=function(n,e,a){n.cmds.push("M"),n.crds.push(e,a)},t.U.P.lineTo=function(n,e,a){n.cmds.push("L"),n.crds.push(e,a)},t.U.P.curveTo=function(n,e,a,i,s,c,u){n.cmds.push("C"),n.crds.push(e,a,i,s,c,u)},t.U.P.qcurveTo=function(n,e,a,i,s){n.cmds.push("Q"),n.crds.push(e,a,i,s)},t.U.P.closePath=function(n){n.cmds.push("Z")},t.U._drawCFF=function(n,e,a,i,s){for(var c=e.stack,u=e.nStems,f=e.haveWidth,d=e.width,h=e.open,g=0,v=e.x,b=e.y,m=0,p=0,x=0,y=0,_=0,M=0,w=0,C=0,F=0,k=0,D={val:0,size:0};g<n.length;){t.CFF.getCharString(n,g,D);var T=D.val;if(g+=D.size,T=="o1"||T=="o18")c.length%2!=0&&!f&&(d=c.shift()+i.nominalWidthX),u+=c.length>>1,c.length=0,f=!0;else if(T=="o3"||T=="o23")c.length%2!=0&&!f&&(d=c.shift()+i.nominalWidthX),u+=c.length>>1,c.length=0,f=!0;else if(T=="o4")c.length>1&&!f&&(d=c.shift()+i.nominalWidthX,f=!0),h&&t.U.P.closePath(s),b+=c.pop(),t.U.P.moveTo(s,v,b),h=!0;else if(T=="o5")for(;c.length>0;)v+=c.shift(),b+=c.shift(),t.U.P.lineTo(s,v,b);else if(T=="o6"||T=="o7")for(var R=c.length,U=T=="o6",j=0;j<R;j++){var z=c.shift();U?v+=z:b+=z,U=!U,t.U.P.lineTo(s,v,b)}else if(T=="o8"||T=="o24"){R=c.length;for(var X=0;X+6<=R;)m=v+c.shift(),p=b+c.shift(),x=m+c.shift(),y=p+c.shift(),v=x+c.shift(),b=y+c.shift(),t.U.P.curveTo(s,m,p,x,y,v,b),X+=6;T=="o24"&&(v+=c.shift(),b+=c.shift(),t.U.P.lineTo(s,v,b))}else{if(T=="o11")break;if(T=="o1234"||T=="o1235"||T=="o1236"||T=="o1237")T=="o1234"&&(p=b,x=(m=v+c.shift())+c.shift(),k=y=p+c.shift(),M=y,C=b,v=(w=(_=(F=x+c.shift())+c.shift())+c.shift())+c.shift(),t.U.P.curveTo(s,m,p,x,y,F,k),t.U.P.curveTo(s,_,M,w,C,v,b)),T=="o1235"&&(m=v+c.shift(),p=b+c.shift(),x=m+c.shift(),y=p+c.shift(),F=x+c.shift(),k=y+c.shift(),_=F+c.shift(),M=k+c.shift(),w=_+c.shift(),C=M+c.shift(),v=w+c.shift(),b=C+c.shift(),c.shift(),t.U.P.curveTo(s,m,p,x,y,F,k),t.U.P.curveTo(s,_,M,w,C,v,b)),T=="o1236"&&(m=v+c.shift(),p=b+c.shift(),x=m+c.shift(),k=y=p+c.shift(),M=y,w=(_=(F=x+c.shift())+c.shift())+c.shift(),C=M+c.shift(),v=w+c.shift(),t.U.P.curveTo(s,m,p,x,y,F,k),t.U.P.curveTo(s,_,M,w,C,v,b)),T=="o1237"&&(m=v+c.shift(),p=b+c.shift(),x=m+c.shift(),y=p+c.shift(),F=x+c.shift(),k=y+c.shift(),_=F+c.shift(),M=k+c.shift(),w=_+c.shift(),C=M+c.shift(),Math.abs(w-v)>Math.abs(C-b)?v=w+c.shift():b=C+c.shift(),t.U.P.curveTo(s,m,p,x,y,F,k),t.U.P.curveTo(s,_,M,w,C,v,b));else if(T=="o14"){if(c.length>0&&!f&&(d=c.shift()+a.nominalWidthX,f=!0),c.length==4){var V=c.shift(),P=c.shift(),O=c.shift(),S=c.shift(),L=t.CFF.glyphBySE(a,O),E=t.CFF.glyphBySE(a,S);t.U._drawCFF(a.CharStrings[L],e,a,i,s),e.x=V,e.y=P,t.U._drawCFF(a.CharStrings[E],e,a,i,s)}h&&(t.U.P.closePath(s),h=!1)}else if(T=="o19"||T=="o20")c.length%2!=0&&!f&&(d=c.shift()+i.nominalWidthX),u+=c.length>>1,c.length=0,f=!0,g+=u+7>>3;else if(T=="o21")c.length>2&&!f&&(d=c.shift()+i.nominalWidthX,f=!0),b+=c.pop(),v+=c.pop(),h&&t.U.P.closePath(s),t.U.P.moveTo(s,v,b),h=!0;else if(T=="o22")c.length>1&&!f&&(d=c.shift()+i.nominalWidthX,f=!0),v+=c.pop(),h&&t.U.P.closePath(s),t.U.P.moveTo(s,v,b),h=!0;else if(T=="o25"){for(;c.length>6;)v+=c.shift(),b+=c.shift(),t.U.P.lineTo(s,v,b);m=v+c.shift(),p=b+c.shift(),x=m+c.shift(),y=p+c.shift(),v=x+c.shift(),b=y+c.shift(),t.U.P.curveTo(s,m,p,x,y,v,b)}else if(T=="o26")for(c.length%2&&(v+=c.shift());c.length>0;)m=v,p=b+c.shift(),v=x=m+c.shift(),b=(y=p+c.shift())+c.shift(),t.U.P.curveTo(s,m,p,x,y,v,b);else if(T=="o27")for(c.length%2&&(b+=c.shift());c.length>0;)p=b,x=(m=v+c.shift())+c.shift(),y=p+c.shift(),v=x+c.shift(),b=y,t.U.P.curveTo(s,m,p,x,y,v,b);else if(T=="o10"||T=="o29"){var I=T=="o10"?i:a;if(c.length==0)console.debug("error: empty stack");else{var B=c.pop(),Q=I.Subrs[B+I.Bias];e.x=v,e.y=b,e.nStems=u,e.haveWidth=f,e.width=d,e.open=h,t.U._drawCFF(Q,e,a,i,s),v=e.x,b=e.y,u=e.nStems,f=e.haveWidth,d=e.width,h=e.open}}else if(T=="o30"||T=="o31"){var G=c.length,q=(X=0,T=="o31");for(X+=G-(R=-3&G);X<R;)q?(p=b,x=(m=v+c.shift())+c.shift(),b=(y=p+c.shift())+c.shift(),R-X==5?(v=x+c.shift(),X++):v=x,q=!1):(m=v,p=b+c.shift(),x=m+c.shift(),y=p+c.shift(),v=x+c.shift(),R-X==5?(b=y+c.shift(),X++):b=y,q=!0),t.U.P.curveTo(s,m,p,x,y,v,b),X+=4}else{if((T+"").charAt(0)=="o")throw console.debug("Unknown operation: "+T,n),T;c.push(T)}}}e.x=v,e.y=b,e.nStems=u,e.haveWidth=f,e.width=d,e.open=h};var r=t,l={Typr:r};return o.Typr=r,o.default=l,Object.defineProperty(o,"__esModule",{value:!0}),o}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function Zf(){return function(o){var t=Uint8Array,r=Uint16Array,l=Uint32Array,n=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i=function(T,R){for(var U=new r(31),j=0;j<31;++j)U[j]=R+=1<<T[j-1];var z=new l(U[30]);for(j=1;j<30;++j)for(var X=U[j];X<U[j+1];++X)z[X]=X-U[j]<<5|j;return[U,z]},s=i(n,2),c=s[0],u=s[1];c[28]=258,u[258]=28;for(var f=i(e,0)[0],d=new r(32768),h=0;h<32768;++h){var g=(43690&h)>>>1|(21845&h)<<1;g=(61680&(g=(52428&g)>>>2|(13107&g)<<2))>>>4|(3855&g)<<4,d[h]=((65280&g)>>>8|(255&g)<<8)>>>1}var v=function(T,R,U){for(var j=T.length,z=0,X=new r(R);z<j;++z)++X[T[z]-1];var V,P=new r(R);for(z=0;z<R;++z)P[z]=P[z-1]+X[z-1]<<1;{V=new r(1<<R);var O=15-R;for(z=0;z<j;++z)if(T[z])for(var S=z<<4|T[z],L=R-T[z],E=P[T[z]-1]++<<L,I=E|(1<<L)-1;E<=I;++E)V[d[E]>>>O]=S}return V},b=new t(288);for(h=0;h<144;++h)b[h]=8;for(h=144;h<256;++h)b[h]=9;for(h=256;h<280;++h)b[h]=7;for(h=280;h<288;++h)b[h]=8;var m=new t(32);for(h=0;h<32;++h)m[h]=5;var p=v(b,9),x=v(m,5),y=function(T){for(var R=T[0],U=1;U<T.length;++U)T[U]>R&&(R=T[U]);return R},_=function(T,R,U){var j=R/8|0;return(T[j]|T[j+1]<<8)>>(7&R)&U},M=function(T,R){var U=R/8|0;return(T[U]|T[U+1]<<8|T[U+2]<<16)>>(7&R)},w=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],C=function(T,R,U){var j=new Error(R||w[T]);if(j.code=T,Error.captureStackTrace&&Error.captureStackTrace(j,C),!U)throw j;return j},F=function(T,R,U){var j=T.length;if(!j||U&&!U.l&&j<5)return R||new t(0);var z=!R||U,X=!U||U.i;U||(U={}),R||(R=new t(3*j));var V,P=function(ie){var _e=R.length;if(ie>_e){var ke=new t(Math.max(2*_e,ie));ke.set(R),R=ke}},O=U.f||0,S=U.p||0,L=U.b||0,E=U.l,I=U.d,B=U.m,Q=U.n,G=8*j;do{if(!E){U.f=O=_(T,S,1);var q=_(T,S+1,3);if(S+=3,!q){var le=T[(W=((V=S)/8|0)+(7&V&&1)+4)-4]|T[W-3]<<8,re=W+le;if(re>j){X&&C(0);break}z&&P(L+le),R.set(T.subarray(W,re),L),U.b=L+=le,U.p=S=8*re;continue}if(q==1)E=p,I=x,B=9,Q=5;else if(q==2){var Z=_(T,S,31)+257,ee=_(T,S+10,15)+4,Me=Z+_(T,S+5,31)+1;S+=14;for(var Se=new t(Me),de=new t(19),ce=0;ce<ee;++ce)de[a[ce]]=_(T,S+3*ce,7);S+=3*ee;var fe=y(de),te=(1<<fe)-1,se=v(de,fe);for(ce=0;ce<Me;){var W,Y=se[_(T,S,te)];if(S+=15&Y,(W=Y>>>4)<16)Se[ce++]=W;else{var N=0,ne=0;for(W==16?(ne=3+_(T,S,3),S+=2,N=Se[ce-1]):W==17?(ne=3+_(T,S,7),S+=3):W==18&&(ne=11+_(T,S,127),S+=7);ne--;)Se[ce++]=N}}var J=Se.subarray(0,Z),K=Se.subarray(Z);B=y(J),Q=y(K),E=v(J,B),I=v(K,Q)}else C(1);if(S>G){X&&C(0);break}}z&&P(L+131072);for(var we=(1<<B)-1,me=(1<<Q)-1,ge=S;;ge=S){var he=(N=E[M(T,S)&we])>>>4;if((S+=15&N)>G){X&&C(0);break}if(N||C(2),he<256)R[L++]=he;else{if(he==256){ge=S,E=null;break}var pe=he-254;if(he>264){var Ie=n[ce=he-257];pe=_(T,S,(1<<Ie)-1)+c[ce],S+=Ie}var Oe=I[M(T,S)&me],$=Oe>>>4;if(Oe||C(3),S+=15&Oe,K=f[$],$>3&&(Ie=e[$],K+=M(T,S)&(1<<Ie)-1,S+=Ie),S>G){X&&C(0);break}z&&P(L+131072);for(var ue=L+pe;L<ue;L+=4)R[L]=R[L-K],R[L+1]=R[L+1-K],R[L+2]=R[L+2-K],R[L+3]=R[L+3-K];L=ue}}U.l=E,U.p=ge,U.b=L,E&&(O=1,U.m=B,U.d=I,U.n=Q)}while(!O);return L==R.length?R:function(ie,_e,ke){(ke==null||ke>ie.length)&&(ke=ie.length);var ze=new(ie instanceof r?r:ie instanceof l?l:t)(ke-_e);return ze.set(ie.subarray(_e,ke)),ze}(R,0,L)},k=new t(0),D=typeof TextDecoder<"u"&&new TextDecoder;try{D.decode(k,{stream:!0})}catch{}return o.convert_streams=function(T){var R=new DataView(T),U=0;function j(){var Z=R.getUint16(U);return U+=2,Z}function z(){var Z=R.getUint32(U);return U+=4,Z}function X(Z){le.setUint16(re,Z),re+=2}function V(Z){le.setUint32(re,Z),re+=4}for(var P={signature:z(),flavor:z(),length:z(),numTables:j(),reserved:j(),totalSfntSize:z(),majorVersion:j(),minorVersion:j(),metaOffset:z(),metaLength:z(),metaOrigLength:z(),privOffset:z(),privLength:z()},O=0;Math.pow(2,O)<=P.numTables;)O++;O--;for(var S=16*Math.pow(2,O),L=16*P.numTables-S,E=12,I=[],B=0;B<P.numTables;B++)I.push({tag:z(),offset:z(),compLength:z(),origLength:z(),origChecksum:z()}),E+=16;var Q,G=new Uint8Array(12+16*I.length+I.reduce(function(Z,ee){return Z+ee.origLength+4},0)),q=G.buffer,le=new DataView(q),re=0;return V(P.flavor),X(P.numTables),X(S),X(O),X(L),I.forEach(function(Z){V(Z.tag),V(Z.origChecksum),V(E),V(Z.origLength),Z.outOffset=E,(E+=Z.origLength)%4!=0&&(E+=4-E%4)}),I.forEach(function(Z){var ee,Me=T.slice(Z.offset,Z.offset+Z.compLength);if(Z.compLength!=Z.origLength){var Se=new Uint8Array(Z.origLength);ee=new Uint8Array(Me,2),F(ee,Se)}else Se=new Uint8Array(Me);G.set(Se,Z.outOffset);var de=0;(E=Z.outOffset+Z.origLength)%4!=0&&(de=4-E%4),G.set(new Uint8Array(de).buffer,Z.outOffset+Z.origLength),Q=E+de}),q.slice(0,Q)},Object.defineProperty(o,"__esModule",{value:!0}),o}({}).convert_streams}function Jf(o,t){const r={M:2,L:2,Q:4,C:6,Z:0},l={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},n=1,e=2,a=4,i=8,s=16,c=32;let u;function f(w){if(!u){const C={R:e,L:n,D:a,C:s,U:c,T:i};u=new Map;for(let F in l){let k=0;l[F].split(",").forEach(D=>{let[T,R]=D.split("+");T=parseInt(T,36),R=R?parseInt(R,36):0,u.set(k+=T,C[F]);for(let U=R;U--;)u.set(++k,C[F])})}}return u.get(w)||c}const d=1,h=2,g=3,v=4,b=[null,"isol","init","fina","medi"];function m(w){const C=new Uint8Array(w.length);let F=c,k=d,D=-1;for(let T=0;T<w.length;T++){const R=w.codePointAt(T);let U=f(R)|0,j=d;U&i||(F&(n|a|s)?U&(e|a|s)?(j=g,(k===d||k===g)&&C[D]++):U&(n|c)&&(k===h||k===v)&&C[D]--:F&(e|c)&&(k===h||k===v)&&C[D]--,k=C[T]=j,F=U,D=T,R>65535&&T++)}return C}function p(w,C){const F=[];for(let D=0;D<C.length;D++){const T=C.codePointAt(D);T>65535&&D++,F.push(o.U.codeToGlyph(w,T))}const k=w.GSUB;if(k){const{lookupList:D,featureList:T}=k;let R;const U=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,j=[];T.forEach(z=>{if(U.test(z.tag))for(let X=0;X<z.tab.length;X++){if(j[z.tab[X]])continue;j[z.tab[X]]=!0;const V=D[z.tab[X]],P=/^(isol|init|fina|medi)$/.test(z.tag);P&&!R&&(R=m(C));for(let O=0;O<F.length;O++)(!R||!P||b[R[O]]===z.tag)&&o.U._applySubs(F,O,V,D)}})}return F}function x(w,C){const F=new Int16Array(C.length*3);let k=0;for(;k<C.length;k++){const U=C[k];if(U===-1)continue;F[k*3+2]=w.hmtx.aWidth[U];const j=w.GPOS;if(j){const z=j.lookupList;for(let X=0;X<z.length;X++){const V=z[X];for(let P=0;P<V.tabs.length;P++){const O=V.tabs[P];if(V.ltype===1){if(o._lctf.coverageIndex(O.coverage,U)!==-1&&O.pos){R(O.pos,k);break}}else if(V.ltype===2){let S=null,L=D();if(L!==-1){const E=o._lctf.coverageIndex(O.coverage,C[L]);if(E!==-1){if(O.fmt===1){const I=O.pairsets[E];for(let B=0;B<I.length;B++)I[B].gid2===U&&(S=I[B])}else if(O.fmt===2){const I=o.U._getGlyphClass(C[L],O.classDef1),B=o.U._getGlyphClass(U,O.classDef2);S=O.matrix[I][B]}if(S){S.val1&&R(S.val1,L),S.val2&&R(S.val2,k);break}}}}else if(V.ltype===4){const S=o._lctf.coverageIndex(O.markCoverage,U);if(S!==-1){const L=D(T),E=L===-1?-1:o._lctf.coverageIndex(O.baseCoverage,C[L]);if(E!==-1){const I=O.markArray[S],B=O.baseArray[E][I.markClass];F[k*3]=B.x-I.x+F[L*3]-F[L*3+2],F[k*3+1]=B.y-I.y+F[L*3+1];break}}}else if(V.ltype===6){const S=o._lctf.coverageIndex(O.mark1Coverage,U);if(S!==-1){const L=D();if(L!==-1){const E=C[L];if(y(w,E)===3){const I=o._lctf.coverageIndex(O.mark2Coverage,E);if(I!==-1){const B=O.mark1Array[S],Q=O.mark2Array[I][B.markClass];F[k*3]=Q.x-B.x+F[L*3]-F[L*3+2],F[k*3+1]=Q.y-B.y+F[L*3+1];break}}}}}}}}else if(w.kern&&!w.cff){const z=D();if(z!==-1){const X=w.kern.glyph1.indexOf(C[z]);if(X!==-1){const V=w.kern.rval[X].glyph2.indexOf(U);V!==-1&&(F[z*3+2]+=w.kern.rval[X].vals[V])}}}}return F;function D(U){for(let j=k-1;j>=0;j--)if(C[j]!==-1&&(!U||U(C[j])))return j;return-1}function T(U){return y(w,U)===1}function R(U,j){for(let z=0;z<3;z++)F[j*3+z]+=U[z]||0}}function y(w,C){const F=w.GDEF&&w.GDEF.glyphClassDef;return F?o.U._getGlyphClass(C,F):0}function _(...w){for(let C=0;C<w.length;C++)if(typeof w[C]=="number")return w[C]}function M(w){const C=Object.create(null),F=w["OS/2"],k=w.hhea,D=w.head.unitsPerEm,T=_(F&&F.sTypoAscender,k&&k.ascender,D),R={unitsPerEm:D,ascender:T,descender:_(F&&F.sTypoDescender,k&&k.descender,0),capHeight:_(F&&F.sCapHeight,T),xHeight:_(F&&F.sxHeight,T),lineGap:_(F&&F.sTypoLineGap,k&&k.lineGap),supportsCodePoint(U){return o.U.codeToGlyph(w,U)>0},forEachGlyph(U,j,z,X){let V=0;const P=1/R.unitsPerEm*j,O=p(w,U);let S=0;const L=x(w,O);return O.forEach((E,I)=>{if(E!==-1){let B=C[E];if(!B){const{cmds:Q,crds:G}=o.U.glyphToPath(w,E);let q="",le=0;for(let Se=0,de=Q.length;Se<de;Se++){const ce=r[Q[Se]];q+=Q[Se];for(let fe=1;fe<=ce;fe++)q+=(fe>1?",":"")+G[le++]}let re,Z,ee,Me;if(G.length){re=Z=1/0,ee=Me=-1/0;for(let Se=0,de=G.length;Se<de;Se+=2){let ce=G[Se],fe=G[Se+1];ce<re&&(re=ce),fe<Z&&(Z=fe),ce>ee&&(ee=ce),fe>Me&&(Me=fe)}}else re=ee=Z=Me=0;B=C[E]={index:E,advanceWidth:w.hmtx.aWidth[E],xMin:re,yMin:Z,xMax:ee,yMax:Me,path:q}}X.call(null,B,V+L[I*3]*P,L[I*3+1]*P,S),V+=L[I*3+2]*P,z&&(V+=z*j)}S+=U.codePointAt(S)>65535?2:1}),V}};return R}return function(C){const F=new Uint8Array(C,0,4),k=o._bin.readASCII(F,0,4);if(k==="wOFF")C=t(C);else if(k==="wOF2")throw new Error("woff2 fonts not supported");return M(o.parse(C)[0])}}const $f=un({name:"Typr Font Parser",dependencies:[Kf,Zf,Jf],init(o,t,r){const l=o(),n=t();return r(l,n)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function ed(){return function(o){var t=function(){this.buckets=new Map};t.prototype.add=function(x){var y=x>>5;this.buckets.set(y,(this.buckets.get(y)||0)|1<<(31&x))},t.prototype.has=function(x){var y=this.buckets.get(x>>5);return y!==void 0&&(y&1<<(31&x))!=0},t.prototype.serialize=function(){var x=[];return this.buckets.forEach(function(y,_){x.push((+_).toString(36)+":"+y.toString(36))}),x.join(",")},t.prototype.deserialize=function(x){var y=this;this.buckets.clear(),x.split(",").forEach(function(_){var M=_.split(":");y.buckets.set(parseInt(M[0],36),parseInt(M[1],36))})};var r=Math.pow(2,8),l=r-1,n=~l;function e(x){var y=function(M){return M&n}(x).toString(16),_=function(M){return(M&n)+r-1}(x).toString(16);return"codepoint-index/plane"+(x>>16)+"/"+y+"-"+_+".json"}function a(x,y){var _=x&l,M=y.codePointAt(_/6|0);return((M=(M||48)-48)&1<<_%6)!=0}function i(x,y){var _;(_=x,_.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(M){return M.split("-").map(function(w){return parseInt(w.trim(),16)})})).forEach(function(M){var w=M[0],C=M[1];C===void 0&&(C=w),y(w,C)})}function s(x,y){i(x,function(_,M){for(var w=_;w<=M;w++)y(w)})}var c={},u={},f=new WeakMap,d="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function h(x){var y=f.get(x);return y||(y=new t,s(x.ranges,function(_){return y.add(_)}),f.set(x,y)),y}var g,v=new Map;function b(x,y,_){return x[y]?y:x[_]?_:function(M){for(var w in M)return w}(x)}function m(x,y){var _=y;if(!x.includes(_)){_=1/0;for(var M=0;M<x.length;M++)Math.abs(x[M]-y)<Math.abs(_-y)&&(_=x[M])}return _}function p(x){return g||(g=new Set,s("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(y){g.add(y)})),g.has(x)}return o.CodePointSet=t,o.clearCache=function(){c={},u={}},o.getFontsForString=function(x,y){y===void 0&&(y={});var _,M=y.lang;M===void 0&&(M=/\p{Script=Hangul}/u.test(_=x)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(_)?"ja":"en");var w=y.category;w===void 0&&(w="sans-serif");var C=y.style;C===void 0&&(C="normal");var F=y.weight;F===void 0&&(F=400);var k=(y.dataUrl||d).replace(/\/$/g,""),D=new Map,T=new Uint8Array(x.length),R={},U={},j=new Array(x.length),z=new Map,X=!1;function V(S){var L=v.get(S);return L||(L=fetch(k+"/"+S).then(function(E){if(!E.ok)throw new Error(E.statusText);return E.json().then(function(I){if(!Array.isArray(I)||I[0]!==1)throw new Error("Incorrect schema version; need 1, got "+I[0]);return I[1]})}).catch(function(E){if(k!==d)return X||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+k+'", trying default CDN. '+E.message),X=!0),k=d,v.delete(S),V(S);throw E}),v.set(S,L)),L}for(var P=function(S){var L=x.codePointAt(S),E=e(L);j[S]=E,c[E]||z.has(E)||z.set(E,V(E).then(function(I){c[E]=I})),L>65535&&(S++,O=S)},O=0;O<x.length;O++)P(O);return Promise.all(z.values()).then(function(){z.clear();for(var S=function(E){var I=x.codePointAt(E),B=null,Q=c[j[E]],G=void 0;for(var q in Q){var le=U[q];if(le===void 0&&(le=U[q]=new RegExp(q).test(M||"en")),le){for(var re in G=q,Q[q])if(a(I,Q[q][re])){B=re;break}break}}if(!B){e:for(var Z in Q)if(Z!==G){for(var ee in Q[Z])if(a(I,Q[Z][ee])){B=ee;break e}}}B||(console.debug("No font coverage for U+"+I.toString(16)),B="latin"),j[E]=B,u[B]||z.has(B)||z.set(B,V("font-meta/"+B+".json").then(function(Me){u[B]=Me})),I>65535&&(E++,L=E)},L=0;L<x.length;L++)S(L);return Promise.all(z.values())}).then(function(){for(var S,L=null,E=0;E<x.length;E++){var I=x.codePointAt(E);if(L&&(p(I)||h(L).has(I)))T[E]=T[E-1];else{L=u[j[E]];var B=R[L.id];if(!B){var Q=L.typeforms,G=b(Q,w,"sans-serif"),q=b(Q[G],C,"normal"),le=m((S=Q[G])===null||S===void 0?void 0:S[q],F);B=R[L.id]=k+"/font-files/"+L.id+"/"+G+"."+q+"."+le+".woff"}var re=D.get(B);re==null&&(re=D.size,D.set(B,re)),T[E]=re}I>65535&&(E++,T[E]=T[E-1])}return{fontUrls:Array.from(D.keys()),chars:T}})},Object.defineProperty(o,"__esModule",{value:!0}),o}({})}function td(o,t){const r=Object.create(null),l=Object.create(null);function n(a,i){const s=c=>{console.error(`Failure loading font ${a}`,c)};try{const c=new XMLHttpRequest;c.open("get",a,!0),c.responseType="arraybuffer",c.onload=function(){if(c.status>=400)s(new Error(c.statusText));else if(c.status>0)try{const u=o(c.response);u.src=a,i(u)}catch(u){s(u)}},c.onerror=s,c.send()}catch(c){s(c)}}function e(a,i){let s=r[a];s?i(s):l[a]?l[a].push(i):(l[a]=[i],n(a,c=>{c.src=a,r[a]=c,l[a].forEach(u=>u(c)),delete l[a]}))}return function(a,i,{lang:s,fonts:c=[],style:u="normal",weight:f="normal",unicodeFontsURL:d}={}){const h=new Uint8Array(a.length),g=[];a.length||p();const v=new Map,b=[];if(u!=="italic"&&(u="normal"),typeof f!="number"&&(f=f==="bold"?700:400),c&&!Array.isArray(c)&&(c=[c]),c=c.slice().filter(y=>!y.lang||y.lang.test(s)).reverse(),c.length){let w=0;(function C(F=0){for(let k=F,D=a.length;k<D;k++){const T=a.codePointAt(k);if(w===1&&g[h[k-1]].supportsCodePoint(T)||k>0&&/\s/.test(a[k]))h[k]=h[k-1],w===2&&(b[b.length-1][1]=k);else for(let R=h[k],U=c.length;R<=U;R++)if(R===U){const j=w===2?b[b.length-1]:b[b.length]=[k,k];j[1]=k,w=2}else{h[k]=R;const{src:j,unicodeRange:z}=c[R];if(!z||x(T,z)){const X=r[j];if(!X){e(j,()=>{C(k)});return}if(X.supportsCodePoint(T)){let V=v.get(X);typeof V!="number"&&(V=g.length,g.push(X),v.set(X,V)),h[k]=V,w=1;break}}}T>65535&&k+1<D&&(h[k+1]=h[k],k++,w===2&&(b[b.length-1][1]=k))}m()})()}else b.push([0,a.length-1]),m();function m(){if(b.length){const y=b.map(_=>a.substring(_[0],_[1]+1)).join(`
`);t.getFontsForString(y,{lang:s||void 0,style:u,weight:f,dataUrl:d}).then(({fontUrls:_,chars:M})=>{const w=g.length;let C=0;b.forEach(k=>{for(let D=0,T=k[1]-k[0];D<=T;D++)h[k[0]+D]=M[C++]+w;C++});let F=0;_.forEach((k,D)=>{e(k,T=>{g[D+w]=T,++F===_.length&&p()})})})}else p()}function p(){i({chars:h,fonts:g})}function x(y,_){for(let M=0;M<_.length;M++){const[w,C=w]=_[M];if(w<=y&&y<=C)return!0}return!1}}}const nd=un({name:"FontResolver",dependencies:[td,$f,ed],init(o,t,r){return o(t,r())}});function od(o,t){const l=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,n="[^\\S\\u00A0]",e=new RegExp(`${n}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function a({text:g,lang:v,fonts:b,style:m,weight:p,preResolvedFonts:x,unicodeFontsURL:y},_){const M=({chars:w,fonts:C})=>{let F,k;const D=[];for(let T=0;T<w.length;T++)w[T]!==k?(k=w[T],D.push(F={start:T,end:T,fontObj:C[w[T]]})):F.end=T;_(D)};x?M(x):o(g,M,{lang:v,fonts:b,style:m,weight:p,unicodeFontsURL:y})}function i({text:g="",font:v,lang:b,sdfGlyphSize:m=64,fontSize:p=400,fontWeight:x=1,fontStyle:y="normal",letterSpacing:_=0,lineHeight:M="normal",maxWidth:w=1/0,direction:C,textAlign:F="left",textIndent:k=0,whiteSpace:D="normal",overflowWrap:T="normal",anchorX:R=0,anchorY:U=0,metricsOnly:j=!1,unicodeFontsURL:z,preResolvedFonts:X=null,includeCaretPositions:V=!1,chunkedBoundsSize:P=8192,colorRanges:O=null},S){const L=f(),E={fontLoad:0,typesetting:0};g.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),g=g.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),p=+p,_=+_,w=+w,M=M||"normal",k=+k,a({text:g,lang:b,style:y,weight:x,fonts:typeof v=="string"?[{src:v}]:v,unicodeFontsURL:z,preResolvedFonts:X},I=>{E.fontLoad=f()-L;const B=isFinite(w);let Q=null,G=null,q=null,le=null,re=null,Z=null,ee=null,Me=null,Se=0,de=0,ce=D!=="nowrap";const fe=new Map,te=f();let se=k,W=0,Y=new d;const N=[Y];I.forEach(me=>{const{fontObj:ge}=me,{ascender:he,descender:pe,unitsPerEm:Ie,lineGap:Oe,capHeight:$,xHeight:ue}=ge;let ie=fe.get(ge);if(!ie){const Ce=p/Ie,Te=M==="normal"?(he-pe+Oe)*Ce:M*p,Ee=(Te-(he-pe)*Ce)/2,H=Math.min(Te,(he-pe)*Ce),ae=(he+pe)/2*Ce+H/2;ie={index:fe.size,src:ge.src,fontObj:ge,fontSizeMult:Ce,unitsPerEm:Ie,ascender:he*Ce,descender:pe*Ce,capHeight:$*Ce,xHeight:ue*Ce,lineHeight:Te,baseline:-Ee-he*Ce,caretTop:ae,caretBottom:ae-H},fe.set(ge,ie)}const{fontSizeMult:_e}=ie,ke=g.slice(me.start,me.end+1);let ze,be;ge.forEachGlyph(ke,p,_,(Ce,Te,Ee,H)=>{Te+=W,H+=me.start,ze=Te,be=Ce;const ae=g.charAt(H),ve=Ce.advanceWidth*_e,ye=Y.count;let xe;if("isEmpty"in Ce||(Ce.isWhitespace=!!ae&&new RegExp(n).test(ae),Ce.canBreakAfter=!!ae&&e.test(ae),Ce.isEmpty=Ce.xMin===Ce.xMax||Ce.yMin===Ce.yMax||l.test(ae)),!Ce.isWhitespace&&!Ce.isEmpty&&de++,ce&&B&&!Ce.isWhitespace&&Te+ve+se>w&&ye){if(Y.glyphAt(ye-1).glyphObj.canBreakAfter)xe=new d,se=-Te;else for(let Ve=ye;Ve--;)if(Ve===0&&T==="break-word"){xe=new d,se=-Te;break}else if(Y.glyphAt(Ve).glyphObj.canBreakAfter){xe=Y.splitAt(Ve+1);const We=xe.glyphAt(0).x;se-=We;for(let Be=xe.count;Be--;)xe.glyphAt(Be).x-=We;break}xe&&(Y.isSoftWrapped=!0,Y=xe,N.push(Y),Se=w)}let Fe=Y.glyphAt(Y.count);Fe.glyphObj=Ce,Fe.x=Te+se,Fe.y=Ee,Fe.width=ve,Fe.charIndex=H,Fe.fontData=ie,ae===`
`&&(Y=new d,N.push(Y),se=-(Te+ve+_*p)+k)}),W=ze+be.advanceWidth*_e+_*p});let ne=0;N.forEach(me=>{let ge=!0;for(let he=me.count;he--;){const pe=me.glyphAt(he);ge&&!pe.glyphObj.isWhitespace&&(me.width=pe.x+pe.width,me.width>Se&&(Se=me.width),ge=!1);let{lineHeight:Ie,capHeight:Oe,xHeight:$,baseline:ue}=pe.fontData;Ie>me.lineHeight&&(me.lineHeight=Ie);const ie=ue-me.baseline;ie<0&&(me.baseline+=ie,me.cap+=ie,me.ex+=ie),me.cap=Math.max(me.cap,me.baseline+Oe),me.ex=Math.max(me.ex,me.baseline+$)}me.baseline-=ne,me.cap-=ne,me.ex-=ne,ne+=me.lineHeight});let J=0,K=0;if(R&&(typeof R=="number"?J=-R:typeof R=="string"&&(J=-Se*(R==="left"?0:R==="center"?.5:R==="right"?1:c(R)))),U&&(typeof U=="number"?K=-U:typeof U=="string"&&(K=U==="top"?0:U==="top-baseline"?-N[0].baseline:U==="top-cap"?-N[0].cap:U==="top-ex"?-N[0].ex:U==="middle"?ne/2:U==="bottom"?ne:U==="bottom-baseline"?-N[N.length-1].baseline:c(U)*ne)),!j){const me=t.getEmbeddingLevels(g,C);Q=new Uint16Array(de),G=new Uint8Array(de),q=new Float32Array(de*2),le={},ee=[1/0,1/0,-1/0,-1/0],Me=[],V&&(Z=new Float32Array(g.length*4)),O&&(re=new Uint8Array(de*3));let ge=0,he=-1,pe=-1,Ie,Oe;if(N.forEach(($,ue)=>{let{count:ie,width:_e}=$;if(ie>0){let ke=0;for(let H=ie;H--&&$.glyphAt(H).glyphObj.isWhitespace;)ke++;let ze=0,be=0;if(F==="center")ze=(Se-_e)/2;else if(F==="right")ze=Se-_e;else if(F==="justify"&&$.isSoftWrapped){let H=0;for(let ae=ie-ke;ae--;)$.glyphAt(ae).glyphObj.isWhitespace&&H++;be=(Se-_e)/H}if(be||ze){let H=0;for(let ae=0;ae<ie;ae++){let ve=$.glyphAt(ae);const ye=ve.glyphObj;ve.x+=ze+H,be!==0&&ye.isWhitespace&&ae<ie-ke&&(H+=be,ve.width+=be)}}const Ce=t.getReorderSegments(g,me,$.glyphAt(0).charIndex,$.glyphAt($.count-1).charIndex);for(let H=0;H<Ce.length;H++){const[ae,ve]=Ce[H];let ye=1/0,xe=-1/0;for(let Fe=0;Fe<ie;Fe++)if($.glyphAt(Fe).charIndex>=ae){let Ve=Fe,We=Fe;for(;We<ie;We++){let Be=$.glyphAt(We);if(Be.charIndex>ve)break;We<ie-ke&&(ye=Math.min(ye,Be.x),xe=Math.max(xe,Be.x+Be.width))}for(let Be=Ve;Be<We;Be++){const je=$.glyphAt(Be);je.x=xe-(je.x+je.width-ye)}break}}let Te;const Ee=H=>Te=H;for(let H=0;H<ie;H++){const ae=$.glyphAt(H);Te=ae.glyphObj;const ve=Te.index,ye=me.levels[ae.charIndex]&1;if(ye){const xe=t.getMirroredCharacter(g[ae.charIndex]);xe&&ae.fontData.fontObj.forEachGlyph(xe,0,0,Ee)}if(V){const{charIndex:xe,fontData:Fe}=ae,Ve=ae.x+J,We=ae.x+ae.width+J;Z[xe*4]=ye?We:Ve,Z[xe*4+1]=ye?Ve:We,Z[xe*4+2]=$.baseline+Fe.caretBottom+K,Z[xe*4+3]=$.baseline+Fe.caretTop+K;const Be=xe-he;Be>1&&u(Z,he,Be),he=xe}if(O){const{charIndex:xe}=ae;for(;xe>pe;)pe++,O.hasOwnProperty(pe)&&(Oe=O[pe])}if(!Te.isWhitespace&&!Te.isEmpty){const xe=ge++,{fontSizeMult:Fe,src:Ve,index:We}=ae.fontData,Be=le[Ve]||(le[Ve]={});Be[ve]||(Be[ve]={path:Te.path,pathBounds:[Te.xMin,Te.yMin,Te.xMax,Te.yMax]});const je=ae.x+J,Ae=ae.y+$.baseline+K;q[xe*2]=je,q[xe*2+1]=Ae;const Le=je+Te.xMin*Fe,Re=Ae+Te.yMin*Fe,Pe=je+Te.xMax*Fe,He=Ae+Te.yMax*Fe;Le<ee[0]&&(ee[0]=Le),Re<ee[1]&&(ee[1]=Re),Pe>ee[2]&&(ee[2]=Pe),He>ee[3]&&(ee[3]=He),xe%P===0&&(Ie={start:xe,end:xe,rect:[1/0,1/0,-1/0,-1/0]},Me.push(Ie)),Ie.end++;const Ge=Ie.rect;if(Le<Ge[0]&&(Ge[0]=Le),Re<Ge[1]&&(Ge[1]=Re),Pe>Ge[2]&&(Ge[2]=Pe),He>Ge[3]&&(Ge[3]=He),Q[xe]=ve,G[xe]=We,O){const it=xe*3;re[it]=Oe>>16&255,re[it+1]=Oe>>8&255,re[it+2]=Oe&255}}}}}),Z){const $=g.length-he;$>1&&u(Z,he,$)}}const we=[];fe.forEach(({index:me,src:ge,unitsPerEm:he,ascender:pe,descender:Ie,lineHeight:Oe,capHeight:$,xHeight:ue})=>{we[me]={src:ge,unitsPerEm:he,ascender:pe,descender:Ie,lineHeight:Oe,capHeight:$,xHeight:ue}}),E.typesetting=f()-te,S({glyphIds:Q,glyphFontIndices:G,glyphPositions:q,glyphData:le,fontData:we,caretPositions:Z,glyphColors:re,chunkedBounds:Me,fontSize:p,topBaseline:K+N[0].baseline,blockBounds:[J,K-ne,J+Se,K],visibleBounds:ee,timings:E})})}function s(g,v){i({...g,metricsOnly:!0},b=>{const[m,p,x,y]=b.blockBounds;v({width:x-m,height:y-p})})}function c(g){let v=g.match(/^([\d.]+)%$/),b=v?parseFloat(v[1]):NaN;return isNaN(b)?0:b/100}function u(g,v,b){const m=g[v*4],p=g[v*4+1],x=g[v*4+2],y=g[v*4+3],_=(p-m)/b;for(let M=0;M<b;M++){const w=(v+M)*4;g[w]=m+_*M,g[w+1]=m+_*(M+1),g[w+2]=x,g[w+3]=y}}function f(){return(self.performance||Date).now()}function d(){this.data=[]}const h=["glyphObj","x","y","width","charIndex","fontData"];return d.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/h.length)},glyphAt(g){let v=d.flyweight;return v.data=this.data,v.index=g,v},splitAt(g){let v=new d;return v.data=this.data.splice(g*h.length),v}},d.flyweight=h.reduce((g,v,b,m)=>(Object.defineProperty(g,v,{get(){return this.data[this.index*h.length+b]},set(p){this.data[this.index*h.length+b]=p}}),g),{data:null,index:0}),{typeset:i,measure:s}}const Nt=()=>(self.performance||Date).now(),xo=Zs();let Ya;function rd(o,t,r,l,n,e,a,i,s,c,u=!0){return u?sd(o,t,r,l,n,e,a,i,s,c).then(null,f=>(Ya||(console.warn("WebGL SDF generation failed, falling back to JS",f),Ya=!0),Qa(o,t,r,l,n,e,a,i,s,c))):Qa(o,t,r,l,n,e,a,i,s,c)}const ro=[],ad=5;let kr=0;function $s(){const o=Nt();for(;ro.length&&Nt()-o<ad;)ro.shift()();kr=ro.length?setTimeout($s,0):0}const sd=(...o)=>new Promise((t,r)=>{ro.push(()=>{const l=Nt();try{xo.webgl.generateIntoCanvas(...o),t({timing:Nt()-l})}catch(n){r(n)}}),kr||(kr=setTimeout($s,0))}),id=4,cd=2e3,Xa={};let ld=0;function Qa(o,t,r,l,n,e,a,i,s,c){const u="TroikaTextSDFGenerator_JS_"+ld++%id;let f=Xa[u];return f||(f=Xa[u]={workerModule:un({name:u,workerId:u,dependencies:[Zs,Nt],init(d,h){const g=d().javascript.generate;return function(...v){const b=h();return{textureData:g(...v),timing:h()-b}}},getTransferables(d){return[d.textureData.buffer]}}),requests:0,idleTimer:null}),f.requests++,clearTimeout(f.idleTimer),f.workerModule(o,t,r,l,n,e).then(({textureData:d,timing:h})=>{const g=Nt(),v=new Uint8Array(d.length*4);for(let b=0;b<d.length;b++)v[b*4+c]=d[b];return xo.webglUtils.renderImageData(a,v,i,s,o,t,1<<3-c),h+=Nt()-g,--f.requests===0&&(f.idleTimer=setTimeout(()=>{Gf(u)},cd)),{timing:h}})}function ud(o){o._warm||(xo.webgl.isSupported(o),o._warm=!0)}const fd=xo.webglUtils.resizeWebGLCanvasWithoutClearing,An={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},dd=new Je;function nn(){return(self.performance||Date).now()}const Ka=Object.create(null);function hd(o,t){o=gd({},o);const r=nn(),l=[];if(o.font&&l.push({label:"user",src:md(o.font)}),o.font=l,o.text=""+o.text,o.sdfGlyphSize=o.sdfGlyphSize||An.sdfGlyphSize,o.unicodeFontsURL=o.unicodeFontsURL||An.unicodeFontsURL,o.colorRanges!=null){let d={};for(let h in o.colorRanges)if(o.colorRanges.hasOwnProperty(h)){let g=o.colorRanges[h];typeof g!="number"&&(g=dd.set(g).getHex()),d[h]=g}o.colorRanges=d}Object.freeze(o);const{textureWidth:n,sdfExponent:e}=An,{sdfGlyphSize:a}=o,i=n/a*4;let s=Ka[a];if(!s){const d=document.createElement("canvas");d.width=n,d.height=a*256/i,s=Ka[a]={glyphCount:0,sdfGlyphSize:a,sdfCanvas:d,sdfTexture:new Dr(d,void 0,void 0,void 0,co,co),contextLost:!1,glyphsByFont:new Map},s.sdfTexture.generateMipmaps=!1,pd(s)}const{sdfTexture:c,sdfCanvas:u}=s;ni(o).then(d=>{const{glyphIds:h,glyphFontIndices:g,fontData:v,glyphPositions:b,fontSize:m,timings:p}=d,x=[],y=new Float32Array(h.length*4);let _=0,M=0;const w=nn(),C=v.map(R=>{let U=s.glyphsByFont.get(R.src);return U||s.glyphsByFont.set(R.src,U=new Map),U});h.forEach((R,U)=>{const j=g[U],{src:z,unitsPerEm:X}=v[j];let V=C[j].get(R);if(!V){const{path:E,pathBounds:I}=d.glyphData[z][R],B=Math.max(I[2]-I[0],I[3]-I[1])/a*(An.sdfMargin*a+.5),Q=s.glyphCount++,G=[I[0]-B,I[1]-B,I[2]+B,I[3]+B];C[j].set(R,V={path:E,atlasIndex:Q,sdfViewBox:G}),x.push(V)}const{sdfViewBox:P}=V,O=b[M++],S=b[M++],L=m/X;y[_++]=O+P[0]*L,y[_++]=S+P[1]*L,y[_++]=O+P[2]*L,y[_++]=S+P[3]*L,h[U]=V.atlasIndex}),p.quads=(p.quads||0)+(nn()-w);const F=nn();p.sdf={};const k=u.height,D=Math.ceil(s.glyphCount/i),T=Math.pow(2,Math.ceil(Math.log2(D*a)));T>k&&(console.info(`Increasing SDF texture size ${k}->${T}`),fd(u,n,T),c.dispose()),Promise.all(x.map(R=>ei(R,s,o.gpuAccelerateSDF).then(({timing:U})=>{p.sdf[R.atlasIndex]=U}))).then(()=>{x.length&&!s.contextLost&&(ti(s),c.needsUpdate=!0),p.sdfTotal=nn()-F,p.total=nn()-r,t(Object.freeze({parameters:o,sdfTexture:c,sdfGlyphSize:a,sdfExponent:e,glyphBounds:y,glyphAtlasIndices:h,glyphColors:d.glyphColors,caretPositions:d.caretPositions,chunkedBounds:d.chunkedBounds,ascender:d.ascender,descender:d.descender,lineHeight:d.lineHeight,capHeight:d.capHeight,xHeight:d.xHeight,topBaseline:d.topBaseline,blockBounds:d.blockBounds,visibleBounds:d.visibleBounds,timings:d.timings}))})}),Promise.resolve().then(()=>{s.contextLost||ud(u)})}function ei({path:o,atlasIndex:t,sdfViewBox:r},{sdfGlyphSize:l,sdfCanvas:n,contextLost:e},a){if(e)return Promise.resolve({timing:-1});const{textureWidth:i,sdfExponent:s}=An,c=Math.max(r[2]-r[0],r[3]-r[1]),u=Math.floor(t/4),f=u%(i/l)*l,d=Math.floor(u/(i/l))*l,h=t%4;return rd(l,l,o,r,c,s,n,f,d,h,a)}function pd(o){const t=o.sdfCanvas;t.addEventListener("webglcontextlost",r=>{console.log("Context Lost",r),r.preventDefault(),o.contextLost=!0}),t.addEventListener("webglcontextrestored",r=>{console.log("Context Restored",r),o.contextLost=!1;const l=[];o.glyphsByFont.forEach(n=>{n.forEach(e=>{l.push(ei(e,o,!0))})}),Promise.all(l).then(()=>{ti(o),o.sdfTexture.needsUpdate=!0})})}function gd(o,t){for(let r in t)t.hasOwnProperty(r)&&(o[r]=t[r]);return o}let Jn;function md(o){return Jn||(Jn=typeof document>"u"?{}:document.createElement("a")),Jn.href=o,Jn.href}function ti(o){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:t,sdfTexture:r}=o,{width:l,height:n}=t,e=o.sdfCanvas.getContext("webgl");let a=r.image.data;(!a||a.length!==l*n*4)&&(a=new Uint8Array(l*n*4),r.image={width:l,height:n,data:a},r.flipY=!1,r.isDataTexture=!0),e.readPixels(0,0,l,n,e.RGBA,e.UNSIGNED_BYTE,a)}}const vd=un({name:"Typesetter",dependencies:[od,nd,Vf],init(o,t,r){return o(t,r())}}),ni=un({name:"Typesetter",dependencies:[vd],init(o){return function(t){return new Promise(r=>{o.typeset(t,r)})}},getTransferables(o){const t=[];for(let r in o)o[r]&&o[r].buffer&&t.push(o[r].buffer);return t}});ni.onMainThread;const Za={};function yd(o){let t=Za[o];return t||(t=Za[o]=new mt(1,1,o,o).translate(.5,.5,0)),t}const wd="aTroikaGlyphBounds",Ja="aTroikaGlyphIndex",bd="aTroikaGlyphColor";class _d extends Pi{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Ei,this.boundingBox=new Bt}computeBoundingSphere(){}computeBoundingBox(){}set detail(t){if(t!==this._detail){this._detail=t,(typeof t!="number"||t<1)&&(t=1);let r=yd(t);["position","normal","uv"].forEach(l=>{this.attributes[l]=r.attributes[l].clone()}),this.setIndex(r.getIndex().clone())}}get detail(){return this._detail}set curveRadius(t){t!==this._curveRadius&&(this._curveRadius=t,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(t,r,l,n,e){this.updateAttributeData(wd,t,4),this.updateAttributeData(Ja,r,1),this.updateAttributeData(bd,e,3),this._blockBounds=l,this._chunkedBounds=n,this.instanceCount=r.length,this._updateBounds()}_updateBounds(){const t=this._blockBounds;if(t){const{curveRadius:r,boundingBox:l}=this;if(r){const{PI:n,floor:e,min:a,max:i,sin:s,cos:c}=Math,u=n/2,f=n*2,d=Math.abs(r),h=t[0]/d,g=t[2]/d,v=e((h+u)/f)!==e((g+u)/f)?-d:a(s(h)*d,s(g)*d),b=e((h-u)/f)!==e((g-u)/f)?d:i(s(h)*d,s(g)*d),m=e((h+n)/f)!==e((g+n)/f)?d*2:i(d-c(h)*d,d-c(g)*d);l.min.set(v,t[1],r<0?-m:0),l.max.set(b,t[3],r<0?0:m)}else l.min.set(t[0],t[1],0),l.max.set(t[2],t[3],0);l.getBoundingSphere(this.boundingSphere)}}applyClipRect(t){let r=this.getAttribute(Ja).count,l=this._chunkedBounds;if(l)for(let n=l.length;n--;){r=l[n].end;let e=l[n].rect;if(e[1]<t.w&&e[3]>t.y&&e[0]<t.z&&e[2]>t.x)break}this.instanceCount=r}updateAttributeData(t,r,l){const n=this.getAttribute(t);r?n&&n.array.length===r.length?(n.array.set(r),n.needsUpdate=!0):(this.setAttribute(t,new on(r,l)),delete this._maxInstanceCount,this.dispose()):n&&this.deleteAttribute(t)}}const xd=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,Sd=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,Md=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,Cd=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function Ad(o){const t=Tr(o,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new oe},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new sa(0,0,0,0)},uTroikaClipRect:{value:new sa(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new oe},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Je},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new vs},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:xd,vertexTransform:Sd,fragmentDefs:Md,fragmentColorTransform:Cd,customRewriter({vertexShader:r,fragmentShader:l}){let n=/\buniform\s+vec3\s+diffuse\b/;return n.test(l)&&(l=l.replace(n,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),n.test(r)||(r=r.replace(Js,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:r,fragmentShader:l}}});return t.transparent=!0,t.forceSinglePass=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),t}const zr=new ht({color:16777215,side:Rr,transparent:!0}),$a=8421504,es=new wt,$n=new A,er=new A,Mn=[],Td=new A,tr="+x+y";function ts(o){return Array.isArray(o)?o[0]:o}let oi=()=>{const o=new Ye(new mt(1,1),zr);return oi=()=>o,o},ri=()=>{const o=new Ye(new mt(1,1,32,1),zr);return ri=()=>o,o};const kd={type:"syncstart"},Fd={type:"synccomplete"},ai=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],Ud=ai.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class vo extends Ye{constructor(){const t=new _d;super(t,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=$a,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=tr,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(t){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(t):(this._isSyncing=!0,this.dispatchEvent(kd),hd({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},r=>{this._isSyncing=!1,this._textRenderInfo=r,this.geometry.updateGlyphs(r.glyphBounds,r.glyphAtlasIndices,r.blockBounds,r.chunkedBounds,r.glyphColors);const l=this._queuedSyncs;l&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{l.forEach(n=>n&&n())})),this.dispatchEvent(Fd),t&&t()})))}onBeforeRender(t,r,l,n,e,a){this.sync(),e.isTroikaTextMaterial&&this._prepareForRender(e)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(t){return Ad(t)}get material(){let t=this._derivedMaterial;const r=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=zr.clone());if((!t||!t.isDerivedFrom(r))&&(t=this._derivedMaterial=this.createDerivedMaterial(r),r.addEventListener("dispose",function l(){r.removeEventListener("dispose",l),t.dispose()})),this.hasOutline()){let l=t._outlineMtl;return l||(l=t._outlineMtl=Object.create(t,{id:{value:t.id+.1}}),l.isTextOutlineMaterial=!0,l.depthWrite=!1,l.map=null,t.addEventListener("dispose",function n(){t.removeEventListener("dispose",n),l.dispose()})),[l,t]}else return t}set material(t){t&&t.isTroikaTextMaterial?(this._derivedMaterial=t,this._baseMaterial=t.baseMaterial):this._baseMaterial=t}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(t){this.geometry.detail=t}get curveRadius(){return this.geometry.curveRadius}set curveRadius(t){this.geometry.curveRadius=t}get customDepthMaterial(){return ts(this.material).getDepthMaterial()}set customDepthMaterial(t){}get customDistanceMaterial(){return ts(this.material).getDistanceMaterial()}set customDistanceMaterial(t){}_prepareForRender(t){const r=t.isTextOutlineMaterial,l=t.uniforms,n=this.textRenderInfo;if(n){const{sdfTexture:i,blockBounds:s}=n;l.uTroikaSDFTexture.value=i,l.uTroikaSDFTextureSize.value.set(i.image.width,i.image.height),l.uTroikaSDFGlyphSize.value=n.sdfGlyphSize,l.uTroikaSDFExponent.value=n.sdfExponent,l.uTroikaTotalBounds.value.fromArray(s),l.uTroikaUseGlyphColors.value=!r&&!!n.glyphColors;let c=0,u=0,f=0,d,h,g,v=0,b=0;if(r){let{outlineWidth:p,outlineOffsetX:x,outlineOffsetY:y,outlineBlur:_,outlineOpacity:M}=this;c=this._parsePercent(p)||0,u=Math.max(0,this._parsePercent(_)||0),d=M,v=this._parsePercent(x)||0,b=this._parsePercent(y)||0}else f=Math.max(0,this._parsePercent(this.strokeWidth)||0),f&&(g=this.strokeColor,l.uTroikaStrokeColor.value.set(g??$a),h=this.strokeOpacity,h==null&&(h=1)),d=this.fillOpacity;l.uTroikaEdgeOffset.value=c,l.uTroikaPositionOffset.value.set(v,b),l.uTroikaBlurRadius.value=u,l.uTroikaStrokeWidth.value=f,l.uTroikaStrokeOpacity.value=h,l.uTroikaFillOpacity.value=d??1,l.uTroikaCurveRadius.value=this.curveRadius||0;let m=this.clipRect;if(m&&Array.isArray(m)&&m.length===4)l.uTroikaClipRect.value.fromArray(m);else{const p=(this.fontSize||.1)*100;l.uTroikaClipRect.value.set(s[0]-p,s[1]-p,s[2]+p,s[3]+p)}this.geometry.applyClipRect(l.uTroikaClipRect.value)}l.uTroikaSDFDebug.value=!!this.debugSDF,t.polygonOffset=!!this.depthOffset,t.polygonOffsetFactor=t.polygonOffsetUnits=this.depthOffset||0;const e=r?this.outlineColor||0:this.color;if(e==null)delete t.color;else{const i=t.hasOwnProperty("color")?t.color:t.color=new Je;(e!==i._input||typeof e=="object")&&i.set(i._input=e)}let a=this.orientation||tr;if(a!==t._orientation){let i=l.uTroikaOrient.value;a=a.replace(/[^-+xyz]/g,"");let s=a!==tr&&a.match(/^([-+])([xyz])([-+])([xyz])$/);if(s){let[,c,u,f,d]=s;$n.set(0,0,0)[u]=c==="-"?1:-1,er.set(0,0,0)[d]=f==="-"?-1:1,es.lookAt(Td,$n.cross(er),er),i.setFromMatrix4(es)}else i.identity();t._orientation=a}}_parsePercent(t){if(typeof t=="string"){let r=t.match(/^(-?[\d.]+)%$/),l=r?parseFloat(r[1]):NaN;t=(isNaN(l)?0:l/100)*this.fontSize}return t}localPositionToTextCoords(t,r=new oe){r.copy(t);const l=this.curveRadius;return l&&(r.x=Math.atan2(t.x,Math.abs(l)-Math.abs(t.z))*Math.abs(l)),r}worldPositionToTextCoords(t,r=new oe){return $n.copy(t),this.localPositionToTextCoords(this.worldToLocal($n),r)}raycast(t,r){const{textRenderInfo:l,curveRadius:n}=this;if(l){const e=l.blockBounds,a=n?ri():oi(),i=a.geometry,{position:s,uv:c}=i.attributes;for(let u=0;u<c.count;u++){let f=e[0]+c.getX(u)*(e[2]-e[0]);const d=e[1]+c.getY(u)*(e[3]-e[1]);let h=0;n&&(h=n-Math.cos(f/n)*n,f=Math.sin(f/n)*n),s.setXYZ(u,f,d,h)}i.boundingSphere=this.geometry.boundingSphere,i.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,Mn.length=0,a.raycast(t,Mn);for(let u=0;u<Mn.length;u++)Mn[u].object=this,r.push(Mn[u])}}copy(t){const r=this.geometry;return super.copy(t),this.geometry=r,Ud.forEach(l=>{this[l]=t[l]}),this}clone(){return new this.constructor().copy(this)}}ai.forEach(o=>{const t="_private_"+o;Object.defineProperty(vo.prototype,o,{get(){return this[t]},set(r){r!==this[t]&&(this[t]=r,this._needsSync=!0)}})});new Bt;new Je;function ns(o,t,r){const l=t.geometry;l.computeBoundingBox();const n=l.getAttribute("position");if(!n)throw new Error("Pane mesh has no position attribute");const e=[],a=new A,i=H=>`${H.x.toFixed(6)},${H.y.toFixed(6)},${H.z.toFixed(6)}`,s=new Set;for(let H=0;H<n.count;H++){a.set(n.getX(H),n.getY(H),n.getZ(H));const ae=i(a);s.has(ae)||(e.push(a.clone()),s.add(ae))}e.length!==4&&console.warn(`[GLBInfoPaneSplit] Expected 4 unique verts, got ${e.length}. Proceeding anyway.`);const c=e.reduce((H,ae)=>H.add(ae),new A).multiplyScalar(1/e.length),u=H=>Math.atan2(H.y-c.y,H.x-c.x);e.sort((H,ae)=>u(H)-u(ae));const f=new A().subVectors(e[1],e[0]),d=new A().subVectors(e[2],e[1]),h=new A().subVectors(e[3],e[2]),g=new A().subVectors(e[0],e[3]);f.lengthSq(),d.lengthSq();function v(H,ae){const ve=H.clone().normalize().add(ae.clone().normalize());return ve.lengthSq()<1e-10?H.clone().normalize():ve.normalize()}const b=v(f,h),m=v(d,g),p=new A(0,1,0),x=new vs().getNormalMatrix(t.matrixWorld),y=b.clone().applyMatrix3(x).normalize(),_=m.clone().applyMatrix3(x).normalize(),M=Math.abs(y.dot(p)),w=Math.abs(_.dot(p));let C=(M<=w?b:m).clone(),F=new A().crossVectors(f,d);F.lengthSq()<1e-10&&F.set(0,0,1),F.normalize();let k=new A().crossVectors(F,C);k.lengthSq()<1e-10?(C.set(1,0,0),k.set(0,1,0),F.set(0,0,1)):k.normalize();let D=-1/0;for(const H of e){const ae=new A().subVectors(H,c);D=Math.max(D,ae.dot(k))}let T=C.clone(),R=k.clone(),U=F.clone();D<0&&(T.multiplyScalar(-1),R.multiplyScalar(-1));const j=new wt().makeBasis(T,R,U),z=new Ne().setFromRotationMatrix(j),X=new dt;X.name="ContentRoot"+r,t.add(X),X.position.copy(c).add(U.clone().multiplyScalar(.0015)),X.quaternion.copy(z),X.renderOrder=10;const V=new dt;V.name="ContentGroup"+r,X.add(V);let P=1/0,O=-1/0,S=1/0,L=-1/0;for(const H of e){const ae=new A().subVectors(H,c),ve=ae.dot(T),ye=ae.dot(R);ve<P&&(P=ve),ve>O&&(O=ve),ye<S&&(S=ye),ye>L&&(L=ye)}const E=O-P,I=L-S,B=.02,Q=L-B,G=S+B,q=Q-G,le=(Q+G)*.5,re=new vo;re.anchorX="center",re.anchorY="top",re.color=0,re.maxWidth=E*.84,re.overflowWrap="break-word",re.depthOffset=-1,re.font="/fonts/MS-Gothic.woff",V.add(re);const Z=new vo;Z.anchorX="center",Z.anchorY="top",Z.color=0,Z.maxWidth=E*.84,Z.overflowWrap="break-word",Z.depthOffset=-1,Z.textAlign="center",Z.font="/fonts/MS-Gothic.woff",V.add(Z);const ee=()=>{const H=ae=>{const ve=ae.material;ve&&(ve.depthWrite=!1,ve.depthTest=!0,ve.transparent=!0,ve.toneMapped=!1,ve.needsUpdate=!0)};H(re),H(Z)},Me=new dt;Me.name=`Scrollbar${r}`,X.add(Me);const Se=new mt(.01,q),de=new ht({color:9349805,transparent:!0,opacity:.2,depthTest:!0,depthWrite:!1}),ce=new Ye(Se,de);ce.name=`ScrollRail${r}`;const fe=.5*Math.min(.02,E*.06);ce.position.set(O-fe,le,.001),Me.add(ce);const te=new mt(.038,.2),se=new ht({color:0,transparent:!0,opacity:.55,depthTest:!0,depthWrite:!1}),W=new Ye(te,se);W.name=`ScrollThumb${r}`,W.position.set(ce.position.x,ce.position.y,.0011),Me.add(W);const Y=new dt;Y.name=`ScrollbarLeft${r}`,X.add(Y);const N=new Ye(Se.clone(),de.clone());N.name=`ScrollRailLeft${r}`,N.position.set(P+fe,le,.001),Y.add(N);const ne=new Ye(te.clone(),se.clone());ne.name=`ScrollThumbLeft${r}`,ne.position.set(N.position.x,N.position.y,.0011),Y.add(ne);function J(H){return new Pr({uniforms:{map:{value:H},uClipTop:{value:1e6},uClipBottom:{value:-1e6},uUseClip:{value:1}},vertexShader:`
        varying vec2 vUv; varying float vY;
        void main(){ vUv=uv; vY=position.y; gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0); }`,fragmentShader:`
        uniform sampler2D map; uniform float uClipTop; uniform float uClipBottom; uniform float uUseClip;
        varying vec2 vUv; varying float vY;
        void main(){ vec4 c=texture2D(map,vUv); if(c.a<0.01) discard; if(uUseClip>0.5&&(vY>uClipTop||vY<uClipBottom)) discard; gl_FragColor=c; }`,transparent:!0,depthTest:!0,depthWrite:!1,toneMapped:!1})}const K=[];let we=0,me=1,ge=!1;function he(){const H=Math.min(1,q/Math.max(q,me)),ae=Math.max(q*H,q*.08);return(q-ae)*.5}function pe(H,ae){const ve=Q-(ae+H.position.y),ye=G-(ae+H.position.y),xe=Math.min(ye,ve),Fe=Math.max(ye,ve);H.clipRect=[-1e6,xe,1e6,Fe]}function Ie(H,ae){const ve=Q-(ae+H.position.y),ye=G-(ae+H.position.y);H.material.uniforms.uClipTop.value=Math.max(ve,ye),H.material.uniforms.uClipBottom.value=Math.min(ve,ye),H.material.needsUpdate=!0}function Oe(){const H=V.position.y;pe(re,H),pe(Z,H);for(const ae of K)Ie(ae.mesh,H);re.sync(),Z.sync()}function $(H){we=De.clamp(H,0,1);const ae=Math.max(0,me-q),ye=(ge?1:-1)*we*ae;V.position.set(0,ye,0),Oe();const xe=he(),Fe=q-2*xe,Ve=De.lerp(+xe,-xe,we);W.scale.set(1,Math.max(1e-4,Fe/.2),1),W.position.y=ce.position.y+Ve,ne.scale.set(1,Math.max(1e-4,Fe/.2),1),ne.position.y=N.position.y+Ve}function ue(H){$(we+H)}function ie(){return we}function _e(H){ge=!!H,$(we)}function ke(H,ae){const ve=he(),ye=H.position.y,Fe=(De.clamp(ae-ye,-ve,+ve)-+ve)/(-ve-+ve);$(Fe)}function ze(H){ke(ce,H)}async function be(H,ae,ve){const ye=await new io().loadAsync(H);ye.colorSpace=ot,ye.wrapS=ye.wrapT=sn,ye.minFilter=ia,ye.magFilter=co,ye.generateMipmaps=!0;const xe=ye.image,Fe=Math.max(1,xe.width??xe.bitmap?.width??1),Ve=Math.max(1,xe.height??xe.bitmap?.height??1),We=Fe/Ve,Be=E*.84,je=I*.18;let Le=ae==="single"?Be:Be*.5,Re=Le/We;Re>je&&(Re=je,Le=Re*We);const Pe=new mt(Le,Re),He=J(ye),Ge=new Ye(Pe,He);return Ge.name=(ae==="single"?"LogoPlaneSingle":ae==="left"?"LogoPlaneLeft":"LogoPlaneRight")+r,ve&&(Ge.userData.href=ve),Ge.position.set(0,0,0),V.add(Ge),{mesh:Ge,drawW:Le,drawH:Re}}async function Ce(H){we=0,V.position.set(0,0,0),me=1;for(const Le of K)Le.mesh.parent&&Le.mesh.parent.remove(Le.mesh),Le.mesh.material.dispose(),Le.mesh.geometry.dispose();K.length=0;let ae=0;if(H.logoUrlLeft&&H.logoUrlRight){const Le=await be(H.logoUrlLeft,"left",H.logoHrefLeft),Re=await be(H.logoUrlRight,"right",H.logoHrefRight),Pe=E*.84*.5,He=Math.min(Le.mesh.geometry.parameters.width,Re.mesh.geometry.parameters.width,Pe),Ge=Math.min(Le.mesh.geometry.parameters.height,Re.mesh.geometry.parameters.height);Le.mesh.geometry.dispose(),Re.mesh.geometry.dispose(),Le.mesh.geometry=new mt(He,Ge),Re.mesh.geometry=new mt(He,Ge),Le.mesh.position.x=-He*.5,Re.mesh.position.x=+He*.5,K.push({mesh:Le.mesh,id:"left",href:H.logoHrefLeft}),K.push({mesh:Re.mesh,id:"right",href:H.logoHrefRight}),ae=Ge}else if(H.logoUrl){const Le=await be(H.logoUrl,"single");K.push({mesh:Le.mesh,id:"single"}),ae=Le.drawH}const ve=I*.08,ye=I*.04;H.title&&(re.text=(H.title??"Info").trim(),re.fontSize=ve,re.lineHeight=1.05,re.maxWidth=E*.84,await new Promise(Le=>re.sync(()=>{ee(),Le()}))),Z.text=H.body??"",Z.fontSize=ye,Z.lineHeight=1.25,Z.maxWidth=E*.84,await new Promise(Le=>Z.sync(()=>{ee(),Le()}));const xe=re.textRenderInfo,Fe=Z.textRenderInfo,Ve=xe.blockBounds[3]-xe.blockBounds[1],We=Fe.blockBounds[3]-Fe.blockBounds[1],Be=ve*.35,je=I*.02;let Ae=Q;if(re.position.set(0,Ae,0),Ae-=Ve+Be,K.length>0){for(const Le of K){Le.mesh.geometry.computeBoundingBox();const Re=Le.mesh.geometry.boundingBox,Pe=Math.max(0,Re.max.y-Re.min.y);Le.mesh.position.y=Ae-Pe*.5}Ae-=ae+je}Z.position.set(0,Ae,0),Ae-=We,console.log("innerW, innerH",E,I),console.log("xAxisLocal",T.toArray(),"yAxisLocal",R.toArray()),await Promise.all([Te(W,H.thumbImageUrl),Te(ne,H.thumbImageUrl)]),me=Q-Ae,$(0)}async function Te(H,ae){if(!ae)return;const ve=await new io().loadAsync(ae);ve.colorSpace=ot,ve.wrapS=ve.wrapT=sn,ve.minFilter=ia,ve.magFilter=co,ve.generateMipmaps=!0;const ye=H.material;ye.map=ve,ye.color.set(16777215),ye.opacity=1,ye.transparent=!0,ye.alphaTest=.1,ye.depthWrite=!1,ye.depthTest=!0,ye.toneMapped=!1,ye.needsUpdate=!0,ve.needsUpdate=!0}function Ee(){re.dispose(),Z.dispose();for(const H of K)H.mesh.material.dispose(),H.mesh.geometry.dispose();ce.material.dispose(),W.material.dispose(),N.material.dispose(),ne.material.dispose(),ce.geometry.dispose(),W.geometry.dispose(),N.geometry.dispose(),ne.geometry.dispose()}return{viewportH:q,open:Ce,setScroll01:$,scrollBy:ue,getScroll01:ie,setInvertScroll:_e,setScrollFromThumbLocalY:ze,setScrollFromThumbLocalYFor:ke,getViewportHeight:()=>q,getScrollbarMeshesBoth:()=>({right:{rail:ce,thumb:W},left:{rail:N,thumb:ne}}),getLogoTargets:()=>K.map(H=>({mesh:H.mesh,id:H.id,href:H.href})),dispose:Ee}}async function Ld(o){o.localClippingEnabled=!1;const t=await Pn(Qs);yr(t);const{pivot:r}=wr(t),l=r.getObjectByName("Pane_TextSurface_L"),n=r.getObjectByName("Pane_TextSurface_R");r.getObjectByName("frame_L"),r.getObjectByName("frame_R"),(!l||!n)&&console.warn("[GLBInfoPaneSplit] Pane_TextSurface_L/R not found in GLB.");const e=ns(o,l,"_L"),a=ns(o,n,"_R"),i=new dt;i.name="GLBInfoPane3D_Split",i.add(r);async function s(d){await Promise.all([e.open(d.left),a.open(d.right)])}function c(d){e.setInvertScroll(d),a.setInvertScroll(d)}function u(){e.dispose(),a.dispose()}const f=d=>({setScroll01:d.setScroll01,scrollBy:d.scrollBy,getScroll01:d.getScroll01,setInvertScroll:d.setInvertScroll,getViewportHeight:d.getViewportHeight,getLogoTargets:d.getLogoTargets});return{group:i,left:f(e),right:f(a),open:s,setInvertScroll:c,dispose:u,getScrollbarMeshesBoth:()=>{const d=e.getScrollbarMeshesBoth?.(),h=a.getScrollbarMeshesBoth?.();return{left:d?.left??e.getScrollbarMeshes?.(),right:h?.right??a.getScrollbarMeshes?.()}},setScrollFromThumbLocalYFor:(d,h)=>{(d?.name??"").endsWith("_L")?e.setScrollFromThumbLocalYFor?.(d,h)??e.setScrollFromThumbLocalY?.(h):a.setScrollFromThumbLocalYFor?.(d,h)??a.setScrollFromThumbLocalY?.(h)}}}let At=null,Dt=null,jt=null;function si(){Dt!=null&&(cancelAnimationFrame(Dt),Dt=null),jt=null}const Dd=o=>o*o*o;let rn=null;const Fr=.8;function ii(o,t){const l=o.material;l&&(Array.isArray(l)?l.forEach(t):t(l))}function ao(o,t,r=!0){o.traverse(l=>{if(!l.isMesh)return;let n=l.parent;for(;n;){if(typeof n.name=="string"&&n.name.startsWith("ContentRoot"))return;n=n.parent}ii(l,e=>{typeof e.opacity=="number"&&(e.opacity=De.clamp(t,0,1),e.transparent=!0,e.depthWrite=t>=.999),e.depthTest=!r,e.toneMapped=!1,e.premultipliedAlpha=!1,e.needsUpdate=!0})})}function ci(o){const t=[];return o.traverse(r=>{typeof r.name=="string"&&r.name.startsWith("ContentRoot")&&t.push(r)}),t}function so(o,t,r=!0){o.traverse(l=>{const n=l.isMesh&&l.material&&l.geometry&&l.isTextMesh||l instanceof vo;if(l.isMesh&&(ii(l,e=>{typeof e.opacity=="number"&&(e.opacity=De.clamp(t,0,1),e.transparent=!0,e.depthWrite=!1),e.depthTest=!r,e.toneMapped=!1,e.premultipliedAlpha=!1,e.needsUpdate=!0}),l.renderOrder=r?100:10),n){const a=l.material;a&&typeof a.opacity=="number"&&(a.opacity=De.clamp(t,0,1),a.transparent=!0,a.depthWrite=!1,a.depthTest=!r,a.needsUpdate=!0)}})}function Rd(o,t,r,l,n,e=.04){const{viewW:a,viewH:i}=Or(t,r),s=a*e,c=i*e,u=Math.max(0,(a-l)*.5-s),f=Math.max(0,(i-n)*.5-c);o.position.x=De.clamp(o.position.x,-u,+u),o.position.y=De.clamp(o.position.y,-f,+f)}function Pd(o){const t=new Bt().setFromObject(o),r=new A;return t.getSize(r),{w:r.x,h:r.y}}function Ed(o,t,r,l){si(),jt="in";const n=1200,e=.86*t,a=1.5*t;ao(o.group,0,!0);const i=ci(o.group);i.forEach(m=>so(m,0,!0));const s=new A().setFromMatrixPosition(o.group.matrixWorld),c=new Ne().setFromRotationMatrix(o.group.matrixWorld),u=new A,f=new Ne;rn.updateMatrixWorld(!0),rn.getWorldPosition(u),rn.getWorldQuaternion(f);const d=mr(s,u),h={t:0,dur:n/1e3,curve:d,fromQuat:c.clone(),toQuat:f.clone(),fromScale:e,toScale:a},g=o.group;let v=performance.now();const b=m=>{if(jt!=="in")return;const p=(m-v)/1e3;v=m;const x=Gs(g,h,p),y=Math.min(1,h.t/h.dur),_=zs(y);if(ao(g,_,!x),i.forEach(M=>so(M,_,!x)),!x)Dt=requestAnimationFrame(b);else{g.position.copy(u),g.quaternion.copy(f),g.scale.setScalar(a),ao(g,1,!1),i.forEach(k=>so(k,1,!1)),Os(rn,g);const M=1.408,w=1.008/1.408,C=M*a,F=M*w*a;Rd(g,r,Fr,F,C),Dt=null,jt=null,l()}};Dt=requestAnimationFrame(b)}function os(o,t){si(),jt="out";const r=o.group.scale.x||1,l=Math.max(1e-4,r*.1),n=1200,e=performance.now(),a=ci(o.group),i=s=>{if(jt!=="out")return;const c=Math.min(1,(s-e)/n),u=Dd(c);o.group.scale.setScalar(r+(l-r)*u);const f=1-u;if(ao(o.group,f,c<1),a.forEach(d=>so(d,f,c<1)),c<1)Dt=requestAnimationFrame(i);else{Dt=null,jt=null;const d=o.group.parent;d&&d.remove(o.group),o.dispose(),t()}};Dt=requestAnimationFrame(i)}let Wt=null;function eo(o){return o.left!==void 0&&o.right!==void 0}function Bd(o,t,r){const l=new fs,n=new oe,e={dragging:!1,dragMode:null,railMesh:null,lastHitYLocal:0,paneMeshForContent:null,pointerId:-1},a=r.style.touchAction;r.style.touchAction="none";const i=6e-4,s=1,c=0;function u(m){const p=r.getBoundingClientRect(),x="clientX"in m?m.clientX:p.left+p.width/2,y="clientY"in m?m.clientY:p.top+p.height/2;n.x=(x-p.left)/p.width*2-1,n.y=-((y-p.top)/p.height*2-1)}function f(m){return u(m),l.setFromCamera(n,t),l.intersectObject(o.group,!0)}function d(){if(o.pane.getScrollbarMeshesBoth)return o.pane.getScrollbarMeshesBoth();const m=o.pane.getScrollbarMeshes?.();return m?{right:m,left:null}:{right:null,left:null}}function h(m){const p=f(m);let x=!1;if(!eo(o.pane))p.some(_=>_.object.name==="Pane_TextSurface"||_.object.parent?.name==="Scrollbar"||_.object.name==="LogoPlaneLeft"||_.object.name==="LogoPlaneRight"||_.object.name==="LogoPlaneSingle")&&(m.preventDefault(),o.pane.scrollBy(m.deltaY*i),x=!0);else{const y=p.some(M=>M.object.name==="Pane_TextSurface_L"||M.object.parent?.name==="Scrollbar_L"||typeof M.object.name=="string"&&M.object.name.endsWith("_L")),_=p.some(M=>M.object.name==="Pane_TextSurface_R"||M.object.parent?.name==="Scrollbar_R"||typeof M.object.name=="string"&&M.object.name.endsWith("_R"));y?(m.preventDefault(),o.pane.left.scrollBy(m.deltaY*i),x=!0):_&&(m.preventDefault(),o.pane.right.scrollBy(m.deltaY*i),x=!0)}}function g(m){const p=f(m);if(p.length===0)return;const x=d(),y=x.right?.rail??null,_=x.left?.rail??null,M=p.find(D=>D.object===y||D.object===_),w=p.find(D=>{const T=D.object;return T===(x.right?.thumb??null)||T===(x.left?.thumb??null)});if(M||w){if(e.dragging=!0,e.dragMode="rail",e.railMesh=M?.object??(w?.object===(x.right?.thumb??null)?y:w?.object===(x.left?.thumb??null)?_:null),e.railMesh){r.setPointerCapture(m.pointerId),e.pointerId=m.pointerId,m.preventDefault();const D=M?.point??w?.point;if(D){const T=e.railMesh.worldToLocal(D.clone());o.pane.setScrollFromThumbLocalYFor?o.pane.setScrollFromThumbLocalYFor(e.railMesh,T.y):o.pane.setScrollFromThumbLocalY?.(T.y)}}return}const C=p.find(D=>typeof D.object.name=="string"&&(D.object.name==="Pane_TextSurface"||D.object.name==="Pane_TextSurface_L"||D.object.name==="Pane_TextSurface_R")),F=p.find(D=>D.object.isTextMesh||typeof D.object.name=="string"&&D.object.name.startsWith("LogoPlane")),k=C??F;if(k){e.dragging=!0,e.dragMode="content",e.paneMeshForContent=k.object,e.pointerId=m.pointerId,r.setPointerCapture(m.pointerId),m.preventDefault();const D=e.paneMeshForContent.worldToLocal(k.point.clone());e.lastHitYLocal=D.y}}function v(m){if(!(!e.dragging||m.pointerId!==e.pointerId)&&!(Math.abs(m.movementY)<c&&Math.abs(m.movementX)<c)){if(e.dragMode==="rail"&&e.railMesh){u(m),l.setFromCamera(n,t);const p=l.intersectObject(e.railMesh,!0);if(p.length){m.preventDefault();const x=e.railMesh.worldToLocal(p[0].point.clone()).y;o.pane.setScrollFromThumbLocalYFor?o.pane.setScrollFromThumbLocalYFor(e.railMesh,x):o.pane.setScrollFromThumbLocalY?.(x)}return}if(e.dragMode==="content"&&e.paneMeshForContent){u(m),l.setFromCamera(n,t);const p=l.intersectObject(e.paneMeshForContent,!0);if(p.length){m.preventDefault();const x=e.paneMeshForContent.worldToLocal(p[0].point.clone()).y,y=x-e.lastHitYLocal;e.lastHitYLocal=x;const _=eo(o.pane)?e.paneMeshForContent.name.endsWith("_L")?o.pane.left.getViewportHeight():o.pane.right.getViewportHeight():o.pane.getViewportHeight?.()??1,M=-(y/Math.max(1e-6,_))*s;eo(o.pane)?e.paneMeshForContent.name.endsWith("_L")?o.pane.left.scrollBy(M):o.pane.right.scrollBy(M):o.pane.scrollBy(M)}}}}function b(m){if(e.dragging&&m.pointerId===e.pointerId){try{r.releasePointerCapture(m.pointerId)}catch{}e.dragging=!1,e.dragMode=null,e.railMesh=null,e.paneMeshForContent=null,e.pointerId=-1}const p=f(m);if(!eo(o.pane)){const y=p.find(_=>_.object.name==="LogoPlaneLeft"||_.object.name==="LogoPlaneRight"||_.object.name==="LogoPlaneSingle");if(y){const _=y.object.userData?.href;_&&window.open(_,"_blank","noopener")}return}const x=p.find(y=>typeof y.object.name=="string"&&y.object.name.startsWith("LogoPlane")&&(y.object.name.endsWith("_L")||y.object.name.endsWith("_R")));if(x){const y=x.object.userData?.href;y&&window.open(y,"_blank","noopener")}}return r.addEventListener("wheel",h,{passive:!1}),r.addEventListener("pointerdown",g,{passive:!1}),r.addEventListener("pointermove",v,{passive:!1}),r.addEventListener("pointerup",b,{passive:!0}),r.addEventListener("pointercancel",b,{passive:!0}),r.addEventListener("lostpointercapture",b,{passive:!0}),()=>{r.removeEventListener("wheel",h),r.removeEventListener("pointerdown",g),r.removeEventListener("pointermove",v),r.removeEventListener("pointerup",b),r.removeEventListener("pointercancel",b),r.removeEventListener("lostpointercapture",b),r.style.touchAction=a??""}}async function Id(o,t,r,l){const n=new dt;n.name="InfoOverlay3D";let e;const a=await Ld(o);a.setInvertScroll(!0);const{left:i,right:s}=l;return await a.open({left:i,right:s}),e=a,n.add(a.group),Wt&&(Wt(),Wt=null),Wt=Bd({group:n,pane:e},t,r),{group:n,pane:e,dispose(){Wt&&(Wt(),Wt=null),e.dispose()}}}async function Od(o,t){const{scene:r,camera:l,renderer:n,dom:e,interactions:a}=o;if(At){const b=At;return new Promise(m=>{os(b,()=>{a.endModal(b.group),At===b&&(At=null),m()})})}const i=await Id(n,l,e,t);rn||(rn=Is(l,Fr)),r.add(i.group),At=i;const s=a.registerObject(i.group,()=>{},100);a.startModal(i.group,()=>{if(!At)return;const b=At;os(b,()=>{s?.(),a.endModal(b.group),At===b&&(At=null)})});const c=Pd(i.group),u=.04,{viewW:f,viewH:d}=Or(l,Fr),h=f*u,g=d*u;let v=1;if(c.w>0&&c.h>0){const b=(f-2*h)/c.w,m=(d-2*g)/c.h;v=Math.max(1e-6,Math.min(b,m))}else v=ft();return new Promise(b=>{Ed(i,v,l,()=>b())})}function zd(o,t=815){let r=!1,l=null;function n(i,s,c){s&&s.traverse(u=>{u.isMesh&&i.registerObject(u,c)})}function e(i){const s=i?.material,c=u=>{u.depthWrite=!0,u.depthTest=!0,u.transparent=!0,u.needsUpdate=!0};Array.isArray(s)?s.forEach(u=>c(u)):s&&c(s)}function a(i){const s=go(i);for(const c of s)c.layers.enable(1)}return{id:"ui.infoButton",priority:t,async init(i){if(r)return;const s=o.getOverlayTB(),c=o.getInteractions();if(!s?.group||!c)return;const u=s.group.getObjectByName("info_btn");if(!u||u.__wired)return;const f=u.getObjectByName("mech");e(f),l=new Xs(go(f)),a(f),n(c,u,async()=>{try{l?.pulseRed(),l?.setActive(!0),await Od({scene:i.scene,camera:i.camera,renderer:i.renderer,dom:i.renderer.domElement,interactions:c},{left:{body:`   
 has unstable locations between port cities in extreme opposites. they are global places of connection where angel is just a vessel, a generic soul that seeks to bridge incompatible realms.

 _ 
 is a California - based artist and curator searching for ecstasy in the chance encounter with opaque and unnamed forms.

   
 is an underground producer from Latvia who primarily makes trap and electronic pop music. They prioritize ethereal / atmospheric soundscapes with dreamy vocals. Their online presence has a deep-internet vibeincorporating glowing, colorful visuals that reflect their musical sensibilities and a custom brand of meta-ironic meme videos.

  
 is an artist from Internet, Romania, currently working in Timioara. Working across software, CGI, drawing, painting, sculpture, and film, he transforms video games and fragments of online spaces into new forms.

  
 is a level 15 hikki doll (haunted) currently praying for the solar storm in Belgrade.

   (they/them) 
 is a multidisciplinary artist with an applied research of digital spaces and memory, and of one's ostracization through textile, mediatic, and illustrative methods. Ambu reflects on the shut-in culture of mental isolation that melds into the physical, secluding oneself from society, and feelings of self-inflicted hurt and alienation. Motka Ambu is currently existing and pursuing a bachelor's degree in Visual Communications in Berlin, Germany.

  
 is a 24-year-old Romanian digital artist whose work diverses between nostalgia and futurism. Specializing in digital collages, 3D art, and immersive visuals created with paint or even plasticine, they weave dreamy textures with a bold, playful edge of a Y2K retro style. She loves the color pink and is enamored by early 2000s transparent tech and trinkets to where she became a collector, or rather, a hoarder. sixtoesss turns personal passions into an eclectic, candy-colored universe for those who resonate and want to feel seen for representing something so awesome.`,thumbImageUrl:"/images/scroll.png"},right:{title:" ",body:"Where each image ends a new one begins. Intelligence relapses on itself while trying to grow an image that holds faeries. Each image is already a playing card when generated through language with a character in mind. Yet the presence of the character can be reshaped by a new descriptor similarly to the transformation of oneself in reality. Transmutation of energy. The oracle is empty precisely because the emptiness of randomness made it, yet nothing is ever really random. The process was organic with a goal that was unclear, which is where faith came in. Faeries exist, elves exist and other beings exist within the oracle. That is possible through our intrinsic knowledge of their absolute existence. Since the internet is writing its own mythology and we are part of its folklore, we can reach the absolute when we let faith guide us. Yet the oracle itself isnt a clear tool for magick. Or maybe it is not for us. Knowledge is held by language, language holds a structure. When you are guided by images instead of language, you will be entering the unconscious, a dream realm. Where pure clarity loses itself and purity enters. An aesthetic value is what guided our selection, that was an objective selection of beauty. What unites all of our different beings and characters is that they are beautiful, beautiful elementals. And beauty is empty in the oracle, but through its emptiness it guides angels.",logoUrlLeft:"/images/wrong_logo.png",logoUrlRight:"/images/arcana_logo.png",logoHrefLeft:"https://thewrong.org/",logoHrefRight:"https://a-r-c-a-n-a.moe/",thumbImageUrl:"/images/scroll.png"}})}catch(h){console.error("[info_btn] presentInfoOverlay error:",h)}finally{l?.setActive(!1)}}),u.__wired=!0,r=!0},update(i){l?.tick(i)},dispose(){}}}async function Gd(o,t){const{scene:r,renderer:l}=o,{hdrUrl:n,showBackground:e=!1,addLightRig:a=!0,exposure:i=1,rotation:s={},cubeSize:c=256}=t;l.toneMappingExposure=i;const u=await new Promise((y,_)=>{new Bi().load(n,M=>y(M),void 0,_)});u.mapping=Ii;const f=new Ur,d=new ca(1,64,32),h=new ht({map:u,side:Oi}),g=new Ye(d,h);f.add(g);const v=y=>(y??0)*Math.PI/180;g.rotation.set(v(s.pitch),v(s.yaw),v(s.roll),"YXZ");const b=new zi(c,{type:l.capabilities.isWebGL2?Gi:Wi,generateMipmaps:!0});new Vi(.01,10,b).update(l,f);const p=new Hi(l);p.compileCubemapShader();const x=p.fromCubemap(b.texture).texture;if(r.environment=x,e){const y=h.clone(),_=new Ye(new ca(50,64,32),y);_.name="HDRBackgroundSkysphere",_.frustumCulled=!1,_.onBeforeRender=(M,w,C)=>{_.position.copy(C.position)},_.rotation.copy(g.rotation),r.getObjectByName("HDRBackgroundSkysphere")?.removeFromParent(),r.add(_)}if(u.dispose(),p.dispose(),b.dispose(),a){const y=new us(16777215,2);y.position.set(3,4,2),y.name="KeyLight",r.getObjectByName("KeyLight")?.removeFromParent(),r.add(y);const _=new ls(16777215,2236979,.6);_.name="HemiFill",r.getObjectByName("HemiFill")?.removeFromParent(),r.add(_)}}function Wd(o,t=50){return{id:"scene.environment",priority:t,async init(r){await Gd(r,o)},update(){},dispose(){}}}function Vd(o,t=750){const r=De.degToRad(o.deadbandDeg??1.25),l={active:!1,qTo:new Ne},n={armReturnNow:()=>{l.active=!0},isReturningActive:()=>l.active},e={id:"camera.return",priority:t,init(){},update(i,s){const c=s.camera,u=o.getIsFocusing(),f=o.spinner.isActive();if(!u&&!f){const d=o.makeFrameQuatFacingCamera(c,!0),h=a(o.cardGroupFrame.quaternion,d);if(!l.active&&h>r&&(l.active=!0,l.qTo.copy(d)),l.active){const g=1-Math.exp(-8*i);o.cardGroupFrame.quaternion.slerp(l.qTo,g),a(o.cardGroupFrame.quaternion,l.qTo)<.001&&(l.active=!1)}}else l.active=!1},dispose(){}};function a(i,s){const c=Math.abs(De.clamp(i.dot(s),-1,1));return 2*Math.acos(c)}return{system:e,get:()=>n}}function Hd(o){const t=new Map;o.forEach(a=>t.set(a.id,a));const r=new Set,l=new Set,n=[],e=a=>{if(l.has(a))return;if(r.has(a))throw new Error(`Cyclic dependency detected involving ${a}`);r.add(a);const i=t.get(a);if(!i)throw new Error(`Unknown dependency id: ${a}`);const s=i.dependsOn||[];for(const c of s)e(c);r.delete(a),l.add(a),n.push(i)};for(const a of o)l.has(a.id)||e(a.id);return n}class Nd{systems=[];rafId=null;running=!1;app;clock=null;ro=null;vvHandler=null;register(t){if(this.running)throw new Error("Cannot register systems after start");if(this.systems.find(r=>r.id===t.id))throw new Error(`System id already registered: ${t.id}`);return this.systems.push(t),this}async start(t){if(this.running)return;this.running=!0,this.app=t,t.clock?this.clock||(this.clock=t.clock):(this.clock=new Ni,this.app.clock=this.clock);const r=Hd(this.systems);for(const n of r)await n.init(this.app);this.systems.sort((n,e)=>n.priority-e.priority);const l=()=>{if(!this.running)return;const n=Math.min(.033,this.clock?.getDelta?.()??1/60);for(const e of this.systems)e.update(n,this.app);this.rafId=requestAnimationFrame(l)};if(this.rafId=requestAnimationFrame(l),typeof window<"u"){window.addEventListener("resize",this.handleResize,{passive:!0});const n=window.visualViewport;n&&(this.vvHandler=()=>this.handleResize(),n.addEventListener("resize",this.vvHandler,{passive:!0}));const e=this.app.container??this.app.renderer.domElement.parentElement;if(typeof ResizeObserver<"u"&&e){this.ro=new ResizeObserver(()=>{queueMicrotask(()=>this.handleResize())});try{this.ro.observe(e)}catch{}}this.handleResize()}}stop(){if(this.running){if(this.running=!1,this.rafId!=null&&cancelAnimationFrame(this.rafId),typeof window<"u"){window.removeEventListener("resize",this.handleResize);const t=window.visualViewport;if(this.vvHandler&&t)try{t.removeEventListener("resize",this.vvHandler)}catch{}this.vvHandler=null}if(this.ro){try{this.ro.disconnect()}catch{}this.ro=null}}}dispose(){this.stop();for(const t of this.systems)try{t.dispose()}catch{}this.systems=[]}handleResize=()=>{const{renderer:t,camera:r}=this.app,l=typeof window<"u"?Math.max(1,window.innerWidth):1,n=typeof window<"u"?Math.max(1,window.innerHeight):1;typeof window<"u"&&typeof t.setPixelRatio=="function"&&t.setPixelRatio(window.devicePixelRatio||1),t.setSize(l,n,!0);const e=r;e&&typeof e.aspect=="number"&&(e.aspect=l/n,e.updateProjectionMatrix?.());for(const a of this.systems)a.onResize?.(l,n,this.app)}}function jd(){return new Nd}function qd(o,t=700){return{id:"cards.core",priority:t,init(){},update(r,l){o.director.update(r);const{layoutChanged:n}=uc(r);n&&!o.isLayoutLocked()&&o.system?.prepareHeartTargets?.(),o.system?.step?.(r,o.getUIValues(),l.camera,{billboard:o.getBillboardMode()})},dispose(){}}}function Yd(o,t=720){const r=Ys(),l=r.viewport.outerMarginX??.15,n=r.viewport.outerMarginY??.22,e=r.viewport.padFudge??.3,a=.02,i=.3,s=20;let c=!1;const u=new A,f=new A;function d(x){x.getWorldPosition(u),x.getWorldDirection(f).normalize();const y=new A().subVectors(o.cardGroupCenter,u);return{dist:Math.abs(f.dot(y))}}function h(x){const y=o.getOverlayBounds?.();if(!y)return null;const{dist:_}=d(x);if(_<1e-6)return null;const M=De.degToRad(x.fov),w=2*Math.tan(M/2)*_,F=w*x.aspect*(1-2*l),k=w*(1-2*n),D=e*.38,T=y.w+2*D,R=y.h+2*D;if(T<=0||R<=0)return null;const U=Math.min(F/T,k/R);return!isFinite(U)||U<=0?null:U}function g(x){if(c)return;const y=h(x);if(y==null)return;const _=o.getCardScale(),M=De.clamp(_*y*.98,i,s);o.snapScales(M,M),c=!0}function v(x){const y=h(x);if(y==null)return;const _=o.getCardScale();if(_*y*.98>=i)return;const w=i/Math.max(1e-6,_*.98);if(w<=y)return;const{dist:C}=d(x),F=C*(w/Math.max(1e-6,y))*1.02;o.controls.minDistance=Math.max(o.controls.minDistance??0,F);const k=new A().subVectors(x.position,o.controls.target);if(k.length()<F){const T=k.normalize();x.position.copy(o.controls.target).addScaledVector(T,F),x.updateProjectionMatrix()}}function b(x){const y=h(x);if(y==null||Math.abs(y-1)<a)return;const _=o.getCardScale(),M=De.clamp(_*y*.98,i,s);o.setLayoutScale(M),o.setCardScale(M)}function m(x){!o.isFlying()&&!o.isFocusing()&&!o.isSpinning()&&!o.isScaleHeld()&&(g(x),v(x),b(x))}return{id:"camera.viewport",priority:t,init(){},onResize(x,y,_){const M=_.camera;M.aspect=x/Math.max(1,y),M.updateProjectionMatrix(),o.overlayCanvas&&(o.overlayCanvas.width=x,o.overlayCanvas.height=y)},update(x,y){const _=y.camera;m(_)},dispose(){}}}function Xd(o){const{renderer:t,camera:r,damp:l=6,radius:n=4.5,maxVel:e=400}=o;let a=!1,i=new A,s=0;const c=new A(0,0,0),u=new Ne;let f=!1;const d=new Ne,h=new Ne,g=new A,v=new A;function b(F,k){const D=t.domElement.getBoundingClientRect(),T=(F-D.left)/D.width*2-1,R=-((k-D.top)/D.height)*2+1;return new oe(T,R)}function m(F){const k=new oe(F.x,F.y),D=k.length(),T=Math.max(1e-6,n);D>T&&k.multiplyScalar(T/D);const R=Math.sqrt(Math.max(0,T*T-k.x*k.x-k.y*k.y));return new A(k.x,k.y,R)}function p(){a=!1,f=!1,c.set(0,0,0)}function x(F){yt.isModalActive()||F.button===0&&(a=!0,s=performance.now(),i.copy(m(b(F.clientX,F.clientY))),f=!1,c.set(0,0,0),F.target.setPointerCapture?.(F.pointerId))}function y(F){if(!a)return;if(yt.isModalActive()){p();return}const k=performance.now(),D=Math.max(.001,(k-s)/1e3),T=m(b(F.clientX,F.clientY));g.copy(i).cross(T);const R=De.clamp(i.dot(T)/(n*n),-1,1);let U=Math.atan2(g.length(),R);if(isFinite(U)&&U>1e-6){g.normalize(),r.matrixWorld.decompose(new A,d,new A),v.copy(g).applyQuaternion(d).normalize(),u.setFromAxisAngle(v,U),f=!0;const j=Math.min(e,U/D),z=v.clone().multiplyScalar(j);c.lerp(z,.8)}i.copy(T),s=k}function _(F){a&&(a=!1,F.target.releasePointerCapture?.(F.pointerId))}t.domElement.addEventListener("pointerdown",x),window.addEventListener("pointermove",y),window.addEventListener("pointerup",_),window.addEventListener("pointercancel",_);function M(F,k){if(yt.isModalActive()){const T=Math.exp(-Math.max(l,12)*k);c.multiplyScalar(T),a&&(a=!1),f=!1;return}if(f&&(F.quaternion.premultiply(u),F.updateMatrixWorld(),f=!1),!a){const T=Math.exp(-l*k);c.multiplyScalar(T),c.lengthSq()<1e-8&&c.set(0,0,0)}const D=a?0:c.length();D>0&&(h.setFromAxisAngle(c.clone().multiplyScalar(1/D),D*k),F.quaternion.premultiply(h),F.updateMatrixWorld())}function w(){return(a||c.lengthSq()>1e-6||f)&&!yt.isModalActive()}function C(){t.domElement.removeEventListener("pointerdown",x),window.removeEventListener("pointermove",y),window.removeEventListener("pointerup",_),window.removeEventListener("pointercancel",_)}return{update:M,dispose:C,isActive:w}}function Qd(o=300){let t=null;const r={isActive:()=>!!t?.isActive()};return{system:{id:"io.spinner",priority:o,init(n){t=Xd({renderer:n.renderer,camera:n.camera})},update(n){t?.update(vt,n)},dispose(){t=null}},get:()=>r}}const Kd="/assets/AccessPoint-Baboe_5R.wav",Zd="/assets/Select-CGDdYP4o.wav";function Jd(o=50){let t=null,r=null;return{id:"app.audio",priority:o,init(l){t=new Audio(Kd),t.preload="auto",t.volume=.7,Ir(()=>{try{t&&(t.currentTime=0,t.play())}catch(n){console.warn("[audio] failed to play AccessPoint.wav:",n)}}),r=new Audio(Zd),r.preload="auto",r.volume=.7,Cu(()=>{try{r&&(r.currentTime=0,r.play())}catch(n){console.warn("[audio] failed to play Select.wav:",n)}})},update(){},dispose(){t=null,r=null}}}function $d(o=1e3){return{id:"render.final",priority:o,init(){},onResize(){},update(t,r){r.renderer.clear(!0,!0,!0),r.renderer.render(r.scene,r.camera)},dispose(){}}}const li=1,ui=new ji;ui.set(li);const eh=.79,nr={uniforms:{tBloom:{value:null}},vertexShader:`
    varying vec2 vUv;
    void main(){ vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0); }
  `,fragmentShader:`
    uniform sampler2D tBloom;
    varying vec2 vUv;
    void main(){
      vec3 b = texture2D(tBloom, vUv).rgb;
      // alpha from average intensity for hue-agnostic glow (k = 1.0)
      float avg = (b.r + b.g + b.b) / 3.0;
      float a = clamp(avg * 1.0, 0.0, 1.0);
      gl_FragColor = vec4(b, a);
    }
  `};function th(o=995){let t=null,r=null,l=null,n=null,e=null;const a=new Map;function i(u,f){if(!t||!r||!l||!n)return;const d=Math.max(1,Math.floor(u*.6)),h=Math.max(1,Math.floor(f*.6));t.setSize(u,f,!1),t.setPixelRatio(1),r.setSize(d,h),r.setPixelRatio(1),n.setSize(d,h),l.setSize(u,f)}function s(u){const f=u;if(!f.isMesh||!f.layers.test(ui)||a.has(f))return;const d=f.material;a.set(f,d);const h=new Je(1,1,1),g=d;let v=1;g.emissive?(h.copy(g.emissive),v=typeof g.emissiveIntensity=="number"?g.emissiveIntensity:1):h.set(1572718);{const p=Math.max(0,v)*eh,x=.2126*h.r+.7152*h.g+.0722*h.b,y=p/Math.max(x,1e-4);h.multiplyScalar(y)}const b=f.userData||(f.userData={});let m=b.__bloomBright;m?(m.color.copy(h),m.needsUpdate=!0):(m=new ht({color:h,toneMapped:!1,depthTest:!0,depthWrite:!1}),b.__bloomBright=m),f.material=m}function c(u){const f=u;if(!f.isMesh)return;const d=a.get(f);d&&(f.material=d,a.delete(f))}return{id:"render.buttonsBloomOverlay",priority:o,init(u){t=new ss({antialias:!0,alpha:!0,premultipliedAlpha:!1});const f=t.domElement;f.style.position="fixed",f.style.inset="0",f.style.pointerEvents="none",f.style.zIndex="10",document.body.appendChild(f),t.setClearColor(0,0),t.setPixelRatio(1),r=new la(t),r.renderToScreen=!1,r.addPass(new qi(u.scene,u.camera)),n=new Yi(new oe(256,256),.65,.1,.7),r.addPass(n),l=new la(t);const d=new Pr({uniforms:ms.clone(nr.uniforms),vertexShader:nr.vertexShader,fragmentShader:nr.fragmentShader,transparent:!0});e=new Xi(d);const h=r.renderTarget2?.texture??r.renderTarget1.texture,g=d.uniforms;g.tBloom=g.tBloom||{value:null},g.tBloom.value=h,l.addPass(e);const v=u.renderer.getSize(new oe);i(v.x,v.y)},onResize(u,f){i(u,f)},update(u,f){if(!t||!r||!l)return;const d=f.camera,h=d.layers.mask;d.layers.set(li),f.scene.traverse(s),r.render(),f.scene.traverse(c),d.layers.mask=h,l.render()},dispose(){if(t)try{t.domElement.remove()}catch{}a.clear(),t=null,r=null,l=null,n=null,e=null}}}const nh=new Map;function oh(o,t){nh.set(o,t)}const rh=async({renderer:o})=>{const t=kc();for(const{id:r}of t)try{const l=await Rn(r);await mo(o,l,{allFronts:!0}),oh(r,l)}catch(l){console.warn("[prewarmAllDecks] failed",r,l)}return{prewarmed:!0}},ah=async()=>{try{await Pn(Qs),console.debug("[prewarmOverlay] info_split_card.glb preloaded")}catch(o){console.warn("[prewarmOverlay] failed to preload info GLB",o)}return{overlayPrewarmed:!0}};function sh(o,t=90){let r=!0,l=0,n=0;function e(){const i=o.getCardsSystem?.()?.cards??[];if(i.length===0)return!1;if(!i.some(f=>f?.state==="flying"))return!0;const c=performance.now()-n,u=Math.max(600,Math.min(4e3,o.maxWaitMs??1800));return c>u}return{id:"cards.reveal-gate",priority:t,init(){r=!0,l=0,n=performance.now(),o.onPatternChange(()=>{if(r){l++;try{o.growNow?.()}catch{}}else o.handlePatternChange()})},update(){if(r&&e()){r=!1;try{ks("homing")}catch{}l>0&&o.handlePatternChange(),l=0;try{o.onFountainEnd?.()}catch{}}},dispose(){}}}const fi=document.getElementById("renderer"),ih=document.getElementById("overlay");if(!fi)throw new Error("#renderer element not found in DOM");const{scene:In,camera:Ft,renderer:En,controls:fn}=Qi(fi);fn.enableRotate=!1;fn.enableZoom=!1;fn.enablePan=!1;const st=jd();Ec(In,En);function Bn(){const o=Ke.cards;if(!o)return!1;for(let t=0;t<o.length;t++){const r=o[t]?.mode;if(r==="focus_in"||r==="focused"||r==="focus_out")return!0}return!1}function ch(){const o=Ke.cards;if(!o)return!1;for(let t=0;t<o.length;t++){const r=o[t]?.state;if(r==="flying"||r==="initialHoming")return!0}return!1}function lh(o,t){const r=nt,l=new A(0,1,0).applyQuaternion(o.quaternion).normalize(),n=new wt().lookAt(r,o.getWorldPosition(new A),l),e=new Ne().setFromRotationMatrix(n);if(t){const a=new Ne().setFromAxisAngle(new A(0,1,0),Math.PI);e.multiply(a)}return e}const di=new dt;In.add(di);const{deck:rs}=await wu({THREE:is,scene:In,renderer:En},{extras:[rh,ah],autoReveal:!0}),Ke=Pc(In,di,{fronts:rs.fronts,back:rs.back}),yo=Xu({system:Ke,camera:Ft,getDeckLength:()=>Ke.getDeckLength()}),an=Uu({system:Ke,getDeckLength:()=>Ke.getDeckLength(),camera:Ft,morphDuration:.75});an.sync({morph:!1});const uh={values:()=>{const o=an.getDesiredCount(),t=Ke.cards?.length??o;return{count:yo.isActive()?Math.max(t,o):o,power:1e4,showPaths:!0,spin:!0}}};function fh(o=.6){const t=Ke.getHeartBoundsWorld?.();if(!t)return;const{center:r,size:l,minY:n,maxY:e}=t,a=Ke.getHeartBottomWorld?.(),i=a?a.x:r.x,s=a?a.y:n,c=a?a.z:r.z,f=.1*Math.max(l.y,1e-4)+.008*Math.sqrt(Math.max(1,Ke.getDeckLength()))*$e,d=De.degToRad(Ft.fov),h=Math.tan(d/2),g=e-(s-f),v=Math.max(l.x,1e-4),b=g/(2*h*o),m=v/(2*h*Ft.aspect*o),p=Math.max(b,m)*1.05;fn.target.copy(r),Ft.position.set(i,r.y,c+p),Ft.up.set(0,1,0),Ft.updateProjectionMatrix()}fh(.6);dc({camera:Ft,forwardTimeToCamera:.01,spreadRight:.05,spreadUp:.01,upMin:10,upMax:200,homingDelay:[50,700.5]});ks("flying");const Gr=Fu({getSystem:()=>Ke},200),ln=Qd(300),hi=Vd({cardGroupFrame:vt,makeFrameQuatFacingCamera:(o,t)=>lh(o,t),getIsFocusing:()=>Bn(),spinner:{isActive:()=>ln.get().isActive()},damp:8,deadbandDeg:1.25},750),So=Rf({getSystem:()=>Ke,isMoving:()=>ln.get().isActive()||Bn()||xs()},710),dh=Yd({system:Ke,cardGroupCenter:nt,cardGroupFrame:vt,controls:fn,overlayCanvas:ih,CARD_H:$e,isFocusing:()=>Bn(),isSpinning:()=>ln.get().isActive(),isScaleHeld:()=>xs(),isFlying:()=>ch(),getCardScale:()=>ft(),setCardScale:o=>lc(o),setLayoutScale:o=>cc(o),snapScales:(o,t)=>fc(o,t),getOverlayBounds:()=>So.get().tubeOutline?.getLastPlaneBounds?.()||null},720),hh=Ef({getOverlayTB:()=>So.get().overlayTB,getInteractions:()=>Gr.get(),getCardsSystem:()=>({setImageDeck:(o,t)=>Ke.setImageDeck(o,t)})},810),ph=zd({getOverlayTB:()=>So.get().overlayTB,getInteractions:()=>Gr.get()},815);st.register(Gr.system);st.register(ln.system);st.register(Wd({hdrUrl:new URL("/assets/studio-BwZMNpPC.hdr",import.meta.url).toString(),showBackground:!1,exposure:1,addLightRig:!0,rotation:{pitch:0,yaw:0,roll:0},cubeSize:256},50));st.register(qd({director:{update:o=>yo.update(o)},system:Ke,getUIValues:()=>uh.values(),getBillboardMode:()=>{const o=ln.get().isActive();return Bn()?"frame":hi.get().isReturningActive()?"camera":o?"frame":"camera"},isLayoutLocked:()=>ln.get().isActive()||Bn()},700));st.register(hi.system);st.register(dh);st.register(So.system);st.register(hh);st.register(ph);st.register(Jd(820));st.register(th(995));st.register($d(1e3));st.register(sh({getCardsSystem:()=>Ke,onPatternChange:o=>Ir(o),handlePatternChange:async()=>{try{const o=Dn?.()??null;if(o){const r=await Rn(o).catch(()=>null);r&&(await mo(En,r),Ke.setImageDeck?.(r.fronts,r.back))}an.onPatternChanged?.();const t=an.getDesiredCount();Ke.ensureCardCount?.(t),yo.preallocate?.(t),yo.start?.()}catch(o){console.error("[reveal-gate] director.start failed:",o)}},growNow:async()=>{try{const o=Dn?.()??null;if(o){const r=await Rn(o).catch(()=>null);r&&(await mo(En,r),Ke.setImageDeck?.(r.fronts,r.back))}an.onPatternChanged?.();const t=an.getDesiredCount();Ke.ensureCardCount?.(t,{quiet:!0})}catch(o){console.error("[reveal-gate] growNow failed:",o)}},maxWaitMs:3e3},90));function gh(o){if(window.__APP_READY__){o();return}const t=()=>{document.removeEventListener("appready",t),o()};document.addEventListener("appready",t)}gh(()=>{st.start({scene:In,camera:Ft,renderer:En,controls:fn})});
