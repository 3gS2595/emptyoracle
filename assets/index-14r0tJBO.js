import{S as Ur,F as yi,P as as,W as ss,a as it,A as wi,O as bi,T as is,V as C,b as yt,G as cs,c as io,C as sn,M as mt,d as or,e as Xe,f as pt,B as kt,g as Ln,L as Lr,h as _i,i as De,j as _t,Q as je,k as cn,l as te,m as xi,H as ls,D as us,n as Rr,R as fs,o as ds,p as Dr,q as hs,r as ps,s as et,t as ms,u as Si,v as Mi,w as It,x as Pr,N as Ci,y as Ai,I as on,z as Ti,E as ki,J as Fi,K as Ui,U as Li,X as Ri,Y as gs,Z as Di,_ as Pi,$ as Ei,a0 as co,a1 as vs,a2 as sa,a3 as ia,a4 as Bi,a5 as Ii,a6 as ca,a7 as Oi,a8 as zi,a9 as Gi,aa as Wi,ab as Vi,ac as Hi,ad as Ni,ae as ji,af as la,ag as qi,ah as Yi,ai as Xi}from"./three-B_POVWff.js";function Qi(o){const t=new Ur;t.background=null,t.fog=new yi(988187,180,900);const r=new as(55,2,.1,200);r.position.set(0,8,0),t.add(r);const l=new ss({antialias:!1,alpha:!0});l.outputColorSpace=it,l.toneMapping=wi,l.toneMappingExposure=1,l.setPixelRatio(window.devicePixelRatio),l.setSize(window.innerWidth,window.innerHeight),l.autoClear=!1,o.appendChild(l.domElement);const n=l.domElement;n.style.width="100%",n.style.height="100%",n.style.display="block";const e=new bi(r,l.domElement);e.enableDamping=!0,e.dampingFactor=.08,e.target.set(0,0,0),e.zoom0=200;const a=o.clientWidth||window.innerWidth,c=o.clientHeight||window.innerHeight;return l.setSize(a,c,!0),r.aspect=a/Math.max(1,c),r.updateProjectionMatrix(),{THREE:is,scene:t,camera:r,renderer:l,controls:e,container:o}}const Ki=new C(0,-9.8,0),Vo=.12,ua=.02,rr=new C(0,.1,0),ys=240,Zi=9e-4,Ji=4e-4,$i=25e-6,ec=3.5,Er="/emptyoracle/assets/back-CkvHV39y.avif",fa=new Map,tc=o=>Math.max(.05,Math.round((o||1)*1e3)/1e3);function ws(o){const t=tc(o);let r=fa.get(t);return r||(r=new yt(tt*t,tt,1,1),fa.set(t,r)),r}const da=new Map;function bs(o,t){const r=`${o.uuid}:${t?"r90":"r0"}`;let l=da.get(r);return l||(l=o.clone(),l.needsUpdate=!0,l.center.set(.5,.5),l.rotation=t?Math.PI*.5:0,"colorSpace"in l?l.colorSpace=it:l.encoding=void 0,da.set(r,l)),l}const tt=.88*1.6,ar=.0025;let Ho=null;function nc(){if(Ho)return Ho;const t=new io().load(Er);return t.anisotropy=8,"colorSpace"in t?t.colorSpace=it:t.encoding=void 0,t.wrapS=sn,t.wrapT=sn,Ho=t,t}nc();function oc(o,t=1,r){const l=tt*Math.max(t,.05),n=tt,e=ws(t);"colorSpace"in o?o.colorSpace=it:o.encoding=void 0,o.anisotropy=Math.max(o.anisotropy??1,8);const a=new mt({map:o,side:or,fog:!1,toneMapped:!1,transparent:!1,opacity:1}),c=new Xe(e,a);c.name="card_front";let s=r;s||(s=new io().load(Er),"colorSpace"in s?s.colorSpace=it:s.encoding=void 0,s.anisotropy=8);const i=t>1,u=bs(s,i),f=new mt({map:u,side:or,fog:!1,toneMapped:!1,transparent:!0,opacity:1}),d=new Xe(e,f);d.rotateY(Math.PI),d.position.z=-ar,d.name="card_back",c.position.z=ar;const h=new pt;return h.add(c,d),{group:h,width:l,height:n}}new cs;function rc(o=65280,t=40){const r=new kt,l=new Float32Array(t*3);r.setAttribute("position",new Ln(l,3)),r.setDrawRange(0,0);const n=new Lr({color:o,transparent:!0,opacity:.65,fog:!0}),e=new _i(r,n);return e.userData={positions:l,max:t,count:0,decayPtsPerSec:24,minMoveSq:6e-4},e}function _s(o,t){const r=ar*.9,l=new C().subVectors(t.position,o.group.position).normalize();return new C().copy(o.group.position).addScaledVector(l,r)}function to(o,t,r,l){const n=o.trail,e=n.userData,{positions:a,max:c}=e,s=_s(o,l);if(r){const i=Math.min(e.count+1,c);for(let u=i-1;u>0;u--)a[u*3+0]=a[(u-1)*3+0],a[u*3+1]=a[(u-1)*3+1],a[u*3+2]=a[(u-1)*3+2];a[0]=s.x,a[1]=s.y,a[2]=s.z,e.count=i,n.geometry.setDrawRange(0,i),n.geometry.attributes.position.needsUpdate=!0;return}if(e.count>0){a[0]=s.x,a[1]=s.y,a[2]=s.z;const i=Math.max(1,Math.floor(e.decayPtsPerSec*t)),u=Math.max(0,e.count-i);e.count=u,n.geometry.setDrawRange(0,u),n.geometry.attributes.position.needsUpdate=!0}}function ac(o){const t=o.trail,r=t.userData;r.count=0,t.geometry.setDrawRange(0,0),t.geometry.attributes.position.needsUpdate=!0}function sc(o,t,r){const l=[];let n=r?.fronts??[],e=r?.back??null,a=-1;const c={cards:l,getHeartBoundsWorld:null,getHeartBottomWorld:null};function s(i,u){const f=i.group,d=f.getObjectByName("card_front"),h=f.getObjectByName("card_back"),m=Math.max(u?.aspect??1,.05),g=d.material;g.map=u.texture,"colorSpace"in u.texture?u.texture.colorSpace=it:u.texture.encoding=void 0,u.texture.anisotropy=Math.max(u.texture.anisotropy??1,8);const b=h.material;b.map=bs(e,m>1);const v=ws(m);d.geometry!==v&&(d.geometry=v),h.geometry!==v&&(h.geometry=v),i.cardWidth=tt*m;const p=f.getObjectByName("card_overlay_glb");p&&f.remove(p)}return{scene:o,trailsGroup:t,cards:l,publicAPI:c,deck:n,backBase:e,_lastCount:a,_targetsDirty:!0,makeCard(i){const u=n[i%Math.max(n.length,1)],f=oc(u?.texture,u?.aspect??1,e??void 0),d=rc(65280,20);return t.add(d),o.add(f.group),{group:f.group,trail:d,velocity:new C,angular:new C,age:0,alive:!1,opacity:1,state:"flying",mode:"normal",targetLocal:new C,homingDelay:1,prevPos:new C,prevHead:null,cardWidth:f.width||tt*(u?.aspect??1)}},setDeck(i){n=i.fronts??[],e=i.back??null,this.deck=n,this.backBase=e;for(let u=0;u<l.length;u++){const f=n[u%Math.max(n.length,1)];f&&s(l[u],f)}this._targetsDirty=!0},updateTrail:to,clearTrail:ac}}const lo=.05,uo=50;let wo=1,Ht=1,bo=1,Nt=1,Br=!1;const ha=1e-4;function ic(){return Ht}function ht(){return Nt}function xs(){return Br}function Tn(o){Br=o,o&&(wo=Ht,bo=Nt)}function cc(o){wo=De.clamp(o,lo,uo)}function lc(o){bo=De.clamp(o,lo,uo)}function uc(o){if(Br)return{layoutChanged:!1,cardChanged:!1};const t=1-Math.exp(-6*Math.max(0,o)),r=1-Math.exp(-8*Math.max(0,o)),l=Ht,n=Nt;Ht+=(wo-Ht)*t,Nt+=(bo-Nt)*r;const e=Math.abs(Ht-l)>ha,a=Math.abs(Nt-n)>ha;return{layoutChanged:e,cardChanged:a}}function fc(o,t){o!==void 0&&(wo=Ht=De.clamp(o,lo,uo)),t!==void 0&&(bo=Nt=De.clamp(t,lo,uo))}const dt=(o,t)=>o+Math.random()*(t-o);let Ss="flying",Ms=!1;const Cn=new C(0,0,1),sr=new C(1,0,0),Cs=new C(0,0,0);let As=9,ir=6.5,cr=10,lr=.35,ur=.15,fr=.8,Ts=1.4;function dc(o){const{camera:t}=o;Cn.copy(t.position).sub(rr).normalize();const r=new C(0,1,0);sr.copy(new C().crossVectors(Cn,r)).normalize(),Cs.copy(new C().crossVectors(sr,Cn)).normalize(),lr=o.spreadRight??lr,ur=o.spreadUp??ur,ir=o.upMin??ir,cr=o.upMax??cr,o.homingDelay&&(fr=o.homingDelay[0],Ts=o.homingDelay[1]);const l=Math.max(.25,o.forwardTimeToCamera),n=new C().subVectors(t.position,rr).dot(Cn);As=Math.max(2e3,n/l),Ms=!0}function ks(o){Ss=o}function dr(o,t,r=50){let l=500,n=!1;typeof r=="number"?l=r:r&&(l=r.power??50,n=!!r.quiet);const e=o?.scene;if(e&&t.group.parent!==e)e.add(t.group);else if(!t.group.parent){const a=o?.trailsGroup?.parent;a&&a.add&&a.add(t.group)}if(t.group.position.copy(rr).add({x:dt(-.05,.05),y:0,z:dt(-.05,.05)}),n)t.velocity.set(0,0,0),t.angular.set(0,0,0),t.state="homing",t.homingDelay=0;else if(Ss==="flying"){if(Ms){const a=dt(ir,cr)*(.8+l/70),c=As*(.6+l/100)*dt(.95,1.05),s=c*lr*dt(-1,1),i=a*ur*dt(-1,1);t.velocity.copy(Cn).multiplyScalar(c).addScaledVector(Cs,a+i).addScaledVector(sr,s)}else t.velocity.set(dt(-.6,.6)*(.6+l/100),dt(6.5,10)*(.8+l/70),dt(-.6,.6)*(.6+l/100));t.angular.set(dt(-2,2),dt(-2,2),dt(-2,2)),t.state="flying",t.homingDelay=fr+Math.random()*(Ts-fr)}else t.velocity.set(0,0,0),t.angular.set(0,0,0),t.state="homing",t.homingDelay=0;t.age=0,t.alive=!0,t.opacity=0,t.trail?.userData&&(t.trail.userData.count=0),t.trail?.geometry?.setDrawRange&&t.trail.geometry.setDrawRange(0,0),t.group.scale.setScalar(.05*ht()),t.prevPos.copy(t.group.position),t.prevHead=null}function hc(o,t,r={}){const l=r.power??50,n=!!r.quiet,e=Math.max(0,t|0);for(;o.cards.length<e;){const s=o.makeCard(o.cards.length);dr(o,s,{power:l,quiet:n}),o.cards.push(s),o._targetsDirty=!0}const a=s=>s==="focus_in"||s==="focused"||s==="focus_out"||s==="transition",c=s=>!!s?.isOverlay||a(s?.mode);for(;o.cards.length>e;){let s=o.cards.length-1;for(;s>=0&&c(o.cards[s]);)s--;if(s<0)break;const[i]=o.cards.splice(s,1);try{i.group?.parent?.remove(i.group)}catch{}try{o.trailsGroup?.remove(i.trail)}catch{}o._targetsDirty=!0}o._lastCount!==e&&(o._lastCount=e,o._targetsDirty=!0)}function pc(o,t){o.age+=t;const r=-Vo*o.velocity.x,l=Ki.y-Vo*o.velocity.y,n=-Vo*o.velocity.z;o.velocity.x+=r*t,o.velocity.y+=l*t,o.velocity.z+=n*t,o.group.position.x+=o.velocity.x*t,o.group.position.y+=o.velocity.y*t,o.group.position.z+=o.velocity.z*t}function mc(o,t,r){const l=1-Math.exp(-r*ec);o.group.position.lerp(t,l),o.velocity.multiplyScalar(.85),o.angular.multiplyScalar(.85)}let gc=-.5;function Fs(o,t,r,l=new C){l.copy(o).sub(t);const n=new C(0,1,0).applyQuaternion(r).normalize();return l.length()<1e-6?l.set(0,1,0).applyQuaternion(r):(l.clone().normalize().dot(n)<gc&&l.multiplyScalar(-1),l)}function Us(o,t,r){const l=o.clone().normalize(),n=l.clone(),e=new C(0,1,0).applyQuaternion(r).normalize(),a=(()=>{const f=t.clone();if(f.addScaledVector(l,-f.dot(l)).normalize(),f.lengthSq()>1e-8)return f;const d=e.clone().addScaledVector(l,-e.dot(l)).normalize();return d.lengthSq()>1e-8?d:e.clone()})(),c=new C().crossVectors(a,n).normalize(),s=new C().crossVectors(n,c).normalize(),i=new _t().makeBasis(c,s,n);return new je().setFromRotationMatrix(i)}function pa(o,t,r,l,n){const e=o.group.getWorldPosition(new C),c=t.getWorldPosition(new C).sub(e).normalize(),s=Fs(e,l,n),i=Us(c,s,n),u=o.group.quaternion,f=De.clamp(u.dot(i),-1,1),d=2*Math.acos(Math.abs(f));if(d<1e-4){o.group.quaternion.copy(i);return}const h=ys*Math.PI/180*r,m=Math.min(1,h/d);o.group.quaternion.slerp(i,m)}function ma(o,t,r,l){const n=new C(0,0,1).applyQuaternion(t).normalize(),e=o.group.getWorldPosition(new C),a=Fs(e,l,t),c=Us(n,a,t),s=o.group.quaternion,i=De.clamp(s.dot(c),-1,1),u=2*Math.acos(Math.abs(i));if(u<1e-4){o.group.quaternion.copy(c);return}const f=ys*Math.PI/180*r,d=Math.min(1,f/u);o.group.quaternion.slerp(c,d)}function ga(o,t,r,l){let n=l;if(o.state!=="flying"){const e=_s(o,t);o.prevHead||(o.prevHead=e.clone()),o.prevHead.distanceToSquared(e)>$i&&(n=!0),o.prevHead.copy(e)}if(o.state!=="flying"){const e=o.velocity.lengthSq();n=n||e>Ji}return n}const st=new C(0,0,0),wt=new cn;function fo(o){return o.clone().applyQuaternion(wt.quaternion).add(wt.position)}const va=[new te(1.5,2.5),new te(-1.5,2.5),new te(0,-2.5),new te(0,1),new te(.5,2),new te(-.5,2),new te(2.3,2),new te(2.5,1),new te(1.8,0),new te(1,-1),new te(.5,-1.7),new te(-.5,-1.8),new te(-1,-1),new te(-2,0),new te(-2.5,1),new te(-2.2,2)],vc={fixedCount:va.length,sample(){return{positions:va.map(t=>new C(t.x,t.y,0))}}},yc=Object.freeze(Object.defineProperty({__proto__:null,default:vc},Symbol.toStringTag,{value:"Module"})),ya=[new te(1.5,1),new te(2.5,.7),new te(3.5,.4),new te(4.5,0),new te(3.5,-.5),new te(2.5,-.7),new te(-2.3,-.7),new te(-3.3,-.4),new te(-4.3,0),new te(-3.3,.5),new te(-2.3,.7),new te(0,-2.5),new te(-1,-2.9),new te(-1.9,-3.3),new te(-2.9,-3.7),new te(-2.5,-2.7),new te(-1.9,-1.9),new te(-1.3,-1),new te(1.5,-1),new te(2,-1.9),new te(2.5,-2.9),new te(2.9,-3.9),new te(1.8,-3.5),new te(1,-2.9),new te(1.3,-2),new te(0,2.5),new te(1,2.9),new te(1.9,3.3),new te(2.9,3.7),new te(2.5,2.7),new te(1.9,1.9),new te(-1.5,1),new te(-2,1.9),new te(-2.5,2.9),new te(-2.9,3.9),new te(-1.8,3.5),new te(-1,2.9)],wc={fixedCount:ya.length,sample(){return{positions:ya.map(t=>new C(t.x,t.y,0))}}},bc=Object.freeze(Object.defineProperty({__proto__:null,default:wc},Symbol.toStringTag,{value:"Module"})),wa=[new te(-2,0),new te(0,0),new te(2,0)],_c={fixedCount:wa.length,sample(){return{positions:wa.map(t=>new C(t.x,t.y,0))}}},xc=Object.freeze(Object.defineProperty({__proto__:null,default:_c},Symbol.toStringTag,{value:"Module"})),ba=[new te(0,.2),new te(-1.2,0),new te(-1.8,-.4),new te(-2.3,-.8),new te(2.3,-.8),new te(1.8,-.4),new te(3.5,-1.8),new te(3.2,-.8),new te(2.6,.2),new te(-.6,1.7),new te(-1.2,1.5),new te(-2.6,.2),new te(-1.7,1.1),new te(-3.2,-.8),new te(-3.5,-1.8),new te(-2.2,.7),new te(2.3,.7),new te(.7,.1),new te(-.7,.1),new te(1.2,0),new te(1.8,1.1),new te(1.2,1.5),new te(0,1.8),new te(.6,1.7)],Sc={fixedCount:ba.length,sample(){return{positions:ba.map(t=>new C(t.x,t.y,0))}}},Mc=Object.freeze(Object.defineProperty({__proto__:null,default:Sc},Symbol.toStringTag,{value:"Module"})),Rt=[];let kn=0;const hr=new Set,Cc={id:"fallback:ring",label:"Ring",sample(o){const t=Math.max(1,o|0),r=1;return{positions:Array.from({length:t},(n,e)=>{const a=e/t*Math.PI*2;return new C(Math.cos(a)*r,Math.sin(a)*r,0)})}}};function Ir(o){return hr.add(o),()=>hr.delete(o)}function pr(){const o=Yt();for(const t of hr)t(o)}function Yt(){return Rt.length?Rt[kn]:Cc}function Rn(){return Yt().id??"fallback:ring"}function Ls(o){return(o.includes(":")?o.split(":")[1]:o).replace(/[_-]+/g," ").replace(/\s+/g," ").trim().replace(/\b\w/g,r=>r.toUpperCase())}let Ac=0;function Tc(o){const t=o.id??`manual:${Ac++}`,r=o.label??Ls(t);return Rt.push({...o,id:t,label:r}),Rt.length===1&&(kn=0,pr()),{...o,id:t,label:r}}function kc(){return Rt.length?Rt.map(o=>({id:o.id,label:o.label})):[{id:"fallback:ring",label:"Ring"}]}function Rs(o){const r=(Yt().fixedCount??o)|0;return Math.max(0,Math.min(r,o|0))}function Fc(o){if(!Rt.length){const l=Rn()===o;return pr(),{changed:!l,pattern:Yt()}}const t=Rt.findIndex(l=>l.id===o);if(t===-1)return{changed:!1,pattern:Yt()};const r=t!==kn;return kn=t,pr(),{changed:r,pattern:Rt[kn]}}function Uc(o){const t=Yt(),r=Math.max(0,o|0),{positions:l}=t.sample(r);for(const n of l)n.z=0;return{positions:l}}function Lc(o){return o&&typeof o=="object"&&typeof o.sample=="function"}function Rc(o){return`custom:${o.split("/").pop().replace(/\.\w+$/,"")}`}const Dc=Object.assign({"/src/features/cardGroup/patterns/custom/test0.ts":yc,"/src/features/cardGroup/patterns/custom/test1.ts":bc,"/src/features/cardGroup/patterns/custom/test2.ts":xc,"/src/features/cardGroup/patterns/custom/test3.ts":Mc}),_a=new Set;Object.entries(Dc).sort(([o],[t])=>o.localeCompare(t)).forEach(([o,t])=>{const r=t.default??t.pattern;if(!Lc(r))return;const l=Rc(o),n=r.id??l;if(_a.has(n))return;const e=r.label??Ls(n);Tc({...r,id:n,label:e}),_a.add(n)});function Qn(o){const t=o.cards.length;if(!t){o._targets=[];return}const r=ic(),{positions:l}=Uc(t);for(let n=0;n<t;n++){const e=l[n%l.length]||new C;o.cards[n].targetLocal=new C(e.x*r,e.y*r,0)}o.publicAPI.getHeartBoundsWorld=function(){if(!l.length)return null;const n={x:1/0,y:1/0,z:1/0},e={x:-1/0,y:-1/0,z:-1/0};for(let s=0;s<t;s++){const i=fo(o.cards[s].targetLocal);i.x<n.x&&(n.x=i.x),i.y<n.y&&(n.y=i.y),i.z<n.z&&(n.z=i.z),i.x>e.x&&(e.x=i.x),i.y>e.y&&(e.y=i.y),i.z>e.z&&(e.z=i.z)}const a=new C((n.x+e.x)/2,(n.y+e.y)/2,(n.z+e.z)/2),c=new C(e.x-n.x,e.y-n.y,e.z-n.z);return{center:a,size:c,minY:n.y,maxY:e.y,min:n,max:e}},o.publicAPI.getHeartBottomWorld=function(){if(!l.length)return null;let n=null,e=1/0;for(let a=0;a<t;a++){const c=fo(o.cards[a].targetLocal);c.y<e&&(e=c.y,n=c)}return n?n.clone():null}}const mr=fo;function xa(o){return o==="focus_in"||o==="focused"||o==="focus_out"}function Pc(o,t,r){const l=sc(o,t,r);function n(f,d){let h=50,m=!1;typeof d=="number"?h=d:d&&(h=d.power??50,m=!!d.quiet),hc(l,Math.max(0,f|0),{power:h,quiet:m}),l._targetsDirty&&l.cards.length&&(Qn(l),l._targetsDirty=!1)}function e(){l._targetsDirty=!0,l.cards.length&&(Qn(l),l._targetsDirty=!1)}function a(f,d,h,m){const g=m?.billboard??"camera",b=wt.quaternion;n(d.count,d.power);const v=ht();for(const p of l.cards){if(p.mode==="transition"){const M=p.prevPos.distanceToSquared(p.group.position)>1e-8;if(d.showPaths){p.trail.visible=!0,p.trail.material.opacity=.9;const w=ga(p,h,f,M);l.updateTrail(p,f,w,h)}else p.trail.visible&&(l.clearTrail(p),p.trail.visible=!1);p.prevPos.copy(p.group.position);continue}if(p.mode==="morph"&&p._morph){p._morph.t+=f;const M=Math.min(1,p._morph.t/Math.max(1e-6,p._morph.dur)),w=M<.5?4*M*M*M:1-Math.pow(-2*M+2,3)/2,A=new C,F=1-w;A.set(0,0,0).addScaledVector(p._morph.p0,F*F*F).addScaledVector(p._morph.p1,3*F*F*w).addScaledVector(p._morph.p2,3*F*w*w).addScaledVector(p._morph.p3,w*w*w),p.group.position.copy(A),g==="camera"?pa(p,h,f,st,b):ma(p,b,f,st);const k=De.degToRad(360)*w;p.group.rotateY(k-(p._morph.prevSpin||0)),p._morph.prevSpin=k;const D=1+.08*Math.sin(Math.PI*w);p.group.scale.setScalar(v*D),p.trail.material.opacity=.85,l.updateTrail(p,f,!0,h),M>=1&&(p.mode="normal",p._morph=null,p.group.scale.setScalar(v),p.trail.material.opacity=.65);continue}if(xa(p.mode)){const M=p.prevPos.distanceToSquared(p.group.position)>1e-8;d.showPaths?(p.trail.visible=!0,l.updateTrail(p,f,M,h)):p.trail.visible&&(l.clearTrail(p),p.trail.visible=!1),p.prevPos.copy(p.group.position);continue}p.alive||dr(l,p,d.power),p.opacity<1&&(p.opacity=Math.min(1,p.opacity+f*2.5));const x=De.lerp(.05,1,p.opacity);p.group.scale.setScalar(v*x);let y=!1;if(p.state==="flying"){if(pc(p,f),p.group.position.y<ua){p.group.position.y=ua,p.velocity.y=Math.max(0,p.velocity.y),p.state="initialHoming";const M=p.group?.uuid??p.group?.id??"?";console.debug(`[card ${M}] flying -> initialHoming (floor)`)}if(p.group.rotation.x+=p.angular.x*f,p.group.rotation.y+=p.angular.y*f,p.group.rotation.z+=p.angular.z*f,p.age-3>p.homingDelay){p.state="initialHoming";const M=p.group?.uuid??p.group?.id??"?";console.debug(`[card ${M}] flying -> initialHoming (delay=${p.homingDelay?.toFixed?p.homingDelay.toFixed(2):p.homingDelay})`)}y=!0}else{const M=mr(p.targetLocal),A=p.group.position.clone().distanceToSquared(M);if(mc(p,M,f),g==="camera"?pa(p,h,f,st,b):ma(p,b,f,st),p.state==="initialHoming"&&A<=Zi){p.state="homing";const F=p.group?.uuid??p.group?.id??"?";console.debug(`[card ${F}] initialHoming -> homing (dist2=${A.toFixed(5)})`)}y=!0}const _=ga(p,h,f,y);d.showPaths?(p.trail.visible=!0,l.updateTrail(p,f,_,h)):p.trail.visible&&(l.clearTrail(p),p.trail.visible=!1),p.prevPos.copy(p.group.position)}}function c(f){l._targetsDirty=!0;for(const d of l.cards)d.mode="normal",d.state="flying",d.opacity=0,d.alive=!0,d._morph=null,l.clearTrail(d),d.trail.visible=!0,d.group.parent!==o&&o.add(d.group),d.group.quaternion.identity(),d.prevPos.copy(d.group.position),d.prevHead=null,d.group.scale.setScalar(ht()),dr(l,d,f),d.trail.material.opacity=.65}function s(f,d){l._targetsDirty=!0,Qn(l),l._targetsDirty=!1;const h=Math.max(.25,Math.min(6,d?.duration??1.6));for(const m of l.cards){if(xa(m.mode))continue;const g=m.group.getWorldPosition(new C),b=mr(m.targetLocal),v=new C().addVectors(g,b).multiplyScalar(.5),p=Math.max(.5,g.distanceTo(b)*.25),x=Math.max(.3,g.distanceTo(b)*.15),y=new C(v.x,v.y+p,v.z),_=new C(b.x,b.y-x,b.z);m.mode="morph",m.state="homing",m.velocity.set(0,0,0),m.angular.set(0,0,0),m._morph={t:0,dur:h,p0:g,p1:y,p2:_,p3:b,prevSpin:0},m.trail.visible=!0,m.trail.material.opacity=.9}}function i(f,d){l.setDeck({fronts:f,back:d}),l.cards.length&&(Qn(l),l._targetsDirty=!1)}function u(){return Math.max(0,l.deck?.length|0||0)}return{...l.publicAPI,scene:l.scene,step:a,reset:c,ensureCardCount:n,prepareHeartTargets:e,morphToNewTargets:s,setImageDeck:i,getDeckLength:u}}function Ec(o,t){t.shadowMap.enabled=!1;let r=o.getObjectByName("FlatAmbient");r?r.intensity=.35:(r=new xi(16777215,.35),r.name="FlatAmbient",o.add(r));let l=o.getObjectByName("FlatHemi");l?l.intensity=.35:(l=new ls(12575743,2109476,.35),l.name="FlatHemi",o.add(l));let n=o.getObjectByName("FlatKey");n?(n.intensity=.8,n.position.set(3,4,2)):(n=new us(16777215,.8),n.position.set(3,4,2),n.name="FlatKey",o.add(n))}const Bc="/emptyoracle/assets/103_converted-CCKUNFTe.avif",Ic="/emptyoracle/assets/106_converted-fa5jghwL.avif",Oc="/emptyoracle/assets/108_converted-CppO2GS5.avif",zc="/emptyoracle/assets/asdf-DuOLjb0-.avif",Gc="/emptyoracle/assets/2_converted-BXNtAhVS.avif",Wc="/emptyoracle/assets/32_converted-YjMYFBEP.avif",Vc="/emptyoracle/assets/21888-CaRacCkE.avif",Hc="/emptyoracle/assets/44_converted-CnQUlqwR.avif",Nc="/emptyoracle/assets/55_converted-fbfd0Qdp.avif",jc="/emptyoracle/assets/61_converted-DHmHUAJg.avif",qc="/emptyoracle/assets/65_converted-_w8fvoP6.avif",Yc="/emptyoracle/assets/66_converted-InZBsrHX.avif",Xc="/emptyoracle/assets/67_converted-B15ZrYUZ.avif",Qc="/emptyoracle/assets/82_converted-BYKiW5zc.avif",Kc="/emptyoracle/assets/90_converted-DiBONRl4.avif",Zc="/emptyoracle/assets/97_converted-D55DAdUG.avif",Ds="/emptyoracle/assets/back-BMQaBRDs.avif",Jc="/emptyoracle/assets/asdf-DuOLjb0-.avif",$c="/emptyoracle/assets/asdf-DuOLjb0-.avif",el="/emptyoracle/assets/asdf-DuOLjb0-.avif",tl="/emptyoracle/assets/909394-o4btXReT.avif",nl="/emptyoracle/assets/909394-o4btXReT.avif",ol="/emptyoracle/assets/909394-o4btXReT.avif",rl="/emptyoracle/assets/55544-CwEbS-e9.avif",al="/emptyoracle/assets/55544-CwEbS-e9.avif",sl="/emptyoracle/assets/55544-CwEbS-e9.avif",il="/emptyoracle/assets/3_converted-4SJ-8_Bi.avif",cl="/emptyoracle/assets/3_converted-4SJ-8_Bi.avif",ll="/emptyoracle/assets/3_converted-4SJ-8_Bi.avif",ul="/emptyoracle/assets/40_converted-DwFDT5b-.avif",fl="/emptyoracle/assets/40_converted-DwFDT5b-.avif",dl="/emptyoracle/assets/40_converted-DwFDT5b-.avif",hl="/emptyoracle/assets/54_converted-C6gsDuDG.avif",pl="/emptyoracle/assets/54_converted-C6gsDuDG.avif",ml="/emptyoracle/assets/54_converted-C6gsDuDG.avif",gl="/emptyoracle/assets/57_converted-BM1TG-qq.avif",vl="/emptyoracle/assets/57_converted-BM1TG-qq.avif",yl="/emptyoracle/assets/57_converted-BM1TG-qq.avif",wl="/emptyoracle/assets/59_converted-RIQhhz8d.avif",bl="/emptyoracle/assets/59_converted-RIQhhz8d.avif",_l="/emptyoracle/assets/59_converted-RIQhhz8d.avif",xl="/emptyoracle/assets/5_converted-B7aoQaEb.avif",Sl="/emptyoracle/assets/5_converted-B7aoQaEb.avif",Ml="/emptyoracle/assets/5_converted-B7aoQaEb.avif",Cl="/emptyoracle/assets/73_converted-D7IqHcDL.avif",Al="/emptyoracle/assets/73_converted-D7IqHcDL.avif",Tl="/emptyoracle/assets/73_converted-D7IqHcDL.avif",kl="/emptyoracle/assets/88_converted-CJAusi-M.avif",Fl="/emptyoracle/assets/88_converted-CJAusi-M.avif",Ul="/emptyoracle/assets/88_converted-CJAusi-M.avif",Ll="/emptyoracle/assets/89_converted-qRCxcDod.avif",Rl="/emptyoracle/assets/89_converted-qRCxcDod.avif",Dl="/emptyoracle/assets/89_converted-qRCxcDod.avif",Pl="/emptyoracle/assets/93_converted-BBJOPPF3.avif",El="/emptyoracle/assets/93_converted-BBJOPPF3.avif",Bl="/emptyoracle/assets/93_converted-BBJOPPF3.avif",Il="/emptyoracle/assets/9_converted-CFAV1elD.avif",Ol="/emptyoracle/assets/9_converted-CFAV1elD.avif",zl="/emptyoracle/assets/9_converted-CFAV1elD.avif",Ps="/emptyoracle/assets/back-CkvHV39y.avif",Gl="/emptyoracle/assets/102_converted-Ch_C-71B.avif",Wl="/emptyoracle/assets/23_converted-BvFqQVZE.avif",Vl="/emptyoracle/assets/94_converted-AceOW8jK.avif",Es="/emptyoracle/assets/back-CkvHV39y.avif",Hl="/emptyoracle/assets/11233-Ba-FPQCp.avif",Nl="/emptyoracle/assets/11233-Ba-FPQCp.avif",jl="/emptyoracle/assets/12300-DfsZGI5m.avif",ql="/emptyoracle/assets/12300-DfsZGI5m.avif",Yl="/emptyoracle/assets/123001-DuM6nCxT.avif",Xl="/emptyoracle/assets/123001-DuM6nCxT.avif",Ql="/emptyoracle/assets/21888-CaRacCkE.avif",Kl="/emptyoracle/assets/21888-CaRacCkE.avif",Zl="/emptyoracle/assets/44422-Bmv9pLdb.avif",Jl="/emptyoracle/assets/44422-Bmv9pLdb.avif",$l="/emptyoracle/assets/444334-D1xZviLq.avif",eu="/emptyoracle/assets/444334-D1xZviLq.avif",tu="/emptyoracle/assets/444411-B_2QgAis.avif",nu="/emptyoracle/assets/444411-B_2QgAis.avif",ou="/emptyoracle/assets/55111-zSUA8aUX.avif",ru="/emptyoracle/assets/55111-zSUA8aUX.avif",au="/emptyoracle/assets/55544-CwEbS-e9.avif",su="/emptyoracle/assets/55544-CwEbS-e9.avif",iu="/emptyoracle/assets/88189-qVFOIBwK.avif",cu="/emptyoracle/assets/88189-qVFOIBwK.avif",lu="/emptyoracle/assets/909394-o4btXReT.avif",uu="/emptyoracle/assets/909394-o4btXReT.avif",fu="/emptyoracle/assets/923999-ClSxhF8r.avif",du="/emptyoracle/assets/923999-ClSxhF8r.avif",hu="/emptyoracle/assets/9995-zNxxyCvB.avif",pu="/emptyoracle/assets/9995-zNxxyCvB.avif",mu="/emptyoracle/assets/asdf-DuOLjb0-.avif",Bs="/emptyoracle/assets/back-CkvHV39y.avif";function gu(o){return(o.includes(":")?o.split(":")[1]:o).trim()}function Sa(o){const t=new Rr(o);return t.needsUpdate=!0,"colorSpace"in t?t.colorSpace=it:t.encoding=void 0,t.anisotropy=8,t.wrapS=sn,t.wrapT=sn,t}function Ma(o){return new Promise((t,r)=>{const l=new Image;l.crossOrigin="anonymous",l.onload=()=>t(l),l.onerror=n=>r(n),l.src=o})}const vu=Object.assign({"/src/assets/image/test0/103_converted.avif":Bc,"/src/assets/image/test0/106_converted.avif":Ic,"/src/assets/image/test0/108_converted.avif":Oc,"/src/assets/image/test0/1_converted.avif":zc,"/src/assets/image/test0/2_converted.avif":Gc,"/src/assets/image/test0/32_converted.avif":Wc,"/src/assets/image/test0/35_converted.avif":Vc,"/src/assets/image/test0/44_converted.avif":Hc,"/src/assets/image/test0/55_converted.avif":Nc,"/src/assets/image/test0/61_converted.avif":jc,"/src/assets/image/test0/65_converted.avif":qc,"/src/assets/image/test0/66_converted.avif":Yc,"/src/assets/image/test0/67_converted.avif":Xc,"/src/assets/image/test0/82_converted.avif":Qc,"/src/assets/image/test0/90_converted.avif":Kc,"/src/assets/image/test0/97_converted.avif":Zc,"/src/assets/image/test0/back.avif":Ds,"/src/assets/image/test1/1_converted copy 2.avif":Jc,"/src/assets/image/test1/1_converted copy.avif":$c,"/src/assets/image/test1/1_converted.avif":el,"/src/assets/image/test1/26_converted copy 2.avif":tl,"/src/assets/image/test1/26_converted copy.avif":nl,"/src/assets/image/test1/26_converted.avif":ol,"/src/assets/image/test1/33_converted copy 2.avif":rl,"/src/assets/image/test1/33_converted copy.avif":al,"/src/assets/image/test1/33_converted.avif":sl,"/src/assets/image/test1/3_converted copy 2.avif":il,"/src/assets/image/test1/3_converted copy.avif":cl,"/src/assets/image/test1/3_converted.avif":ll,"/src/assets/image/test1/40_converted copy 2.avif":ul,"/src/assets/image/test1/40_converted copy.avif":fl,"/src/assets/image/test1/40_converted.avif":dl,"/src/assets/image/test1/54_converted copy 2.avif":hl,"/src/assets/image/test1/54_converted copy.avif":pl,"/src/assets/image/test1/54_converted.avif":ml,"/src/assets/image/test1/57_converted copy 2.avif":gl,"/src/assets/image/test1/57_converted copy.avif":vl,"/src/assets/image/test1/57_converted.avif":yl,"/src/assets/image/test1/59_converted copy 2.avif":wl,"/src/assets/image/test1/59_converted copy.avif":bl,"/src/assets/image/test1/59_converted.avif":_l,"/src/assets/image/test1/5_converted copy 2.avif":xl,"/src/assets/image/test1/5_converted copy.avif":Sl,"/src/assets/image/test1/5_converted.avif":Ml,"/src/assets/image/test1/73_converted copy 2.avif":Cl,"/src/assets/image/test1/73_converted copy.avif":Al,"/src/assets/image/test1/73_converted.avif":Tl,"/src/assets/image/test1/88_converted copy 2.avif":kl,"/src/assets/image/test1/88_converted copy.avif":Fl,"/src/assets/image/test1/88_converted.avif":Ul,"/src/assets/image/test1/89_converted copy 2.avif":Ll,"/src/assets/image/test1/89_converted copy.avif":Rl,"/src/assets/image/test1/89_converted.avif":Dl,"/src/assets/image/test1/93_converted copy 2.avif":Pl,"/src/assets/image/test1/93_converted copy.avif":El,"/src/assets/image/test1/93_converted.avif":Bl,"/src/assets/image/test1/9_converted copy 2.avif":Il,"/src/assets/image/test1/9_converted copy.avif":Ol,"/src/assets/image/test1/9_converted.avif":zl,"/src/assets/image/test1/back.avif":Ps,"/src/assets/image/test2/102_converted.avif":Gl,"/src/assets/image/test2/23_converted.avif":Wl,"/src/assets/image/test2/94_converted.avif":Vl,"/src/assets/image/test2/back.avif":Es,"/src/assets/image/test3/11233 copy.avif":Hl,"/src/assets/image/test3/11233.avif":Nl,"/src/assets/image/test3/12300 copy.avif":jl,"/src/assets/image/test3/12300.avif":ql,"/src/assets/image/test3/123001 copy.avif":Yl,"/src/assets/image/test3/123001.avif":Xl,"/src/assets/image/test3/21888 copy.avif":Ql,"/src/assets/image/test3/21888.avif":Kl,"/src/assets/image/test3/44422 copy.avif":Zl,"/src/assets/image/test3/44422.avif":Jl,"/src/assets/image/test3/444334 copy.avif":$l,"/src/assets/image/test3/444334.avif":eu,"/src/assets/image/test3/444411 copy.avif":tu,"/src/assets/image/test3/444411.avif":nu,"/src/assets/image/test3/55111 copy.avif":ou,"/src/assets/image/test3/55111.avif":ru,"/src/assets/image/test3/55544 copy.avif":au,"/src/assets/image/test3/55544.avif":su,"/src/assets/image/test3/88189 copy.avif":iu,"/src/assets/image/test3/88189.avif":cu,"/src/assets/image/test3/909394 copy.avif":lu,"/src/assets/image/test3/909394.avif":uu,"/src/assets/image/test3/923999 copy.avif":fu,"/src/assets/image/test3/923999.avif":du,"/src/assets/image/test3/9995 copy.avif":hu,"/src/assets/image/test3/9995.avif":pu,"/src/assets/image/test3/asdf.avif":mu,"/src/assets/image/test3/back.avif":Bs}),yu=Object.assign({"/src/assets/image/test0/back.avif":Ds,"/src/assets/image/test1/back.avif":Ps,"/src/assets/image/test2/back.avif":Es,"/src/assets/image/test3/back.avif":Bs}),Ca=new Map;async function Dn(o,t){const r=Ca.get(o);if(r)return r;const l=gu(o),n=[];for(const[h,m]of Object.entries(vu)){const g=h.split("/"),b=g[g.length-2],v=g[g.length-1].toLowerCase();b===l&&!v.startsWith("back.")&&n.push(m)}n.sort((h,m)=>{const g=h.split("/").pop()??h,b=m.split("/").pop()??m;return g.localeCompare(b,void 0,{numeric:!0,sensitivity:"base"})});let e=null;for(const[h,m]of Object.entries(yu)){const g=h.split("/");if(g[g.length-2]===l){e=m;break}}e||(e=Er);const a=n.length+1;let c=0;const s=()=>t?.(++c,a),i=await Ma(e).catch(()=>null);s();const u=i?Sa(i):new Rr,f=[];for(const h of n)try{const m=await Ma(h),g=Math.max((m.naturalWidth||1)/Math.max(m.naturalHeight||1,1),.05);f.push({url:h,texture:Sa(m),aspect:g,widthPx:m.naturalWidth||0,heightPx:m.naturalHeight||0})}catch{}finally{s()}const d={id:o,folder:l,fronts:f,back:u};return Ca.set(o,d),d}async function wu(o,t={}){const{THREE:r,scene:l}=o,n=t.autoReveal!==!1,e=t.startButtonId??"boot-start",a=document.getElementById("boot"),c=document.getElementById("viewport"),s=document.getElementById("bootPercent"),i=document.getElementById(e);!n&&i&&(i.disabled=!0,i.setAttribute("aria-disabled","true"));const u=M=>{const w=Math.max(0,Math.min(100,Math.round(M)));s.textContent=String(w)+"%"};let f=0,d=0;const h=r.DefaultLoadingManager;h.onStart=(M,w,A)=>{d=A||0,f=w||0},h.onProgress=(M,w,A)=>{f=w||0,d=A||0,b()},h.onLoad=()=>{f=d,b()},h.onError=M=>console.warn("[loader] error:",M);let m=0,g=0;function b(){const M=d>0?f/Math.max(1,d):0,w=g>0?m/Math.max(1,g):0,F=100*(d>0&&g>0?.5*M+.5*w:Math.max(M,w));u(F)}const v=Rn?.()??"fallback:ring",p=(async()=>Dn(v,(M,w)=>{m=M,g=w,b()}))(),[x]=await Promise.all([p]),y={};if(t.extras?.length){const M=await Promise.all(t.extras.map(async w=>await w(o)||{}));for(const w of M)Object.assign(y,w)}s.classList.add("hidden"),u(100);const _=()=>{a.classList.contains("hidden")||(a.classList.add("hidden"),c.classList.remove("hidden"),window.__APP_READY__=!0,document.dispatchEvent(new Event("appready")))};if(n)_();else if(i){(()=>{i.disabled=!1,i.removeAttribute("aria-disabled"),i.focus?.()})();const w=()=>{i.removeEventListener("click",w),i.removeEventListener("keydown",A),_()},A=F=>{(F.key==="Enter"||F.key===" ")&&(F.preventDefault(),w())};i.addEventListener("click",w,{once:!0}),i.addEventListener("keydown",A)}else console.warn(`[boot] start button id "${e}" not found; revealing automatically.`),_();return{deck:x,extras:y,reveal:_}}function gr(o,t){const r=new C().copy(st),l=o.distanceTo(r),n=t.distanceTo(r),e=new C().subVectors(r,o).normalize(),a=new C().subVectors(r,t).normalize(),c=Math.min(1,.45*l),s=Math.min(1,.15*n),i=new C().copy(o).addScaledVector(e,c),u=new C().copy(t).addScaledVector(a,s),f=.12*(l+n);return i.y+=f*.25,u.y+=f*.1,{p0:o.clone(),p1:i,p2:u,p3:t.clone()}}function Is(o,t){const r=new cn;return r.position.set(0,0,-t),o.add(r),r}function Os(o,t){o.updateWorldMatrix(!0,!1),o.attach(t),t.position.set(0,0,0),t.quaternion.identity()}function Or(o,t){const r=De.degToRad(o.fov),l=2*Math.tan(r/2)*t;return{viewW:l*o.aspect,viewH:l}}function bu(o){return Math.max(.05,(o.cardWidth??tt)/tt)}function Aa(o,t,r,l,n){const{viewW:e,viewH:a}=Or(t,r),c=bu(o),s=a*l/tt,i=e*l/(tt*c);return n==="height"?s:Math.min(s,i)}const zs=o=>o<.5?4*o*o*o:1-Math.pow(-2*o+2,3)/2;function _u(o,t,r,l,n,e=new C){const a=1-n,c=a*a*a,s=3*a*a*n,i=3*a*n*n,u=n*n*n;return e.set(0,0,0).addScaledVector(o,c).addScaledVector(t,s).addScaledVector(r,i).addScaledVector(l,u)}function Gs(o,t,r){t.t+=r;const l=Math.min(1,t.t/Math.max(1e-6,t.dur)),n=zs(l),e=_u(t.curve.p0,t.curve.p1,t.curve.p2,t.curve.p3,n),a=new je().copy(t.fromQuat).slerp(t.toQuat,n),c=De.lerp(t.fromScale,t.toScale,n);return o.position.copy(e),o.quaternion.copy(a),o.scale.setScalar(c),l>=1}const vr=new Set,xu=new Set;function Su(o){for(const t of vr)t(o)}function Mu(o){for(const t of xu)t(o)}function Cu(o){return vr.add(o),()=>vr.delete(o)}function Au({camera:o,scene:t,renderer:r,system:l,options:n={}}){const e={distance:n.distance??.8,margin:n.margin??1,fitMode:n.fitMode??"contain",animDur:n.animDur??1.2},a=new Set,c=Is(o,e.distance),s=v=>v.getWorldPosition(new C),i=v=>v.getWorldQuaternion(new je);function u(v,p,x,y,_,M){const w=i(v.group),A=v.group.scale.x;v._anim={t:0,dur:_,curve:p,fromQuat:w,toQuat:x.clone(),fromScale:A,toScale:y},v._onAnimDone=M,a.add(v)}function f(v){if(a.size)for(const p of Array.from(a)){const x=p._anim;if(!x){a.delete(p);continue}p.group.parent!==t&&t.add(p.group);const y=Gs(p.group,x,v);if(p.trail.visible=!0,to(p,v,!0,o),y){a.delete(p),p._anim=void 0;const _=p._onAnimDone;p._onAnimDone=void 0,_?.()}}}function d(v){if(bt.isModalActive())return;Su(v),v._preFocusQuat=i(v.group).clone(),v.velocity.set(0,0,0),v.angular.set(0,0,0),v.state="homing",v.opacity=1,v.mode="focus_in";const p=s(v.group),x=o.getWorldPosition(new C),y=o.getWorldDirection(new C),_=x.clone().add(y.multiplyScalar(e.distance)),M=o.getWorldQuaternion(new je),w=Aa(v,o,e.distance,e.margin,e.fitMode),A=gr(p,_);v.trail.visible=!0,u(v,A,M,w,e.animDur,()=>{Os(c,v.group),v.group.scale.setScalar(w),v.mode="focused",to(v,0,!1,o)})}function h(v){Mu(v);const p=s(v.group),x=i(v.group),y=v.group.scale.x;v.group.parent!==t&&(t.add(v.group),v.group.position.copy(p),v.group.quaternion.copy(x),v.group.scale.setScalar(y));const _=fo(v.targetLocal);v.mode="focus_out",v.trail.visible=!0;const M=gr(p,_),w=v._preFocusQuat?.clone()??x.clone();u(v,M,w,ht(),e.animDur,()=>{v.mode="normal",v.state="homing",v.velocity.set(0,0,0),v.angular.set(0,0,0)})}function m(v){if(!bt.isModalActive())if(v.mode==="focused"||v.mode==="focus_in")h(v);else{for(const p of l.cards)p!==v&&(p.mode==="focused"||p.mode==="focus_in")&&h(p);d(v)}}function g(){for(const v of l.cards)if(v._anim=void 0,v._onAnimDone=void 0,v.mode&&v.mode!=="normal"){const p=s(v.group),x=i(v.group),y=v.group.scale.x;v.group.parent!==t&&t.add(v.group),v.group.position.copy(p),v.group.quaternion.copy(x),v.group.scale.setScalar(y),v.mode="normal",v.state="homing",v.velocity.set(0,0,0),v.angular.set(0,0,0)}}const b=()=>{for(const v of l.cards)if(v.mode==="focused"&&!v._anim){const p=Aa(v,o,e.distance,e.margin,e.fitMode);v.group.scale.setScalar(p)}};return window.addEventListener("resize",b),{update(v){for(const p of l.cards)p.mode==="focused"&&!p._anim&&p.trail.visible&&to(p,v,!1,o);f(v)},clear:g,dispose(){window.removeEventListener("resize",b),g(),c.parent&&c.parent.remove(c)},focus:d,release:h,toggle:m}}function Tu({camera:o,renderer:t,system:r,onCardClick:l}){const n=new fs,e=new te,a=new Map;let c=null;function s(x,y,_=0){return a.set(x,{onClick:y,priority:_}),()=>a.delete(x)}function i(x,y){c={root:x,onOutsideClick:y}}function u(x){c&&(!x||c.root===x)&&(c=null)}function f(x){let y=x;for(;y;){const _=r.cards.find(M=>M.group===y);if(_)return _;y=y.parent}return null}function d(x,y){const _=t.domElement.getBoundingClientRect();e.set((x-_.left)/_.width*2-1,-((y-_.top)/_.height)*2+1)}function h(x,y){d(x,y),n.setFromCamera(e,o);const _=Array.from(a.keys()),M=r.cards.map(w=>w.group);return n.intersectObjects([..._,...M],!0)}function m(x){let y=null;for(const _ of x){let M=_.object;for(;M;){const w=a.get(M);if(w){const A={entry:w,hit:_,distance:_.distance};(!y||w.priority>y.entry.priority||w.priority===y.entry.priority&&_.distance<y.distance)&&(y=A);break}M=M.parent}}return y?(y.entry.onClick(y.hit),!0):!1}function g(x){for(const y of x){const _=f(y.object);if(_)return l(_),!0}return!1}function b(x){const y=h(x.clientX,x.clientY);if(!y.length){bt.isModalActive()&&c&&c.onOutsideClick();return}if(bt.isModalActive()&&c){if(y.find(M=>{let w=M.object;for(;w;){if(w===c.root)return!0;w=w.parent}return!1})){m(y);return}c.onOutsideClick();return}m(y)||g(y)}t.domElement.addEventListener("click",b);function v(){t.domElement.removeEventListener("click",b),a.clear(),c=null}function p(x,y){const _=h(x,y);if(!_.length)return null;let M=null;for(const w of _){let A=w.object;for(;A;){const F=a.get(A);if(F){const k={entry:F,hit:w,distance:w.distance};(!M||F.priority>M.entry.priority||F.priority===M.entry.priority&&w.distance<M.distance)&&(M=k);break}A=A.parent}}if(M)return{type:"registered",hit:M.hit,handler:M.entry.onClick};for(const w of _){const A=f(w.object);if(A)return{type:"card",hit:w,card:A}}return null}return{register:s,dispose:v,pick:p,setModalOverlay:i,clearModalOverlay:u}}const bt=(()=>{let o=null;return{enableModal(t){o=t},disableModal(t){o===t&&(o=null)},isModalActive(){return o!==null},who(){return o}}})();function ku({camera:o,scene:t,renderer:r,system:l}){const n=Au({camera:o,scene:t,renderer:r,system:l,options:{distance:.8,margin:.65,fitMode:"contain",animDur:.75}}),e=Tu({camera:o,renderer:r,system:l,onCardClick:s=>{bt.isModalActive()||n.toggle(s)}});function a(s,i){n.clear?.(),bt.enableModal("infoCard"),e.setModalOverlay?.(s,i)}function c(s){e.clearModalOverlay?.(s),bt.disableModal("infoCard")}return{update(s){n.update(s)},clear(){n.clear()},dispose(){e.dispose(),n.dispose()},registerObject(s,i,u=0){return e.register(s,()=>i(),u)},startModal:a,endModal:c,_focus:n}}function Fu(o,t=200){let r=null;return{system:{id:"io.interactions",priority:t,init(n){const e=ku({camera:n.camera,scene:n.scene,renderer:n.renderer,system:o?.getSystem?.()});r={update:c=>e.update?.(c),registerObject:(c,s)=>e.registerObject?.(c,s)??(()=>{}),startModal:e.startModal?(c,s)=>e.startModal(c,s):()=>{},endModal:e.endModal?c=>e.endModal(c):()=>{},clear:e.clear?()=>e.clear():()=>{}}},update(n){r?.update(n)},dispose(){r=null}},get:()=>r}}function Uu(o){const{system:t,getDeckLength:r,camera:l,morphDuration:n=.75}=o;let e=null;function a(){const u=Math.max(0,r()|0),f=Rs(u),d=e??f??t.cards.length;return Math.max(0,Math.min(d|0,u|0))}function c(){const u=a(),f=t.cards.length|0;return u===f?!1:(t.ensureCardCount(u),!0)}function s(){t.prepareHeartTargets?.()}function i(){t.morphToNewTargets?.(l,{duration:n})}return{sync(u){const f=c();return s(),u?.morph&&i(),f},setManualCount(u){e=u,c(),s(),i()},onPatternChanged(){c(),s(),i()},getManualCount(){return e},getDesiredCount(){return a()}}}function Kn(o){return o<.5?4*o*o*o:1-Math.pow(-2*o+2,3)/2}function Ta(o,t,r,l){return o<=t?0:o>=r?1:l((o-t)/Math.max(1e-9,r-t))}class Lu{N=0;u;v;theta0;R;omega;gP0;gV0;gP1;gV1;gDur;dP0;dV0;dP1;dV1;dDur;alpha;isNew;isRemove;seedR;seedSp;seedWag;seedBank;seedPulse;pulsePhase;center=new C;tGather=0;tOrbit=0;tDeal=0;alloc(t){const r=l=>new Float32Array(l*3);this.N=t,this.u=r(t),this.v=r(t),this.theta0=new Float32Array(t),this.R=new Float32Array(t),this.omega=new Float32Array(t),this.gP0=r(t),this.gV0=r(t),this.gP1=r(t),this.gV1=r(t),this.gDur=new Float32Array(t),this.dP0=r(t),this.dV0=r(t),this.dP1=r(t),this.dV1=r(t),this.dDur=new Float32Array(t),this.alpha=new Float32Array(t),this.isNew=new Uint8Array(t),this.isRemove=new Uint8Array(t),this.seedR=new Float32Array(t),this.seedSp=new Float32Array(t),this.seedWag=new Float32Array(t),this.seedBank=new Float32Array(t),this.seedPulse=new Float32Array(t),this.pulsePhase=new Float32Array(t),this.tGather=0,this.tOrbit=0,this.tDeal=0}ensure(t){this.alloc(t),this.isNew.fill(0),this.isRemove.fill(0),this.alpha.fill(1),this.tGather=0,this.tOrbit=0,this.tDeal=0}get3(t,r,l=new C){const n=r*3;return l.set(t[n],t[n+1],t[n+2])}set3(t,r,l){const n=r*3;t[n]=l.x,t[n+1]=l.y,t[n+2]=l.z}}const Ws=.2,Vs=.015,ka=300,Ru=500,Du=50,Ot=.1,Fa=.5,Pu=.3,Eu=.1,Bu=1,St={rAmp:.8,rFreq:.18,speedAmp:.15,speedFreq:.12,wagAmp:.08,wagFreq:.27,bankAmp:.25,bankFreq:.2,pulseAmp:.035,pulseFreq:.35},No=o=>Math.max(0,Math.min(1,o)),Ye={v0:new C,v1:new C,v2:new C,v3:new C,v4:new C,v5:new C,q0:new je,q1:new je},Iu=.5*(Math.sqrt(3)-1),Sn=(3-Math.sqrt(3))/6,Ou=1/3,Mt=1/6,zu=(Math.sqrt(5)-1)/4,nt=(5-Math.sqrt(5))/20,$e=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),Ze=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);class _o{constructor(t=Math.random){const r=typeof t=="function"?t:Wu(t);this.p=Gu(r),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let l=0;l<512;l++)this.perm[l]=this.p[l&255],this.permMod12[l]=this.perm[l]%12}noise2D(t,r){const l=this.permMod12,n=this.perm;let e=0,a=0,c=0;const s=(t+r)*Iu,i=Math.floor(t+s),u=Math.floor(r+s),f=(i+u)*Sn,d=i-f,h=u-f,m=t-d,g=r-h;let b,v;m>g?(b=1,v=0):(b=0,v=1);const p=m-b+Sn,x=g-v+Sn,y=m-1+2*Sn,_=g-1+2*Sn,M=i&255,w=u&255;let A=.5-m*m-g*g;if(A>=0){const D=l[M+n[w]]*3;A*=A,e=A*A*($e[D]*m+$e[D+1]*g)}let F=.5-p*p-x*x;if(F>=0){const D=l[M+b+n[w+v]]*3;F*=F,a=F*F*($e[D]*p+$e[D+1]*x)}let k=.5-y*y-_*_;if(k>=0){const D=l[M+1+n[w+1]]*3;k*=k,c=k*k*($e[D]*y+$e[D+1]*_)}return 70*(e+a+c)}noise3D(t,r,l){const n=this.permMod12,e=this.perm;let a,c,s,i;const u=(t+r+l)*Ou,f=Math.floor(t+u),d=Math.floor(r+u),h=Math.floor(l+u),m=(f+d+h)*Mt,g=f-m,b=d-m,v=h-m,p=t-g,x=r-b,y=l-v;let _,M,w,A,F,k;p>=x?x>=y?(_=1,M=0,w=0,A=1,F=1,k=0):p>=y?(_=1,M=0,w=0,A=1,F=0,k=1):(_=0,M=0,w=1,A=1,F=0,k=1):x<y?(_=0,M=0,w=1,A=0,F=1,k=1):p<y?(_=0,M=1,w=0,A=0,F=1,k=1):(_=0,M=1,w=0,A=1,F=1,k=0);const D=p-_+Mt,T=x-M+Mt,R=y-w+Mt,U=p-A+2*Mt,H=x-F+2*Mt,G=y-k+2*Mt,X=p-1+3*Mt,V=x-1+3*Mt,P=y-1+3*Mt,O=f&255,S=d&255,L=h&255;let I=.6-p*p-x*x-y*y;if(I<0)a=0;else{const z=n[O+e[S+e[L]]]*3;I*=I,a=I*I*($e[z]*p+$e[z+1]*x+$e[z+2]*y)}let B=.6-D*D-T*T-R*R;if(B<0)c=0;else{const z=n[O+_+e[S+M+e[L+w]]]*3;B*=B,c=B*B*($e[z]*D+$e[z+1]*T+$e[z+2]*R)}let E=.6-U*U-H*H-G*G;if(E<0)s=0;else{const z=n[O+A+e[S+F+e[L+k]]]*3;E*=E,s=E*E*($e[z]*U+$e[z+1]*H+$e[z+2]*G)}let q=.6-X*X-V*V-P*P;if(q<0)i=0;else{const z=n[O+1+e[S+1+e[L+1]]]*3;q*=q,i=q*q*($e[z]*X+$e[z+1]*V+$e[z+2]*P)}return 32*(a+c+s+i)}noise4D(t,r,l,n){const e=this.perm;let a,c,s,i,u;const f=(t+r+l+n)*zu,d=Math.floor(t+f),h=Math.floor(r+f),m=Math.floor(l+f),g=Math.floor(n+f),b=(d+h+m+g)*nt,v=d-b,p=h-b,x=m-b,y=g-b,_=t-v,M=r-p,w=l-x,A=n-y;let F=0,k=0,D=0,T=0;_>M?F++:k++,_>w?F++:D++,_>A?F++:T++,M>w?k++:D++,M>A?k++:T++,w>A?D++:T++;const R=F>=3?1:0,U=k>=3?1:0,H=D>=3?1:0,G=T>=3?1:0,X=F>=2?1:0,V=k>=2?1:0,P=D>=2?1:0,O=T>=2?1:0,S=F>=1?1:0,L=k>=1?1:0,I=D>=1?1:0,B=T>=1?1:0,E=_-R+nt,q=M-U+nt,z=w-H+nt,Y=A-G+nt,ue=_-X+2*nt,ie=M-V+2*nt,ne=w-P+2*nt,Z=A-O+2*nt,Ce=_-S+3*nt,ve=M-L+3*nt,re=w-I+3*nt,he=A-B+3*nt,de=_-1+4*nt,$=M-1+4*nt,ae=w-1+4*nt,W=A-1+4*nt,j=d&255,N=h&255,oe=m&255,K=g&255;let J=.6-_*_-M*M-w*w-A*A;if(J<0)a=0;else{const fe=e[j+e[N+e[oe+e[K]]]]%32*4;J*=J,a=J*J*(Ze[fe]*_+Ze[fe+1]*M+Ze[fe+2]*w+Ze[fe+3]*A)}let we=.6-E*E-q*q-z*z-Y*Y;if(we<0)c=0;else{const fe=e[j+R+e[N+U+e[oe+H+e[K+G]]]]%32*4;we*=we,c=we*we*(Ze[fe]*E+Ze[fe+1]*q+Ze[fe+2]*z+Ze[fe+3]*Y)}let pe=.6-ue*ue-ie*ie-ne*ne-Z*Z;if(pe<0)s=0;else{const fe=e[j+X+e[N+V+e[oe+P+e[K+O]]]]%32*4;pe*=pe,s=pe*pe*(Ze[fe]*ue+Ze[fe+1]*ie+Ze[fe+2]*ne+Ze[fe+3]*Z)}let me=.6-Ce*Ce-ve*ve-re*re-he*he;if(me<0)i=0;else{const fe=e[j+S+e[N+L+e[oe+I+e[K+B]]]]%32*4;me*=me,i=me*me*(Ze[fe]*Ce+Ze[fe+1]*ve+Ze[fe+2]*re+Ze[fe+3]*he)}let ce=.6-de*de-$*$-ae*ae-W*W;if(ce<0)u=0;else{const fe=e[j+1+e[N+1+e[oe+1+e[K+1]]]]%32*4;ce*=ce,u=ce*ce*(Ze[fe]*de+Ze[fe+1]*$+Ze[fe+2]*ae+Ze[fe+3]*W)}return 27*(a+c+s+i+u)}}function Gu(o){const t=new Uint8Array(256);for(let r=0;r<256;r++)t[r]=r;for(let r=0;r<255;r++){const l=r+~~(o()*(256-r)),n=t[r];t[r]=t[l],t[l]=n}return t}function Wu(o){let t=0,r=0,l=0,n=1;const e=Vu();return t=e(" "),r=e(" "),l=e(" "),t-=e(o),t<0&&(t+=1),r-=e(o),r<0&&(r+=1),l-=e(o),l<0&&(l+=1),function(){const a=2091639*t+n*23283064365386963e-26;return t=r,r=l,l=a-(n=a|0)}}function Vu(){let o=4022871197;return function(t){t=t.toString();for(let r=0;r<t.length;r++){o+=t.charCodeAt(r);let l=.02519603282416938*o;o=l>>>0,l-=o,l*=o,o=l>>>0,l-=o,o+=l*4294967296}return(o>>>0)*23283064365386963e-26}}const Hu=new _o("orbit-2595");function no(o,t){return Hu.noise2D(o,t)}function Nu(o,t){return .5+.5*no(o,t)}function Ft(o){let t=(o>>>0)*2654435761;return t^=t<<13,t^=t>>>17,t^=t<<5,(t>>>0)%268435455/268435455}function ju(o,t){const r=(1+Math.sqrt(5))*.5,l=2*Math.PI*(o/r),n=1-(2*o+1)/t,e=Math.sqrt(Math.max(0,1-n*n));return new C(e*Math.cos(l),n,e*Math.sin(l)).normalize()}function Hs(o){const t=Math.abs(o.y)<.9?new C(0,1,0):new C(1,0,0),r=new C().crossVectors(t,o).normalize(),l=new C().crossVectors(o,r).normalize();return{u:r,v:l}}function ho(o,t,r){const l=new je().setFromAxisAngle(t,r);return o.clone().applyQuaternion(l)}function qu(o,t){if(!(o.length<2))for(let r=0;r<Bu;r++)for(let l=0;l<o.length;l++)for(let n=l+1;n<o.length;n++){const e=o[l],a=o[n],c=De.clamp(e.dot(a),-1,1),s=Math.acos(c);if(s<t){const i=new C().crossVectors(e,a);if(i.lengthSq()<1e-8){const f=Hs(e).u;i.copy(f)}else i.normalize();const u=(t-s)*.5;o[l].copy(ho(e,i,-u)).normalize(),o[n].copy(ho(a,i,+u)).normalize()}}}function Ua(o){const t=[];for(let s=0;s<o;s++)t.push(ju(s,Math.max(1,o)));qu(t,De.degToRad(Eu));const r=new Array(o),l=new Array(o),n=new Array(o),e=new Float32Array(o),a=new Float32Array(o),c=new Float32Array(o);for(let s=0;s<o;s++){const i=t[s],{u,v:f}=Hs(i),d=(Ft(s+71)-.5)*Math.PI,h=ho(u,i,d),m=ho(f,i,d),g=i.dot(h),b=i.dot(m),v=Math.atan2(b,g),p=Ft(s)<.5?-1:1,x=(19+3*(Ft(s+17)-.5))*p,y=Ws+Vs+Pu*(Ft(s+33)-.5),M=m.clone().multiplyScalar(Math.cos(v)).addScaledVector(h,-Math.sin(v)).normalize().multiplyScalar(Math.sign(x)||1);r[s]=h,l[s]=m,e[s]=v,a[s]=y,c[s]=x,n[s]=M}return{u:r,v:l,theta0:e,R:a,omega:c,tMoveDir:n}}function jo(o,t){const l=o.clone().normalize(),n=new C().crossVectors(t,l).normalize(),e=new C().crossVectors(l,n).normalize(),a=new _t().makeBasis(n,e,l);return new je().setFromRotationMatrix(a)}function en(o,t){const r=De.clamp(t,0,1);o.traverse(l=>{if(!l?.isMesh)return;const n=Array.isArray(l.material)?l.material:[l.material];for(const e of n)e&&typeof e.opacity=="number"&&(e.opacity=r,"depthWrite"in e&&(e.depthWrite=r>=.999),e.needsUpdate=!1)})}function La(o,t,r,l,n,e=new C){const a=n*n,c=a*n,s=2*c-3*a+1,i=c-2*a+n,u=-2*c+3*a,f=c-a;return e.copy(o).multiplyScalar(s).addScaledVector(t,i).addScaledVector(r,u).addScaledVector(l,f)}function qo(o,t){return Math.min(o.N,t.length)}function Yu(o){const t=Math.max(200,Du),r=new Lu;let l=new Set,n=new Set;function e(a){r.seedR[a]=Ft(a+101)*100+2,r.seedSp[a]=Ft(a+102)*100+3,r.seedWag[a]=Ft(a+103)*100+4,r.seedBank[a]=Ft(a+104)*100+5,r.seedPulse[a]=Ft(a+105)*Math.PI*2,r.pulsePhase[a]=r.seedPulse[a]}return{name:"orbit-sphere-SoA",preallocate(a){r.ensure(Math.max(0,a|0))},beginGather(a){Tn(!0);const c=a.cards(),s=c.length;r.ensure(s),r.center.copy(st);const i=Ua(s);for(let u=0;u<s;u++){const f=c[u];if(!f)continue;f.mode="transition",f.trail.visible=!1,r.u.set([i.u[u].x,i.u[u].y,i.u[u].z],u*3),r.v.set([i.v[u].x,i.v[u].y,i.v[u].z],u*3),r.theta0[u]=i.theta0[u],r.R[u]=i.R[u],r.omega[u]=i.omega[u];const d=i.u[u],h=i.v[u],m=i.theta0[u],g=i.R[u],b=new C().copy(r.center).addScaledVector(d,Math.cos(m)*g).addScaledVector(h,Math.sin(m)*g),p=h.clone().multiplyScalar(Math.cos(m)).addScaledVector(d,-Math.sin(m)).normalize().multiplyScalar(Math.sign(i.omega[u])||1),x=f.group.getWorldPosition(new C),y=x.distanceTo(b),_=De.clamp(.35*y,.15*g,.6*g),A=b.clone().addScaledVector(p,-_).clone().sub(x).normalize().lerp(p,.6).normalize(),F=p.clone().multiplyScalar(Math.abs(i.omega[u])*g),k=A.multiplyScalar(F.length()*.9);r.gDur[u]=ka/1e3,r.set3(r.gP0,u,x),r.set3(r.gP1,u,b),r.set3(r.gV0,u,k),r.set3(r.gV1,u,F),f.group.scale.setScalar(ht()),en(f.group,1),e(u),r.isNew[u]=0,r.isRemove[u]=0,r.alpha[u]=1}l.clear(),n.clear(),r.tGather=0},updateGather(a,c){r.tGather+=c;const s=a.cards(),i=qo(r,s);if(i===0)return!0;for(let u=0;u<i;u++){const f=s[u];if(!f)continue;const d=Math.max(1e-6,r.gDur[u]),h=No(Math.min(1,r.tGather/d)),m=r.get3(r.gP0,u,Ye.v0),g=r.get3(r.gP1,u,Ye.v1),b=r.get3(r.gV0,u,Ye.v2),v=r.get3(r.gV1,u,Ye.v3),p=La(m,b,g,v,h,Ye.v0);f.group.position.copy(p);const x=v.clone().normalize();Ye.q0.copy(f.group.quaternion),Ye.q1.copy(jo(new C().subVectors(r.center,p),x)),f.group.quaternion.copy(Ye.q0.slerp(Ye.q1,h)),f.group.scale.setScalar(ht());const y=De.lerp(1,Ot,Kn(h));Math.abs(y-r.alpha[u])>.001&&(en(f.group,y),r.alpha[u]=y)}return r.tGather>=ka/1e3},beginShuffle(a){const c=a.cards().length|0,s=Math.max(0,a.targetCount|0);if(l.clear(),n.clear(),s<c){const d=c-s,h=a.cards();for(let m=0;m<d;m++){const g=h[h.length-1-m];g&&l.add(g)}}else s>c&&a.system.ensureCardCount(s,{quiet:!0});const i=a.cards(),u=i.length,f=Ua(u);for(let d=c;d<u;d++){const h=i[d];h&&n.add(h)}r.ensure(u),r.center.copy(st);for(let d=0;d<u;d++){const h=i[d];h&&(h.mode="transition",h.trail.visible=!1,r.u.set([f.u[d].x,f.u[d].y,f.u[d].z],d*3),r.v.set([f.v[d].x,f.v[d].y,f.v[d].z],d*3),r.theta0[d]=f.theta0[d],r.R[d]=f.R[d],r.omega[d]=f.omega[d],e(d),n.has(h)?(r.isNew[d]=1,r.alpha[d]=0,en(h.group,0)):(r.isNew[d]=0,r.alpha[d]=Ot,en(h.group,Ot)),r.isRemove[d]=l.has(h)?1:0,h.group.scale.setScalar(ht()))}r.tOrbit=0},updateShuffle(a,c){r.tOrbit+=c;const s=t/1e3,i=No(r.tOrbit/s),u=a.cards(),f=qo(r,u);if(f===0)return!0;for(let h=0;h<f;h++){const m=u[h];if(!m)continue;const g=r.get3(r.u,h,Ye.v0),b=r.get3(r.v,h,Ye.v1),v=Ye.v4.copy(g).cross(b).normalize(),p=r.R[h],x=r.theta0[h],y=r.omega[h],_=r.tOrbit,M=St.rAmp*no(r.seedR[h],St.rFreq*_),w=Math.max(Ws+Vs*.5,p*(1+M)),A=1+St.speedAmp*no(r.seedSp[h],St.speedFreq*_),F=x+y*A*_,k=new C().copy(r.center).addScaledVector(g,Math.cos(F)*w).addScaledVector(b,Math.sin(F)*w),D=St.wagAmp*no(r.seedWag[h],St.wagFreq*_);k.addScaledVector(v,D);const R=Ye.v5.copy(b).multiplyScalar(Math.cos(F)).addScaledVector(g,-Math.sin(F)).normalize().multiplyScalar(Math.sign(y)||1),U=St.bankAmp*Nu(r.seedBank[h],St.bankFreq*_),H=R.clone().multiplyScalar(1-U).addScaledVector(v,U).normalize();m.group.position.copy(k),m.group.quaternion.copy(jo(new C().subVectors(r.center,k),H));const G=1+St.pulseAmp*Math.sin(2*Math.PI*St.pulseFreq*_+r.pulsePhase[h]);m.group.scale.setScalar(ht()*G);let X=Ot;if(r.isRemove[h]){const V=Ta(i,1-Fa,1,Kn);X=Ot*(1-V)}else if(r.isNew[h]){const V=Ta(i,0,Fa,Kn);X=Ot*V}Math.abs(X-r.alpha[h])>.001&&(en(m.group,X),r.alpha[h]=X)}const d=i>=1;return d&&l.size&&a.system.ensureCardCount(a.targetCount,{quiet:!0}),d},beginDeal(a){const c=a.cards(),s=c.length;r.tDeal=0,a.system.prepareHeartTargets?.(),a.applyImmediateFit?.(),a.system.prepareHeartTargets?.(),r.N;for(let i=0;i<s;i++){const u=c[i];if(!u)continue;const f=r.get3(r.u,i,Ye.v0),d=r.get3(r.v,i,Ye.v1),h=r.omega[i],m=r.R[i],g=u.group.getWorldPosition(Ye.v0),b=g.clone().sub(r.center).normalize(),v=b.dot(f),p=b.dot(d),x=Math.atan2(p,v),M=d.clone().multiplyScalar(Math.cos(x)).addScaledVector(f,-Math.sin(x)).normalize().multiplyScalar(Math.sign(h)||1).clone().multiplyScalar(Math.abs(h)*m),w=mr(u.targetLocal.clone());r.set3(r.dP0,i,g),r.set3(r.dV0,i,M),r.set3(r.dP1,i,w),r.set3(r.dV1,i,new C(0,0,0)),r.dDur[i]=Ru/1e3,u.trail.visible=!0,u.trail.material.opacity=.85}},updateDeal(a,c){r.tDeal+=c;const s=a.cards(),i=qo(r,s);if(i===0)return Tn(!1),!0;let u=!0;for(let f=0;f<i;f++){const d=s[f];if(!d)continue;const h=No(r.tDeal/Math.max(1e-6,r.dDur[f])),m=h,g=r.get3(r.dP0,f,Ye.v0),b=r.get3(r.dV0,f,Ye.v1),v=r.get3(r.dP1,f,Ye.v2),p=r.get3(r.dV1,f,Ye.v3),x=La(g,b,v,p,m,Ye.v0);d.group.position.copy(x),Ye.q0.copy(d.group.quaternion),Ye.q1.copy(jo(new C().subVectors(st,x),new C(0,1,0))),d.group.quaternion.copy(Ye.q0.slerp(Ye.q1,m)),d.group.scale.setScalar(ht());const y=De.lerp(Ot,1,Kn(h));Math.abs(y-r.alpha[f])>.001&&(en(d.group,y),r.alpha[f]=y),h<1&&(u=!1)}if(u){for(const f of a.cards())f.mode="normal",f.trail.material.opacity=.65,f.trail.visible=!0;Tn(!1)}return u}}}function Xu(o){const{system:t,camera:r,getDeckLength:l,applyImmediateFit:n}=o,e=o.strategy??Yu();let a="idle",c=new WeakMap,s=null;const i=new C,u=new je;function f(){i.copy(st);const m=new je().setFromAxisAngle(new C(0,1,0),Math.PI);u.copy(r.quaternion).multiply(m)}function d(m){return{system:t,camera:r,deckLen:Math.max(0,l()|0),targetCount:m,deckAnchor:i,deckQuat:u,cards:()=>t.cards,markRemoving:()=>{},addNewlyAdded:()=>{},scratch:c,applyImmediateFit:n}}function h(){c=new WeakMap,s=null,a="idle"}return{isActive(){return a!=="idle"},preallocate(m){e.preallocate?.(m)},start(){if(a!=="idle")return;f();const m=Math.max(0,l()|0),g=Math.max(0,Math.min(Rs(m),m));s=d(g),Tn(!0),e.beginGather(s),a="gather"},update(m){if(s)switch(f(),a){case"gather":e.updateGather(s,m)&&(e.beginShuffle(s),a="shuffle");break;case"shuffle":e.updateShuffle(s,m)&&(e.beginDeal(s),a="deal");break;case"deal":if(e.updateDeal(s,m)){for(const g of t.cards)g.mode="normal";Tn(!1),h()}break}}}}const Qu=["TL","TR","BR","BL"],Zn=new mt({colorWrite:!1,depthWrite:!0,depthTest:!0});function Ku(o){const{radius:t=.2,tubularSegments:r=96,radialSegments:l=14,ropeSegments:n=20,gravity:e=1,damping:a=.1,stiffness:c=2,solverIters:s=6}=o||{},i=new pt;i.name="CornerConduits",i.matrixAutoUpdate=!1;const u=new ds({color:19878,transparent:!0,opacity:0,roughness:.85,metalness:.05,depthTest:!0,depthWrite:!1,side:Dr}),f={TL:new Xe(new kt,u),TR:new Xe(new kt,u),BR:new Xe(new kt,u),BL:new Xe(new kt,u)},d={TL:new Xe(f.TL.geometry,Zn),TR:new Xe(f.TR.geometry,Zn),BR:new Xe(f.BR.geometry,Zn),BL:new Xe(f.BL.geometry,Zn)};Object.values(d).forEach(w=>{w.frustumCulled=!1,i.add(w)}),Object.values(f).forEach(w=>{w.frustumCulled=!1,i.add(w)});const h={TL:{nodes:[],prev:[],rest:0,segments:n,alive:!1},TR:{nodes:[],prev:[],rest:0,segments:n,alive:!1},BR:{nodes:[],prev:[],rest:0,segments:n,alive:!1},BL:{nodes:[],prev:[],rest:0,segments:n,alive:!1}},m={TL:null,TR:null,BR:null,BL:null},g={camPos:new C,fwd:new C,up:new C,right:new C,center:new C,gVec:new C};function b(w,A,F){const k=h[w];k.nodes=[],k.prev=[],k.segments=n,k.alive=!0;for(let D=0;D<=k.segments;D++){const T=D/k.segments,R=new C().lerpVectors(A,F,T);k.nodes.push(R),k.prev.push(R.clone())}k.rest=A.distanceTo(F)/k.segments}function v(w,A,F,k,D){if(!w.alive)return;const T=w.nodes.length;if(T<2)return;w.rest=Math.max(1e-4,k.distanceTo(D)/w.segments);const R=F.x*e*A*A,U=F.y*e*A*A,H=F.z*e*A*A;for(let G=1;G<T-1;G++){const X=w.nodes[G],V=w.prev[G];if(!X||!V)continue;const P=(X.x-V.x)*(1-a),O=(X.y-V.y)*(1-a),S=(X.z-V.z)*(1-a);w.prev[G]!==void 0&&X!==void 0&&w.prev[G].copy(X),X.x+=P+R,X.y+=O+U,X.z+=S+H}w.nodes[0]!==void 0&&w.nodes[0].copy(k),w.nodes[T-1]!==void 0&&w.nodes[T-1].copy(D);for(let G=0;G<s;G++){for(let X=0;X<T-1;X++){const V=w.nodes[X],P=w.nodes[X+1];if(!V||!P)continue;const O=P.x-V.x,S=P.y-V.y,L=P.z-V.z,I=Math.sqrt(O*O+S*S+L*L)||1e-6,B=(I-w.rest)/I,E=O*.5*B*c,q=S*.5*B*c,z=L*.5*B*c;X>0&&V&&(V.x+=E,V.y+=q,V.z+=z),X+1<T-1&&P&&(P.x-=E,P.y-=q,P.z-=z)}w.nodes[0]!==void 0&&w.nodes[0].copy(k),w.nodes[T-1]!==void 0&&w.nodes[T-1].copy(D)}}function p(w,A,F){const k=w.nodes,D=new hs(k,!1,"centripetal",.5),T=new ps(D,r,F,l,!1),R=f[A],U=d[A],H=R.geometry;R.geometry=T,U.geometry=T,H.dispose()}function x(w,A){const F=r,k=l;let D=m[w];if(!D||D.tubular!==F||D.radial!==k){if(D?.lines&&(i.remove(D.lines),D.lines.geometry.dispose(),D.lines.material.dispose()),!A)return;const R=Math.max(1,Math.floor(F/(A.countU??3e4))),U=Math.max(1,Math.floor(k/(A.countV??20))),H=[];for(let B=0;B<=F;B+=R)for(let E=0;E<=k;E+=U)H.push({u:B,v:E,len:(A.length??.07)*(.85+.3*Math.random())});const G=H.length,X=new Float32Array(G*2*3),V=new et(A.baseColor??16731558),P=new et(A.tipColor??16777215),O=new Float32Array(G*2*3);for(let B=0;B<G;B++){const E=(B*2+0)*3,q=(B*2+1)*3;O.set([V.r,V.g,V.b],E),O.set([P.r,P.g,P.b],q)}const S=new kt;S.setAttribute("position",new Ln(X,3)),S.setAttribute("color",new Ln(O,3)),S.setDrawRange(0,G*2);const L=new Lr({vertexColors:!0,transparent:!0,opacity:.2,depthTest:!0,depthWrite:!1}),I=new ms(S,L);I.frustumCulled=!1,i.add(I),D={lines:I,positions:X,anchors:H,tubular:F,radial:k,simplex:new _o(String(A.seed??2595)),params:{countU:A.countU??3e4,countV:A.countV??20,length:A.length??.07,sway:A.sway??.4,speed:A.speed??.3,baseColor:V,tipColor:P,onTop:!1,opacity:.9,seed:A.seed??2595}},m[w]=D}else{const R=D.lines.material;R.opacity=.9}}function y(w,A){const F=m[w];if(!F||!F.lines||!F.positions)return;const D=f[w].geometry,T=D.getAttribute("position"),R=D.getAttribute("normal");if(!T||!R)return;const U=F.tubular,H=F.radial,G=F.positions,X=performance.now()*.001*(A?.speed??F.params.speed),V=new C(0,0,1),P=new C(1,0,0);for(let S=0;S<F.anchors.length;S++){const L=F.anchors[S];if(!L)continue;const{u:I,v:B,len:E}=L,q=Math.min(I,U),z=Math.min(B,H),Y=q*(H+1)+z,ue=T.getX(Y),ie=T.getY(Y),ne=T.getZ(Y),Z=R.getX(Y),Ce=R.getY(Y),ve=R.getZ(Y),re=new C(ue,ie,ne),he=new C(Z,Ce,ve).normalize();let de=new C().crossVectors(he,V);de.lengthSq()<1e-6&&de.crossVectors(he,P),de.normalize();const $=new C().crossVectors(he,de).normalize(),ae=F.simplex.noise4D(re.x,re.y,re.z,X),W=Math.cos(ae),j=Math.sin(ae),N=A?.sway??F.params.sway,oe=new C().addScaledVector(de,W*N).addScaledVector($,j*N),K=new C().copy(re).addScaledVector(he,E).add(oe),J=(S*2+0)*3,we=(S*2+1)*3;G[J+0]=re.x,G[J+1]=re.y,G[J+2]=re.z,G[we+0]=K.x,G[we+1]=K.y,G[we+2]=K.z}const O=F.lines.geometry;O.getAttribute("position").needsUpdate=!0}function _(w,A,F){const k=A?.cfg;k&&(k.color!==void 0&&f.TL.material.color.set(k.color),k.opacity!==void 0&&Object.values(f).forEach(S=>S.material.opacity=k.opacity));const T=k?.tubeRadius??t;g.up.set(0,1,0).applyQuaternion(w.quaternion).normalize(),g.gVec.copy(g.up).multiplyScalar(-1);let R=[];if(typeof A.getRingWorldSnapshot=="function"){const S=A.getRingWorldSnapshot();S&&Array.isArray(S.ringWorld)&&(R=S.ringWorld)}let U=1/0,H=-1/0;for(const S of R)S.x<U&&(U=S.x),S.x>H&&(H=S.x);const G=.2,X=1,V=U*1.2,P=H*1.2,O={TL:{start:new C(V-G,-2,-1),end:A.getAttachPointForCorner("TL")},TR:{start:new C(P+G,-2,-1),end:A.getAttachPointForCorner("BR")},BR:{start:new C(P,-1,X),end:A.getAttachPointForCorner("TR")},BL:{start:new C(V,-1,X),end:A.getAttachPointForCorner("BL")}};for(const S of Qu){const L=O[S],I=f[S],B=d[S];if(!L.end){const Y=new kt,ue=I.geometry;I.geometry=Y,B.geometry=Y,ue.dispose();const ie=m[S];ie?.lines&&(ie.lines.visible=!1),h[S].alive=!1;continue}(!h[S].alive||h[S].nodes.length!==n+1)&&b(S,L.start,L.end);const E=Math.max(.001,Math.min(.033,F||.016));v(h[S],E,g.gVec,L.start,L.end),p(h[S],S,T);const q={countU:k?.fur?.countU??3e4,countV:k?.fur?.countV??20,length:k?.fur?.length??.07,sway:k?.fur?.sway??.4,speed:k?.fur?.speed??.3,baseColor:k?.fur?.baseColor??16731558,tipColor:k?.fur?.tipColor??16777215,seed:k?.fur?.seed??2595};x(S,q);const z=m[S];z?.lines&&(z.lines.visible=!0),y(S,q)}i.updateMatrix()}function M(){Object.values(f).forEach(w=>w.geometry.dispose()),Object.values(d).forEach(w=>w.geometry.dispose()),Object.values(m).forEach(w=>{w?.lines&&(w.lines.geometry.dispose(),w.lines.material.dispose())})}return{group:i,update:_,dispose:M}}function Zu(){const o=new cs,r=new Si().setDecoderPath("/emptyoracle/draco/").setDecoderConfig({type:"wasm"});return o.setDRACOLoader(r),o.setMeshoptDecoder(Mi),o}async function Pn(o){const t=Zu(),r=o.substring(0,o.lastIndexOf("/")+1);t.setResourcePath(r),t.setPath("");const l=await t.loadAsync(o),n=l.scene||l.scenes?.[0];if(!n)throw new Error(`GLTF/GLB had no scene: ${o}`);return n}function yr(o,t={}){const{frustumCulled:r=!1}=t;o.traverse(l=>{l.isMesh&&(l.frustumCulled=r)})}function wr(o){const t=new cn;t.name="CenteredPivot",t.add(o);const l=new It().setFromObject(o).getCenter(new C);o.position.sub(new C(l.x,l.y,0)),t.updateMatrixWorld(!0);const n=new It().setFromObject(t),e=new C;n.getSize(e);const a=Math.max(e.x,1e-6),c=Math.max(e.y,1e-6);return{pivot:t,baseWidth:a,baseHeight:c}}function Ju(o){o&&(o.map&&"colorSpace"in o.map&&(o.map.colorSpace=it),o.emissiveMap&&"colorSpace"in o.emissiveMap&&(o.emissiveMap.colorSpace=it),[o.metalnessMap,o.roughnessMap,o.normalMap,o.aoMap].forEach(t=>{t&&"colorSpace"in t&&(t.colorSpace=Ci)}))}function Ns(o,t){return o.depthTest=!t,o.depthWrite=t?!1:o.depthWrite??!0,o}function $u(o,t,r){const l=new mt({color:o?.color?o.color.clone():new et(16777215),map:o?.map??null,transparent:t<1||!!o?.transparent,opacity:t,side:o?.side??or,alphaTest:o?.alphaTest??0,fog:!1,toneMapped:!1,vertexColors:!!o?.vertexColors});return l.map&&"colorSpace"in l.map&&(l.map.colorSpace=it),Ns(l,r)}function ef(o,t,r,l){const n=new Pr({uniforms:{map:{value:o},useMap:{value:!!o},mixStrength:{value:De.clamp(t,0,1)},opacity:{value:r}},vertexShader:`
      varying vec3 vNormal; varying vec2 vUv;
      void main(){
        vNormal = normalize(normalMatrix * normal);
        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
      }
    `,fragmentShader:`
      uniform sampler2D map; uniform bool useMap; uniform float mixStrength; uniform float opacity;
      varying vec3 vNormal; varying vec2 vUv;
      void main(){
        vec3 n = normalize(vNormal) * 0.5 + 0.5;
        vec3 tex = useMap ? texture2D(map, vUv).rgb : vec3(1.0);
        gl_FragColor = vec4(mix(tex, n, mixStrength), opacity);
      }
    `,transparent:!0});return Ns(n,l)}function tf(o,t,r,l){if(!o)return;o.transparent=t<1||!!o.transparent,o.opacity=t,r&&(o.depthTest=!1,o.depthWrite=!1,o.fog=!1,"toneMapped"in o&&(o.toneMapped=!0)),Ju(o),(o.isMeshStandardMaterial||o.isMeshPhysicalMaterial)&&l&&l.envMap&&(o.envMap=l.envMap,o.envMapIntensity=l.intensity??1),o.needsUpdate=!0}function Ra(o,t,{renderOnTop:r=!1,opacity:l=1,mixStrength:n=.5,pbrEnv:e}){o.traverse(a=>{if(!a.isMesh)return;if(t==="unlit"){a.material=$u(a.material,l,r);return}if(t==="normals"){const s=a.material?.map??null;s&&"colorSpace"in s&&(s.colorSpace=it),a.material=ef(s,n,l,r);return}const c=Array.isArray(a.material)?a.material:[a.material];c.forEach(s=>tf(s,l,r,e)),a.material=Array.isArray(a.material)?c:c[0]})}function nf(o,t){o.traverse(r=>{const l=r.material;l.depthTest=!1,l.depthWrite=!1,l&&(Array.isArray(l)?l.forEach(n=>{typeof n.opacity=="number"&&(n.transparent=!0,n.opacity=t),n.uniforms&&"opacity"in n.uniforms&&(n.uniforms.opacity.value=t)}):(typeof l.opacity=="number"&&(l.transparent=!0,l.opacity=t),l.uniforms&&"opacity"in l.uniforms&&(l.uniforms.opacity.value=t)))})}class br{constructor(t){this.alpha=t}y;initialized=!1;reset(t){this.y=t,this.initialized=!0}update(t,r){return this.initialized||this.reset(r),this.alpha=t,this.y=this.y+this.alpha*(r-this.y),this.y}}function po(o,t){return 1/(1+1/(2*Math.PI*Math.max(1e-6,t))/Math.max(1e-6,o))}class Yo{constructor(t,r,l){this.minCutoff=t,this.beta=r,this.dCutoff=l}dxLP=new br(1);xLP=new br(1);initialized=!1;xPrev=0;update(t,r){if(!this.initialized)return this.xPrev=r,this.dxLP.reset(0),this.xLP.reset(r),this.initialized=!0,r;const l=(r-this.xPrev)/Math.max(1e-6,t);this.xPrev=r;const n=po(t,this.dCutoff),e=this.dxLP.update(n,l),a=this.minCutoff+this.beta*Math.abs(e),c=po(t,a);return this.xLP.update(c,r)}}class js{constructor(t,r,l){this.minCutoff=t,this.beta=r,this.dCutoff=l,this.fx=new Yo(t,r,l),this.fy=new Yo(t,r,l),this.fz=new Yo(t,r,l)}fx;fy;fz;update(t,r,l=new C){return l.set(this.fx.update(t,r.x),this.fy.update(t,r.y),this.fz.update(t,r.z)),l}}class _r{constructor(t,r,l){this.minCutoff=t,this.beta=r,this.dCutoff=l}dLP=new br(1);initialized=!1;qFilt=new je;update(t,r,l=new je){if(!this.initialized)return this.qFilt.copy(r),this.dLP.reset(0),this.initialized=!0,l.copy(this.qFilt);const a=this.qFilt.dot(r)>=0?r:new je(-r.x,-r.y,-r.z,-r.w),c=this.qFilt.dot(a),i=2*Math.acos(De.clamp(c,-1,1))/Math.max(1e-6,t),u=po(t,this.dCutoff),f=this.dLP.update(u,i),d=this.minCutoff+this.beta*Math.abs(f),h=po(t,d);return this.qFilt.slerp(a,De.clamp(h,0,1)),l.copy(this.qFilt)}}function xr(o,t){const r=t.clone();return o&&o.dot(r)<0&&r.set(-r.x,-r.y,-r.z,-r.w),r}function Sr(o){const t=new C(1,0,0).applyQuaternion(o).normalize(),r=new C(0,1,0).applyQuaternion(o).normalize(),l=new C(0,0,1).applyQuaternion(o).normalize();return{right:t,up:r,z:l}}function Da(o){const t=new C;if(!o.length)return t;for(const r of o)t.add(r);return t.multiplyScalar(1/o.length)}function Mr(o,t,r){let l=0;const n=o.length;for(let e=0;e<n;e++){const a=o[e],c=o[(e+1)%n],s=a.dot(t),i=a.dot(r),u=c.dot(t),f=c.dot(r);l+=s*f-u*i}return .5*l}function Xo(o,t,r){return new C().crossVectors(t,o).multiplyScalar(r>0?-1:1).normalize()}function Qo(o){let t=0;for(let r=0;r<o.length;r++)t+=o[r].distanceTo(o[(r+1)%o.length]);return t}function Ko(o,t){const r=o.length,l=o[(t-1+r)%r],n=o[(t+1)%r],e=new C().subVectors(n,l);return e.lengthSq()<1e-10?new C(1,0,0):e.normalize()}function tn(o,t){let r=0,l=1/0;for(let n=0;n<o.length;n++){const e=o[n].distanceToSquared(t);e<l&&(l=e,r=n)}return r}function of(o,t,r,l){const n=o.length;if(n===0)return 0;if(l<=0)return(t%n+n)%n;const e=i=>(i%n+n)%n,c=((i,u)=>{const f=((u-i)%n+n)%n;return f>n/2?f-n:f})(r,t),s=De.clamp(c,-l,l);return e(r+s)}const rf=function(){const t=typeof document<"u"&&document.createElement("link").relList;return t&&t.supports&&t.supports("modulepreload")?"modulepreload":"preload"}(),af=function(o){return"/emptyoracle/"+o},Pa={},Zo=function(t,r,l){let n=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),c=a?.nonce||a?.getAttribute("nonce");n=Promise.allSettled(r.map(s=>{if(s=af(s),s in Pa)return;Pa[s]=!0;const i=s.endsWith(".css"),u=i?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${u}`))return;const f=document.createElement("link");if(f.rel=i?"stylesheet":rf,i||(f.as="script"),f.crossOrigin="",f.href=s,c&&f.setAttribute("nonce",c),document.head.appendChild(f),i)return new Promise((d,h)=>{f.addEventListener("load",d),f.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${s}`)))})}))}function e(a){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=a,window.dispatchEvent(c),!c.defaultPrevented)throw a}return n.then(a=>{for(const c of a||[])c.status==="rejected"&&e(c.reason);return t().catch(e)})};function sf(o){const t=o.index?o.toNonIndexed():o.clone(),r=t.attributes.position.array;let l=0;for(let n=0;n<r.length;n+=9){const e=r[n],a=r[n+1],c=r[n+2],s=r[n+3],i=r[n+4],u=r[n+5],f=r[n+6],d=r[n+7],h=r[n+8],m=s-e,g=i-a,b=u-c,v=f-e,p=d-a,x=h-c,y=g*x-b*p,_=b*v-m*x,M=m*p-g*v,w=.5*Math.sqrt(y*y+_*_+M*M);l+=w}return t.dispose(),l}async function cf(o,t,r={}){const{density:l=140,length:n,color:e=16731558,tipColor:a=16777215,intensity:c,speed:s=.5,seed:i=1337,onTop:u=!0,opacity:f=1,maxSkinnedHairs:d=3e3,mode:h="gpu"}=r,[{LineSegmentsGeometry:m},{LineSegments2:g},{LineMaterial:b}]=await Promise.all([Zo(()=>import("./three-B_POVWff.js").then(W=>W.aj),[]),Zo(()=>import("./three-B_POVWff.js").then(W=>W.al),[]),Zo(()=>import("./three-B_POVWff.js").then(W=>W.ak),[])]),v=new et(e),p=new et(a),x=[],y=[];t.traverse(W=>{W?.isSkinnedMesh?y.push(W):W?.isMesh&&W.geometry&&x.push(W)});const _=[],M=[];for(const W of x){const j=sf(W.geometry),N=Math.round(j*l);if(N<=0)continue;const oe=new Ai(W).setWeightAttribute(null).build(),K=n??.12*Math.min(new It().setFromObject(t).getSize(new C).x,new It().setFromObject(t).getSize(new C).y),J=new C,we=new C,pe=new C,me=new C,ce=new C,fe=new C;for(let Pe=0;Pe<N;Pe++){oe.sample(J,we),pe.copy(J).addScaledVector(we,K),me.copy(J),o.worldToLocal(me),ce.copy(pe),o.worldToLocal(ce),fe.copy(ce).sub(me).normalize();const Oe=new C(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),ee=new C().crossVectors(fe,Oe);ee.lengthSq()<1e-6&&ee.set(1,0,0).cross(fe),ee.normalize();const le=new C().crossVectors(fe,ee).normalize();_.push({rootLocal:me.clone(),axisLocal:fe.clone(),length:K,u:ee,v:le,rootRGB:[v.r,v.g,v.b],tipRGB:[p.r,p.g,p.b]})}}const w=new It().setFromObject(t),A=n??.12*Math.min(w.getSize(new C).x,w.getSize(new C).y);for(const W of y){const j=W.geometry,N=j.getAttribute("position"),oe=j.getAttribute("normal"),K=j.getAttribute("skinIndex"),J=j.getAttribute("skinWeight");if(!K||!J||!N)continue;const we=N.count;if(we<=0)continue;const pe=Math.max(1,Math.floor(d/Math.max(1,y.length))),me=Math.max(1,Math.floor(we/pe));for(let ce=0;ce<we;ce+=me){const fe=J.getX(ce),Pe=J.getY(ce),Oe=J.getZ(ce),ee=J.getW(ce),le=[fe,Pe,Oe,ee];let se=0;for(let ze=1;ze<4;ze++)le[ze]>le[se]&&(se=ze);const be=[K.getX(ce),K.getY(ce),K.getZ(ce),K.getW(ce)][se]|0,ke=new C().fromBufferAttribute(N,ce),Ge=ke.clone().applyMatrix4(W.bindMatrix),xe=oe?new C().fromBufferAttribute(oe,ce):new C(0,0,1),Fe=ke.clone().add(xe).applyMatrix4(W.bindMatrix).sub(Ge),Be=xe.clone().normalize(),ye=new C(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),_e=new C().crossVectors(Be,ye);_e.lengthSq()<1e-6&&_e.set(1,0,0).cross(Be),_e.normalize();const Ie=new C().crossVectors(Be,_e).normalize();M.push({mesh:W,boneIndex:be,pLocalPre:Ge,nLocalPre:Fe,length:A,u:_e,v:Ie,rootRGB:[v.r,v.g,v.b],tipRGB:[p.r,p.g,p.b]})}}const F=_.length+M.length;if(F<=0)return{object:new cn,update:()=>{},setOpacity:()=>{}};const k=new Float32Array(F*2*3),D=new Float32Array(F*2*3),T=new Float32Array(F*3),R=new Float32Array(F*3),U=new Float32Array(F*3),H=new Float32Array(F*3),G=new Float32Array(F*3),X=(W,j,N)=>{const oe=typeof i=="number"?i:(i+"").length,K=Math.sin(W*12.9898+j*78.233+(N+1)*37.719+oe*.11)*43758.5453;return(K-Math.floor(K))*Math.PI*2};let V=0;for(const W of _){const j=W.rootLocal.clone().addScaledVector(W.axisLocal,W.length),N=V*6;k[N+0]=W.rootLocal.x,k[N+1]=W.rootLocal.y,k[N+2]=W.rootLocal.z,k[N+3]=j.x,k[N+4]=j.y,k[N+5]=j.z;const oe=V*6;D[oe+0]=W.rootRGB[0],D[oe+1]=W.rootRGB[1],D[oe+2]=W.rootRGB[2],D[oe+3]=W.tipRGB[0],D[oe+4]=W.tipRGB[1],D[oe+5]=W.tipRGB[2];const K=V*3;T[K+0]=W.rootLocal.x,T[K+1]=W.rootLocal.y,T[K+2]=W.rootLocal.z,R[K+0]=W.axisLocal.x,R[K+1]=W.axisLocal.y,R[K+2]=W.axisLocal.z,U[K+0]=W.u.x,U[K+1]=W.u.y,U[K+2]=W.u.z,H[K+0]=W.v.x,H[K+1]=W.v.y,H[K+2]=W.v.z,G[K+0]=W.length,G[K+1]=c??.5*W.length,G[K+2]=X(W.rootLocal.x,W.rootLocal.y,V),V++}for(const W of M){const j=new C,N=new C(0,0,W.length),oe=V*6;k[oe+0]=j.x,k[oe+1]=j.y,k[oe+2]=j.z,k[oe+3]=N.x,k[oe+4]=N.y,k[oe+5]=N.z;const K=V*6;D[K+0]=W.rootRGB[0],D[K+1]=W.rootRGB[1],D[K+2]=W.rootRGB[2],D[K+3]=W.tipRGB[0],D[K+4]=W.tipRGB[1],D[K+5]=W.tipRGB[2];const J=V*3;T[J+0]=j.x,T[J+1]=j.y,T[J+2]=j.z,R[J+0]=0,R[J+1]=0,R[J+2]=1,U[J+0]=1,U[J+1]=0,U[J+2]=0,H[J+0]=0,H[J+1]=1,H[J+2]=0,G[J+0]=W.length,G[J+1]=c??.45*W.length,G[J+2]=X(V,W.length,V),V++}const P=new m;P.setPositions(k),P.setColors(D),h==="gpu"&&(P.setAttribute("aRoot",new on(T,3)),P.setAttribute("aAxis",new on(R,3)),P.setAttribute("aU",new on(U,3)),P.setAttribute("aV",new on(H,3)),P.setAttribute("aLenAmpPhase",new on(G,3)));const O=new b({color:16777215,vertexColors:!0,transparent:!0,depthTest:!u,depthWrite:!u,linewidth:1,opacity:f,stencilWrite:!0,stencilFunc:Ti,stencilRef:1});h==="gpu"&&(O.userData=O.userData||{},O.userData.uTime={value:0},O.userData.uSpeed={value:s},O.onBeforeCompile=W=>{W.uniforms.uTime=O.userData.uTime,W.uniforms.uSpeed=O.userData.uSpeed,W.vertexShader=W.vertexShader.replace("#include <common>",`#include <common>
attribute vec3 aRoot;
attribute vec3 aAxis;
attribute vec3 aU;
attribute vec3 aV;
attribute vec3 aLenAmpPhase;
uniform float uTime;
uniform float uSpeed;`).replace("vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );","vec3 _root = aRoot; vec3 _axis = normalize(aAxis); float _len = aLenAmpPhase.x; float _amp = aLenAmpPhase.y; float _ph = aLenAmpPhase.z; float _t = uTime * uSpeed + _ph; vec3 _sw = aU * cos(_t) + aV * sin(_t); vec3 _endL = _root + _axis * _len + _sw * _amp; vec4 start = modelViewMatrix * vec4( _root, 1.0 ); vec4 end = modelViewMatrix * vec4( _endL, 1.0 );").replace("vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );","")});const S=new g(P,O);S.frustumCulled=!1;const L=new _o(String(i)),I=W=>c??.5*W,B=W=>c??.45*W,E=P.attributes.instanceStart.array,q=P.attributes.instanceEnd.array,z=new _t,Y=new C,ue=new C,ie=new C,ne=new C,Z=new C,Ce=new _t,ve=new C,re=new C,he=new C,de=new C;function $(W){h==="gpu"&&(O.userData.uTime.value=W),Ce.copy(o.matrixWorld).invert();let j=0;if(h==="cpu")for(const N of _){const oe=L.noise4D(N.rootLocal.x,N.rootLocal.y,N.rootLocal.z,W*s),K=Math.cos(oe),J=Math.sin(oe),we=I(N.length),pe=N.u.x*K*we+N.v.x*J*we,me=N.u.y*K*we+N.v.y*J*we,ce=N.u.z*K*we+N.v.z*J*we,fe=N.rootLocal.x+N.axisLocal.x*N.length+pe,Pe=N.rootLocal.y+N.axisLocal.y*N.length+me,Oe=N.rootLocal.z+N.axisLocal.z*N.length+ce,ee=j*6;E[ee+0]=N.rootLocal.x,E[ee+1]=N.rootLocal.y,E[ee+2]=N.rootLocal.z,q[ee+3]=fe,q[ee+4]=Pe,q[ee+5]=Oe,j++}else j+=_.length;for(const N of M){const oe=j,K=oe*3,J=oe*6,we=N.mesh.skeleton;if(z.fromArray(we.boneMatrices,N.boneIndex*16),Y.copy(N.pLocalPre).applyMatrix4(z).applyMatrix4(N.mesh.bindMatrixInverse),Y.applyMatrix4(N.mesh.matrixWorld),ue.copy(N.pLocalPre).add(N.nLocalPre).applyMatrix4(z).applyMatrix4(N.mesh.bindMatrixInverse),ue.applyMatrix4(N.mesh.matrixWorld),ie.copy(Y).applyMatrix4(Ce),ne.copy(ue).applyMatrix4(Ce),Z.copy(ne).sub(ie).normalize(),ve.copy(N.pLocalPre).add(N.u).applyMatrix4(z).applyMatrix4(N.mesh.bindMatrixInverse).applyMatrix4(N.mesh.matrixWorld).sub(Y),re.copy(N.pLocalPre).add(N.v).applyMatrix4(z).applyMatrix4(N.mesh.bindMatrixInverse).applyMatrix4(N.mesh.matrixWorld).sub(Y),he.copy(ve).add(Y).applyMatrix4(Ce).sub(ie).normalize(),de.copy(re).add(Y).applyMatrix4(Ce).sub(ie).normalize(),h==="cpu"){const pe=L.noise4D(ie.x,ie.y,ie.z,W*s),me=Math.cos(pe),ce=Math.sin(pe),fe=B(N.length),Pe=he.x*me*fe+de.x*ce*fe,Oe=he.y*me*fe+de.y*ce*fe,ee=he.z*me*fe+de.z*ce*fe,le=ie.x+Z.x*N.length+Pe,se=ie.y+Z.y*N.length+Oe,be=ie.z+Z.z*N.length+ee;E[J+0]=ie.x,E[J+1]=ie.y,E[J+2]=ie.z,q[J+3]=le,q[J+4]=se,q[J+5]=be}else T[K+0]=ie.x,T[K+1]=ie.y,T[K+2]=ie.z,R[K+0]=Z.x,R[K+1]=Z.y,R[K+2]=Z.z,U[K+0]=he.x,U[K+1]=he.y,U[K+2]=he.z,H[K+0]=de.x,H[K+1]=de.y,H[K+2]=de.z;j++}if(h==="cpu")P.attributes.instanceStart.needsUpdate=!0,P.attributes.instanceEnd.needsUpdate=!0;else{const N=P;M.length>0&&(N.attributes.aRoot.needsUpdate=!0,N.attributes.aAxis.needsUpdate=!0,N.attributes.aU.needsUpdate=!0,N.attributes.aV.needsUpdate=!0)}}function ae(W){S.material.transparent=!0,S.material.opacity=W}return{object:S,update:$,setOpacity:ae}}async function qs(o,t,r={}){const l=await cf(o,t,{density:r.density??140,length:r.length,color:r.color??16731558,tipColor:r.tipColor??16777215,intensity:r.intensity,speed:r.speed??.5,seed:r.seed??1337,onTop:r.onTop??!0,opacity:r.opacity??1});return{object:l.object,update:l.update,setOpacity:l.setOpacity,dispose(){}}}async function lf(o){const{scene:t,camera:r,ring:l}=o,n=l.cfg?.tubeRadius??.4,e=De.clamp(o.faceCameraBias??.85,0,1),a={posMinCutoff:o.smoothing?.posMinCutoff??2,rotMinCutoff:o.smoothing?.rotMinCutoff??3,beta:o.smoothing?.beta??.4,dCutoff:o.smoothing?.derivativeCutoff??1,anchorRadius:Math.max(0,Math.floor(o.smoothing?.anchorSearchRadius??6))},c=new pt;c.name="TopBottomOverlay",t.add(c);function s(f,d){const h=new cn;h.name=f==="top"?"OverlayTopRoot":"OverlayBottomRoot";const m=new cn;m.name=f==="top"?"OverlayTopPivot":"OverlayBottomPivot",h.add(m),c.add(h);let g=null,b=1,v=1,p=null,x=null,y=null;const _=new js(a.posMinCutoff,a.beta,a.dCutoff),M=new _r(a.rotMinCutoff,a.beta,a.dCutoff);let w=0,A=1;const F=d.attachPadding??.06,k=d.fur===!1?!1:d.fur??o.fur;let D=null,T=performance.now()*.001;const R=(async()=>{g=await Pn(d.glbUrl),g.name=d.name,yr(g,{frustumCulled:!1}),Ra(g,d.lighting??"normals",{renderOnTop:!1,opacity:d.initialOpacity??.3,mixStrength:.5});const V=wr(g);if(b=V.baseWidth,v=V.baseHeight,m.add(V.pivot),k)try{D=await qs(m,g,{...k}),m.add(D.object)}catch(P){console.warn(`[TopBottomOverlay:${f}] attachFurToSurface failed:`,P)}})();async function U(V){await R;const P=await Pn(V.url);P.name=V.name??"OverlayCompanion",yr(P,{frustumCulled:!1}),Ra(P,V.lighting??"material",{renderOnTop:!!V.renderOnTop,opacity:V.opacity??d.initialOpacity??.3});const{pivot:O,baseWidth:S,baseHeight:L}=wr(P);if(V.fitToBase!==!1){const I=Math.min(b/S,v/L);P.scale.setScalar(I)}if(m.add(O),V.layout==="edgeRow"){const I=V.gap??.06*b,B=m.children.filter(Y=>Y!==g&&Y!==O&&Y!==D?.object),E=B.length+1,q=(E-1)*I;let z=0;V.align==="left"?z=0:V.align==="right"?z=-q:z=-q/2,B.forEach((Y,ue)=>{Y.position.x=z+ue*I}),O.position.x=z+(E-1)*I}return P}function H(V){nf(h,V),D&&D.setOpacity(V)}function G(){const V=l.getRingWorldSnapshot(),P=V.ringWorld;if(P.length<2)return;const O=xr(p,V.planeQuat);p=O.clone();let{right:S,up:L}=Sr(O);x&&y&&x.dot(S)+y.dot(L)<0&&(S.multiplyScalar(-1),L.multiplyScalar(-1)),x=S.clone(),y=L.clone();const I=Mr(P,S,L)>=0?1:-1;P.length,w=P.length,A=I;const B=V.centerWorld;let E=-1/0,q=1/0;for(let ae=0;ae<P.length;ae++){const W=P[ae];if(W!=null){const N=W.clone().sub(B).dot(L);N>E&&(E=N),N<q&&(q=N)}}const z=f==="top",Y=z?E:q,ue=z?1:-1,ie=n+F,ne=B.clone().addScaledVector(L,Y+ue*ie),Z=1/60,Ce=_.update(Z,ne,new C);h.position.copy(Ce);const re=r.quaternion.clone(),he=O,de=new je().slerpQuaternions(he,re,e),$=M.update(Z,de);if(h.quaternion.copy($),h.updateMatrixWorld(!0),D){const ae=performance.now()*.001-T;D.update(ae)}}function X(){D&&(D.dispose(),D=null),c.remove(h)}return{root:h,pivot:m,addCompanion:U,setOpacity:H,update:G,dispose:X}}const i=s("top",o.top),u=s("bottom",o.bottom);return{group:c,top:i,bottom:u,update(){i.update(),u.update()},setOpacity(f){i.setOpacity(f),u.setOpacity(f)},dispose(){i.dispose(),u.dispose(),t.remove(c)}}}const uf="/emptyoracle/assets/overlayTop-aA_s40gC.glb",ff="/emptyoracle/assets/overlayBottom-C9Z4NtbS.glb",df="/emptyoracle/assets/bandaid--W6OFC-Q.glb",hf="/emptyoracle/assets/clasp_top_middle-CKkc2Pbh.glb",pf="/emptyoracle/assets/deck_btn_0-CVQPhlAj.glb",mf="/emptyoracle/assets/deck_btn_1-CR67j6MH.glb",gf="/emptyoracle/assets/deck_btn_2-CMun63dg.glb",vf="/emptyoracle/assets/info_btn-B34vGzmO.glb";async function yf(o,t,r){const l=await lf({scene:o,camera:t,ring:r,fur:{enabled:!0,density:3e4,color:14626182,tipColor:16777215,length:.02,speed:0,onTop:!1,opacity:.2,seed:2595},top:{glbUrl:uf,name:"overlayTop",lighting:"normals",initialOpacity:.3,attachPadding:-.31},bottom:{glbUrl:ff,name:"overlayBottom",lighting:"normals",initialOpacity:.3,attachPadding:-.31},faceCameraBias:.85,smoothing:{posMinCutoff:2,rotMinCutoff:3,beta:.4,derivativeCutoff:1,anchorSearchRadius:6}});return await l.top.addCompanion({url:df,name:"bandaid",lighting:"material",fitToBase:!1,opacity:.5}),await l.top.addCompanion({url:pf,name:"deck_btn_0",lighting:"material",opacity:.6}),await l.top.addCompanion({url:mf,name:"deck_btn_1",lighting:"material",opacity:.6}),await l.bottom.addCompanion({url:gf,name:"info_btn",lighting:"material",opacity:.6}),await l.top.addCompanion({url:hf,name:"clasp_top_middle",lighting:"material",opacity:.6}),await l.top.addCompanion({url:vf,name:"deck_btn_2",lighting:"material",opacity:.6}),l}function Ea(o,t){const r=[];return o.traverse(l=>{l?.isBone&&typeof l.name=="string"&&l.name.startsWith(t)&&r.push(l)}),r.sort((l,n)=>l.name.localeCompare(n.name,void 0,{numeric:!0})),r}function Ba(o){if(o.length<=1)return o.length?[1]:[];const t=new Array(o.length).fill(1),r=new C,l=new C;for(let n=0;n<o.length-1;n++)o[n]&&o[n+1]&&(o[n].getWorldPosition(r),o[n+1].getWorldPosition(l),t[n]=Math.max(1e-4,r.distanceTo(l)));return t[o.length-1]=t[o.length-2]??1,t}function Lt(o,t,r,l){const n=o.length;if(n<2)return(o[0]??new C).clone();let e=(t%n+n)%n,a=Math.max(0,l);for(;a>0;){const c=(e+r+n)%n,s=o[c]&&o[e]?o[c].distanceTo(o[e]):0;if(s>=a){const i=s>1e-6?a/s:0;return new C().copy(o[e]??new C).lerp(o[c]??new C,i)}a-=s,e=c}return(o[e]??new C).clone()}function wf(o,t,r,l,n,e){const a=Lt(o,t,r,l);let c=l,s=l+Math.max(n*1.25,.001);const i=l+e;for(;s-l<e&&!(Lt(o,t,r,s).distanceTo(a)>=n||(s=Math.min(i,s+Math.max(n,.02)),s>=i)););for(let u=0;u<12;u++){const f=(c+s)*.5;Lt(o,t,r,f).distanceTo(a)>=n?s=f:c=f}return(c+s)*.5}function Ia(o,t){const r=o.length,l=o[(t-1+r)%r],n=o[t],e=o[(t+1)%r];if(!l||!n||!e)return 0;const a=new C().subVectors(n,l).normalize(),c=new C().subVectors(e,n).normalize();return Math.acos(De.clamp(a.dot(c),-1,1))}function Jo(o){const t=o.startsWith("-");return{axis:t?o.slice(1):o,sign:t?-1:1}}function Oa(o,t,r){switch(o){case"BL":return{axisH:t.clone(),axisV:r.clone()};case"TL":return{axisH:t.clone(),axisV:r.clone().negate()};case"TR":return{axisH:t.clone().negate(),axisV:r.clone().negate()};case"BR":return{axisH:t.clone().negate(),axisV:r.clone()}}}function za(o,t,r){switch(o){case"RIGHT":return{axisH:r.clone(),axisV:r.clone().negate()};case"LEFT":return{axisH:r.clone(),axisV:r.clone().negate()};case"TOP":return{axisH:t.clone(),axisV:t.clone().negate()};case"BOTTOM":return{axisH:t.clone(),axisV:t.clone().negate()}}}function Ga(o,t,r,l,n){const e=(a,c)=>{const s=Lt(o,t,a,0),i=Lt(o,t,a,n),u=new C().subVectors(i,s).normalize(),f=Lt(o,t,c,0),d=Lt(o,t,c,n),h=new C().subVectors(d,f).normalize();return u.dot(r)+h.dot(l)};return[e(1,-1),e(-1,1)]}function bf(o,t,r,l,n,e){const a=o.clone().normalize(),c=t.clone().normalize(),s=r.clone().normalize(),i={},u=(p,x,y)=>{i[p]=x.clone().multiplyScalar(y)},f=Jo(l),d=Jo(n),h=Jo(e);u(f.axis,a,f.sign),u(d.axis,c,d.sign),u(h.axis,s,h.sign);const m=i.x??new C().crossVectors(i.y,i.z).normalize(),g=i.y??new C().crossVectors(i.z,i.x).normalize(),b=i.z??new C().crossVectors(i.x,i.y).normalize(),v=new _t().makeBasis(m,g,b);return new je().setFromRotationMatrix(v)}function Wa(o,t){let r=o;for(let l=0;l<Math.max(0,t|0);l++){const n=r.length;if(n<3)break;const e=[];for(let a=0;a<n;a++){const c=r[a]??new C,s=r[(a+1)%n]??new C;e.push(new C().lerpVectors(c,s,.25)),e.push(new C().lerpVectors(c,s,.75))}r=e}return r}const Qe={v1:new C,v2:new C,v3:new C,v4:new C,v5:new C,q1:new je,q2:new je};async function _f(o){const{scene:t,tube:r,cornerUrl:l,shadow:n=!1}=o,e=o.anchor??{mode:"corner",corner:o.corner??"BL"},a=(o.assetToOurBasis??new je).clone(),c=o.faceAxisLocal??"z",s=o.thicknessAxisLocal??"x",i=De.clamp(o.cameraFaceBias??.85,0,1),u=o.faceAxisLocalH??c,f=o.thicknessAxisLocalH??s,d=o.faceAxisLocalV??c,h=o.thicknessAxisLocalV??s,m=r?.cfg?.tubeRadius??.4,g=Math.max(0,o.attachDepth??m),b=Math.max(0,o.attachPadding??.02),v=g+b,p=e.mode==="sideMid",x=De.clamp(p?Math.max(o.cornerSoftness??.6,.7):o.cornerSoftness??.6,0,1),y=De.clamp(p?Math.max(o.minAttachFactor??.6,.68):o.minAttachFactor??.6,.1,1);let _=Math.max(0,o.smoothPasses??1);const M=De.clamp(o.normalSmooth??.02,0,1),w=De.clamp(o.arcBlendStrength??.65,0,1),A=o.arcBlendCurvLo??.35,F=o.arcBlendCurvHi??1.2,k=De.clamp(o.minArcFrac??.35,0,.95),D={posMinCutoff:o.smoothing?.posMinCutoff??2,rotMinCutoff:o.smoothing?.rotMinCutoff??3,beta:o.smoothing?.beta??.4,dCutoff:o.smoothing?.derivativeCutoff??1,dirMargin:o.smoothing?.dirHysteresisMargin??.12,dirFrames:o.smoothing?.dirHysteresisFrames??0,anchorRadius:Math.max(0,Math.floor(o.smoothing?.anchorSearchRadius??6))},T=await Pn(l);let R=null;if(T.traverse(ee=>{ee?.isSkinnedMesh&&!R&&(R=ee.parent??null)}),!R)throw new Error("tubeOverlay: Could not find a SkinnedMesh in the GLB.");const U=ki(R);U.name=e.mode==="corner"?`Corner_${e.corner}`:`Side_${e.side}`,U.visible=!1,n&&U.traverse(ee=>{const le=ee;le?.isMesh&&(le.castShadow=!0,le.receiveShadow=!0)}),t.add(U);let H=null;o.fur&&o.fur.enabled!==!1&&(H=await qs(U,U,o.fur),U.add(H.object));function G(ee,le){const se=ee;"opacity"in se&&(se.opacity=De.clamp(le,0,1),se.transparent=se.opacity<1||se.transparent===!0,se.depthTest=!0,se.depthWrite=!0,se.needsUpdate=!0)}function X(ee){U.traverse(le=>{const se=le;if(se?.isMesh){const be=se.material;Array.isArray(be)?be.forEach(ke=>G(ke,ee)):be&&G(be,ee)}})}o.initialOpacity!==void 0&&X(o.initialOpacity);const V=Ea(U,"H_"),P=Ea(U,"V_"),O=ee=>{if(ee.length<2)return"x";const le=new C(0,0,0);for(let be=0;be<Math.min(ee.length-1,4);be++){const ke=ee[be+1]?.position?.clone?.()??new C;le.x+=Math.abs(ke.x),le.y+=Math.abs(ke.y),le.z+=Math.abs(ke.z)}const se=Math.max(le.x,le.y,le.z);return se===le.x?"x":se===le.y?"y":"z"},S=Ba(V),L=Ba(P),I=O(V),B=O(P);new C,new C,new C;function E(ee,le){const se=ee.parent,be=Qe.q1;se.getWorldQuaternion(be),be.invert(),ee.quaternion.copy(be.multiply(le))}function q(ee,le){const be=ee.parent.worldToLocal(le.clone());ee.position.copy(be)}function z(ee,le,se,be){const ke=be.length,Ge=new Array(ke),xe=new Array(ke),Me=Qo(ee),Fe=Math.max(Me*.28,be.reduce((ye,_e)=>ye+_e,0)*1.25);let Be=0;Ge[0]=Lt(ee,le,se,Be),xe[0]=tn(ee,Ge[0]);for(let ye=0;ye<ke-1;ye++){const _e=be[ye]??1,Ie=xe[ye]??0,ze=Ia(ee,Ie),Q=w*xf(A,F,ze),ge=wf(ee,le,se,Be,_e,Fe),Se=Be+_e;let Ae=De.lerp(ge,Se,Q);const Ue=k*_e;Ae-Be<Ue&&(Ae=Math.min(Be+Ue,Be+Fe)),Be=Ae;const He=Lt(ee,le,se,Be);Ge[ye+1]=He,xe[ye+1]=tn(ee,He)}return{P:Ge,K:xe}}function Y(ee,le,se,be,ke,Ge,xe,Me,Fe,Be,ye,_e,Ie,ze,Q,ge){if(ee.length===0||se.length<2)return;const{P:Se,K:Ae}=z(se,be,ke,le),Ue=new Array(ee.length),He=new Array(ee.length);for(let Te=0;Te<ee.length;Te++){const qe=Ae[Te]??0,We=Ko(se,qe);let Ee=Xo(We,ye,_e);const Ve=Qe.v1.copy(Se[Te]??new C).sub(ze);Ee.dot(Ve)<0&&Ee.multiplyScalar(-1),Te>0&&(Ee=Qe.v2.copy(He[Te-1]??new C).lerp(Ee,M).normalize()),He[Te]=Ee;const Le=Ia(se,qe),Ne=De.clamp(Le/(Math.PI/2),0,1),at=1-x*Ne,Ke=De.clamp(at,y,1),rt=Ie*Ke;Ue[Te]=Qe.v3.copy(Se[Te]??new C).addScaledVector(Ee,rt).clone()}for(let Te=0;Te<ee.length;Te++){ee[Te]&&Ue[Te]&&q(ee[Te],Ue[Te]);const qe=Qe.v4.set(0,0,0);Te<ee.length-1&&Ue[Te+1]&&Ue[Te]?qe.copy(Ue[Te+1]).sub(Ue[Te]):Ue[Te]&&Ue[Te-1]?qe.copy(Ue[Te]).sub(Ue[Te-1]):Ue[Te]&&qe.copy(Ue[Te]);const We=Qe.v5.copy(qe);We.lengthSq()<=1e-12?We.set(1,0,0):We.normalize();let Ee=Qe.v1.copy(ye).addScaledVector(We,-ye.dot(We));if(Ee.lengthSq()<1e-8){const Ke=Math.abs(We.dot(Be))<Math.abs(We.dot(Fe))?Be:Fe;Ee.copy(Ke).addScaledVector(We,-Ke.dot(We))}Ee.normalize();let Ve=Qe.v2.copy(new C().crossVectors(He[Te]??new C,We)).normalize();Ve.multiplyScalar(1-i).add(Qe.v3.copy(Ee).multiplyScalar(i)),Ve.lengthSq()<1e-10&&Ve.copy(Ee),Ve.normalize();let Le=Qe.v1.copy(new C().crossVectors(We,Ve)).normalize();const Ne=Qe.v2.copy(Ue[Te]??new C).sub(ze);Le.dot(Ne)<0&&Le.multiplyScalar(-1),Ve.copy(new C().crossVectors(Le,We)).normalize();const at=bf(We,Ve,Le,Ge,xe,Me);if(Q&&Q[Te]){const Ke=Q[Te].update(ge,at,Qe.q2);ee[Te]&&E(ee[Te],Ke)}else ee[Te]&&E(ee[Te],at);ee[Te]&&ee[Te].scale.set(1,1,1)}}let ue=performance.now()*.001,ie=null,ne=null,Z=null;const Ce=new js(D.posMinCutoff,D.beta,D.dCutoff),ve=V.map(()=>new _r(D.rotMinCutoff,D.beta,D.dCutoff)),re=P.map(()=>new _r(D.rotMinCutoff,D.beta,D.dCutoff));let he=0,de=null,$=0,ae=0;const W=(o.tube?.cfg?.tubeRadius??.4)*100,j=.1,N=new C;let oe=0,K=0,J=1,we=!1;function pe(){const ee=r.getRingWorldSnapshot?.();if(!ee)return!1;const le=ee.ringWorld;if(!le||le.length<2)return!1;const se=xr(ie,ee.planeQuat);ie=se.clone();const{right:be,up:ke,z:Ge}=Sr(se);ne=be.clone(),Z=ke.clone();const xe=_>0?Wa(le,_):le,Me=Da(xe),Fe=Mr(xe,be,ke)>=0?1:-1;K=xe.length,J=Fe;let Be=0,ye,_e;if(e.mode==="corner"){const Ee=r.getCornerAnchorIndex(e.corner),Ve=Ee>=0?Ee%le.length:0;Be=tn(xe,le[Ve]??new C);const Le=Oa(e.corner,be,ke);ye=Le.axisH,_e=Le.axisV}else{const Ee=e.side==="RIGHT"?be.clone():e.side==="LEFT"?be.clone().negate():e.side==="TOP"?ke.clone():ke.clone().negate();Be=me(xe,Me,Ee);const Ve=za(e.side,be,ke);ye=Ve.axisH,_e=Ve.axisV}ae=Be,N.copy(xe[ae]??new C);const Ie=Math.max(1e-4,Qo(xe)),ze=Math.min(Ie*.01,.05),[Q,ge]=Ga(xe,ae,ye,_e,ze);he=Q>=ge?0:1,de=null,$=0;const Se=Ko(xe,ae);let Ae=Xo(Se,Ge,Fe);const Ue=Qe.v1.copy(xe[ae]??new C).sub(Me);Ae.dot(Ue)<0&&Ae.multiplyScalar(-1);const He=Qe.v2.copy(xe[ae]??new C).addScaledVector(Ae,v);U.position.copy(He),U.quaternion.copy(se).multiply(a);const Te=he===0?1:-1,qe=he===0?-1:1;Y(V,S,xe,ae,Te,I,u,f,be,ke,Ge,Fe,v,Me,null,1/60),Y(P,L,xe,ae,qe,B,d,h,be,ke,Ge,Fe,v,Me,null,1/60),Ce.update(1/60,He,Qe.v3);const We=Qe.q1;for(let Ee=0;Ee<V.length;Ee++)V[Ee]&&ve[Ee]&&(V[Ee].getWorldQuaternion(We),ve[Ee].update(1/60,We,Qe.q2));for(let Ee=0;Ee<P.length;Ee++)P[Ee]&&re[Ee]&&(P[Ee].getWorldQuaternion(We),re[Ee].update(1/60,We,Qe.q2));return U.updateMatrixWorld(!0),we=!0,U.visible=!0,ue=performance.now()*.001,!0}function me(ee,le,se){let be=0,ke=-1/0;const Ge=se.clone().normalize();for(let xe=0;xe<ee.length;xe++){const Fe=(ee[xe]??new C).clone().sub(le).normalize().dot(Ge);Fe>ke&&(ke=Fe,be=xe)}return be}function ce(ee){_=Math.max(0,ee|0)}function fe(){if(!we)return pe(),void 0;const ee=performance.now()*.001,le=De.clamp(ee-ue,1/240,1/20);ue=ee;const se=r.getRingWorldSnapshot(),be=se.ringWorld;if(be.length<2)return;const ke=xr(ie,se.planeQuat);ie=ke.clone();let{right:Ge,up:xe,z:Me}=Sr(ke),Fe=Ge.clone(),Be=xe.clone();ne&&Z&&ne.dot(Ge)+Z.dot(xe)<0&&(Fe.multiplyScalar(-1),Be.multiplyScalar(-1)),ne=Fe.clone(),Z=Be.clone();const ye=_>0?Wa(be,_):be,_e=Da(ye),Ie=Mr(ye,Fe,Be)>=0?1:-1;(ye.length!==K||Ie!==J)&&(ae=tn(ye,N)),K=ye.length,J=Ie;let Q=0,ge,Se;if(e.mode==="corner"){const Pt=r.getCornerAnchorIndex(e.corner),At=Pt>=0?Pt%be.length:0;Q=tn(ye,be[At]??new C);const Qt=Oa(e.corner,Fe,Be);ge=Qt.axisH,Se=Qt.axisV}else{const Pt=e.side==="RIGHT"?Fe.clone():e.side==="LEFT"?Fe.clone().negate():e.side==="TOP"?Be.clone():Be.clone().negate();Q=me(ye,_e,Pt);const At=za(e.side,Fe,Be);ge=At.axisH,Se=At.axisV}const Ae=ye[Q]??ye[0];(Ae?Ae.distanceTo(N):0)>W?(oe++,oe<j?Q=tn(ye,N):oe=0):oe=0;const Te=of(ye,Q,ae,D.anchorRadius);ae=Te,N.copy(ye[Te]??new C);const qe=Ko(ye,Te);let We=Xo(qe,Me,Ie);const Ee=Qe.v1.copy(ye[Te]??new C).sub(_e);We.dot(Ee)<0&&We.multiplyScalar(-1);const Ve=Qe.v2.copy(ye[Te]??new C).addScaledVector(We,v),Le=Ce.update(le,Ve,Qe.v3);U.position.copy(Le),U.quaternion.copy(ke).multiply(a);const Ne=Math.max(1e-4,Qo(ye)),at=Math.min(Ne*.01,.05),[Ke,rt]=Ga(ye,Te,ge,Se,at);let Ct=Ke>=rt?0:1;const Xt=Math.abs(Ke-rt);Ct!==he?Xt>=D.dirMargin?D.dirFrames<=0?(he=Ct,de=null,$=0):de===Ct?($++,$>=D.dirFrames&&(he=Ct,de=null,$=0)):(de=Ct,$=1):(de=null,$=0,Ct=he):(de=null,$=0);const dn=he===0?1:-1,Mo=he===0?-1:1;Y(V,S,ye,Te,dn,I,u,f,Fe,Be,Me,Ie,v,_e,ve,le),Y(P,L,ye,Te,Mo,B,d,h,Fe,Be,Me,Ie,v,_e,re,le),H&&H.update(performance.now()*.001),U.updateMatrixWorld(!0)}function Pe(ee){U.visible=ee}function Oe(){U.traverse(ee=>{const le=ee;if(le?.isMesh){const se=le.material;Array.isArray(se)?se.forEach(be=>be.dispose?.()):se?.dispose?.(),le.geometry?.dispose?.()}}),t.remove(U),H?.dispose()}return{root:U,update:fe,show:Pe,setOpacity:X,setSmoothPasses:ce,dispose:Oe}}function xf(o,t,r){const l=De.clamp((r-o)/Math.max(1e-6,t-o),0,1);return l*l*(3-2*l)}const Sf="/emptyoracle/assets/cornerTR-DZyV4bvD.glb",Mf="/emptyoracle/assets/cornerTL-D8k8UNsS.glb",Cf="/emptyoracle/assets/cornerBM-BZaANnLg.glb";async function Af(o,t,r,l){const n=[{side:"RIGHT",url:Sf},{side:"LEFT",url:Mf},{side:"BOTTOM",url:Cf}],a=(await Promise.all(n.map(({side:i,url:u})=>_f({scene:o,tube:r,cornerUrl:u,anchor:{mode:"sideMid",side:i},fur:{enabled:!0,density:180,length:.095,intensity:.02,speed:.6,color:14626182,tipColor:16777215,onTop:!1,opacity:.15,seed:2595},...l})))).filter(Boolean);let c=typeof l?.smoothPasses=="number"?l.smoothPasses:1;const s=i=>{c=Math.max(0,i|0);for(const u of a)u.setSmoothPasses?.(c)};return s(c),{rigs:a,updateAll(){for(const i of a)i.update()},showAll(i){for(const u of a)u.show(i)},setSmoothPasses:s,dispose(){for(const i of a)i.dispose()}}}function Tf(o,t,r){if(r<=1e-9)return Math.min(o,t);const l=Math.max(r-Math.abs(o-t),0)/r;return Math.min(o,t)-l*l*l*(r/6)}function kf(o,t,r,l,n,e){const a=new te().subVectors(o,t),c=a.dot(r),s=a.dot(l),i=Math.abs(c)-n,u=Math.abs(s)-e,f=Math.max(i,0),d=Math.max(u,0),h=Math.hypot(f,d),m=Math.min(Math.max(i,u),0);return h+m}function Ff(o,t,r,l){const n=[],e=Math.max(160,Math.floor(l)),a=r/64;for(let c=0;c<e;c++){const s=c/e*Math.PI*2,i=new te(Math.cos(s),Math.sin(s));let u=r,f=o(new te(t.x+i.x*u,t.y+i.y*u)),d=u,h=f;for(;d>0&&(d-=a,h=o(new te(t.x+i.x*d,t.y+i.y*d)),!(h<=0)););if(d<=0&&h>0)continue;for(;f<=0&&u<r;)u+=a,f=o(new te(t.x+i.x*u,t.y+i.y*u));let m=Math.max(0,d),g=Math.min(r,u);for(let v=0;v<18;v++){const p=.5*(m+g);o(new te(t.x+i.x*p,t.y+i.y*p))>0?g=p:m=p}const b=.5*(m+g);n.push(new C(t.x+i.x*b,t.y+i.y*b,0))}return n}function Uf(o,t){if(o.length<4)return o;let r=o.slice();for(let l=0;l<t;l++){const n=[];for(let e=0;e<r.length;e++){const a=r[e]??new C,c=r[(e+1)%r.length]??new C;n.push(new C().lerpVectors(a,c,.35),new C().lerpVectors(a,c,.65))}r=n}return r}function Lf(o={}){const t={color:o.color??16731558,opacity:Math.max(0,Math.min(1,o.opacity??.25)),tubeRadius:Math.max(.001,o.tubeRadius??.4),margin:Math.max(0,o.margin??.5),smoothUnionRadius:Math.max(0,o.smoothUnionRadius??2.5),pathSegments:Math.max(120,Math.floor(o.pathSegments??280)),radialSegments:Math.max(6,Math.floor(o.radialSegments??10)),closed:o.closed??!0,fur:{enabled:o.fur?.enabled??!0,countU:Math.max(12,Math.floor(o.fur?.countU??80)),countV:Math.max(3,Math.floor(o.fur?.countV??6)),length:Math.max(.001,o.fur?.length??.1),sway:Math.max(0,o.fur?.sway??.5*(o.fur?.length??.1)),speed:Math.max(0,o.fur?.speed??.6),baseColor:o.fur?.baseColor??16731558,tipColor:o.fur?.tipColor??16777215,onTop:o.fur?.onTop??!0,seed:o.fur?.seed??1337,opacity:o.fur?.opacity??.2}},r=new pt;r.name="TubeOutline",r.matrixAutoUpdate=!1;const l=new ds({color:t.color,transparent:!0,opacity:t.opacity,roughness:.85,metalness:.05,depthTest:!0,depthWrite:!1,side:Dr}),n=new Xe(new kt,l);n.frustumCulled=!1,r.add(n);const e=new mt({colorWrite:!1,depthWrite:!0,depthTest:!0}),a=new Xe(n.geometry,e);a.frustumCulled=!1,r.add(a);const c={enabled:t.fur.enabled,simplex:new _o(String(t.fur.seed)),lines:null,positions:null,colors:null,anchors:[],tubular:t.pathSegments,radial:t.radialSegments};if(c.enabled){const R=Math.max(1,Math.floor(t.pathSegments/t.fur.countU)),U=Math.max(1,Math.floor(t.radialSegments/t.fur.countV));for(let I=0;I<=t.pathSegments;I+=R)for(let B=0;B<=t.radialSegments;B+=U)c.anchors.push({u:I,v:B,len:t.fur.length*(.85+.3*Math.random())});const H=c.anchors.length,G=new Float32Array(H*2*3),X=new Float32Array(H*2*3),V=new et(t.fur.baseColor),P=new et(t.fur.tipColor);for(let I=0;I<H;I++){const B=(I*2+0)*3,E=(I*2+1)*3;X[B+0]=V.r,X[B+1]=V.g,X[B+2]=V.b,X[E+0]=P.r,X[E+1]=P.g,X[E+2]=P.b}const O=new kt;O.setAttribute("position",new Ln(G,3)),O.setAttribute("color",new Ln(X,3)),O.setDrawRange(0,H*2);const S=new Lr({vertexColors:!0,transparent:!0,opacity:t.fur.opacity,depthTest:!0,depthWrite:!1}),L=new ms(O,S);L.frustumCulled=!1,r.add(L),c.lines=L,c.positions=G,c.colors=X}const s=new C,i=new C,u=new C,f=new C,d=new C,h=new C;let m=null,g=null,b=null;function v(R,U,H,G,X=new C){const V=h.copy(R).sub(U),P=G.dot(V);if(Math.abs(P)<1e-6){const S=d.copy(R).sub(H),L=G.dot(S);return X.copy(R).sub(d.copy(G).multiplyScalar(L))}const O=G.dot(d.copy(H).sub(U))/P;return X.copy(U).addScaledVector(V,O)}function p(R,U){const H=R.cards.length;if(!H){g=null,b=null,m=null;return}const G=new C().copy(st);U.getWorldDirection(u).normalize(),i.set(0,1,0).applyQuaternion(U.quaternion).normalize();const X=new je().setFromRotationMatrix(new _t().lookAt(G,G.clone().add(u.multiplyScalar(1)),i)),V=new _t().compose(G,X,new C(1,1,1)).invert();U.getWorldPosition(f);const P=[],O=[],S=[],L=[],I=[];let B=1/0,E=1/0,q=-1/0,z=-1/0;const Y=ht(),ue=t.margin+t.tubeRadius;for(let de=0;de<H;de++){const $=R.cards[de];if($.mode==="focused"||$.mode==="focus_in")continue;const ae=Math.max(1e-4,($.cardWidth??tt)*Y),W=tt*Y,j=[new C(-ae/2,-W/2,0),new C(ae/2,-W/2,0),new C(ae/2,W/2,0),new C(-ae/2,W/2,0)],N=[];let oe=1/0,K=1/0,J=-1/0,we=-1/0;for(let ye=0;ye<4;ye++){const _e=$.group?.matrixWorld?$.group:void 0;if(!_e)continue;const Ie=j[ye];if(!Ie)continue;const ze=Ie.clone().applyMatrix4(_e.matrixWorld),ge=v(ze,f,G,u,s).applyMatrix4(V);N.push(new te(ge.x,ge.y)),ge.x<oe&&(oe=ge.x),ge.x>J&&(J=ge.x),ge.y<K&&(K=ge.y),ge.y>we&&(we=ge.y)}const pe=oe-t.margin,me=K-t.margin,ce=J+t.margin,fe=we+t.margin;pe<B&&(B=pe),ce>q&&(q=ce),me<E&&(E=me),fe>z&&(z=fe);const Pe=new te(.25*((N[0]?.x??0)+(N[1]?.x??0)+(N[2]?.x??0)+(N[3]?.x??0)),.25*((N[0]?.y??0)+(N[1]?.y??0)+(N[2]?.y??0)+(N[3]?.y??0)));let Oe=0,ee=0,le=0;for(let ye=0;ye<4;ye++){const _e=(N[ye]?.x??0)-Pe.x,Ie=(N[ye]?.y??0)-Pe.y;Oe+=_e*_e,ee+=_e*Ie,le+=Ie*Ie}const se=Oe+le,be=Oe*le-ee*ee,ke=Math.sqrt(Math.max(0,se*se*.25-be)),Ge=se*.5+ke;let xe=new te(ee,Ge-Oe);xe.lengthSq()<1e-10&&xe.set(Ge-le,ee),xe.lengthSq()<1e-10&&xe.set(1,0),xe.normalize();const Me=new te(-xe.y,xe.x);let Fe=0,Be=0;for(let ye=0;ye<4;ye++){const _e=new te().subVectors(N[ye]??new te,Pe);Fe=Math.max(Fe,Math.abs(_e.dot(xe))),Be=Math.max(Be,Math.abs(_e.dot(Me)))}Fe+=ue,Be+=ue,P.push(Pe),L.push(xe),I.push(Me),O.push(Fe),S.push(Be)}isFinite(B)&&isFinite(q)&&isFinite(E)&&isFinite(z)?m={w:Math.max(0,q-B),h:Math.max(0,z-E)}:m=null;const ie=de=>{let $=1/0;for(let ae=0;ae<P.length;ae++){const W=kf(de,P[ae]??new te,L[ae]??new te(1,0),I[ae]??new te(0,1),O[ae]??0,S[ae]??0);$=Tf($,W,t.smoothUnionRadius)}return $},ne=new te((B+q)*.5,(E+z)*.5),Z=Math.hypot(q-ne.x,z-ne.y)*1.35||1,Ce=Uf(Ff(ie,ne,Z,t.pathSegments),1);g=Ce.map(de=>de.clone()),b=ne.clone();const ve=new hs(Ce,!0,"centripetal",.5),re=new ps(ve,t.pathSegments,t.tubeRadius,t.radialSegments,t.closed),he=n.geometry;n.geometry=re,a.geometry=re,he.dispose(),c.tubular=t.pathSegments,c.radial=t.radialSegments,r.position.copy(G),r.quaternion.copy(X),r.updateMatrix()}function x(R){if(!c.enabled||!c.lines||!c.positions)return;const U=n.geometry,H=U.getAttribute("position"),G=U.getAttribute("normal");if(!H||!G)return;const X=c.tubular,V=c.radial,P=c.positions,O=performance.now()*.001*t.fur.speed,S=new C(0,0,1),L=new C(1,0,0);for(let B=0;B<c.anchors.length;B++){const E=c.anchors[B];if(!E)continue;const{u:q,v:z,len:Y}=E,ue=Math.min(q,X),ie=Math.min(z,V),ne=ue*(V+1)+ie,Z=H.getX(ne),Ce=H.getY(ne),ve=H.getZ(ne),re=G.getX(ne),he=G.getY(ne),de=G.getZ(ne),$=new C(Z,Ce,ve),ae=new C(re,he,de).normalize();let W=new C().crossVectors(ae,S);W.lengthSq()<1e-6&&W.crossVectors(ae,L),W.normalize();const j=new C().crossVectors(ae,W).normalize(),N=c.simplex.noise4D($.x,$.y,$.z,O),oe=Math.cos(N),K=Math.sin(N),J=t.fur.sway,we=new C().addScaledVector(W,oe*J).addScaledVector(j,K*J),pe=new C().copy($).addScaledVector(ae,Y).add(we),me=(B*2+0)*3,ce=(B*2+1)*3;P[me+0]=$.x,P[me+1]=$.y,P[me+2]=$.z,P[ce+0]=pe.x,P[ce+1]=pe.y,P[ce+2]=pe.z}const I=c.lines.geometry;I.getAttribute("position").needsUpdate=!0}function y(R,U,H){p(R,U),x()}function _(R){t.margin=Math.max(0,R)}function M(){return m?{...m}:null}function w(R){if(!g||!b||!g.length)return-1;const U=R.clone().normalize();let H=0,G=-1/0;for(let X=0;X<g.length;X++){const V=g[X];if(!V)continue;const P=new te(V.x-b.x,V.y-b.y).normalize(),O=P.x*U.x+P.y*U.y;O>G&&(G=O,H=X)}return H}function A(R,U,H){let G=(R+U)%H;return G<0&&(G+=H),G}function F(R){if(!g||!b||!g.length)return null;const U=g.length,H=new te(-1,0),G=new te(1,0),X=w(H),V=w(G);if(X<0||V<0)return null;const P=Math.max(1,Math.round(U*.01));let O=0,S=5,L=5;R==="TL"?O=A(X,-P*S,U):R==="BL"?O=A(X,+P*L,U):R==="TR"?O=A(V,-P*L,U):O=A(V,+P*S,U);const I=g[O];return I?I.clone().applyQuaternion(r.quaternion).add(r.position):null}function k(){return{TL:F("TL"),TR:F("TR"),BR:F("BR"),BL:F("BL")}}function D(){if(!g||!g.length||!b)return{ringWorld:[],centerWorld:new C,planeQuat:r.quaternion.clone()};const R=g.map(H=>H.clone().applyQuaternion(r.quaternion).add(r.position)),U=new C(b.x,b.y,0).applyQuaternion(r.quaternion).add(r.position);return{ringWorld:R,centerWorld:U,planeQuat:r.quaternion.clone()}}function T(R){if(!g||!b||!g.length)return-1;const U={TL:new te(-1,1).normalize(),TR:new te(1,1).normalize(),BR:new te(1,-1).normalize(),BL:new te(-1,-1).normalize()}[R];let H=0,G=-1/0;for(let X=0;X<g.length;X++){const V=g[X];if(!V)continue;const P=new te(V.x-b.x,V.y-b.y).normalize(),O=P.x*U.x+P.y*U.y;O>G&&(G=O,H=X)}return H}return{group:r,update:y,setInnerMargin:_,getLastPlaneBounds:M,cfg:t,getAttachPointForCorner:F,getAttachPointsAll:k,getRingWorldSnapshot:D,getCornerAnchorIndex:T}}function zt(o){if(o==null)return;const t=Number(o);return Number.isFinite(t)?t:void 0}function Rf(){const o=new URLSearchParams(typeof window<"u"?window.location.search:""),t={},r={};return t.gapNarrowPx=zt(o.get("ovGapNarrow")),t.gapWidePx=zt(o.get("ovGapWide")),t.breakpointPx=zt(o.get("ovBreak")),t.worldGap=zt(o.get("ovWorldGap")),r.outerMarginX=zt(o.get("vpMarginX")),r.outerMarginY=zt(o.get("vpMarginY")),r.padFudge=zt(o.get("vpPadFudge")),{overlay:t,viewport:r}}function Ys(){const o={overlay:{gapNarrowPx:25,gapWidePx:5,breakpointPx:1200,worldGap:NaN},viewport:{outerMarginX:.15,outerMarginY:.22,padFudge:.3}},r=(typeof window<"u"?window:{ArcanaConfig:void 0}).ArcanaConfig||{},l=Rf();return{overlay:{gapNarrowPx:Gt(l.overlay?.gapNarrowPx,r.overlay?.gapNarrowPx,o.overlay.gapNarrowPx),gapWidePx:Gt(l.overlay?.gapWidePx,r.overlay?.gapWidePx,o.overlay.gapWidePx),breakpointPx:Gt(l.overlay?.breakpointPx,r.overlay?.breakpointPx,o.overlay.breakpointPx),worldGap:Gt(l.overlay?.worldGap,r.overlay?.worldGap,o.overlay.worldGap)},viewport:{outerMarginX:Gt(l.viewport?.outerMarginX,r.viewport?.outerMarginX,o.viewport.outerMarginX),outerMarginY:Gt(l.viewport?.outerMarginY,r.viewport?.outerMarginY,o.viewport.outerMarginY),padFudge:Gt(l.viewport?.padFudge,r.viewport?.padFudge,o.viewport.padFudge)}}}function Gt(o,t,r){return o!==void 0?o:t!==void 0?t:r}function Df(o,t=800){let r=null,l=null,n=null,e=null,a=2;const c=Ys(),s=c.overlay.gapNarrowPx??25,i=c.overlay.gapWidePx??5,u=c.overlay.breakpointPx??1200,f=c.overlay.worldGap;function d(m,g,b){const v=(()=>{const _=new C,M=new C;m.getWorldPosition(_),m.getWorldDirection(M).normalize();const A=st.clone().sub(_);return Math.abs(M.dot(A))})(),p=De.degToRad(m.fov),x=2*Math.tan(p/2)*v,y=g.getSize(new te);return x*(b/Math.max(1,y.y))}return{system:{id:"ui.overlay",priority:t,async init(m){a=m.renderer.getSize(new te).x<u?s:i,r||(r=Lf({color:19878,opacity:0,tubeRadius:.1615,margin:1,smoothUnionRadius:.38,pathSegments:100,radialSegments:20,closed:!0,fur:{enabled:!0,countU:250,countV:30,length:.091,sway:.08,speed:1,baseColor:16731558,tipColor:16777215,onTop:!0,opacity:.6,seed:2595}}));const b=m.scene;r?.group&&b.children.indexOf(r.group)===-1&&b.add(r.group),l||(l=Ku({tubularSegments:30,radialSegments:20}),l?.group&&b.children.indexOf(l.group)===-1&&b.add(l.group)),n||(n=await yf(b,m.camera,r)),e||(e=await Af(b,m.camera,r,{smoothPasses:1,normalSmooth:.45,cornerSoftness:.7,minAttachFactor:.55,arcBlendStrength:.75,minArcFrac:.4,attachPadding:.2,faceAxisLocal:"-z",thicknessAxisLocalH:"-z",thicknessAxisLocalV:"-x",initialOpacity:.32,smoothing:{posMinCutoff:2,rotMinCutoff:3,beta:.4,derivativeCutoff:1,dirHysteresisMargin:.12,dirHysteresisFrames:0,anchorSearchRadius:6}}))},onResize(m,g){a=m<u?s:i},update(m,g){if(!r||!l)return;const b=o.getSystem(),v=g.camera,p=a;Number.isNaN(f)?r.setInnerMargin(d(v,g.renderer,p)):r.setInnerMargin(f),r.update(b,v,m);const x=o.isMoving?.()??!1;e&&(e.setSmoothPasses(x?0:1),e.updateAll()),l.update(v,r,m),n?.update?.()},dispose(){}},get:()=>({tubeOutline:r,cornerConduits:l,overlayTB:n,sideMids:e})}}const Pf={redDur:1.17647,redPeak:.9,pauseAfterRed:.18,greenIntensity:.9,greenFadeDur:.35,redHex:16711680,greenHex:1572718,yellowHex:16776960};function mo(o){if(!o)return[];const t=[];return o.traverse(r=>{r?.isMesh&&t.push(r)}),t}class Xs{meshes;cfg;state="idle";t=0;wantActive=!1;afterFade=null;colorRed;colorGreen;colorYellow;listeners=new Set;onStateChange(t){return this.listeners.add(t),()=>this.listeners.delete(t)}emit(){for(const t of this.listeners)t(this.state)}setState(t){this.state!==t&&(this.state=t,this.emit())}getState(){return this.state}waitUntil(t){return this.state===t?Promise.resolve():new Promise(r=>{const l=this.onStateChange(n=>{n===t&&(l(),r())})})}constructor(t,r){this.meshes=t,this.cfg={...Pf,...r||{}},this.colorRed=new et(this.cfg.redHex),this.colorGreen=new et(this.cfg.greenHex),this.colorYellow=new et(this.cfg.yellowHex);for(const l of this.meshes){const n=l.material,e=a=>{const c=a.clone?.()??a;return c.isMeshStandardMaterial||c.isMeshPhysicalMaterial?(c.emissive||(c.emissive=new et(0)),typeof c.emissiveIntensity!="number"&&(c.emissiveIntensity=0),c.map&&"colorSpace"in c.map&&(c.map.colorSpace=it),c.emissiveMap&&"colorSpace"in c.emissiveMap&&(c.emissiveMap.colorSpace=it)):c.emissive||(c.emissive=new et(0)),c.needsUpdate=!0,c};Array.isArray(n)?l.material=n.map(e):l.material=e(n)}this.setColor(this.colorYellow),this.setIntensity(0),this.setState("yellowFadeIn"),this.t=0}pulseRed(){this.setState("redPulse"),this.t=0,this.afterFade=null,this.setColor(this.colorRed),this.setIntensity(0)}setActive(t){this.wantActive=t,t?this.state==="yellowHold"||this.state==="yellowFadeIn"?(this.setState("yellowFadeOut"),this.t=0,this.afterFade="greenFadeIn"):(this.state==="idle"||this.state==="greenFadeOut"||this.state==="yellowFadeOut")&&(this.state==="greenFadeOut"||this.state==="yellowFadeOut"?this.afterFade="greenFadeIn":(this.setState("greenFadeIn"),this.t=0,this.afterFade=null,this.setColor(this.colorGreen),this.setIntensity(0))):(this.state==="greenHold"||this.state==="greenFadeIn")&&(this.setState("greenFadeOut"),this.t=0,this.afterFade="yellowFadeIn")}tick(t){switch(this.state){case"redPulse":{const r=Math.min(1,this.t/this.cfg.redDur),l=Math.sin(Math.PI*r);this.setColor(this.colorRed),this.setIntensity(this.cfg.redPeak*l),this.t+=t,r>=1&&(this.setIntensity(0),this.wantActive?(this.setState("pauseAfterRed"),this.t=0):(this.setState("yellowFadeIn"),this.t=0,this.setColor(this.colorYellow),this.setIntensity(0)));break}case"pauseAfterRed":{if(this.t+=t,!this.wantActive){this.setState("yellowFadeIn"),this.t=0,this.setColor(this.colorYellow),this.setIntensity(0);break}this.t>=this.cfg.pauseAfterRed&&(this.setState("greenFadeIn"),this.t=0,this.afterFade=null,this.setColor(this.colorGreen),this.setIntensity(0));break}case"greenFadeIn":{const r=Math.min(1,this.t/this.cfg.greenFadeDur),l=r*r*(3-2*r);this.setColor(this.colorGreen),this.setIntensity(this.cfg.greenIntensity*l),this.t+=t,r>=1&&(this.setState("greenHold"),this.setIntensity(this.cfg.greenIntensity));break}case"greenHold":{this.wantActive?this.setIntensity(this.cfg.greenIntensity):(this.setState("greenFadeOut"),this.t=0,this.afterFade="yellowFadeIn");break}case"greenFadeOut":{const r=Math.min(1,this.t/this.cfg.greenFadeDur),l=1-r;if(this.setColor(this.colorGreen),this.setIntensity(this.cfg.greenIntensity*l),this.t+=t,r>=1){const n=this.afterFade;this.afterFade=null,n?(this.setState(n),this.t=0,n==="yellowFadeIn"?(this.setColor(this.colorYellow),this.setIntensity(0)):n==="greenFadeIn"&&(this.setColor(this.colorGreen),this.setIntensity(0))):(this.setState("idle"),this.setIntensity(0))}break}case"yellowFadeIn":{const r=Math.min(1,this.t/this.cfg.greenFadeDur),l=r*r*(3-2*r);this.setColor(this.colorYellow),this.setIntensity(this.cfg.greenIntensity*l),this.t+=t,r>=1&&(this.setState("yellowHold"),this.setIntensity(this.cfg.greenIntensity));break}case"yellowHold":{this.wantActive?(this.setState("yellowFadeOut"),this.t=0,this.afterFade="greenFadeIn"):this.setIntensity(this.cfg.greenIntensity);break}case"yellowFadeOut":{const r=Math.min(1,this.t/this.cfg.greenFadeDur),l=1-r;if(this.setColor(this.colorYellow),this.setIntensity(this.cfg.greenIntensity*l),this.t+=t,r>=1){const n=this.afterFade;this.afterFade=null,n?(this.setState(n),this.t=0,n==="greenFadeIn"?(this.setColor(this.colorGreen),this.setIntensity(0)):n==="yellowFadeIn"&&(this.setColor(this.colorYellow),this.setIntensity(0))):(this.setState("idle"),this.setIntensity(0))}break}case"idle":default:{this.setIntensity(0);break}}}setColor(t){const r=l=>{l&&(l.emissive?l.emissive.copy(t):l.emissive=new et(t),l.needsUpdate=!0)};for(const l of this.meshes){const n=l.material;Array.isArray(n)?n.forEach(r):r(n)}}setIntensity(t){const r=l=>{l&&(l.isMeshStandardMaterial||l.isMeshPhysicalMaterial?l.emissiveIntensity=t:l.emissive&&(l.__baseEmissive||(l.__baseEmissive=l.emissive.clone()),l.emissive.copy(l.__baseEmissive).multiplyScalar(t/Math.max(1e-6,this.cfg.greenIntensity))),l.needsUpdate=!0)};for(const l of this.meshes){const n=l.material;Array.isArray(n)?n.forEach(r):r(n)}}}async function go(o,t){const r=new Ur,l=new as(60,1,.1,10);l.position.z=2;const n=new pt;r.add(n);const e=t.fronts.slice(0,Math.min(6,t.fronts.length));for(const u of e){const f=new yt(tt*Math.max(.05,u.aspect||1),tt,1,1),d=new mt({map:u.texture,toneMapped:!1,fog:!1}),h=new Xe(f,d);n.add(h)}const a=new Xe(new yt(tt,tt,1,1),new mt({map:t.back,toneMapped:!1,fog:!1})),c=a.clone();a.material.map&&(a.material.map.center.set(.5,.5),a.material.map.rotation=0),c.material.map&&(c.material.map=t.back,c.material.map.center.set(.5,.5),c.material.map.rotation=Math.PI/2),n.add(a,c),o.compile(r,l);const s=o.getRenderTarget(),i=new Fi(2,2,{depthBuffer:!1,stencilBuffer:!1});o.setRenderTarget(i),o.render(r,l),o.setRenderTarget(s);for(const u of n.children){const f=u;f.geometry.dispose();const d=f.material;d.map&&(d.map=null),d.dispose()}i.dispose()}function Ef(o,t=810){const r=[{rootName:"deck_btn_0",patternId:"custom:test0"},{rootName:"deck_btn_1",patternId:"custom:test1"},{rootName:"deck_btn_2",patternId:"custom:test3"},{rootName:"clasp_top_middle",patternId:"custom:test2"}],l=[];let n=null,e=!1;function a(){if(e)return;const c=Yt()?.id??"";for(const s of l){const i=s.patternId===c;n&&s===n?s.rig.setActive(!0):s.rig.setActive(i)}}return{id:"ui.buttons",priority:t,async init(c){const s=o.getOverlayTB();if(!s?.group)return;const i=o.getInteractions(),u=o.getCardsSystem();if(!i||!u)return;function f(d,h){if(!d)return;const m=o.getInteractions();m&&d.traverse(g=>{g.isMesh&&m.registerObject(g,h)})}for(const d of r){const h=s.group.getObjectByName(d.rootName),m=h?.getObjectByName("mech");(y=>{const _=y?.material,M=w=>{w.depthWrite=!0,w.depthTest=!0,w.transparent=!0,w.needsUpdate=!0};Array.isArray(_)?_.forEach(w=>M(w)):_&&M(_)})(m);const b=new Xs(mo(m),d.pulse??o.pulse),v={root:h,mech:m,rig:b,patternId:d.patternId},p=mo(m);for(const y of p)y.layers.enable(1);l.push(v),f(h,async()=>{const y=Rn(),_=l.find(T=>T.patternId===y)||null;e=!0,b.pulseRed(),b.setActive(!0),_&&_!==l.find(T=>T.rig===b)&&_.rig.setActive(!0),wt.quaternion.set(0,0,0,1);const M=c.camera,w=new C(0,1,0).applyQuaternion(M.quaternion).normalize(),A=new _t().lookAt(st,M.getWorldPosition(new C),w);wt.setRotationFromMatrix(A);const F=new je().setFromAxisAngle(new C(0,1,0),Math.PI);wt.quaternion.multiply(F),wt.position.copy(st),wt.updateMatrixWorld();const k=d.patternId,D=await Dn(k).catch(()=>null);D&&(await go(c.renderer,D),u.setImageDeck(D.fronts,D.back)),n=l.find(T=>T.rig===b)??null,Fc(k),a(),b.waitUntil("greenHold").then(()=>{_&&_!==n&&_.rig.setActive(!1),n=null,e=!1,a()})})}Ir(a),a()},update(c){for(const s of l)s.rig.tick(c)},dispose(){}}}const Qs="/emptyoracle/assets/info_split_card-CET3QmFT.glb";function Bf(){var o=Object.create(null);function t(n,e){var a=n.id,c=n.name,s=n.dependencies;s===void 0&&(s=[]);var i=n.init;i===void 0&&(i=function(){});var u=n.getTransferables;if(u===void 0&&(u=null),!o[a])try{s=s.map(function(d){return d&&d.isWorkerModule&&(t(d,function(h){if(h instanceof Error)throw h}),d=o[d.id].value),d}),i=l("<"+c+">.init",i),u&&(u=l("<"+c+">.getTransferables",u));var f=null;typeof i=="function"?f=i.apply(void 0,s):console.error("worker module init function failed to rehydrate"),o[a]={id:a,value:f,getTransferables:u},e(f)}catch(d){d&&d.noLog||console.error(d),e(d)}}function r(n,e){var a,c=n.id,s=n.args;(!o[c]||typeof o[c].value!="function")&&e(new Error("Worker module "+c+": not found or its 'init' did not return a function"));try{var i=(a=o[c]).value.apply(a,s);i&&typeof i.then=="function"?i.then(u,function(f){return e(f instanceof Error?f:new Error(""+f))}):u(i)}catch(f){e(f)}function u(f){try{var d=o[c].getTransferables&&o[c].getTransferables(f);(!d||!Array.isArray(d)||!d.length)&&(d=void 0),e(f,d)}catch(h){console.error(h),e(h)}}}function l(n,e){var a=void 0;self.troikaDefine=function(s){return a=s};var c=URL.createObjectURL(new Blob(["/** "+n.replace(/\*/g,"")+` **/

troikaDefine(
`+e+`
)`],{type:"application/javascript"}));try{importScripts(c)}catch(s){console.error(s)}return URL.revokeObjectURL(c),delete self.troikaDefine,a}self.addEventListener("message",function(n){var e=n.data,a=e.messageId,c=e.action,s=e.data;try{c==="registerModule"&&t(s,function(i){i instanceof Error?postMessage({messageId:a,success:!1,error:i.message}):postMessage({messageId:a,success:!0,result:{isCallable:typeof i=="function"}})}),c==="callModule"&&r(s,function(i,u){i instanceof Error?postMessage({messageId:a,success:!1,error:i.message}):postMessage({messageId:a,success:!0,result:i},u||void 0)})}catch(i){postMessage({messageId:a,success:!1,error:i.stack})}})}function If(o){var t=function(){for(var r=[],l=arguments.length;l--;)r[l]=arguments[l];return t._getInitResult().then(function(n){if(typeof n=="function")return n.apply(void 0,r);throw new Error("Worker module function was called but `init` did not return a callable function")})};return t._getInitResult=function(){var r=o.dependencies,l=o.init;r=Array.isArray(r)?r.map(function(e){return e&&(e=e.onMainThread||e,e._getInitResult&&(e=e._getInitResult())),e}):[];var n=Promise.all(r).then(function(e){return l.apply(null,e)});return t._getInitResult=function(){return n},n},t}var Ks=function(){var o=!1;if(typeof window<"u"&&typeof window.document<"u")try{var t=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));t.terminate(),o=!0}catch(r){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+r.message+"]")}return Ks=function(){return o},o},Of=0,zf=0,$o=!1,Fn=Object.create(null),Un=Object.create(null),Cr=Object.create(null);function un(o){if((!o||typeof o.init!="function")&&!$o)throw new Error("requires `options.init` function");var t=o.dependencies,r=o.init,l=o.getTransferables,n=o.workerId,e=If(o);n==null&&(n="#default");var a="workerModule"+ ++Of,c=o.name||a,s=null;t=t&&t.map(function(u){return typeof u=="function"&&!u.workerModuleData&&($o=!0,u=un({workerId:n,name:"<"+c+"> function dependency: "+u.name,init:`function(){return (
`+oo(u)+`
)}`}),$o=!1),u&&u.workerModuleData&&(u=u.workerModuleData),u});function i(){for(var u=[],f=arguments.length;f--;)u[f]=arguments[f];if(!Ks())return e.apply(void 0,u);if(!s){s=Va(n,"registerModule",i.workerModuleData);var d=function(){s=null,Un[n].delete(d)};(Un[n]||(Un[n]=new Set)).add(d)}return s.then(function(h){var m=h.isCallable;if(m)return Va(n,"callModule",{id:a,args:u});throw new Error("Worker module function was called but `init` did not return a callable function")})}return i.workerModuleData={isWorkerModule:!0,id:a,name:c,dependencies:t,init:oo(r),getTransferables:l&&oo(l)},i.onMainThread=e,i}function Gf(o){Un[o]&&Un[o].forEach(function(t){t()}),Fn[o]&&(Fn[o].terminate(),delete Fn[o])}function oo(o){var t=o.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function Wf(o){var t=Fn[o];if(!t){var r=oo(Bf);t=Fn[o]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+o.replace(/\*/g,"")+` **/

;(`+r+")()"],{type:"application/javascript"}))),t.onmessage=function(l){var n=l.data,e=n.messageId,a=Cr[e];if(!a)throw new Error("WorkerModule response with empty or unknown messageId");delete Cr[e],a(n)}}return t}function Va(o,t,r){return new Promise(function(l,n){var e=++zf;Cr[e]=function(a){a.success?l(a.result):n(new Error("Error in worker "+t+" call: "+a.error))},Wf(o).postMessage({messageId:e,action:t,data:r})})}function Zs(){var o=function(t){function r(P,O,S,L,I,B,E,q){var z=1-E;q.x=z*z*P+2*z*E*S+E*E*I,q.y=z*z*O+2*z*E*L+E*E*B}function l(P,O,S,L,I,B,E,q,z,Y){var ue=1-z;Y.x=ue*ue*ue*P+3*ue*ue*z*S+3*ue*z*z*I+z*z*z*E,Y.y=ue*ue*ue*O+3*ue*ue*z*L+3*ue*z*z*B+z*z*z*q}function n(P,O){for(var S=/([MLQCZ])([^MLQCZ]*)/g,L,I,B,E,q;L=S.exec(P);){var z=L[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(Y){return parseFloat(Y)});switch(L[1]){case"M":E=I=z[0],q=B=z[1];break;case"L":(z[0]!==E||z[1]!==q)&&O("L",E,q,E=z[0],q=z[1]);break;case"Q":{O("Q",E,q,E=z[2],q=z[3],z[0],z[1]);break}case"C":{O("C",E,q,E=z[4],q=z[5],z[0],z[1],z[2],z[3]);break}case"Z":(E!==I||q!==B)&&O("L",E,q,I,B);break}}}function e(P,O,S){S===void 0&&(S=16);var L={x:0,y:0};n(P,function(I,B,E,q,z,Y,ue,ie,ne){switch(I){case"L":O(B,E,q,z);break;case"Q":{for(var Z=B,Ce=E,ve=1;ve<S;ve++)r(B,E,Y,ue,q,z,ve/(S-1),L),O(Z,Ce,L.x,L.y),Z=L.x,Ce=L.y;break}case"C":{for(var re=B,he=E,de=1;de<S;de++)l(B,E,Y,ue,ie,ne,q,z,de/(S-1),L),O(re,he,L.x,L.y),re=L.x,he=L.y;break}}})}var a="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",c="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",s=new WeakMap,i={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function u(P,O){var S=P.getContext?P.getContext("webgl",i):P,L=s.get(S);if(!L){let ue=function(re){var he=B[re];if(!he&&(he=B[re]=S.getExtension(re),!he))throw new Error(re+" not supported");return he},ie=function(re,he){var de=S.createShader(he);return S.shaderSource(de,re),S.compileShader(de),de},ne=function(re,he,de,$){if(!E[re]){var ae={},W={},j=S.createProgram();S.attachShader(j,ie(he,S.VERTEX_SHADER)),S.attachShader(j,ie(de,S.FRAGMENT_SHADER)),S.linkProgram(j),E[re]={program:j,transaction:function(oe){S.useProgram(j),oe({setUniform:function(J,we){for(var pe=[],me=arguments.length-2;me-- >0;)pe[me]=arguments[me+2];var ce=W[we]||(W[we]=S.getUniformLocation(j,we));S["uniform"+J].apply(S,[ce].concat(pe))},setAttribute:function(J,we,pe,me,ce){var fe=ae[J];fe||(fe=ae[J]={buf:S.createBuffer(),loc:S.getAttribLocation(j,J),data:null}),S.bindBuffer(S.ARRAY_BUFFER,fe.buf),S.vertexAttribPointer(fe.loc,we,S.FLOAT,!1,0,0),S.enableVertexAttribArray(fe.loc),I?S.vertexAttribDivisor(fe.loc,me):ue("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(fe.loc,me),ce!==fe.data&&(S.bufferData(S.ARRAY_BUFFER,ce,pe),fe.data=ce)}})}}}E[re].transaction($)},Z=function(re,he){z++;try{S.activeTexture(S.TEXTURE0+z);var de=q[re];de||(de=q[re]=S.createTexture(),S.bindTexture(S.TEXTURE_2D,de),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,S.NEAREST),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,S.NEAREST)),S.bindTexture(S.TEXTURE_2D,de),he(de,z)}finally{z--}},Ce=function(re,he,de){var $=S.createFramebuffer();Y.push($),S.bindFramebuffer(S.FRAMEBUFFER,$),S.activeTexture(S.TEXTURE0+he),S.bindTexture(S.TEXTURE_2D,re),S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_2D,re,0);try{de($)}finally{S.deleteFramebuffer($),S.bindFramebuffer(S.FRAMEBUFFER,Y[--Y.length-1]||null)}},ve=function(){B={},E={},q={},z=-1,Y.length=0};var I=typeof WebGL2RenderingContext<"u"&&S instanceof WebGL2RenderingContext,B={},E={},q={},z=-1,Y=[];S.canvas.addEventListener("webglcontextlost",function(re){ve(),re.preventDefault()},!1),s.set(S,L={gl:S,isWebGL2:I,getExtension:ue,withProgram:ne,withTexture:Z,withTextureFramebuffer:Ce,handleContextLoss:ve})}O(L)}function f(P,O,S,L,I,B,E,q){E===void 0&&(E=15),q===void 0&&(q=null),u(P,function(z){var Y=z.gl,ue=z.withProgram,ie=z.withTexture;ie("copy",function(ne,Z){Y.texImage2D(Y.TEXTURE_2D,0,Y.RGBA,I,B,0,Y.RGBA,Y.UNSIGNED_BYTE,O),ue("copy",a,c,function(Ce){var ve=Ce.setUniform,re=Ce.setAttribute;re("aUV",2,Y.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),ve("1i","image",Z),Y.bindFramebuffer(Y.FRAMEBUFFER,q||null),Y.disable(Y.BLEND),Y.colorMask(E&8,E&4,E&2,E&1),Y.viewport(S,L,I,B),Y.scissor(S,L,I,B),Y.drawArrays(Y.TRIANGLES,0,3)})})})}function d(P,O,S){var L=P.width,I=P.height;u(P,function(B){var E=B.gl,q=new Uint8Array(L*I*4);E.readPixels(0,0,L,I,E.RGBA,E.UNSIGNED_BYTE,q),P.width=O,P.height=S,f(E,q,0,0,L,I)})}var h=Object.freeze({__proto__:null,withWebGLContext:u,renderImageData:f,resizeWebGLCanvasWithoutClearing:d});function m(P,O,S,L,I,B){B===void 0&&(B=1);var E=new Uint8Array(P*O),q=L[2]-L[0],z=L[3]-L[1],Y=[];e(S,function(re,he,de,$){Y.push({x1:re,y1:he,x2:de,y2:$,minX:Math.min(re,de),minY:Math.min(he,$),maxX:Math.max(re,de),maxY:Math.max(he,$)})}),Y.sort(function(re,he){return re.maxX-he.maxX});for(var ue=0;ue<P;ue++)for(var ie=0;ie<O;ie++){var ne=Ce(L[0]+q*(ue+.5)/P,L[1]+z*(ie+.5)/O),Z=Math.pow(1-Math.abs(ne)/I,B)/2;ne<0&&(Z=1-Z),Z=Math.max(0,Math.min(255,Math.round(Z*255))),E[ie*P+ue]=Z}return E;function Ce(re,he){for(var de=1/0,$=1/0,ae=Y.length;ae--;){var W=Y[ae];if(W.maxX+$<=re)break;if(re+$>W.minX&&he-$<W.maxY&&he+$>W.minY){var j=v(re,he,W.x1,W.y1,W.x2,W.y2);j<de&&(de=j,$=Math.sqrt(de))}}return ve(re,he)&&($=-$),$}function ve(re,he){for(var de=0,$=Y.length;$--;){var ae=Y[$];if(ae.maxX<=re)break;var W=ae.y1>he!=ae.y2>he&&re<(ae.x2-ae.x1)*(he-ae.y1)/(ae.y2-ae.y1)+ae.x1;W&&(de+=ae.y1<ae.y2?1:-1)}return de!==0}}function g(P,O,S,L,I,B,E,q,z,Y){B===void 0&&(B=1),q===void 0&&(q=0),z===void 0&&(z=0),Y===void 0&&(Y=0),b(P,O,S,L,I,B,E,null,q,z,Y)}function b(P,O,S,L,I,B,E,q,z,Y,ue){B===void 0&&(B=1),z===void 0&&(z=0),Y===void 0&&(Y=0),ue===void 0&&(ue=0);for(var ie=m(P,O,S,L,I,B),ne=new Uint8Array(ie.length*4),Z=0;Z<ie.length;Z++)ne[Z*4+ue]=ie[Z];f(E,ne,z,Y,P,O,1<<3-ue,q)}function v(P,O,S,L,I,B){var E=I-S,q=B-L,z=E*E+q*q,Y=z?Math.max(0,Math.min(1,((P-S)*E+(O-L)*q)/z)):0,ue=P-(S+Y*E),ie=O-(L+Y*q);return ue*ue+ie*ie}var p=Object.freeze({__proto__:null,generate:m,generateIntoCanvas:g,generateIntoFramebuffer:b}),x="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",y="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",_="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",M=new Float32Array([0,0,2,0,0,2]),w=null,A=!1,F={},k=new WeakMap;function D(P){if(!A&&!H(P))throw new Error("WebGL generation not supported")}function T(P,O,S,L,I,B,E){if(B===void 0&&(B=1),E===void 0&&(E=null),!E&&(E=w,!E)){var q=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!q)throw new Error("OffscreenCanvas or DOM canvas not supported");E=w=q.getContext("webgl",{depth:!1})}D(E);var z=new Uint8Array(P*O*4);u(E,function(ne){var Z=ne.gl,Ce=ne.withTexture,ve=ne.withTextureFramebuffer;Ce("readable",function(re,he){Z.texImage2D(Z.TEXTURE_2D,0,Z.RGBA,P,O,0,Z.RGBA,Z.UNSIGNED_BYTE,null),ve(re,he,function(de){U(P,O,S,L,I,B,Z,de,0,0,0),Z.readPixels(0,0,P,O,Z.RGBA,Z.UNSIGNED_BYTE,z)})})});for(var Y=new Uint8Array(P*O),ue=0,ie=0;ue<z.length;ue+=4)Y[ie++]=z[ue];return Y}function R(P,O,S,L,I,B,E,q,z,Y){B===void 0&&(B=1),q===void 0&&(q=0),z===void 0&&(z=0),Y===void 0&&(Y=0),U(P,O,S,L,I,B,E,null,q,z,Y)}function U(P,O,S,L,I,B,E,q,z,Y,ue){B===void 0&&(B=1),z===void 0&&(z=0),Y===void 0&&(Y=0),ue===void 0&&(ue=0),D(E);var ie=[];e(S,function(ne,Z,Ce,ve){ie.push(ne,Z,Ce,ve)}),ie=new Float32Array(ie),u(E,function(ne){var Z=ne.gl,Ce=ne.isWebGL2,ve=ne.getExtension,re=ne.withProgram,he=ne.withTexture,de=ne.withTextureFramebuffer,$=ne.handleContextLoss;if(he("rawDistances",function(ae,W){(P!==ae._lastWidth||O!==ae._lastHeight)&&Z.texImage2D(Z.TEXTURE_2D,0,Z.RGBA,ae._lastWidth=P,ae._lastHeight=O,0,Z.RGBA,Z.UNSIGNED_BYTE,null),re("main",x,y,function(j){var N=j.setAttribute,oe=j.setUniform,K=!Ce&&ve("ANGLE_instanced_arrays"),J=!Ce&&ve("EXT_blend_minmax");N("aUV",2,Z.STATIC_DRAW,0,M),N("aLineSegment",4,Z.DYNAMIC_DRAW,1,ie),oe.apply(void 0,["4f","uGlyphBounds"].concat(L)),oe("1f","uMaxDistance",I),oe("1f","uExponent",B),de(ae,W,function(we){Z.enable(Z.BLEND),Z.colorMask(!0,!0,!0,!0),Z.viewport(0,0,P,O),Z.scissor(0,0,P,O),Z.blendFunc(Z.ONE,Z.ONE),Z.blendEquationSeparate(Z.FUNC_ADD,Ce?Z.MAX:J.MAX_EXT),Z.clear(Z.COLOR_BUFFER_BIT),Ce?Z.drawArraysInstanced(Z.TRIANGLES,0,3,ie.length/4):K.drawArraysInstancedANGLE(Z.TRIANGLES,0,3,ie.length/4)})}),re("post",a,_,function(j){j.setAttribute("aUV",2,Z.STATIC_DRAW,0,M),j.setUniform("1i","tex",W),Z.bindFramebuffer(Z.FRAMEBUFFER,q),Z.disable(Z.BLEND),Z.colorMask(ue===0,ue===1,ue===2,ue===3),Z.viewport(z,Y,P,O),Z.scissor(z,Y,P,O),Z.drawArrays(Z.TRIANGLES,0,3)})}),Z.isContextLost())throw $(),new Error("webgl context lost")})}function H(P){var O=!P||P===w?F:P.canvas||P,S=k.get(O);if(S===void 0){A=!0;var L=null;try{var I=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],B=T(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,P);S=B&&I.length===B.length&&B.every(function(E,q){return E===I[q]}),S||(L="bad trial run results",console.info(I,B))}catch(E){S=!1,L=E.message}L&&console.warn("WebGL SDF generation not supported:",L),A=!1,k.set(O,S)}return S}var G=Object.freeze({__proto__:null,generate:T,generateIntoCanvas:R,generateIntoFramebuffer:U,isSupported:H});function X(P,O,S,L,I,B){I===void 0&&(I=Math.max(L[2]-L[0],L[3]-L[1])/2),B===void 0&&(B=1);try{return T.apply(G,arguments)}catch(E){return console.info("WebGL SDF generation failed, falling back to JS",E),m.apply(p,arguments)}}function V(P,O,S,L,I,B,E,q,z,Y){I===void 0&&(I=Math.max(L[2]-L[0],L[3]-L[1])/2),B===void 0&&(B=1),q===void 0&&(q=0),z===void 0&&(z=0),Y===void 0&&(Y=0);try{return R.apply(G,arguments)}catch(ue){return console.info("WebGL SDF generation failed, falling back to JS",ue),g.apply(p,arguments)}}return t.forEachPathCommand=n,t.generate=X,t.generateIntoCanvas=V,t.javascript=p,t.pathToLineSegments=e,t.webgl=G,t.webglUtils=h,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return o}function Vf(){var o=function(t){var r={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},l={},n={};l.L=1,n[1]="L",Object.keys(r).forEach(function($,ae){l[$]=1<<ae+1,n[l[$]]=$}),Object.freeze(l);var e=l.LRI|l.RLI|l.FSI,a=l.L|l.R|l.AL,c=l.B|l.S|l.WS|l.ON|l.FSI|l.LRI|l.RLI|l.PDI,s=l.BN|l.RLE|l.LRE|l.RLO|l.LRO|l.PDF,i=l.S|l.WS|l.B|e|l.PDI|s,u=null;function f(){if(!u){u=new Map;var $=function(W){if(r.hasOwnProperty(W)){var j=0;r[W].split(",").forEach(function(N){var oe=N.split("+"),K=oe[0],J=oe[1];K=parseInt(K,36),J=J?parseInt(J,36):0,u.set(j+=K,l[W]);for(var we=0;we<J;we++)u.set(++j,l[W])})}};for(var ae in r)$(ae)}}function d($){return f(),u.get($.codePointAt(0))||l.L}function h($){return n[d($)]}var m={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function g($,ae){var W=36,j=0,N=new Map,oe=ae&&new Map,K;return $.split(",").forEach(function J(we){if(we.indexOf("+")!==-1)for(var pe=+we;pe--;)J(K);else{K=we;var me=we.split(">"),ce=me[0],fe=me[1];ce=String.fromCodePoint(j+=parseInt(ce,W)),fe=String.fromCodePoint(j+=parseInt(fe,W)),N.set(ce,fe),ae&&oe.set(fe,ce)}}),{map:N,reverseMap:oe}}var b,v,p;function x(){if(!b){var $=g(m.pairs,!0),ae=$.map,W=$.reverseMap;b=ae,v=W,p=g(m.canonical,!1).map}}function y($){return x(),b.get($)||null}function _($){return x(),v.get($)||null}function M($){return x(),p.get($)||null}var w=l.L,A=l.R,F=l.EN,k=l.ES,D=l.ET,T=l.AN,R=l.CS,U=l.B,H=l.S,G=l.ON,X=l.BN,V=l.NSM,P=l.AL,O=l.LRO,S=l.RLO,L=l.LRE,I=l.RLE,B=l.PDF,E=l.LRI,q=l.RLI,z=l.FSI,Y=l.PDI;function ue($,ae){for(var W=125,j=new Uint32Array($.length),N=0;N<$.length;N++)j[N]=d($[N]);var oe=new Map;function K(ct,vt){var lt=j[ct];j[ct]=vt,oe.set(lt,oe.get(lt)-1),lt&c&&oe.set(c,oe.get(c)-1),oe.set(vt,(oe.get(vt)||0)+1),vt&c&&oe.set(c,(oe.get(c)||0)+1)}for(var J=new Uint8Array($.length),we=new Map,pe=[],me=null,ce=0;ce<$.length;ce++)me||pe.push(me={start:ce,end:$.length-1,level:ae==="rtl"?1:ae==="ltr"?0:ra(ce,!1)}),j[ce]&U&&(me.end=ce,me=null);for(var fe=I|L|S|O|e|Y|B|U,Pe=function(ct){return ct+(ct&1?1:2)},Oe=function(ct){return ct+(ct&1?2:1)},ee=0;ee<pe.length;ee++){me=pe[ee];var le=[{_level:me.level,_override:0,_isolate:0}],se=void 0,be=0,ke=0,Ge=0;oe.clear();for(var xe=me.start;xe<=me.end;xe++){var Me=j[xe];if(se=le[le.length-1],oe.set(Me,(oe.get(Me)||0)+1),Me&c&&oe.set(c,(oe.get(c)||0)+1),Me&fe)if(Me&(I|L)){J[xe]=se._level;var Fe=(Me===I?Oe:Pe)(se._level);Fe<=W&&!be&&!ke?le.push({_level:Fe,_override:0,_isolate:0}):be||ke++}else if(Me&(S|O)){J[xe]=se._level;var Be=(Me===S?Oe:Pe)(se._level);Be<=W&&!be&&!ke?le.push({_level:Be,_override:Me&S?A:w,_isolate:0}):be||ke++}else if(Me&e){Me&z&&(Me=ra(xe+1,!0)===1?q:E),J[xe]=se._level,se._override&&K(xe,se._override);var ye=(Me===q?Oe:Pe)(se._level);ye<=W&&be===0&&ke===0?(Ge++,le.push({_level:ye,_override:0,_isolate:1,_isolInitIndex:xe})):be++}else if(Me&Y){if(be>0)be--;else if(Ge>0){for(ke=0;!le[le.length-1]._isolate;)le.pop();var _e=le[le.length-1]._isolInitIndex;_e!=null&&(we.set(_e,xe),we.set(xe,_e)),le.pop(),Ge--}se=le[le.length-1],J[xe]=se._level,se._override&&K(xe,se._override)}else Me&B?(be===0&&(ke>0?ke--:!se._isolate&&le.length>1&&(le.pop(),se=le[le.length-1])),J[xe]=se._level):Me&U&&(J[xe]=me.level);else J[xe]=se._level,se._override&&Me!==X&&K(xe,se._override)}for(var Ie=[],ze=null,Q=me.start;Q<=me.end;Q++){var ge=j[Q];if(!(ge&s)){var Se=J[Q],Ae=ge&e,Ue=ge===Y;ze&&Se===ze._level?(ze._end=Q,ze._endsWithIsolInit=Ae):Ie.push(ze={_start:Q,_end:Q,_level:Se,_startsWithPDI:Ue,_endsWithIsolInit:Ae})}}for(var He=[],Te=0;Te<Ie.length;Te++){var qe=Ie[Te];if(!qe._startsWithPDI||qe._startsWithPDI&&!we.has(qe._start)){for(var We=[ze=qe],Ee=void 0;ze&&ze._endsWithIsolInit&&(Ee=we.get(ze._end))!=null;)for(var Ve=Te+1;Ve<Ie.length;Ve++)if(Ie[Ve]._start===Ee){We.push(ze=Ie[Ve]);break}for(var Le=[],Ne=0;Ne<We.length;Ne++)for(var at=We[Ne],Ke=at._start;Ke<=at._end;Ke++)Le.push(Ke);for(var rt=J[Le[0]],Ct=me.level,Xt=Le[0]-1;Xt>=0;Xt--)if(!(j[Xt]&s)){Ct=J[Xt];break}var dn=Le[Le.length-1],Mo=J[dn],Pt=me.level;if(!(j[dn]&e)){for(var At=dn+1;At<=me.end;At++)if(!(j[At]&s)){Pt=J[At];break}}He.push({_seqIndices:Le,_sosType:Math.max(Ct,rt)%2?A:w,_eosType:Math.max(Pt,Mo)%2?A:w})}}for(var Qt=0;Qt<He.length;Qt++){var Co=He[Qt],Re=Co._seqIndices,hn=Co._sosType,pi=Co._eosType,Kt=J[Re[0]]&1?A:w;if(oe.get(V))for(var On=0;On<Re.length;On++){var Wr=Re[On];if(j[Wr]&V){for(var Ao=hn,zn=On-1;zn>=0;zn--)if(!(j[Re[zn]]&s)){Ao=j[Re[zn]];break}K(Wr,Ao&(e|Y)?G:Ao)}}if(oe.get(F))for(var Gn=0;Gn<Re.length;Gn++){var Vr=Re[Gn];if(j[Vr]&F)for(var Wn=Gn-1;Wn>=-1;Wn--){var Hr=Wn===-1?hn:j[Re[Wn]];if(Hr&a){Hr===P&&K(Vr,T);break}}}if(oe.get(P))for(var To=0;To<Re.length;To++){var Nr=Re[To];j[Nr]&P&&K(Nr,A)}if(oe.get(k)||oe.get(R))for(var pn=1;pn<Re.length-1;pn++){var ko=Re[pn];if(j[ko]&(k|R)){for(var Zt=0,Fo=0,Uo=pn-1;Uo>=0&&(Zt=j[Re[Uo]],!!(Zt&s));Uo--);for(var Lo=pn+1;Lo<Re.length&&(Fo=j[Re[Lo]],!!(Fo&s));Lo++);Zt===Fo&&(j[ko]===k?Zt===F:Zt&(F|T))&&K(ko,Zt)}}if(oe.get(F))for(var xt=0;xt<Re.length;xt++){var mi=Re[xt];if(j[mi]&F){for(var Vn=xt-1;Vn>=0&&j[Re[Vn]]&(D|s);Vn--)K(Re[Vn],F);for(xt++;xt<Re.length&&j[Re[xt]]&(D|s|F);xt++)j[Re[xt]]!==F&&K(Re[xt],F)}}if(oe.get(D)||oe.get(k)||oe.get(R))for(var mn=0;mn<Re.length;mn++){var jr=Re[mn];if(j[jr]&(D|k|R)){K(jr,G);for(var Hn=mn-1;Hn>=0&&j[Re[Hn]]&s;Hn--)K(Re[Hn],G);for(var Nn=mn+1;Nn<Re.length&&j[Re[Nn]]&s;Nn++)K(Re[Nn],G)}}if(oe.get(F))for(var Ro=0,qr=hn;Ro<Re.length;Ro++){var Yr=Re[Ro],Do=j[Yr];Do&F?qr===w&&K(Yr,w):Do&a&&(qr=Do)}if(oe.get(c)){var gn=A|F|T,Xr=gn|w,jn=[];{for(var Jt=[],$t=0;$t<Re.length;$t++)if(j[Re[$t]]&c){var vn=$[Re[$t]],Qr=void 0;if(y(vn)!==null)if(Jt.length<63)Jt.push({char:vn,seqIndex:$t});else break;else if((Qr=_(vn))!==null)for(var yn=Jt.length-1;yn>=0;yn--){var Po=Jt[yn].char;if(Po===Qr||Po===_(M(vn))||y(M(Po))===vn){jn.push([Jt[yn].seqIndex,$t]),Jt.length=yn;break}}}jn.sort(function(ct,vt){return ct[0]-vt[0]})}for(var Eo=0;Eo<jn.length;Eo++){for(var Kr=jn[Eo],qn=Kr[0],Bo=Kr[1],Zr=!1,gt=0,Io=qn+1;Io<Bo;Io++){var Jr=Re[Io];if(j[Jr]&Xr){Zr=!0;var $r=j[Jr]&gn?A:w;if($r===Kt){gt=$r;break}}}if(Zr&&!gt){gt=hn;for(var Oo=qn-1;Oo>=0;Oo--){var ea=Re[Oo];if(j[ea]&Xr){var ta=j[ea]&gn?A:w;ta!==Kt?gt=ta:gt=Kt;break}}}if(gt){if(j[Re[qn]]=j[Re[Bo]]=gt,gt!==Kt){for(var wn=qn+1;wn<Re.length;wn++)if(!(j[Re[wn]]&s)){d($[Re[wn]])&V&&(j[Re[wn]]=gt);break}}if(gt!==Kt){for(var bn=Bo+1;bn<Re.length;bn++)if(!(j[Re[bn]]&s)){d($[Re[bn]])&V&&(j[Re[bn]]=gt);break}}}}for(var Et=0;Et<Re.length;Et++)if(j[Re[Et]]&c){for(var na=Et,zo=Et,Go=hn,_n=Et-1;_n>=0;_n--)if(j[Re[_n]]&s)na=_n;else{Go=j[Re[_n]]&gn?A:w;break}for(var oa=pi,xn=Et+1;xn<Re.length;xn++)if(j[Re[xn]]&(c|s))zo=xn;else{oa=j[Re[xn]]&gn?A:w;break}for(var Wo=na;Wo<=zo;Wo++)j[Re[Wo]]=Go===oa?Go:Kt;Et=zo}}}for(var ft=me.start;ft<=me.end;ft++){var gi=J[ft],Yn=j[ft];if(gi&1?Yn&(w|F|T)&&J[ft]++:Yn&A?J[ft]++:Yn&(T|F)&&(J[ft]+=2),Yn&s&&(J[ft]=ft===0?me.level:J[ft-1]),ft===me.end||d($[ft])&(H|U))for(var Xn=ft;Xn>=0&&d($[Xn])&i;Xn--)J[Xn]=me.level}}return{levels:J,paragraphs:pe};function ra(ct,vt){for(var lt=ct;lt<$.length;lt++){var Bt=j[lt];if(Bt&(A|P))return 1;if(Bt&(U|w)||vt&&Bt===Y)return 0;if(Bt&e){var aa=vi(lt);lt=aa===-1?$.length:aa}}return 0}function vi(ct){for(var vt=1,lt=ct+1;lt<$.length;lt++){var Bt=j[lt];if(Bt&U)break;if(Bt&Y){if(--vt===0)return lt}else Bt&e&&vt++}return-1}}var ie="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",ne;function Z(){if(!ne){var $=g(ie,!0),ae=$.map,W=$.reverseMap;W.forEach(function(j,N){ae.set(N,j)}),ne=ae}}function Ce($){return Z(),ne.get($)||null}function ve($,ae,W,j){var N=$.length;W=Math.max(0,W==null?0:+W),j=Math.min(N-1,j==null?N-1:+j);for(var oe=new Map,K=W;K<=j;K++)if(ae[K]&1){var J=Ce($[K]);J!==null&&oe.set(K,J)}return oe}function re($,ae,W,j){var N=$.length;W=Math.max(0,W==null?0:+W),j=Math.min(N-1,j==null?N-1:+j);var oe=[];return ae.paragraphs.forEach(function(K){var J=Math.max(W,K.start),we=Math.min(j,K.end);if(J<we){for(var pe=ae.levels.slice(J,we+1),me=we;me>=J&&d($[me])&i;me--)pe[me]=K.level;for(var ce=K.level,fe=1/0,Pe=0;Pe<pe.length;Pe++){var Oe=pe[Pe];Oe>ce&&(ce=Oe),Oe<fe&&(fe=Oe|1)}for(var ee=ce;ee>=fe;ee--)for(var le=0;le<pe.length;le++)if(pe[le]>=ee){for(var se=le;le+1<pe.length&&pe[le+1]>=ee;)le++;le>se&&oe.push([se+J,le+J])}}}),oe}function he($,ae,W,j){var N=de($,ae,W,j),oe=[].concat($);return N.forEach(function(K,J){oe[J]=(ae.levels[K]&1?Ce($[K]):null)||$[K]}),oe.join("")}function de($,ae,W,j){for(var N=re($,ae,W,j),oe=[],K=0;K<$.length;K++)oe[K]=K;return N.forEach(function(J){for(var we=J[0],pe=J[1],me=oe.slice(we,pe+1),ce=me.length;ce--;)oe[pe-ce]=me[ce]}),oe}return t.closingToOpeningBracket=_,t.getBidiCharType=d,t.getBidiCharTypeName=h,t.getCanonicalBracket=M,t.getEmbeddingLevels=ue,t.getMirroredCharacter=Ce,t.getMirroredCharactersMap=ve,t.getReorderSegments=re,t.getReorderedIndices=de,t.getReorderedString=he,t.openingToClosingBracket=y,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return o}const Js=/\bvoid\s+main\s*\(\s*\)\s*{/g;function Ar(o){const t=/^[ \t]*#include +<([\w\d./]+)>/gm;function r(l,n){let e=Di[n];return e?Ar(e):l}return o.replace(t,r)}const ot=[];for(let o=0;o<256;o++)ot[o]=(o<16?"0":"")+o.toString(16);function Hf(){const o=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0,l=Math.random()*4294967295|0;return(ot[o&255]+ot[o>>8&255]+ot[o>>16&255]+ot[o>>24&255]+"-"+ot[t&255]+ot[t>>8&255]+"-"+ot[t>>16&15|64]+ot[t>>24&255]+"-"+ot[r&63|128]+ot[r>>8&255]+"-"+ot[r>>16&255]+ot[r>>24&255]+ot[l&255]+ot[l>>8&255]+ot[l>>16&255]+ot[l>>24&255]).toUpperCase()}const Wt=Object.assign||function(){let o=arguments[0];for(let t=1,r=arguments.length;t<r;t++){let l=arguments[t];if(l)for(let n in l)Object.prototype.hasOwnProperty.call(l,n)&&(o[n]=l[n])}return o},Nf=Date.now(),Ha=new WeakMap,Na=new Map;let jf=1e10;function Tr(o,t){const r=Qf(t);let l=Ha.get(o);if(l||Ha.set(o,l=Object.create(null)),l[r])return new l[r];const n=`_onBeforeCompile${r}`,e=function(i,u){o.onBeforeCompile.call(this,i,u);const f=this.customProgramCacheKey()+"|"+i.vertexShader+"|"+i.fragmentShader;let d=Na[f];if(!d){const h=qf(this,i,t,r);d=Na[f]=h}i.vertexShader=d.vertexShader,i.fragmentShader=d.fragmentShader,Wt(i.uniforms,this.uniforms),t.timeUniform&&(i.uniforms[t.timeUniform]={get value(){return Date.now()-Nf}}),this[n]&&this[n](i)},a=function(){return c(t.chained?o:o.clone())},c=function(i){const u=Object.create(i,s);return Object.defineProperty(u,"baseMaterial",{value:o}),Object.defineProperty(u,"id",{value:jf++}),u.uuid=Hf(),u.uniforms=Wt({},i.uniforms,t.uniforms),u.defines=Wt({},i.defines,t.defines),u.defines[`TROIKA_DERIVED_MATERIAL_${r}`]="",u.extensions=Wt({},i.extensions,t.extensions),u._listeners=void 0,u},s={constructor:{value:a},isDerivedMaterial:{value:!0},type:{get:()=>o.type,set:i=>{o.type=i}},isDerivedFrom:{writable:!0,configurable:!0,value:function(i){const u=this.baseMaterial;return i===u||u.isDerivedMaterial&&u.isDerivedFrom(i)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return o.customProgramCacheKey()+"|"+r}},onBeforeCompile:{get(){return e},set(i){this[n]=i}},copy:{writable:!0,configurable:!0,value:function(i){return o.copy.call(this,i),!o.isShaderMaterial&&!o.isDerivedMaterial&&(Wt(this.extensions,i.extensions),Wt(this.defines,i.defines),Wt(this.uniforms,gs.clone(i.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const i=new o.constructor;return c(i).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let i=this._depthMaterial;return i||(i=this._depthMaterial=Tr(o.isDerivedMaterial?o.getDepthMaterial():new Li({depthPacking:Ri}),t),i.defines.IS_DEPTH_MATERIAL="",i.uniforms=this.uniforms),i}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let i=this._distanceMaterial;return i||(i=this._distanceMaterial=Tr(o.isDerivedMaterial?o.getDistanceMaterial():new Ui,t),i.defines.IS_DISTANCE_MATERIAL="",i.uniforms=this.uniforms),i}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:i,_distanceMaterial:u}=this;i&&i.dispose(),u&&u.dispose(),o.dispose.call(this)}}};return l[r]=a,new a}function qf(o,{vertexShader:t,fragmentShader:r},l,n){let{vertexDefs:e,vertexMainIntro:a,vertexMainOutro:c,vertexTransform:s,fragmentDefs:i,fragmentMainIntro:u,fragmentMainOutro:f,fragmentColorTransform:d,customRewriter:h,timeUniform:m}=l;if(e=e||"",a=a||"",c=c||"",i=i||"",u=u||"",f=f||"",(s||h)&&(t=Ar(t)),(d||h)&&(r=r.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),r=Ar(r)),h){let g=h({vertexShader:t,fragmentShader:r});t=g.vertexShader,r=g.fragmentShader}if(d){let g=[];r=r.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,b=>(g.push(b),"")),f=`${d}
${g.join(`
`)}
${f}`}if(m){const g=`
uniform float ${m};
`;e=g+e,i=g+i}return s&&(t=`vec3 troika_position_${n};
vec3 troika_normal_${n};
vec2 troika_uv_${n};
${t}
`,e=`${e}
void troikaVertexTransform${n}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${s}
}
`,a=`
troika_position_${n} = vec3(position);
troika_normal_${n} = vec3(normal);
troika_uv_${n} = vec2(uv);
troikaVertexTransform${n}(troika_position_${n}, troika_normal_${n}, troika_uv_${n});
${a}
`,t=t.replace(/\b(position|normal|uv)\b/g,(g,b,v,p)=>/\battribute\s+vec[23]\s+$/.test(p.substr(0,v))?b:`troika_${b}_${n}`),o.map&&o.map.channel>0||(t=t.replace(/\bMAP_UV\b/g,`troika_uv_${n}`))),t=ja(t,n,e,a,c),r=ja(r,n,i,u,f),{vertexShader:t,fragmentShader:r}}function ja(o,t,r,l,n){return(l||n||r)&&(o=o.replace(Js,`
${r}
void troikaOrigMain${t}() {`),o+=`
void main() {
  ${l}
  troikaOrigMain${t}();
  ${n}
}`),o}function Yf(o,t){return o==="uniforms"?void 0:typeof t=="function"?t.toString():t}let Xf=0;const qa=new Map;function Qf(o){const t=JSON.stringify(o,Yf);let r=qa.get(t);return r==null&&qa.set(t,r=++Xf),r}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function Kf(){return typeof window>"u"&&(self.window=self),function(o){var t={parse:function(n){var e=t._bin,a=new Uint8Array(n);if(e.readASCII(a,0,4)=="ttcf"){var c=4;e.readUshort(a,c),c+=2,e.readUshort(a,c),c+=2;var s=e.readUint(a,c);c+=4;for(var i=[],u=0;u<s;u++){var f=e.readUint(a,c);c+=4,i.push(t._readFont(a,f))}return i}return[t._readFont(a,0)]},_readFont:function(n,e){var a=t._bin,c=e;a.readFixed(n,e),e+=4;var s=a.readUshort(n,e);e+=2,a.readUshort(n,e),e+=2,a.readUshort(n,e),e+=2,a.readUshort(n,e),e+=2;for(var i=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],u={_data:n,_offset:c},f={},d=0;d<s;d++){var h=a.readASCII(n,e,4);e+=4,a.readUint(n,e),e+=4;var m=a.readUint(n,e);e+=4;var g=a.readUint(n,e);e+=4,f[h]={offset:m,length:g}}for(d=0;d<i.length;d++){var b=i[d];f[b]&&(u[b.trim()]=t[b.trim()].parse(n,f[b].offset,f[b].length,u))}return u},_tabOffset:function(n,e,a){for(var c=t._bin,s=c.readUshort(n,a+4),i=a+12,u=0;u<s;u++){var f=c.readASCII(n,i,4);i+=4,c.readUint(n,i),i+=4;var d=c.readUint(n,i);if(i+=4,c.readUint(n,i),i+=4,f==e)return d}return 0}};t._bin={readFixed:function(n,e){return(n[e]<<8|n[e+1])+(n[e+2]<<8|n[e+3])/65540},readF2dot14:function(n,e){return t._bin.readShort(n,e)/16384},readInt:function(n,e){return t._bin._view(n).getInt32(e)},readInt8:function(n,e){return t._bin._view(n).getInt8(e)},readShort:function(n,e){return t._bin._view(n).getInt16(e)},readUshort:function(n,e){return t._bin._view(n).getUint16(e)},readUshorts:function(n,e,a){for(var c=[],s=0;s<a;s++)c.push(t._bin.readUshort(n,e+2*s));return c},readUint:function(n,e){return t._bin._view(n).getUint32(e)},readUint64:function(n,e){return 4294967296*t._bin.readUint(n,e)+t._bin.readUint(n,e+4)},readASCII:function(n,e,a){for(var c="",s=0;s<a;s++)c+=String.fromCharCode(n[e+s]);return c},readUnicode:function(n,e,a){for(var c="",s=0;s<a;s++){var i=n[e++]<<8|n[e++];c+=String.fromCharCode(i)}return c},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(n,e,a){var c=t._bin._tdec;return c&&e==0&&a==n.length?c.decode(n):t._bin.readASCII(n,e,a)},readBytes:function(n,e,a){for(var c=[],s=0;s<a;s++)c.push(n[e+s]);return c},readASCIIArray:function(n,e,a){for(var c=[],s=0;s<a;s++)c.push(String.fromCharCode(n[e+s]));return c},_view:function(n){return n._dataView||(n._dataView=n.buffer?new DataView(n.buffer,n.byteOffset,n.byteLength):new DataView(new Uint8Array(n).buffer))}},t._lctf={},t._lctf.parse=function(n,e,a,c,s){var i=t._bin,u={},f=e;i.readFixed(n,e),e+=4;var d=i.readUshort(n,e);e+=2;var h=i.readUshort(n,e);e+=2;var m=i.readUshort(n,e);return e+=2,u.scriptList=t._lctf.readScriptList(n,f+d),u.featureList=t._lctf.readFeatureList(n,f+h),u.lookupList=t._lctf.readLookupList(n,f+m,s),u},t._lctf.readLookupList=function(n,e,a){var c=t._bin,s=e,i=[],u=c.readUshort(n,e);e+=2;for(var f=0;f<u;f++){var d=c.readUshort(n,e);e+=2;var h=t._lctf.readLookupTable(n,s+d,a);i.push(h)}return i},t._lctf.readLookupTable=function(n,e,a){var c=t._bin,s=e,i={tabs:[]};i.ltype=c.readUshort(n,e),e+=2,i.flag=c.readUshort(n,e),e+=2;var u=c.readUshort(n,e);e+=2;for(var f=i.ltype,d=0;d<u;d++){var h=c.readUshort(n,e);e+=2;var m=a(n,f,s+h,i);i.tabs.push(m)}return i},t._lctf.numOfOnes=function(n){for(var e=0,a=0;a<32;a++)n>>>a&1&&e++;return e},t._lctf.readClassDef=function(n,e){var a=t._bin,c=[],s=a.readUshort(n,e);if(e+=2,s==1){var i=a.readUshort(n,e);e+=2;var u=a.readUshort(n,e);e+=2;for(var f=0;f<u;f++)c.push(i+f),c.push(i+f),c.push(a.readUshort(n,e)),e+=2}if(s==2){var d=a.readUshort(n,e);for(e+=2,f=0;f<d;f++)c.push(a.readUshort(n,e)),e+=2,c.push(a.readUshort(n,e)),e+=2,c.push(a.readUshort(n,e)),e+=2}return c},t._lctf.getInterval=function(n,e){for(var a=0;a<n.length;a+=3){var c=n[a],s=n[a+1];if(n[a+2],c<=e&&e<=s)return a}return-1},t._lctf.readCoverage=function(n,e){var a=t._bin,c={};c.fmt=a.readUshort(n,e),e+=2;var s=a.readUshort(n,e);return e+=2,c.fmt==1&&(c.tab=a.readUshorts(n,e,s)),c.fmt==2&&(c.tab=a.readUshorts(n,e,3*s)),c},t._lctf.coverageIndex=function(n,e){var a=n.tab;if(n.fmt==1)return a.indexOf(e);if(n.fmt==2){var c=t._lctf.getInterval(a,e);if(c!=-1)return a[c+2]+(e-a[c])}return-1},t._lctf.readFeatureList=function(n,e){var a=t._bin,c=e,s=[],i=a.readUshort(n,e);e+=2;for(var u=0;u<i;u++){var f=a.readASCII(n,e,4);e+=4;var d=a.readUshort(n,e);e+=2;var h=t._lctf.readFeatureTable(n,c+d);h.tag=f.trim(),s.push(h)}return s},t._lctf.readFeatureTable=function(n,e){var a=t._bin,c=e,s={},i=a.readUshort(n,e);e+=2,i>0&&(s.featureParams=c+i);var u=a.readUshort(n,e);e+=2,s.tab=[];for(var f=0;f<u;f++)s.tab.push(a.readUshort(n,e+2*f));return s},t._lctf.readScriptList=function(n,e){var a=t._bin,c=e,s={},i=a.readUshort(n,e);e+=2;for(var u=0;u<i;u++){var f=a.readASCII(n,e,4);e+=4;var d=a.readUshort(n,e);e+=2,s[f.trim()]=t._lctf.readScriptTable(n,c+d)}return s},t._lctf.readScriptTable=function(n,e){var a=t._bin,c=e,s={},i=a.readUshort(n,e);e+=2,i>0&&(s.default=t._lctf.readLangSysTable(n,c+i));var u=a.readUshort(n,e);e+=2;for(var f=0;f<u;f++){var d=a.readASCII(n,e,4);e+=4;var h=a.readUshort(n,e);e+=2,s[d.trim()]=t._lctf.readLangSysTable(n,c+h)}return s},t._lctf.readLangSysTable=function(n,e){var a=t._bin,c={};a.readUshort(n,e),e+=2,c.reqFeature=a.readUshort(n,e),e+=2;var s=a.readUshort(n,e);return e+=2,c.features=a.readUshorts(n,e,s),c},t.CFF={},t.CFF.parse=function(n,e,a){var c=t._bin;(n=new Uint8Array(n.buffer,e,a))[e=0],n[++e],n[++e],n[++e],e++;var s=[];e=t.CFF.readIndex(n,e,s);for(var i=[],u=0;u<s.length-1;u++)i.push(c.readASCII(n,e+s[u],s[u+1]-s[u]));e+=s[s.length-1];var f=[];e=t.CFF.readIndex(n,e,f);var d=[];for(u=0;u<f.length-1;u++)d.push(t.CFF.readDict(n,e+f[u],e+f[u+1]));e+=f[f.length-1];var h=d[0],m=[];e=t.CFF.readIndex(n,e,m);var g=[];for(u=0;u<m.length-1;u++)g.push(c.readASCII(n,e+m[u],m[u+1]-m[u]));if(e+=m[m.length-1],t.CFF.readSubrs(n,e,h),h.CharStrings){e=h.CharStrings,m=[],e=t.CFF.readIndex(n,e,m);var b=[];for(u=0;u<m.length-1;u++)b.push(c.readBytes(n,e+m[u],m[u+1]-m[u]));h.CharStrings=b}if(h.ROS){e=h.FDArray;var v=[];for(e=t.CFF.readIndex(n,e,v),h.FDArray=[],u=0;u<v.length-1;u++){var p=t.CFF.readDict(n,e+v[u],e+v[u+1]);t.CFF._readFDict(n,p,g),h.FDArray.push(p)}e+=v[v.length-1],e=h.FDSelect,h.FDSelect=[];var x=n[e];if(e++,x!=3)throw x;var y=c.readUshort(n,e);for(e+=2,u=0;u<y+1;u++)h.FDSelect.push(c.readUshort(n,e),n[e+2]),e+=3}return h.Encoding&&(h.Encoding=t.CFF.readEncoding(n,h.Encoding,h.CharStrings.length)),h.charset&&(h.charset=t.CFF.readCharset(n,h.charset,h.CharStrings.length)),t.CFF._readFDict(n,h,g),h},t.CFF._readFDict=function(n,e,a){var c;for(var s in e.Private&&(c=e.Private[1],e.Private=t.CFF.readDict(n,c,c+e.Private[0]),e.Private.Subrs&&t.CFF.readSubrs(n,c+e.Private.Subrs,e.Private)),e)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(s)!=-1&&(e[s]=a[e[s]-426+35])},t.CFF.readSubrs=function(n,e,a){var c=t._bin,s=[];e=t.CFF.readIndex(n,e,s);var i,u=s.length;i=u<1240?107:u<33900?1131:32768,a.Bias=i,a.Subrs=[];for(var f=0;f<s.length-1;f++)a.Subrs.push(c.readBytes(n,e+s[f],s[f+1]-s[f]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(n,e){for(var a=0;a<n.charset.length;a++)if(n.charset[a]==e)return a;return-1},t.CFF.glyphBySE=function(n,e){return e<0||e>255?-1:t.CFF.glyphByUnicode(n,t.CFF.tableSE[e])},t.CFF.readEncoding=function(n,e,a){t._bin;var c=[".notdef"],s=n[e];if(e++,s!=0)throw"error: unknown encoding format: "+s;var i=n[e];e++;for(var u=0;u<i;u++)c.push(n[e+u]);return c},t.CFF.readCharset=function(n,e,a){var c=t._bin,s=[".notdef"],i=n[e];if(e++,i==0)for(var u=0;u<a;u++){var f=c.readUshort(n,e);e+=2,s.push(f)}else{if(i!=1&&i!=2)throw"error: format: "+i;for(;s.length<a;){f=c.readUshort(n,e),e+=2;var d=0;for(i==1?(d=n[e],e++):(d=c.readUshort(n,e),e+=2),u=0;u<=d;u++)s.push(f),f++}}return s},t.CFF.readIndex=function(n,e,a){var c=t._bin,s=c.readUshort(n,e)+1,i=n[e+=2];if(e++,i==1)for(var u=0;u<s;u++)a.push(n[e+u]);else if(i==2)for(u=0;u<s;u++)a.push(c.readUshort(n,e+2*u));else if(i==3)for(u=0;u<s;u++)a.push(16777215&c.readUint(n,e+3*u-1));else if(s!=1)throw"unsupported offset size: "+i+", count: "+s;return(e+=s*i)-1},t.CFF.getCharString=function(n,e,a){var c=t._bin,s=n[e],i=n[e+1];n[e+2],n[e+3],n[e+4];var u=1,f=null,d=null;s<=20&&(f=s,u=1),s==12&&(f=100*s+i,u=2),21<=s&&s<=27&&(f=s,u=1),s==28&&(d=c.readShort(n,e+1),u=3),29<=s&&s<=31&&(f=s,u=1),32<=s&&s<=246&&(d=s-139,u=1),247<=s&&s<=250&&(d=256*(s-247)+i+108,u=2),251<=s&&s<=254&&(d=256*-(s-251)-i-108,u=2),s==255&&(d=c.readInt(n,e+1)/65535,u=5),a.val=d??"o"+f,a.size=u},t.CFF.readCharString=function(n,e,a){for(var c=e+a,s=t._bin,i=[];e<c;){var u=n[e],f=n[e+1];n[e+2],n[e+3],n[e+4];var d=1,h=null,m=null;u<=20&&(h=u,d=1),u==12&&(h=100*u+f,d=2),u!=19&&u!=20||(h=u,d=2),21<=u&&u<=27&&(h=u,d=1),u==28&&(m=s.readShort(n,e+1),d=3),29<=u&&u<=31&&(h=u,d=1),32<=u&&u<=246&&(m=u-139,d=1),247<=u&&u<=250&&(m=256*(u-247)+f+108,d=2),251<=u&&u<=254&&(m=256*-(u-251)-f-108,d=2),u==255&&(m=s.readInt(n,e+1)/65535,d=5),i.push(m??"o"+h),e+=d}return i},t.CFF.readDict=function(n,e,a){for(var c=t._bin,s={},i=[];e<a;){var u=n[e],f=n[e+1];n[e+2],n[e+3],n[e+4];var d=1,h=null,m=null;if(u==28&&(m=c.readShort(n,e+1),d=3),u==29&&(m=c.readInt(n,e+1),d=5),32<=u&&u<=246&&(m=u-139,d=1),247<=u&&u<=250&&(m=256*(u-247)+f+108,d=2),251<=u&&u<=254&&(m=256*-(u-251)-f-108,d=2),u==255)throw m=c.readInt(n,e+1)/65535,d=5,"unknown number";if(u==30){var g=[];for(d=1;;){var b=n[e+d];d++;var v=b>>4,p=15&b;if(v!=15&&g.push(v),p!=15&&g.push(p),p==15)break}for(var x="",y=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],_=0;_<g.length;_++)x+=y[g[_]];m=parseFloat(x)}u<=21&&(h=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][u],d=1,u==12&&(h=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][f],d=2)),h!=null?(s[h]=i.length==1?i[0]:i,i=[]):i.push(m),e+=d}return s},t.cmap={},t.cmap.parse=function(n,e,a){n=new Uint8Array(n.buffer,e,a),e=0;var c=t._bin,s={};c.readUshort(n,e),e+=2;var i=c.readUshort(n,e);e+=2;var u=[];s.tables=[];for(var f=0;f<i;f++){var d=c.readUshort(n,e);e+=2;var h=c.readUshort(n,e);e+=2;var m=c.readUint(n,e);e+=4;var g="p"+d+"e"+h,b=u.indexOf(m);if(b==-1){var v;b=s.tables.length,u.push(m);var p=c.readUshort(n,m);p==0?v=t.cmap.parse0(n,m):p==4?v=t.cmap.parse4(n,m):p==6?v=t.cmap.parse6(n,m):p==12?v=t.cmap.parse12(n,m):console.debug("unknown format: "+p,d,h,m),s.tables.push(v)}if(s[g]!=null)throw"multiple tables for one platform+encoding";s[g]=b}return s},t.cmap.parse0=function(n,e){var a=t._bin,c={};c.format=a.readUshort(n,e),e+=2;var s=a.readUshort(n,e);e+=2,a.readUshort(n,e),e+=2,c.map=[];for(var i=0;i<s-6;i++)c.map.push(n[e+i]);return c},t.cmap.parse4=function(n,e){var a=t._bin,c=e,s={};s.format=a.readUshort(n,e),e+=2;var i=a.readUshort(n,e);e+=2,a.readUshort(n,e),e+=2;var u=a.readUshort(n,e);e+=2;var f=u/2;s.searchRange=a.readUshort(n,e),e+=2,s.entrySelector=a.readUshort(n,e),e+=2,s.rangeShift=a.readUshort(n,e),e+=2,s.endCount=a.readUshorts(n,e,f),e+=2*f,e+=2,s.startCount=a.readUshorts(n,e,f),e+=2*f,s.idDelta=[];for(var d=0;d<f;d++)s.idDelta.push(a.readShort(n,e)),e+=2;for(s.idRangeOffset=a.readUshorts(n,e,f),e+=2*f,s.glyphIdArray=[];e<c+i;)s.glyphIdArray.push(a.readUshort(n,e)),e+=2;return s},t.cmap.parse6=function(n,e){var a=t._bin,c={};c.format=a.readUshort(n,e),e+=2,a.readUshort(n,e),e+=2,a.readUshort(n,e),e+=2,c.firstCode=a.readUshort(n,e),e+=2;var s=a.readUshort(n,e);e+=2,c.glyphIdArray=[];for(var i=0;i<s;i++)c.glyphIdArray.push(a.readUshort(n,e)),e+=2;return c},t.cmap.parse12=function(n,e){var a=t._bin,c={};c.format=a.readUshort(n,e),e+=2,e+=2,a.readUint(n,e),e+=4,a.readUint(n,e),e+=4;var s=a.readUint(n,e);e+=4,c.groups=[];for(var i=0;i<s;i++){var u=e+12*i,f=a.readUint(n,u+0),d=a.readUint(n,u+4),h=a.readUint(n,u+8);c.groups.push([f,d,h])}return c},t.glyf={},t.glyf.parse=function(n,e,a,c){for(var s=[],i=0;i<c.maxp.numGlyphs;i++)s.push(null);return s},t.glyf._parseGlyf=function(n,e){var a=t._bin,c=n._data,s=t._tabOffset(c,"glyf",n._offset)+n.loca[e];if(n.loca[e]==n.loca[e+1])return null;var i={};if(i.noc=a.readShort(c,s),s+=2,i.xMin=a.readShort(c,s),s+=2,i.yMin=a.readShort(c,s),s+=2,i.xMax=a.readShort(c,s),s+=2,i.yMax=a.readShort(c,s),s+=2,i.xMin>=i.xMax||i.yMin>=i.yMax)return null;if(i.noc>0){i.endPts=[];for(var u=0;u<i.noc;u++)i.endPts.push(a.readUshort(c,s)),s+=2;var f=a.readUshort(c,s);if(s+=2,c.length-s<f)return null;i.instructions=a.readBytes(c,s,f),s+=f;var d=i.endPts[i.noc-1]+1;for(i.flags=[],u=0;u<d;u++){var h=c[s];if(s++,i.flags.push(h),(8&h)!=0){var m=c[s];s++;for(var g=0;g<m;g++)i.flags.push(h),u++}}for(i.xs=[],u=0;u<d;u++){var b=(2&i.flags[u])!=0,v=(16&i.flags[u])!=0;b?(i.xs.push(v?c[s]:-c[s]),s++):v?i.xs.push(0):(i.xs.push(a.readShort(c,s)),s+=2)}for(i.ys=[],u=0;u<d;u++)b=(4&i.flags[u])!=0,v=(32&i.flags[u])!=0,b?(i.ys.push(v?c[s]:-c[s]),s++):v?i.ys.push(0):(i.ys.push(a.readShort(c,s)),s+=2);var p=0,x=0;for(u=0;u<d;u++)p+=i.xs[u],x+=i.ys[u],i.xs[u]=p,i.ys[u]=x}else{var y;i.parts=[];do{y=a.readUshort(c,s),s+=2;var _={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(i.parts.push(_),_.glyphIndex=a.readUshort(c,s),s+=2,1&y){var M=a.readShort(c,s);s+=2;var w=a.readShort(c,s);s+=2}else M=a.readInt8(c,s),s++,w=a.readInt8(c,s),s++;2&y?(_.m.tx=M,_.m.ty=w):(_.p1=M,_.p2=w),8&y?(_.m.a=_.m.d=a.readF2dot14(c,s),s+=2):64&y?(_.m.a=a.readF2dot14(c,s),s+=2,_.m.d=a.readF2dot14(c,s),s+=2):128&y&&(_.m.a=a.readF2dot14(c,s),s+=2,_.m.b=a.readF2dot14(c,s),s+=2,_.m.c=a.readF2dot14(c,s),s+=2,_.m.d=a.readF2dot14(c,s),s+=2)}while(32&y);if(256&y){var A=a.readUshort(c,s);for(s+=2,i.instr=[],u=0;u<A;u++)i.instr.push(c[s]),s++}}return i},t.GDEF={},t.GDEF.parse=function(n,e,a,c){var s=e;e+=4;var i=t._bin.readUshort(n,e);return{glyphClassDef:i===0?null:t._lctf.readClassDef(n,s+i)}},t.GPOS={},t.GPOS.parse=function(n,e,a,c){return t._lctf.parse(n,e,a,c,t.GPOS.subt)},t.GPOS.subt=function(n,e,a,c){var s=t._bin,i=a,u={};if(u.fmt=s.readUshort(n,a),a+=2,e==1||e==2||e==3||e==7||e==8&&u.fmt<=2){var f=s.readUshort(n,a);a+=2,u.coverage=t._lctf.readCoverage(n,f+i)}if(e==1&&u.fmt==1){var d=s.readUshort(n,a);a+=2,d!=0&&(u.pos=t.GPOS.readValueRecord(n,a,d))}else if(e==2&&u.fmt>=1&&u.fmt<=2){d=s.readUshort(n,a),a+=2;var h=s.readUshort(n,a);a+=2;var m=t._lctf.numOfOnes(d),g=t._lctf.numOfOnes(h);if(u.fmt==1){u.pairsets=[];var b=s.readUshort(n,a);a+=2;for(var v=0;v<b;v++){var p=i+s.readUshort(n,a);a+=2;var x=s.readUshort(n,p);p+=2;for(var y=[],_=0;_<x;_++){var M=s.readUshort(n,p);p+=2,d!=0&&(T=t.GPOS.readValueRecord(n,p,d),p+=2*m),h!=0&&(R=t.GPOS.readValueRecord(n,p,h),p+=2*g),y.push({gid2:M,val1:T,val2:R})}u.pairsets.push(y)}}if(u.fmt==2){var w=s.readUshort(n,a);a+=2;var A=s.readUshort(n,a);a+=2;var F=s.readUshort(n,a);a+=2;var k=s.readUshort(n,a);for(a+=2,u.classDef1=t._lctf.readClassDef(n,i+w),u.classDef2=t._lctf.readClassDef(n,i+A),u.matrix=[],v=0;v<F;v++){var D=[];for(_=0;_<k;_++){var T=null,R=null;d!=0&&(T=t.GPOS.readValueRecord(n,a,d),a+=2*m),h!=0&&(R=t.GPOS.readValueRecord(n,a,h),a+=2*g),D.push({val1:T,val2:R})}u.matrix.push(D)}}}else if(e==4&&u.fmt==1)u.markCoverage=t._lctf.readCoverage(n,s.readUshort(n,a)+i),u.baseCoverage=t._lctf.readCoverage(n,s.readUshort(n,a+2)+i),u.markClassCount=s.readUshort(n,a+4),u.markArray=t.GPOS.readMarkArray(n,s.readUshort(n,a+6)+i),u.baseArray=t.GPOS.readBaseArray(n,s.readUshort(n,a+8)+i,u.markClassCount);else if(e==6&&u.fmt==1)u.mark1Coverage=t._lctf.readCoverage(n,s.readUshort(n,a)+i),u.mark2Coverage=t._lctf.readCoverage(n,s.readUshort(n,a+2)+i),u.markClassCount=s.readUshort(n,a+4),u.mark1Array=t.GPOS.readMarkArray(n,s.readUshort(n,a+6)+i),u.mark2Array=t.GPOS.readBaseArray(n,s.readUshort(n,a+8)+i,u.markClassCount);else{if(e==9&&u.fmt==1){var U=s.readUshort(n,a);a+=2;var H=s.readUint(n,a);if(a+=4,c.ltype==9)c.ltype=U;else if(c.ltype!=U)throw"invalid extension substitution";return t.GPOS.subt(n,c.ltype,i+H)}console.debug("unsupported GPOS table LookupType",e,"format",u.fmt)}return u},t.GPOS.readValueRecord=function(n,e,a){var c=t._bin,s=[];return s.push(1&a?c.readShort(n,e):0),e+=1&a?2:0,s.push(2&a?c.readShort(n,e):0),e+=2&a?2:0,s.push(4&a?c.readShort(n,e):0),e+=4&a?2:0,s.push(8&a?c.readShort(n,e):0),e+=8&a?2:0,s},t.GPOS.readBaseArray=function(n,e,a){var c=t._bin,s=[],i=e,u=c.readUshort(n,e);e+=2;for(var f=0;f<u;f++){for(var d=[],h=0;h<a;h++)d.push(t.GPOS.readAnchorRecord(n,i+c.readUshort(n,e))),e+=2;s.push(d)}return s},t.GPOS.readMarkArray=function(n,e){var a=t._bin,c=[],s=e,i=a.readUshort(n,e);e+=2;for(var u=0;u<i;u++){var f=t.GPOS.readAnchorRecord(n,a.readUshort(n,e+2)+s);f.markClass=a.readUshort(n,e),c.push(f),e+=4}return c},t.GPOS.readAnchorRecord=function(n,e){var a=t._bin,c={};return c.fmt=a.readUshort(n,e),c.x=a.readShort(n,e+2),c.y=a.readShort(n,e+4),c},t.GSUB={},t.GSUB.parse=function(n,e,a,c){return t._lctf.parse(n,e,a,c,t.GSUB.subt)},t.GSUB.subt=function(n,e,a,c){var s=t._bin,i=a,u={};if(u.fmt=s.readUshort(n,a),a+=2,e!=1&&e!=2&&e!=4&&e!=5&&e!=6)return null;if(e==1||e==2||e==4||e==5&&u.fmt<=2||e==6&&u.fmt<=2){var f=s.readUshort(n,a);a+=2,u.coverage=t._lctf.readCoverage(n,i+f)}if(e==1&&u.fmt>=1&&u.fmt<=2){if(u.fmt==1)u.delta=s.readShort(n,a),a+=2;else if(u.fmt==2){var d=s.readUshort(n,a);a+=2,u.newg=s.readUshorts(n,a,d),a+=2*u.newg.length}}else if(e==2&&u.fmt==1){d=s.readUshort(n,a),a+=2,u.seqs=[];for(var h=0;h<d;h++){var m=s.readUshort(n,a)+i;a+=2;var g=s.readUshort(n,m);u.seqs.push(s.readUshorts(n,m+2,g))}}else if(e==4)for(u.vals=[],d=s.readUshort(n,a),a+=2,h=0;h<d;h++){var b=s.readUshort(n,a);a+=2,u.vals.push(t.GSUB.readLigatureSet(n,i+b))}else if(e==5&&u.fmt==2){if(u.fmt==2){var v=s.readUshort(n,a);a+=2,u.cDef=t._lctf.readClassDef(n,i+v),u.scset=[];var p=s.readUshort(n,a);for(a+=2,h=0;h<p;h++){var x=s.readUshort(n,a);a+=2,u.scset.push(x==0?null:t.GSUB.readSubClassSet(n,i+x))}}}else if(e==6&&u.fmt==3){if(u.fmt==3){for(h=0;h<3;h++){d=s.readUshort(n,a),a+=2;for(var y=[],_=0;_<d;_++)y.push(t._lctf.readCoverage(n,i+s.readUshort(n,a+2*_)));a+=2*d,h==0&&(u.backCvg=y),h==1&&(u.inptCvg=y),h==2&&(u.ahedCvg=y)}d=s.readUshort(n,a),a+=2,u.lookupRec=t.GSUB.readSubstLookupRecords(n,a,d)}}else{if(e==7&&u.fmt==1){var M=s.readUshort(n,a);a+=2;var w=s.readUint(n,a);if(a+=4,c.ltype==9)c.ltype=M;else if(c.ltype!=M)throw"invalid extension substitution";return t.GSUB.subt(n,c.ltype,i+w)}console.debug("unsupported GSUB table LookupType",e,"format",u.fmt)}return u},t.GSUB.readSubClassSet=function(n,e){var a=t._bin.readUshort,c=e,s=[],i=a(n,e);e+=2;for(var u=0;u<i;u++){var f=a(n,e);e+=2,s.push(t.GSUB.readSubClassRule(n,c+f))}return s},t.GSUB.readSubClassRule=function(n,e){var a=t._bin.readUshort,c={},s=a(n,e),i=a(n,e+=2);e+=2,c.input=[];for(var u=0;u<s-1;u++)c.input.push(a(n,e)),e+=2;return c.substLookupRecords=t.GSUB.readSubstLookupRecords(n,e,i),c},t.GSUB.readSubstLookupRecords=function(n,e,a){for(var c=t._bin.readUshort,s=[],i=0;i<a;i++)s.push(c(n,e),c(n,e+2)),e+=4;return s},t.GSUB.readChainSubClassSet=function(n,e){var a=t._bin,c=e,s=[],i=a.readUshort(n,e);e+=2;for(var u=0;u<i;u++){var f=a.readUshort(n,e);e+=2,s.push(t.GSUB.readChainSubClassRule(n,c+f))}return s},t.GSUB.readChainSubClassRule=function(n,e){for(var a=t._bin,c={},s=["backtrack","input","lookahead"],i=0;i<s.length;i++){var u=a.readUshort(n,e);e+=2,i==1&&u--,c[s[i]]=a.readUshorts(n,e,u),e+=2*c[s[i]].length}return u=a.readUshort(n,e),e+=2,c.subst=a.readUshorts(n,e,2*u),e+=2*c.subst.length,c},t.GSUB.readLigatureSet=function(n,e){var a=t._bin,c=e,s=[],i=a.readUshort(n,e);e+=2;for(var u=0;u<i;u++){var f=a.readUshort(n,e);e+=2,s.push(t.GSUB.readLigature(n,c+f))}return s},t.GSUB.readLigature=function(n,e){var a=t._bin,c={chain:[]};c.nglyph=a.readUshort(n,e),e+=2;var s=a.readUshort(n,e);e+=2;for(var i=0;i<s-1;i++)c.chain.push(a.readUshort(n,e)),e+=2;return c},t.head={},t.head.parse=function(n,e,a){var c=t._bin,s={};return c.readFixed(n,e),e+=4,s.fontRevision=c.readFixed(n,e),e+=4,c.readUint(n,e),e+=4,c.readUint(n,e),e+=4,s.flags=c.readUshort(n,e),e+=2,s.unitsPerEm=c.readUshort(n,e),e+=2,s.created=c.readUint64(n,e),e+=8,s.modified=c.readUint64(n,e),e+=8,s.xMin=c.readShort(n,e),e+=2,s.yMin=c.readShort(n,e),e+=2,s.xMax=c.readShort(n,e),e+=2,s.yMax=c.readShort(n,e),e+=2,s.macStyle=c.readUshort(n,e),e+=2,s.lowestRecPPEM=c.readUshort(n,e),e+=2,s.fontDirectionHint=c.readShort(n,e),e+=2,s.indexToLocFormat=c.readShort(n,e),e+=2,s.glyphDataFormat=c.readShort(n,e),e+=2,s},t.hhea={},t.hhea.parse=function(n,e,a){var c=t._bin,s={};return c.readFixed(n,e),e+=4,s.ascender=c.readShort(n,e),e+=2,s.descender=c.readShort(n,e),e+=2,s.lineGap=c.readShort(n,e),e+=2,s.advanceWidthMax=c.readUshort(n,e),e+=2,s.minLeftSideBearing=c.readShort(n,e),e+=2,s.minRightSideBearing=c.readShort(n,e),e+=2,s.xMaxExtent=c.readShort(n,e),e+=2,s.caretSlopeRise=c.readShort(n,e),e+=2,s.caretSlopeRun=c.readShort(n,e),e+=2,s.caretOffset=c.readShort(n,e),e+=2,e+=8,s.metricDataFormat=c.readShort(n,e),e+=2,s.numberOfHMetrics=c.readUshort(n,e),e+=2,s},t.hmtx={},t.hmtx.parse=function(n,e,a,c){for(var s=t._bin,i={aWidth:[],lsBearing:[]},u=0,f=0,d=0;d<c.maxp.numGlyphs;d++)d<c.hhea.numberOfHMetrics&&(u=s.readUshort(n,e),e+=2,f=s.readShort(n,e),e+=2),i.aWidth.push(u),i.lsBearing.push(f);return i},t.kern={},t.kern.parse=function(n,e,a,c){var s=t._bin,i=s.readUshort(n,e);if(e+=2,i==1)return t.kern.parseV1(n,e-2,a,c);var u=s.readUshort(n,e);e+=2;for(var f={glyph1:[],rval:[]},d=0;d<u;d++){e+=2,a=s.readUshort(n,e),e+=2;var h=s.readUshort(n,e);e+=2;var m=h>>>8;if((m&=15)!=0)throw"unknown kern table format: "+m;e=t.kern.readFormat0(n,e,f)}return f},t.kern.parseV1=function(n,e,a,c){var s=t._bin;s.readFixed(n,e),e+=4;var i=s.readUint(n,e);e+=4;for(var u={glyph1:[],rval:[]},f=0;f<i;f++){s.readUint(n,e),e+=4;var d=s.readUshort(n,e);e+=2,s.readUshort(n,e),e+=2;var h=d>>>8;if((h&=15)!=0)throw"unknown kern table format: "+h;e=t.kern.readFormat0(n,e,u)}return u},t.kern.readFormat0=function(n,e,a){var c=t._bin,s=-1,i=c.readUshort(n,e);e+=2,c.readUshort(n,e),e+=2,c.readUshort(n,e),e+=2,c.readUshort(n,e),e+=2;for(var u=0;u<i;u++){var f=c.readUshort(n,e);e+=2;var d=c.readUshort(n,e);e+=2;var h=c.readShort(n,e);e+=2,f!=s&&(a.glyph1.push(f),a.rval.push({glyph2:[],vals:[]}));var m=a.rval[a.rval.length-1];m.glyph2.push(d),m.vals.push(h),s=f}return e},t.loca={},t.loca.parse=function(n,e,a,c){var s=t._bin,i=[],u=c.head.indexToLocFormat,f=c.maxp.numGlyphs+1;if(u==0)for(var d=0;d<f;d++)i.push(s.readUshort(n,e+(d<<1))<<1);if(u==1)for(d=0;d<f;d++)i.push(s.readUint(n,e+(d<<2)));return i},t.maxp={},t.maxp.parse=function(n,e,a){var c=t._bin,s={},i=c.readUint(n,e);return e+=4,s.numGlyphs=c.readUshort(n,e),e+=2,i==65536&&(s.maxPoints=c.readUshort(n,e),e+=2,s.maxContours=c.readUshort(n,e),e+=2,s.maxCompositePoints=c.readUshort(n,e),e+=2,s.maxCompositeContours=c.readUshort(n,e),e+=2,s.maxZones=c.readUshort(n,e),e+=2,s.maxTwilightPoints=c.readUshort(n,e),e+=2,s.maxStorage=c.readUshort(n,e),e+=2,s.maxFunctionDefs=c.readUshort(n,e),e+=2,s.maxInstructionDefs=c.readUshort(n,e),e+=2,s.maxStackElements=c.readUshort(n,e),e+=2,s.maxSizeOfInstructions=c.readUshort(n,e),e+=2,s.maxComponentElements=c.readUshort(n,e),e+=2,s.maxComponentDepth=c.readUshort(n,e),e+=2),s},t.name={},t.name.parse=function(n,e,a){var c=t._bin,s={};c.readUshort(n,e),e+=2;var i=c.readUshort(n,e);e+=2,c.readUshort(n,e);for(var u,f=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],d=e+=2,h=0;h<i;h++){var m=c.readUshort(n,e);e+=2;var g=c.readUshort(n,e);e+=2;var b=c.readUshort(n,e);e+=2;var v=c.readUshort(n,e);e+=2;var p=c.readUshort(n,e);e+=2;var x=c.readUshort(n,e);e+=2;var y,_=f[v],M=d+12*i+x;if(m==0)y=c.readUnicode(n,M,p/2);else if(m==3&&g==0)y=c.readUnicode(n,M,p/2);else if(g==0)y=c.readASCII(n,M,p);else if(g==1)y=c.readUnicode(n,M,p/2);else if(g==3)y=c.readUnicode(n,M,p/2);else{if(m!=1)throw"unknown encoding "+g+", platformID: "+m;y=c.readASCII(n,M,p),console.debug("reading unknown MAC encoding "+g+" as ASCII")}var w="p"+m+","+b.toString(16);s[w]==null&&(s[w]={}),s[w][_!==void 0?_:v]=y,s[w]._lang=b}for(var A in s)if(s[A].postScriptName!=null&&s[A]._lang==1033)return s[A];for(var A in s)if(s[A].postScriptName!=null&&s[A]._lang==0)return s[A];for(var A in s)if(s[A].postScriptName!=null&&s[A]._lang==3084)return s[A];for(var A in s)if(s[A].postScriptName!=null)return s[A];for(var A in s){u=A;break}return console.debug("returning name table with languageID "+s[u]._lang),s[u]},t["OS/2"]={},t["OS/2"].parse=function(n,e,a){var c=t._bin.readUshort(n,e);e+=2;var s={};if(c==0)t["OS/2"].version0(n,e,s);else if(c==1)t["OS/2"].version1(n,e,s);else if(c==2||c==3||c==4)t["OS/2"].version2(n,e,s);else{if(c!=5)throw"unknown OS/2 table version: "+c;t["OS/2"].version5(n,e,s)}return s},t["OS/2"].version0=function(n,e,a){var c=t._bin;return a.xAvgCharWidth=c.readShort(n,e),e+=2,a.usWeightClass=c.readUshort(n,e),e+=2,a.usWidthClass=c.readUshort(n,e),e+=2,a.fsType=c.readUshort(n,e),e+=2,a.ySubscriptXSize=c.readShort(n,e),e+=2,a.ySubscriptYSize=c.readShort(n,e),e+=2,a.ySubscriptXOffset=c.readShort(n,e),e+=2,a.ySubscriptYOffset=c.readShort(n,e),e+=2,a.ySuperscriptXSize=c.readShort(n,e),e+=2,a.ySuperscriptYSize=c.readShort(n,e),e+=2,a.ySuperscriptXOffset=c.readShort(n,e),e+=2,a.ySuperscriptYOffset=c.readShort(n,e),e+=2,a.yStrikeoutSize=c.readShort(n,e),e+=2,a.yStrikeoutPosition=c.readShort(n,e),e+=2,a.sFamilyClass=c.readShort(n,e),e+=2,a.panose=c.readBytes(n,e,10),e+=10,a.ulUnicodeRange1=c.readUint(n,e),e+=4,a.ulUnicodeRange2=c.readUint(n,e),e+=4,a.ulUnicodeRange3=c.readUint(n,e),e+=4,a.ulUnicodeRange4=c.readUint(n,e),e+=4,a.achVendID=[c.readInt8(n,e),c.readInt8(n,e+1),c.readInt8(n,e+2),c.readInt8(n,e+3)],e+=4,a.fsSelection=c.readUshort(n,e),e+=2,a.usFirstCharIndex=c.readUshort(n,e),e+=2,a.usLastCharIndex=c.readUshort(n,e),e+=2,a.sTypoAscender=c.readShort(n,e),e+=2,a.sTypoDescender=c.readShort(n,e),e+=2,a.sTypoLineGap=c.readShort(n,e),e+=2,a.usWinAscent=c.readUshort(n,e),e+=2,a.usWinDescent=c.readUshort(n,e),e+=2},t["OS/2"].version1=function(n,e,a){var c=t._bin;return e=t["OS/2"].version0(n,e,a),a.ulCodePageRange1=c.readUint(n,e),e+=4,a.ulCodePageRange2=c.readUint(n,e),e+=4},t["OS/2"].version2=function(n,e,a){var c=t._bin;return e=t["OS/2"].version1(n,e,a),a.sxHeight=c.readShort(n,e),e+=2,a.sCapHeight=c.readShort(n,e),e+=2,a.usDefault=c.readUshort(n,e),e+=2,a.usBreak=c.readUshort(n,e),e+=2,a.usMaxContext=c.readUshort(n,e),e+=2},t["OS/2"].version5=function(n,e,a){var c=t._bin;return e=t["OS/2"].version2(n,e,a),a.usLowerOpticalPointSize=c.readUshort(n,e),e+=2,a.usUpperOpticalPointSize=c.readUshort(n,e),e+=2},t.post={},t.post.parse=function(n,e,a){var c=t._bin,s={};return s.version=c.readFixed(n,e),e+=4,s.italicAngle=c.readFixed(n,e),e+=4,s.underlinePosition=c.readShort(n,e),e+=2,s.underlineThickness=c.readShort(n,e),e+=2,s},t==null&&(t={}),t.U==null&&(t.U={}),t.U.codeToGlyph=function(n,e){var a=n.cmap,c=-1;if(a.p0e4!=null?c=a.p0e4:a.p3e1!=null?c=a.p3e1:a.p1e0!=null?c=a.p1e0:a.p0e3!=null&&(c=a.p0e3),c==-1)throw"no familiar platform and encoding!";var s=a.tables[c];if(s.format==0)return e>=s.map.length?0:s.map[e];if(s.format==4){for(var i=-1,u=0;u<s.endCount.length;u++)if(e<=s.endCount[u]){i=u;break}return i==-1||s.startCount[i]>e?0:65535&(s.idRangeOffset[i]!=0?s.glyphIdArray[e-s.startCount[i]+(s.idRangeOffset[i]>>1)-(s.idRangeOffset.length-i)]:e+s.idDelta[i])}if(s.format==12){if(e>s.groups[s.groups.length-1][1])return 0;for(u=0;u<s.groups.length;u++){var f=s.groups[u];if(f[0]<=e&&e<=f[1])return f[2]+(e-f[0])}return 0}throw"unknown cmap table format "+s.format},t.U.glyphToPath=function(n,e){var a={cmds:[],crds:[]};if(n.SVG&&n.SVG.entries[e]){var c=n.SVG.entries[e];return c==null?a:(typeof c=="string"&&(c=t.SVG.toPath(c),n.SVG.entries[e]=c),c)}if(n.CFF){var s={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:n.CFF.Private?n.CFF.Private.defaultWidthX:0,open:!1},i=n.CFF,u=n.CFF.Private;if(i.ROS){for(var f=0;i.FDSelect[f+2]<=e;)f+=2;u=i.FDArray[i.FDSelect[f+1]].Private}t.U._drawCFF(n.CFF.CharStrings[e],s,i,u,a)}else n.glyf&&t.U._drawGlyf(e,n,a);return a},t.U._drawGlyf=function(n,e,a){var c=e.glyf[n];c==null&&(c=e.glyf[n]=t.glyf._parseGlyf(e,n)),c!=null&&(c.noc>-1?t.U._simpleGlyph(c,a):t.U._compoGlyph(c,e,a))},t.U._simpleGlyph=function(n,e){for(var a=0;a<n.noc;a++){for(var c=a==0?0:n.endPts[a-1]+1,s=n.endPts[a],i=c;i<=s;i++){var u=i==c?s:i-1,f=i==s?c:i+1,d=1&n.flags[i],h=1&n.flags[u],m=1&n.flags[f],g=n.xs[i],b=n.ys[i];if(i==c)if(d){if(!h){t.U.P.moveTo(e,g,b);continue}t.U.P.moveTo(e,n.xs[u],n.ys[u])}else h?t.U.P.moveTo(e,n.xs[u],n.ys[u]):t.U.P.moveTo(e,(n.xs[u]+g)/2,(n.ys[u]+b)/2);d?h&&t.U.P.lineTo(e,g,b):m?t.U.P.qcurveTo(e,g,b,n.xs[f],n.ys[f]):t.U.P.qcurveTo(e,g,b,(g+n.xs[f])/2,(b+n.ys[f])/2)}t.U.P.closePath(e)}},t.U._compoGlyph=function(n,e,a){for(var c=0;c<n.parts.length;c++){var s={cmds:[],crds:[]},i=n.parts[c];t.U._drawGlyf(i.glyphIndex,e,s);for(var u=i.m,f=0;f<s.crds.length;f+=2){var d=s.crds[f],h=s.crds[f+1];a.crds.push(d*u.a+h*u.b+u.tx),a.crds.push(d*u.c+h*u.d+u.ty)}for(f=0;f<s.cmds.length;f++)a.cmds.push(s.cmds[f])}},t.U._getGlyphClass=function(n,e){var a=t._lctf.getInterval(e,n);return a==-1?0:e[a+2]},t.U._applySubs=function(n,e,a,c){for(var s=n.length-e-1,i=0;i<a.tabs.length;i++)if(a.tabs[i]!=null){var u,f=a.tabs[i];if(!f.coverage||(u=t._lctf.coverageIndex(f.coverage,n[e]))!=-1){if(a.ltype==1)n[e],f.fmt==1?n[e]=n[e]+f.delta:n[e]=f.newg[u];else if(a.ltype==4)for(var d=f.vals[u],h=0;h<d.length;h++){var m=d[h],g=m.chain.length;if(!(g>s)){for(var b=!0,v=0,p=0;p<g;p++){for(;n[e+v+(1+p)]==-1;)v++;m.chain[p]!=n[e+v+(1+p)]&&(b=!1)}if(b){for(n[e]=m.nglyph,p=0;p<g+v;p++)n[e+p+1]=-1;break}}}else if(a.ltype==5&&f.fmt==2)for(var x=t._lctf.getInterval(f.cDef,n[e]),y=f.cDef[x+2],_=f.scset[y],M=0;M<_.length;M++){var w=_[M],A=w.input;if(!(A.length>s)){for(b=!0,p=0;p<A.length;p++){var F=t._lctf.getInterval(f.cDef,n[e+1+p]);if(x==-1&&f.cDef[F+2]!=A[p]){b=!1;break}}if(b){var k=w.substLookupRecords;for(h=0;h<k.length;h+=2)k[h],k[h+1]}}}else if(a.ltype==6&&f.fmt==3){if(!t.U._glsCovered(n,f.backCvg,e-f.backCvg.length)||!t.U._glsCovered(n,f.inptCvg,e)||!t.U._glsCovered(n,f.ahedCvg,e+f.inptCvg.length))continue;var D=f.lookupRec;for(M=0;M<D.length;M+=2){x=D[M];var T=c[D[M+1]];t.U._applySubs(n,e+x,T,c)}}}}},t.U._glsCovered=function(n,e,a){for(var c=0;c<e.length;c++)if(t._lctf.coverageIndex(e[c],n[a+c])==-1)return!1;return!0},t.U.glyphsToPath=function(n,e,a){for(var c={cmds:[],crds:[]},s=0,i=0;i<e.length;i++){var u=e[i];if(u!=-1){for(var f=i<e.length-1&&e[i+1]!=-1?e[i+1]:0,d=t.U.glyphToPath(n,u),h=0;h<d.crds.length;h+=2)c.crds.push(d.crds[h]+s),c.crds.push(d.crds[h+1]);for(a&&c.cmds.push(a),h=0;h<d.cmds.length;h++)c.cmds.push(d.cmds[h]);a&&c.cmds.push("X"),s+=n.hmtx.aWidth[u],i<e.length-1&&(s+=t.U.getPairAdjustment(n,u,f))}}return c},t.U.P={},t.U.P.moveTo=function(n,e,a){n.cmds.push("M"),n.crds.push(e,a)},t.U.P.lineTo=function(n,e,a){n.cmds.push("L"),n.crds.push(e,a)},t.U.P.curveTo=function(n,e,a,c,s,i,u){n.cmds.push("C"),n.crds.push(e,a,c,s,i,u)},t.U.P.qcurveTo=function(n,e,a,c,s){n.cmds.push("Q"),n.crds.push(e,a,c,s)},t.U.P.closePath=function(n){n.cmds.push("Z")},t.U._drawCFF=function(n,e,a,c,s){for(var i=e.stack,u=e.nStems,f=e.haveWidth,d=e.width,h=e.open,m=0,g=e.x,b=e.y,v=0,p=0,x=0,y=0,_=0,M=0,w=0,A=0,F=0,k=0,D={val:0,size:0};m<n.length;){t.CFF.getCharString(n,m,D);var T=D.val;if(m+=D.size,T=="o1"||T=="o18")i.length%2!=0&&!f&&(d=i.shift()+c.nominalWidthX),u+=i.length>>1,i.length=0,f=!0;else if(T=="o3"||T=="o23")i.length%2!=0&&!f&&(d=i.shift()+c.nominalWidthX),u+=i.length>>1,i.length=0,f=!0;else if(T=="o4")i.length>1&&!f&&(d=i.shift()+c.nominalWidthX,f=!0),h&&t.U.P.closePath(s),b+=i.pop(),t.U.P.moveTo(s,g,b),h=!0;else if(T=="o5")for(;i.length>0;)g+=i.shift(),b+=i.shift(),t.U.P.lineTo(s,g,b);else if(T=="o6"||T=="o7")for(var R=i.length,U=T=="o6",H=0;H<R;H++){var G=i.shift();U?g+=G:b+=G,U=!U,t.U.P.lineTo(s,g,b)}else if(T=="o8"||T=="o24"){R=i.length;for(var X=0;X+6<=R;)v=g+i.shift(),p=b+i.shift(),x=v+i.shift(),y=p+i.shift(),g=x+i.shift(),b=y+i.shift(),t.U.P.curveTo(s,v,p,x,y,g,b),X+=6;T=="o24"&&(g+=i.shift(),b+=i.shift(),t.U.P.lineTo(s,g,b))}else{if(T=="o11")break;if(T=="o1234"||T=="o1235"||T=="o1236"||T=="o1237")T=="o1234"&&(p=b,x=(v=g+i.shift())+i.shift(),k=y=p+i.shift(),M=y,A=b,g=(w=(_=(F=x+i.shift())+i.shift())+i.shift())+i.shift(),t.U.P.curveTo(s,v,p,x,y,F,k),t.U.P.curveTo(s,_,M,w,A,g,b)),T=="o1235"&&(v=g+i.shift(),p=b+i.shift(),x=v+i.shift(),y=p+i.shift(),F=x+i.shift(),k=y+i.shift(),_=F+i.shift(),M=k+i.shift(),w=_+i.shift(),A=M+i.shift(),g=w+i.shift(),b=A+i.shift(),i.shift(),t.U.P.curveTo(s,v,p,x,y,F,k),t.U.P.curveTo(s,_,M,w,A,g,b)),T=="o1236"&&(v=g+i.shift(),p=b+i.shift(),x=v+i.shift(),k=y=p+i.shift(),M=y,w=(_=(F=x+i.shift())+i.shift())+i.shift(),A=M+i.shift(),g=w+i.shift(),t.U.P.curveTo(s,v,p,x,y,F,k),t.U.P.curveTo(s,_,M,w,A,g,b)),T=="o1237"&&(v=g+i.shift(),p=b+i.shift(),x=v+i.shift(),y=p+i.shift(),F=x+i.shift(),k=y+i.shift(),_=F+i.shift(),M=k+i.shift(),w=_+i.shift(),A=M+i.shift(),Math.abs(w-g)>Math.abs(A-b)?g=w+i.shift():b=A+i.shift(),t.U.P.curveTo(s,v,p,x,y,F,k),t.U.P.curveTo(s,_,M,w,A,g,b));else if(T=="o14"){if(i.length>0&&!f&&(d=i.shift()+a.nominalWidthX,f=!0),i.length==4){var V=i.shift(),P=i.shift(),O=i.shift(),S=i.shift(),L=t.CFF.glyphBySE(a,O),I=t.CFF.glyphBySE(a,S);t.U._drawCFF(a.CharStrings[L],e,a,c,s),e.x=V,e.y=P,t.U._drawCFF(a.CharStrings[I],e,a,c,s)}h&&(t.U.P.closePath(s),h=!1)}else if(T=="o19"||T=="o20")i.length%2!=0&&!f&&(d=i.shift()+c.nominalWidthX),u+=i.length>>1,i.length=0,f=!0,m+=u+7>>3;else if(T=="o21")i.length>2&&!f&&(d=i.shift()+c.nominalWidthX,f=!0),b+=i.pop(),g+=i.pop(),h&&t.U.P.closePath(s),t.U.P.moveTo(s,g,b),h=!0;else if(T=="o22")i.length>1&&!f&&(d=i.shift()+c.nominalWidthX,f=!0),g+=i.pop(),h&&t.U.P.closePath(s),t.U.P.moveTo(s,g,b),h=!0;else if(T=="o25"){for(;i.length>6;)g+=i.shift(),b+=i.shift(),t.U.P.lineTo(s,g,b);v=g+i.shift(),p=b+i.shift(),x=v+i.shift(),y=p+i.shift(),g=x+i.shift(),b=y+i.shift(),t.U.P.curveTo(s,v,p,x,y,g,b)}else if(T=="o26")for(i.length%2&&(g+=i.shift());i.length>0;)v=g,p=b+i.shift(),g=x=v+i.shift(),b=(y=p+i.shift())+i.shift(),t.U.P.curveTo(s,v,p,x,y,g,b);else if(T=="o27")for(i.length%2&&(b+=i.shift());i.length>0;)p=b,x=(v=g+i.shift())+i.shift(),y=p+i.shift(),g=x+i.shift(),b=y,t.U.P.curveTo(s,v,p,x,y,g,b);else if(T=="o10"||T=="o29"){var B=T=="o10"?c:a;if(i.length==0)console.debug("error: empty stack");else{var E=i.pop(),q=B.Subrs[E+B.Bias];e.x=g,e.y=b,e.nStems=u,e.haveWidth=f,e.width=d,e.open=h,t.U._drawCFF(q,e,a,c,s),g=e.x,b=e.y,u=e.nStems,f=e.haveWidth,d=e.width,h=e.open}}else if(T=="o30"||T=="o31"){var z=i.length,Y=(X=0,T=="o31");for(X+=z-(R=-3&z);X<R;)Y?(p=b,x=(v=g+i.shift())+i.shift(),b=(y=p+i.shift())+i.shift(),R-X==5?(g=x+i.shift(),X++):g=x,Y=!1):(v=g,p=b+i.shift(),x=v+i.shift(),y=p+i.shift(),g=x+i.shift(),R-X==5?(b=y+i.shift(),X++):b=y,Y=!0),t.U.P.curveTo(s,v,p,x,y,g,b),X+=4}else{if((T+"").charAt(0)=="o")throw console.debug("Unknown operation: "+T,n),T;i.push(T)}}}e.x=g,e.y=b,e.nStems=u,e.haveWidth=f,e.width=d,e.open=h};var r=t,l={Typr:r};return o.Typr=r,o.default=l,Object.defineProperty(o,"__esModule",{value:!0}),o}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function Zf(){return function(o){var t=Uint8Array,r=Uint16Array,l=Uint32Array,n=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),c=function(T,R){for(var U=new r(31),H=0;H<31;++H)U[H]=R+=1<<T[H-1];var G=new l(U[30]);for(H=1;H<30;++H)for(var X=U[H];X<U[H+1];++X)G[X]=X-U[H]<<5|H;return[U,G]},s=c(n,2),i=s[0],u=s[1];i[28]=258,u[258]=28;for(var f=c(e,0)[0],d=new r(32768),h=0;h<32768;++h){var m=(43690&h)>>>1|(21845&h)<<1;m=(61680&(m=(52428&m)>>>2|(13107&m)<<2))>>>4|(3855&m)<<4,d[h]=((65280&m)>>>8|(255&m)<<8)>>>1}var g=function(T,R,U){for(var H=T.length,G=0,X=new r(R);G<H;++G)++X[T[G]-1];var V,P=new r(R);for(G=0;G<R;++G)P[G]=P[G-1]+X[G-1]<<1;{V=new r(1<<R);var O=15-R;for(G=0;G<H;++G)if(T[G])for(var S=G<<4|T[G],L=R-T[G],I=P[T[G]-1]++<<L,B=I|(1<<L)-1;I<=B;++I)V[d[I]>>>O]=S}return V},b=new t(288);for(h=0;h<144;++h)b[h]=8;for(h=144;h<256;++h)b[h]=9;for(h=256;h<280;++h)b[h]=7;for(h=280;h<288;++h)b[h]=8;var v=new t(32);for(h=0;h<32;++h)v[h]=5;var p=g(b,9),x=g(v,5),y=function(T){for(var R=T[0],U=1;U<T.length;++U)T[U]>R&&(R=T[U]);return R},_=function(T,R,U){var H=R/8|0;return(T[H]|T[H+1]<<8)>>(7&R)&U},M=function(T,R){var U=R/8|0;return(T[U]|T[U+1]<<8|T[U+2]<<16)>>(7&R)},w=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],A=function(T,R,U){var H=new Error(R||w[T]);if(H.code=T,Error.captureStackTrace&&Error.captureStackTrace(H,A),!U)throw H;return H},F=function(T,R,U){var H=T.length;if(!H||U&&!U.l&&H<5)return R||new t(0);var G=!R||U,X=!U||U.i;U||(U={}),R||(R=new t(3*H));var V,P=function(se){var be=R.length;if(se>be){var ke=new t(Math.max(2*be,se));ke.set(R),R=ke}},O=U.f||0,S=U.p||0,L=U.b||0,I=U.l,B=U.d,E=U.m,q=U.n,z=8*H;do{if(!I){U.f=O=_(T,S,1);var Y=_(T,S+1,3);if(S+=3,!Y){var ue=T[(W=((V=S)/8|0)+(7&V&&1)+4)-4]|T[W-3]<<8,ie=W+ue;if(ie>H){X&&A(0);break}G&&P(L+ue),R.set(T.subarray(W,ie),L),U.b=L+=ue,U.p=S=8*ie;continue}if(Y==1)I=p,B=x,E=9,q=5;else if(Y==2){var ne=_(T,S,31)+257,Z=_(T,S+10,15)+4,Ce=ne+_(T,S+5,31)+1;S+=14;for(var ve=new t(Ce),re=new t(19),he=0;he<Z;++he)re[a[he]]=_(T,S+3*he,7);S+=3*Z;var de=y(re),$=(1<<de)-1,ae=g(re,de);for(he=0;he<Ce;){var W,j=ae[_(T,S,$)];if(S+=15&j,(W=j>>>4)<16)ve[he++]=W;else{var N=0,oe=0;for(W==16?(oe=3+_(T,S,3),S+=2,N=ve[he-1]):W==17?(oe=3+_(T,S,7),S+=3):W==18&&(oe=11+_(T,S,127),S+=7);oe--;)ve[he++]=N}}var K=ve.subarray(0,ne),J=ve.subarray(ne);E=y(K),q=y(J),I=g(K,E),B=g(J,q)}else A(1);if(S>z){X&&A(0);break}}G&&P(L+131072);for(var we=(1<<E)-1,pe=(1<<q)-1,me=S;;me=S){var ce=(N=I[M(T,S)&we])>>>4;if((S+=15&N)>z){X&&A(0);break}if(N||A(2),ce<256)R[L++]=ce;else{if(ce==256){me=S,I=null;break}var fe=ce-254;if(ce>264){var Pe=n[he=ce-257];fe=_(T,S,(1<<Pe)-1)+i[he],S+=Pe}var Oe=B[M(T,S)&pe],ee=Oe>>>4;if(Oe||A(3),S+=15&Oe,J=f[ee],ee>3&&(Pe=e[ee],J+=M(T,S)&(1<<Pe)-1,S+=Pe),S>z){X&&A(0);break}G&&P(L+131072);for(var le=L+fe;L<le;L+=4)R[L]=R[L-J],R[L+1]=R[L+1-J],R[L+2]=R[L+2-J],R[L+3]=R[L+3-J];L=le}}U.l=I,U.p=me,U.b=L,I&&(O=1,U.m=E,U.d=B,U.n=q)}while(!O);return L==R.length?R:function(se,be,ke){(ke==null||ke>se.length)&&(ke=se.length);var Ge=new(se instanceof r?r:se instanceof l?l:t)(ke-be);return Ge.set(se.subarray(be,ke)),Ge}(R,0,L)},k=new t(0),D=typeof TextDecoder<"u"&&new TextDecoder;try{D.decode(k,{stream:!0})}catch{}return o.convert_streams=function(T){var R=new DataView(T),U=0;function H(){var ne=R.getUint16(U);return U+=2,ne}function G(){var ne=R.getUint32(U);return U+=4,ne}function X(ne){ue.setUint16(ie,ne),ie+=2}function V(ne){ue.setUint32(ie,ne),ie+=4}for(var P={signature:G(),flavor:G(),length:G(),numTables:H(),reserved:H(),totalSfntSize:G(),majorVersion:H(),minorVersion:H(),metaOffset:G(),metaLength:G(),metaOrigLength:G(),privOffset:G(),privLength:G()},O=0;Math.pow(2,O)<=P.numTables;)O++;O--;for(var S=16*Math.pow(2,O),L=16*P.numTables-S,I=12,B=[],E=0;E<P.numTables;E++)B.push({tag:G(),offset:G(),compLength:G(),origLength:G(),origChecksum:G()}),I+=16;var q,z=new Uint8Array(12+16*B.length+B.reduce(function(ne,Z){return ne+Z.origLength+4},0)),Y=z.buffer,ue=new DataView(Y),ie=0;return V(P.flavor),X(P.numTables),X(S),X(O),X(L),B.forEach(function(ne){V(ne.tag),V(ne.origChecksum),V(I),V(ne.origLength),ne.outOffset=I,(I+=ne.origLength)%4!=0&&(I+=4-I%4)}),B.forEach(function(ne){var Z,Ce=T.slice(ne.offset,ne.offset+ne.compLength);if(ne.compLength!=ne.origLength){var ve=new Uint8Array(ne.origLength);Z=new Uint8Array(Ce,2),F(Z,ve)}else ve=new Uint8Array(Ce);z.set(ve,ne.outOffset);var re=0;(I=ne.outOffset+ne.origLength)%4!=0&&(re=4-I%4),z.set(new Uint8Array(re).buffer,ne.outOffset+ne.origLength),q=I+re}),Y.slice(0,q)},Object.defineProperty(o,"__esModule",{value:!0}),o}({}).convert_streams}function Jf(o,t){const r={M:2,L:2,Q:4,C:6,Z:0},l={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},n=1,e=2,a=4,c=8,s=16,i=32;let u;function f(w){if(!u){const A={R:e,L:n,D:a,C:s,U:i,T:c};u=new Map;for(let F in l){let k=0;l[F].split(",").forEach(D=>{let[T,R]=D.split("+");T=parseInt(T,36),R=R?parseInt(R,36):0,u.set(k+=T,A[F]);for(let U=R;U--;)u.set(++k,A[F])})}}return u.get(w)||i}const d=1,h=2,m=3,g=4,b=[null,"isol","init","fina","medi"];function v(w){const A=new Uint8Array(w.length);let F=i,k=d,D=-1;for(let T=0;T<w.length;T++){const R=w.codePointAt(T);let U=f(R)|0,H=d;U&c||(F&(n|a|s)?U&(e|a|s)?(H=m,(k===d||k===m)&&A[D]++):U&(n|i)&&(k===h||k===g)&&A[D]--:F&(e|i)&&(k===h||k===g)&&A[D]--,k=A[T]=H,F=U,D=T,R>65535&&T++)}return A}function p(w,A){const F=[];for(let D=0;D<A.length;D++){const T=A.codePointAt(D);T>65535&&D++,F.push(o.U.codeToGlyph(w,T))}const k=w.GSUB;if(k){const{lookupList:D,featureList:T}=k;let R;const U=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,H=[];T.forEach(G=>{if(U.test(G.tag))for(let X=0;X<G.tab.length;X++){if(H[G.tab[X]])continue;H[G.tab[X]]=!0;const V=D[G.tab[X]],P=/^(isol|init|fina|medi)$/.test(G.tag);P&&!R&&(R=v(A));for(let O=0;O<F.length;O++)(!R||!P||b[R[O]]===G.tag)&&o.U._applySubs(F,O,V,D)}})}return F}function x(w,A){const F=new Int16Array(A.length*3);let k=0;for(;k<A.length;k++){const U=A[k];if(U===-1)continue;F[k*3+2]=w.hmtx.aWidth[U];const H=w.GPOS;if(H){const G=H.lookupList;for(let X=0;X<G.length;X++){const V=G[X];for(let P=0;P<V.tabs.length;P++){const O=V.tabs[P];if(V.ltype===1){if(o._lctf.coverageIndex(O.coverage,U)!==-1&&O.pos){R(O.pos,k);break}}else if(V.ltype===2){let S=null,L=D();if(L!==-1){const I=o._lctf.coverageIndex(O.coverage,A[L]);if(I!==-1){if(O.fmt===1){const B=O.pairsets[I];for(let E=0;E<B.length;E++)B[E].gid2===U&&(S=B[E])}else if(O.fmt===2){const B=o.U._getGlyphClass(A[L],O.classDef1),E=o.U._getGlyphClass(U,O.classDef2);S=O.matrix[B][E]}if(S){S.val1&&R(S.val1,L),S.val2&&R(S.val2,k);break}}}}else if(V.ltype===4){const S=o._lctf.coverageIndex(O.markCoverage,U);if(S!==-1){const L=D(T),I=L===-1?-1:o._lctf.coverageIndex(O.baseCoverage,A[L]);if(I!==-1){const B=O.markArray[S],E=O.baseArray[I][B.markClass];F[k*3]=E.x-B.x+F[L*3]-F[L*3+2],F[k*3+1]=E.y-B.y+F[L*3+1];break}}}else if(V.ltype===6){const S=o._lctf.coverageIndex(O.mark1Coverage,U);if(S!==-1){const L=D();if(L!==-1){const I=A[L];if(y(w,I)===3){const B=o._lctf.coverageIndex(O.mark2Coverage,I);if(B!==-1){const E=O.mark1Array[S],q=O.mark2Array[B][E.markClass];F[k*3]=q.x-E.x+F[L*3]-F[L*3+2],F[k*3+1]=q.y-E.y+F[L*3+1];break}}}}}}}}else if(w.kern&&!w.cff){const G=D();if(G!==-1){const X=w.kern.glyph1.indexOf(A[G]);if(X!==-1){const V=w.kern.rval[X].glyph2.indexOf(U);V!==-1&&(F[G*3+2]+=w.kern.rval[X].vals[V])}}}}return F;function D(U){for(let H=k-1;H>=0;H--)if(A[H]!==-1&&(!U||U(A[H])))return H;return-1}function T(U){return y(w,U)===1}function R(U,H){for(let G=0;G<3;G++)F[H*3+G]+=U[G]||0}}function y(w,A){const F=w.GDEF&&w.GDEF.glyphClassDef;return F?o.U._getGlyphClass(A,F):0}function _(...w){for(let A=0;A<w.length;A++)if(typeof w[A]=="number")return w[A]}function M(w){const A=Object.create(null),F=w["OS/2"],k=w.hhea,D=w.head.unitsPerEm,T=_(F&&F.sTypoAscender,k&&k.ascender,D),R={unitsPerEm:D,ascender:T,descender:_(F&&F.sTypoDescender,k&&k.descender,0),capHeight:_(F&&F.sCapHeight,T),xHeight:_(F&&F.sxHeight,T),lineGap:_(F&&F.sTypoLineGap,k&&k.lineGap),supportsCodePoint(U){return o.U.codeToGlyph(w,U)>0},forEachGlyph(U,H,G,X){let V=0;const P=1/R.unitsPerEm*H,O=p(w,U);let S=0;const L=x(w,O);return O.forEach((I,B)=>{if(I!==-1){let E=A[I];if(!E){const{cmds:q,crds:z}=o.U.glyphToPath(w,I);let Y="",ue=0;for(let ve=0,re=q.length;ve<re;ve++){const he=r[q[ve]];Y+=q[ve];for(let de=1;de<=he;de++)Y+=(de>1?",":"")+z[ue++]}let ie,ne,Z,Ce;if(z.length){ie=ne=1/0,Z=Ce=-1/0;for(let ve=0,re=z.length;ve<re;ve+=2){let he=z[ve],de=z[ve+1];he<ie&&(ie=he),de<ne&&(ne=de),he>Z&&(Z=he),de>Ce&&(Ce=de)}}else ie=Z=ne=Ce=0;E=A[I]={index:I,advanceWidth:w.hmtx.aWidth[I],xMin:ie,yMin:ne,xMax:Z,yMax:Ce,path:Y}}X.call(null,E,V+L[B*3]*P,L[B*3+1]*P,S),V+=L[B*3+2]*P,G&&(V+=G*H)}S+=U.codePointAt(S)>65535?2:1}),V}};return R}return function(A){const F=new Uint8Array(A,0,4),k=o._bin.readASCII(F,0,4);if(k==="wOFF")A=t(A);else if(k==="wOF2")throw new Error("woff2 fonts not supported");return M(o.parse(A)[0])}}const $f=un({name:"Typr Font Parser",dependencies:[Kf,Zf,Jf],init(o,t,r){const l=o(),n=t();return r(l,n)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function ed(){return function(o){var t=function(){this.buckets=new Map};t.prototype.add=function(x){var y=x>>5;this.buckets.set(y,(this.buckets.get(y)||0)|1<<(31&x))},t.prototype.has=function(x){var y=this.buckets.get(x>>5);return y!==void 0&&(y&1<<(31&x))!=0},t.prototype.serialize=function(){var x=[];return this.buckets.forEach(function(y,_){x.push((+_).toString(36)+":"+y.toString(36))}),x.join(",")},t.prototype.deserialize=function(x){var y=this;this.buckets.clear(),x.split(",").forEach(function(_){var M=_.split(":");y.buckets.set(parseInt(M[0],36),parseInt(M[1],36))})};var r=Math.pow(2,8),l=r-1,n=~l;function e(x){var y=function(M){return M&n}(x).toString(16),_=function(M){return(M&n)+r-1}(x).toString(16);return"codepoint-index/plane"+(x>>16)+"/"+y+"-"+_+".json"}function a(x,y){var _=x&l,M=y.codePointAt(_/6|0);return((M=(M||48)-48)&1<<_%6)!=0}function c(x,y){var _;(_=x,_.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(M){return M.split("-").map(function(w){return parseInt(w.trim(),16)})})).forEach(function(M){var w=M[0],A=M[1];A===void 0&&(A=w),y(w,A)})}function s(x,y){c(x,function(_,M){for(var w=_;w<=M;w++)y(w)})}var i={},u={},f=new WeakMap,d="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function h(x){var y=f.get(x);return y||(y=new t,s(x.ranges,function(_){return y.add(_)}),f.set(x,y)),y}var m,g=new Map;function b(x,y,_){return x[y]?y:x[_]?_:function(M){for(var w in M)return w}(x)}function v(x,y){var _=y;if(!x.includes(_)){_=1/0;for(var M=0;M<x.length;M++)Math.abs(x[M]-y)<Math.abs(_-y)&&(_=x[M])}return _}function p(x){return m||(m=new Set,s("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(y){m.add(y)})),m.has(x)}return o.CodePointSet=t,o.clearCache=function(){i={},u={}},o.getFontsForString=function(x,y){y===void 0&&(y={});var _,M=y.lang;M===void 0&&(M=/\p{Script=Hangul}/u.test(_=x)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(_)?"ja":"en");var w=y.category;w===void 0&&(w="sans-serif");var A=y.style;A===void 0&&(A="normal");var F=y.weight;F===void 0&&(F=400);var k=(y.dataUrl||d).replace(/\/$/g,""),D=new Map,T=new Uint8Array(x.length),R={},U={},H=new Array(x.length),G=new Map,X=!1;function V(S){var L=g.get(S);return L||(L=fetch(k+"/"+S).then(function(I){if(!I.ok)throw new Error(I.statusText);return I.json().then(function(B){if(!Array.isArray(B)||B[0]!==1)throw new Error("Incorrect schema version; need 1, got "+B[0]);return B[1]})}).catch(function(I){if(k!==d)return X||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+k+'", trying default CDN. '+I.message),X=!0),k=d,g.delete(S),V(S);throw I}),g.set(S,L)),L}for(var P=function(S){var L=x.codePointAt(S),I=e(L);H[S]=I,i[I]||G.has(I)||G.set(I,V(I).then(function(B){i[I]=B})),L>65535&&(S++,O=S)},O=0;O<x.length;O++)P(O);return Promise.all(G.values()).then(function(){G.clear();for(var S=function(I){var B=x.codePointAt(I),E=null,q=i[H[I]],z=void 0;for(var Y in q){var ue=U[Y];if(ue===void 0&&(ue=U[Y]=new RegExp(Y).test(M||"en")),ue){for(var ie in z=Y,q[Y])if(a(B,q[Y][ie])){E=ie;break}break}}if(!E){e:for(var ne in q)if(ne!==z){for(var Z in q[ne])if(a(B,q[ne][Z])){E=Z;break e}}}E||(console.debug("No font coverage for U+"+B.toString(16)),E="latin"),H[I]=E,u[E]||G.has(E)||G.set(E,V("font-meta/"+E+".json").then(function(Ce){u[E]=Ce})),B>65535&&(I++,L=I)},L=0;L<x.length;L++)S(L);return Promise.all(G.values())}).then(function(){for(var S,L=null,I=0;I<x.length;I++){var B=x.codePointAt(I);if(L&&(p(B)||h(L).has(B)))T[I]=T[I-1];else{L=u[H[I]];var E=R[L.id];if(!E){var q=L.typeforms,z=b(q,w,"sans-serif"),Y=b(q[z],A,"normal"),ue=v((S=q[z])===null||S===void 0?void 0:S[Y],F);E=R[L.id]=k+"/font-files/"+L.id+"/"+z+"."+Y+"."+ue+".woff"}var ie=D.get(E);ie==null&&(ie=D.size,D.set(E,ie)),T[I]=ie}B>65535&&(I++,T[I]=T[I-1])}return{fontUrls:Array.from(D.keys()),chars:T}})},Object.defineProperty(o,"__esModule",{value:!0}),o}({})}function td(o,t){const r=Object.create(null),l=Object.create(null);function n(a,c){const s=i=>{console.error(`Failure loading font ${a}`,i)};try{const i=new XMLHttpRequest;i.open("get",a,!0),i.responseType="arraybuffer",i.onload=function(){if(i.status>=400)s(new Error(i.statusText));else if(i.status>0)try{const u=o(i.response);u.src=a,c(u)}catch(u){s(u)}},i.onerror=s,i.send()}catch(i){s(i)}}function e(a,c){let s=r[a];s?c(s):l[a]?l[a].push(c):(l[a]=[c],n(a,i=>{i.src=a,r[a]=i,l[a].forEach(u=>u(i)),delete l[a]}))}return function(a,c,{lang:s,fonts:i=[],style:u="normal",weight:f="normal",unicodeFontsURL:d}={}){const h=new Uint8Array(a.length),m=[];a.length||p();const g=new Map,b=[];if(u!=="italic"&&(u="normal"),typeof f!="number"&&(f=f==="bold"?700:400),i&&!Array.isArray(i)&&(i=[i]),i=i.slice().filter(y=>!y.lang||y.lang.test(s)).reverse(),i.length){let w=0;(function A(F=0){for(let k=F,D=a.length;k<D;k++){const T=a.codePointAt(k);if(w===1&&m[h[k-1]].supportsCodePoint(T)||k>0&&/\s/.test(a[k]))h[k]=h[k-1],w===2&&(b[b.length-1][1]=k);else for(let R=h[k],U=i.length;R<=U;R++)if(R===U){const H=w===2?b[b.length-1]:b[b.length]=[k,k];H[1]=k,w=2}else{h[k]=R;const{src:H,unicodeRange:G}=i[R];if(!G||x(T,G)){const X=r[H];if(!X){e(H,()=>{A(k)});return}if(X.supportsCodePoint(T)){let V=g.get(X);typeof V!="number"&&(V=m.length,m.push(X),g.set(X,V)),h[k]=V,w=1;break}}}T>65535&&k+1<D&&(h[k+1]=h[k],k++,w===2&&(b[b.length-1][1]=k))}v()})()}else b.push([0,a.length-1]),v();function v(){if(b.length){const y=b.map(_=>a.substring(_[0],_[1]+1)).join(`
`);t.getFontsForString(y,{lang:s||void 0,style:u,weight:f,dataUrl:d}).then(({fontUrls:_,chars:M})=>{const w=m.length;let A=0;b.forEach(k=>{for(let D=0,T=k[1]-k[0];D<=T;D++)h[k[0]+D]=M[A++]+w;A++});let F=0;_.forEach((k,D)=>{e(k,T=>{m[D+w]=T,++F===_.length&&p()})})})}else p()}function p(){c({chars:h,fonts:m})}function x(y,_){for(let M=0;M<_.length;M++){const[w,A=w]=_[M];if(w<=y&&y<=A)return!0}return!1}}}const nd=un({name:"FontResolver",dependencies:[td,$f,ed],init(o,t,r){return o(t,r())}});function od(o,t){const l=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,n="[^\\S\\u00A0]",e=new RegExp(`${n}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function a({text:m,lang:g,fonts:b,style:v,weight:p,preResolvedFonts:x,unicodeFontsURL:y},_){const M=({chars:w,fonts:A})=>{let F,k;const D=[];for(let T=0;T<w.length;T++)w[T]!==k?(k=w[T],D.push(F={start:T,end:T,fontObj:A[w[T]]})):F.end=T;_(D)};x?M(x):o(m,M,{lang:g,fonts:b,style:v,weight:p,unicodeFontsURL:y})}function c({text:m="",font:g,lang:b,sdfGlyphSize:v=64,fontSize:p=400,fontWeight:x=1,fontStyle:y="normal",letterSpacing:_=0,lineHeight:M="normal",maxWidth:w=1/0,direction:A,textAlign:F="left",textIndent:k=0,whiteSpace:D="normal",overflowWrap:T="normal",anchorX:R=0,anchorY:U=0,metricsOnly:H=!1,unicodeFontsURL:G,preResolvedFonts:X=null,includeCaretPositions:V=!1,chunkedBoundsSize:P=8192,colorRanges:O=null},S){const L=f(),I={fontLoad:0,typesetting:0};m.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),m=m.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),p=+p,_=+_,w=+w,M=M||"normal",k=+k,a({text:m,lang:b,style:y,weight:x,fonts:typeof g=="string"?[{src:g}]:g,unicodeFontsURL:G,preResolvedFonts:X},B=>{I.fontLoad=f()-L;const E=isFinite(w);let q=null,z=null,Y=null,ue=null,ie=null,ne=null,Z=null,Ce=null,ve=0,re=0,he=D!=="nowrap";const de=new Map,$=f();let ae=k,W=0,j=new d;const N=[j];B.forEach(pe=>{const{fontObj:me}=pe,{ascender:ce,descender:fe,unitsPerEm:Pe,lineGap:Oe,capHeight:ee,xHeight:le}=me;let se=de.get(me);if(!se){const Me=p/Pe,Fe=M==="normal"?(ce-fe+Oe)*Me:M*p,Be=(Fe-(ce-fe)*Me)/2,ye=Math.min(Fe,(ce-fe)*Me),_e=(ce+fe)/2*Me+ye/2;se={index:de.size,src:me.src,fontObj:me,fontSizeMult:Me,unitsPerEm:Pe,ascender:ce*Me,descender:fe*Me,capHeight:ee*Me,xHeight:le*Me,lineHeight:Fe,baseline:-Be-ce*Me,caretTop:_e,caretBottom:_e-ye},de.set(me,se)}const{fontSizeMult:be}=se,ke=m.slice(pe.start,pe.end+1);let Ge,xe;me.forEachGlyph(ke,p,_,(Me,Fe,Be,ye)=>{Fe+=W,ye+=pe.start,Ge=Fe,xe=Me;const _e=m.charAt(ye),Ie=Me.advanceWidth*be,ze=j.count;let Q;if("isEmpty"in Me||(Me.isWhitespace=!!_e&&new RegExp(n).test(_e),Me.canBreakAfter=!!_e&&e.test(_e),Me.isEmpty=Me.xMin===Me.xMax||Me.yMin===Me.yMax||l.test(_e)),!Me.isWhitespace&&!Me.isEmpty&&re++,he&&E&&!Me.isWhitespace&&Fe+Ie+ae>w&&ze){if(j.glyphAt(ze-1).glyphObj.canBreakAfter)Q=new d,ae=-Fe;else for(let Se=ze;Se--;)if(Se===0&&T==="break-word"){Q=new d,ae=-Fe;break}else if(j.glyphAt(Se).glyphObj.canBreakAfter){Q=j.splitAt(Se+1);const Ae=Q.glyphAt(0).x;ae-=Ae;for(let Ue=Q.count;Ue--;)Q.glyphAt(Ue).x-=Ae;break}Q&&(j.isSoftWrapped=!0,j=Q,N.push(j),ve=w)}let ge=j.glyphAt(j.count);ge.glyphObj=Me,ge.x=Fe+ae,ge.y=Be,ge.width=Ie,ge.charIndex=ye,ge.fontData=se,_e===`
`&&(j=new d,N.push(j),ae=-(Fe+Ie+_*p)+k)}),W=Ge+xe.advanceWidth*be+_*p});let oe=0;N.forEach(pe=>{let me=!0;for(let ce=pe.count;ce--;){const fe=pe.glyphAt(ce);me&&!fe.glyphObj.isWhitespace&&(pe.width=fe.x+fe.width,pe.width>ve&&(ve=pe.width),me=!1);let{lineHeight:Pe,capHeight:Oe,xHeight:ee,baseline:le}=fe.fontData;Pe>pe.lineHeight&&(pe.lineHeight=Pe);const se=le-pe.baseline;se<0&&(pe.baseline+=se,pe.cap+=se,pe.ex+=se),pe.cap=Math.max(pe.cap,pe.baseline+Oe),pe.ex=Math.max(pe.ex,pe.baseline+ee)}pe.baseline-=oe,pe.cap-=oe,pe.ex-=oe,oe+=pe.lineHeight});let K=0,J=0;if(R&&(typeof R=="number"?K=-R:typeof R=="string"&&(K=-ve*(R==="left"?0:R==="center"?.5:R==="right"?1:i(R)))),U&&(typeof U=="number"?J=-U:typeof U=="string"&&(J=U==="top"?0:U==="top-baseline"?-N[0].baseline:U==="top-cap"?-N[0].cap:U==="top-ex"?-N[0].ex:U==="middle"?oe/2:U==="bottom"?oe:U==="bottom-baseline"?-N[N.length-1].baseline:i(U)*oe)),!H){const pe=t.getEmbeddingLevels(m,A);q=new Uint16Array(re),z=new Uint8Array(re),Y=new Float32Array(re*2),ue={},Z=[1/0,1/0,-1/0,-1/0],Ce=[],V&&(ne=new Float32Array(m.length*4)),O&&(ie=new Uint8Array(re*3));let me=0,ce=-1,fe=-1,Pe,Oe;if(N.forEach((ee,le)=>{let{count:se,width:be}=ee;if(se>0){let ke=0;for(let ye=se;ye--&&ee.glyphAt(ye).glyphObj.isWhitespace;)ke++;let Ge=0,xe=0;if(F==="center")Ge=(ve-be)/2;else if(F==="right")Ge=ve-be;else if(F==="justify"&&ee.isSoftWrapped){let ye=0;for(let _e=se-ke;_e--;)ee.glyphAt(_e).glyphObj.isWhitespace&&ye++;xe=(ve-be)/ye}if(xe||Ge){let ye=0;for(let _e=0;_e<se;_e++){let Ie=ee.glyphAt(_e);const ze=Ie.glyphObj;Ie.x+=Ge+ye,xe!==0&&ze.isWhitespace&&_e<se-ke&&(ye+=xe,Ie.width+=xe)}}const Me=t.getReorderSegments(m,pe,ee.glyphAt(0).charIndex,ee.glyphAt(ee.count-1).charIndex);for(let ye=0;ye<Me.length;ye++){const[_e,Ie]=Me[ye];let ze=1/0,Q=-1/0;for(let ge=0;ge<se;ge++)if(ee.glyphAt(ge).charIndex>=_e){let Se=ge,Ae=ge;for(;Ae<se;Ae++){let Ue=ee.glyphAt(Ae);if(Ue.charIndex>Ie)break;Ae<se-ke&&(ze=Math.min(ze,Ue.x),Q=Math.max(Q,Ue.x+Ue.width))}for(let Ue=Se;Ue<Ae;Ue++){const He=ee.glyphAt(Ue);He.x=Q-(He.x+He.width-ze)}break}}let Fe;const Be=ye=>Fe=ye;for(let ye=0;ye<se;ye++){const _e=ee.glyphAt(ye);Fe=_e.glyphObj;const Ie=Fe.index,ze=pe.levels[_e.charIndex]&1;if(ze){const Q=t.getMirroredCharacter(m[_e.charIndex]);Q&&_e.fontData.fontObj.forEachGlyph(Q,0,0,Be)}if(V){const{charIndex:Q,fontData:ge}=_e,Se=_e.x+K,Ae=_e.x+_e.width+K;ne[Q*4]=ze?Ae:Se,ne[Q*4+1]=ze?Se:Ae,ne[Q*4+2]=ee.baseline+ge.caretBottom+J,ne[Q*4+3]=ee.baseline+ge.caretTop+J;const Ue=Q-ce;Ue>1&&u(ne,ce,Ue),ce=Q}if(O){const{charIndex:Q}=_e;for(;Q>fe;)fe++,O.hasOwnProperty(fe)&&(Oe=O[fe])}if(!Fe.isWhitespace&&!Fe.isEmpty){const Q=me++,{fontSizeMult:ge,src:Se,index:Ae}=_e.fontData,Ue=ue[Se]||(ue[Se]={});Ue[Ie]||(Ue[Ie]={path:Fe.path,pathBounds:[Fe.xMin,Fe.yMin,Fe.xMax,Fe.yMax]});const He=_e.x+K,Te=_e.y+ee.baseline+J;Y[Q*2]=He,Y[Q*2+1]=Te;const qe=He+Fe.xMin*ge,We=Te+Fe.yMin*ge,Ee=He+Fe.xMax*ge,Ve=Te+Fe.yMax*ge;qe<Z[0]&&(Z[0]=qe),We<Z[1]&&(Z[1]=We),Ee>Z[2]&&(Z[2]=Ee),Ve>Z[3]&&(Z[3]=Ve),Q%P===0&&(Pe={start:Q,end:Q,rect:[1/0,1/0,-1/0,-1/0]},Ce.push(Pe)),Pe.end++;const Le=Pe.rect;if(qe<Le[0]&&(Le[0]=qe),We<Le[1]&&(Le[1]=We),Ee>Le[2]&&(Le[2]=Ee),Ve>Le[3]&&(Le[3]=Ve),q[Q]=Ie,z[Q]=Ae,O){const Ne=Q*3;ie[Ne]=Oe>>16&255,ie[Ne+1]=Oe>>8&255,ie[Ne+2]=Oe&255}}}}}),ne){const ee=m.length-ce;ee>1&&u(ne,ce,ee)}}const we=[];de.forEach(({index:pe,src:me,unitsPerEm:ce,ascender:fe,descender:Pe,lineHeight:Oe,capHeight:ee,xHeight:le})=>{we[pe]={src:me,unitsPerEm:ce,ascender:fe,descender:Pe,lineHeight:Oe,capHeight:ee,xHeight:le}}),I.typesetting=f()-$,S({glyphIds:q,glyphFontIndices:z,glyphPositions:Y,glyphData:ue,fontData:we,caretPositions:ne,glyphColors:ie,chunkedBounds:Ce,fontSize:p,topBaseline:J+N[0].baseline,blockBounds:[K,J-oe,K+ve,J],visibleBounds:Z,timings:I})})}function s(m,g){c({...m,metricsOnly:!0},b=>{const[v,p,x,y]=b.blockBounds;g({width:x-v,height:y-p})})}function i(m){let g=m.match(/^([\d.]+)%$/),b=g?parseFloat(g[1]):NaN;return isNaN(b)?0:b/100}function u(m,g,b){const v=m[g*4],p=m[g*4+1],x=m[g*4+2],y=m[g*4+3],_=(p-v)/b;for(let M=0;M<b;M++){const w=(g+M)*4;m[w]=v+_*M,m[w+1]=v+_*(M+1),m[w+2]=x,m[w+3]=y}}function f(){return(self.performance||Date).now()}function d(){this.data=[]}const h=["glyphObj","x","y","width","charIndex","fontData"];return d.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/h.length)},glyphAt(m){let g=d.flyweight;return g.data=this.data,g.index=m,g},splitAt(m){let g=new d;return g.data=this.data.splice(m*h.length),g}},d.flyweight=h.reduce((m,g,b,v)=>(Object.defineProperty(m,g,{get(){return this.data[this.index*h.length+b]},set(p){this.data[this.index*h.length+b]=p}}),m),{data:null,index:0}),{typeset:c,measure:s}}const jt=()=>(self.performance||Date).now(),xo=Zs();let Ya;function rd(o,t,r,l,n,e,a,c,s,i,u=!0){return u?sd(o,t,r,l,n,e,a,c,s,i).then(null,f=>(Ya||(console.warn("WebGL SDF generation failed, falling back to JS",f),Ya=!0),Qa(o,t,r,l,n,e,a,c,s,i))):Qa(o,t,r,l,n,e,a,c,s,i)}const ro=[],ad=5;let kr=0;function $s(){const o=jt();for(;ro.length&&jt()-o<ad;)ro.shift()();kr=ro.length?setTimeout($s,0):0}const sd=(...o)=>new Promise((t,r)=>{ro.push(()=>{const l=jt();try{xo.webgl.generateIntoCanvas(...o),t({timing:jt()-l})}catch(n){r(n)}}),kr||(kr=setTimeout($s,0))}),id=4,cd=2e3,Xa={};let ld=0;function Qa(o,t,r,l,n,e,a,c,s,i){const u="TroikaTextSDFGenerator_JS_"+ld++%id;let f=Xa[u];return f||(f=Xa[u]={workerModule:un({name:u,workerId:u,dependencies:[Zs,jt],init(d,h){const m=d().javascript.generate;return function(...g){const b=h();return{textureData:m(...g),timing:h()-b}}},getTransferables(d){return[d.textureData.buffer]}}),requests:0,idleTimer:null}),f.requests++,clearTimeout(f.idleTimer),f.workerModule(o,t,r,l,n,e).then(({textureData:d,timing:h})=>{const m=jt(),g=new Uint8Array(d.length*4);for(let b=0;b<d.length;b++)g[b*4+i]=d[b];return xo.webglUtils.renderImageData(a,g,c,s,o,t,1<<3-i),h+=jt()-m,--f.requests===0&&(f.idleTimer=setTimeout(()=>{Gf(u)},cd)),{timing:h}})}function ud(o){o._warm||(xo.webgl.isSupported(o),o._warm=!0)}const fd=xo.webglUtils.resizeWebGLCanvasWithoutClearing,An={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},dd=new et;function nn(){return(self.performance||Date).now()}const Ka=Object.create(null);function hd(o,t){o=md({},o);const r=nn(),l=[];if(o.font&&l.push({label:"user",src:gd(o.font)}),o.font=l,o.text=""+o.text,o.sdfGlyphSize=o.sdfGlyphSize||An.sdfGlyphSize,o.unicodeFontsURL=o.unicodeFontsURL||An.unicodeFontsURL,o.colorRanges!=null){let d={};for(let h in o.colorRanges)if(o.colorRanges.hasOwnProperty(h)){let m=o.colorRanges[h];typeof m!="number"&&(m=dd.set(m).getHex()),d[h]=m}o.colorRanges=d}Object.freeze(o);const{textureWidth:n,sdfExponent:e}=An,{sdfGlyphSize:a}=o,c=n/a*4;let s=Ka[a];if(!s){const d=document.createElement("canvas");d.width=n,d.height=a*256/c,s=Ka[a]={glyphCount:0,sdfGlyphSize:a,sdfCanvas:d,sdfTexture:new Rr(d,void 0,void 0,void 0,co,co),contextLost:!1,glyphsByFont:new Map},s.sdfTexture.generateMipmaps=!1,pd(s)}const{sdfTexture:i,sdfCanvas:u}=s;ni(o).then(d=>{const{glyphIds:h,glyphFontIndices:m,fontData:g,glyphPositions:b,fontSize:v,timings:p}=d,x=[],y=new Float32Array(h.length*4);let _=0,M=0;const w=nn(),A=g.map(R=>{let U=s.glyphsByFont.get(R.src);return U||s.glyphsByFont.set(R.src,U=new Map),U});h.forEach((R,U)=>{const H=m[U],{src:G,unitsPerEm:X}=g[H];let V=A[H].get(R);if(!V){const{path:I,pathBounds:B}=d.glyphData[G][R],E=Math.max(B[2]-B[0],B[3]-B[1])/a*(An.sdfMargin*a+.5),q=s.glyphCount++,z=[B[0]-E,B[1]-E,B[2]+E,B[3]+E];A[H].set(R,V={path:I,atlasIndex:q,sdfViewBox:z}),x.push(V)}const{sdfViewBox:P}=V,O=b[M++],S=b[M++],L=v/X;y[_++]=O+P[0]*L,y[_++]=S+P[1]*L,y[_++]=O+P[2]*L,y[_++]=S+P[3]*L,h[U]=V.atlasIndex}),p.quads=(p.quads||0)+(nn()-w);const F=nn();p.sdf={};const k=u.height,D=Math.ceil(s.glyphCount/c),T=Math.pow(2,Math.ceil(Math.log2(D*a)));T>k&&(console.info(`Increasing SDF texture size ${k}->${T}`),fd(u,n,T),i.dispose()),Promise.all(x.map(R=>ei(R,s,o.gpuAccelerateSDF).then(({timing:U})=>{p.sdf[R.atlasIndex]=U}))).then(()=>{x.length&&!s.contextLost&&(ti(s),i.needsUpdate=!0),p.sdfTotal=nn()-F,p.total=nn()-r,t(Object.freeze({parameters:o,sdfTexture:i,sdfGlyphSize:a,sdfExponent:e,glyphBounds:y,glyphAtlasIndices:h,glyphColors:d.glyphColors,caretPositions:d.caretPositions,chunkedBounds:d.chunkedBounds,ascender:d.ascender,descender:d.descender,lineHeight:d.lineHeight,capHeight:d.capHeight,xHeight:d.xHeight,topBaseline:d.topBaseline,blockBounds:d.blockBounds,visibleBounds:d.visibleBounds,timings:d.timings}))})}),Promise.resolve().then(()=>{s.contextLost||ud(u)})}function ei({path:o,atlasIndex:t,sdfViewBox:r},{sdfGlyphSize:l,sdfCanvas:n,contextLost:e},a){if(e)return Promise.resolve({timing:-1});const{textureWidth:c,sdfExponent:s}=An,i=Math.max(r[2]-r[0],r[3]-r[1]),u=Math.floor(t/4),f=u%(c/l)*l,d=Math.floor(u/(c/l))*l,h=t%4;return rd(l,l,o,r,i,s,n,f,d,h,a)}function pd(o){const t=o.sdfCanvas;t.addEventListener("webglcontextlost",r=>{console.log("Context Lost",r),r.preventDefault(),o.contextLost=!0}),t.addEventListener("webglcontextrestored",r=>{console.log("Context Restored",r),o.contextLost=!1;const l=[];o.glyphsByFont.forEach(n=>{n.forEach(e=>{l.push(ei(e,o,!0))})}),Promise.all(l).then(()=>{ti(o),o.sdfTexture.needsUpdate=!0})})}function md(o,t){for(let r in t)t.hasOwnProperty(r)&&(o[r]=t[r]);return o}let Jn;function gd(o){return Jn||(Jn=typeof document>"u"?{}:document.createElement("a")),Jn.href=o,Jn.href}function ti(o){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:t,sdfTexture:r}=o,{width:l,height:n}=t,e=o.sdfCanvas.getContext("webgl");let a=r.image.data;(!a||a.length!==l*n*4)&&(a=new Uint8Array(l*n*4),r.image={width:l,height:n,data:a},r.flipY=!1,r.isDataTexture=!0),e.readPixels(0,0,l,n,e.RGBA,e.UNSIGNED_BYTE,a)}}const vd=un({name:"Typesetter",dependencies:[od,nd,Vf],init(o,t,r){return o(t,r())}}),ni=un({name:"Typesetter",dependencies:[vd],init(o){return function(t){return new Promise(r=>{o.typeset(t,r)})}},getTransferables(o){const t=[];for(let r in o)o[r]&&o[r].buffer&&t.push(o[r].buffer);return t}});ni.onMainThread;const Za={};function yd(o){let t=Za[o];return t||(t=Za[o]=new yt(1,1,o,o).translate(.5,.5,0)),t}const wd="aTroikaGlyphBounds",Ja="aTroikaGlyphIndex",bd="aTroikaGlyphColor";class _d extends Pi{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Ei,this.boundingBox=new It}computeBoundingSphere(){}computeBoundingBox(){}set detail(t){if(t!==this._detail){this._detail=t,(typeof t!="number"||t<1)&&(t=1);let r=yd(t);["position","normal","uv"].forEach(l=>{this.attributes[l]=r.attributes[l].clone()}),this.setIndex(r.getIndex().clone())}}get detail(){return this._detail}set curveRadius(t){t!==this._curveRadius&&(this._curveRadius=t,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(t,r,l,n,e){this.updateAttributeData(wd,t,4),this.updateAttributeData(Ja,r,1),this.updateAttributeData(bd,e,3),this._blockBounds=l,this._chunkedBounds=n,this.instanceCount=r.length,this._updateBounds()}_updateBounds(){const t=this._blockBounds;if(t){const{curveRadius:r,boundingBox:l}=this;if(r){const{PI:n,floor:e,min:a,max:c,sin:s,cos:i}=Math,u=n/2,f=n*2,d=Math.abs(r),h=t[0]/d,m=t[2]/d,g=e((h+u)/f)!==e((m+u)/f)?-d:a(s(h)*d,s(m)*d),b=e((h-u)/f)!==e((m-u)/f)?d:c(s(h)*d,s(m)*d),v=e((h+n)/f)!==e((m+n)/f)?d*2:c(d-i(h)*d,d-i(m)*d);l.min.set(g,t[1],r<0?-v:0),l.max.set(b,t[3],r<0?0:v)}else l.min.set(t[0],t[1],0),l.max.set(t[2],t[3],0);l.getBoundingSphere(this.boundingSphere)}}applyClipRect(t){let r=this.getAttribute(Ja).count,l=this._chunkedBounds;if(l)for(let n=l.length;n--;){r=l[n].end;let e=l[n].rect;if(e[1]<t.w&&e[3]>t.y&&e[0]<t.z&&e[2]>t.x)break}this.instanceCount=r}updateAttributeData(t,r,l){const n=this.getAttribute(t);r?n&&n.array.length===r.length?(n.array.set(r),n.needsUpdate=!0):(this.setAttribute(t,new on(r,l)),delete this._maxInstanceCount,this.dispose()):n&&this.deleteAttribute(t)}}const xd=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,Sd=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,Md=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,Cd=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function Ad(o){const t=Tr(o,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new te},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new sa(0,0,0,0)},uTroikaClipRect:{value:new sa(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new te},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new et},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new vs},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:xd,vertexTransform:Sd,fragmentDefs:Md,fragmentColorTransform:Cd,customRewriter({vertexShader:r,fragmentShader:l}){let n=/\buniform\s+vec3\s+diffuse\b/;return n.test(l)&&(l=l.replace(n,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),n.test(r)||(r=r.replace(Js,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:r,fragmentShader:l}}});return t.transparent=!0,t.forceSinglePass=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),t}const zr=new mt({color:16777215,side:Dr,transparent:!0}),$a=8421504,es=new _t,$n=new C,er=new C,Mn=[],Td=new C,tr="+x+y";function ts(o){return Array.isArray(o)?o[0]:o}let oi=()=>{const o=new Xe(new yt(1,1),zr);return oi=()=>o,o},ri=()=>{const o=new Xe(new yt(1,1,32,1),zr);return ri=()=>o,o};const kd={type:"syncstart"},Fd={type:"synccomplete"},ai=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],Ud=ai.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class vo extends Xe{constructor(){const t=new _d;super(t,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=$a,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=tr,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(t){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(t):(this._isSyncing=!0,this.dispatchEvent(kd),hd({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},r=>{this._isSyncing=!1,this._textRenderInfo=r,this.geometry.updateGlyphs(r.glyphBounds,r.glyphAtlasIndices,r.blockBounds,r.chunkedBounds,r.glyphColors);const l=this._queuedSyncs;l&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{l.forEach(n=>n&&n())})),this.dispatchEvent(Fd),t&&t()})))}onBeforeRender(t,r,l,n,e,a){this.sync(),e.isTroikaTextMaterial&&this._prepareForRender(e)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(t){return Ad(t)}get material(){let t=this._derivedMaterial;const r=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=zr.clone());if((!t||!t.isDerivedFrom(r))&&(t=this._derivedMaterial=this.createDerivedMaterial(r),r.addEventListener("dispose",function l(){r.removeEventListener("dispose",l),t.dispose()})),this.hasOutline()){let l=t._outlineMtl;return l||(l=t._outlineMtl=Object.create(t,{id:{value:t.id+.1}}),l.isTextOutlineMaterial=!0,l.depthWrite=!1,l.map=null,t.addEventListener("dispose",function n(){t.removeEventListener("dispose",n),l.dispose()})),[l,t]}else return t}set material(t){t&&t.isTroikaTextMaterial?(this._derivedMaterial=t,this._baseMaterial=t.baseMaterial):this._baseMaterial=t}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(t){this.geometry.detail=t}get curveRadius(){return this.geometry.curveRadius}set curveRadius(t){this.geometry.curveRadius=t}get customDepthMaterial(){return ts(this.material).getDepthMaterial()}set customDepthMaterial(t){}get customDistanceMaterial(){return ts(this.material).getDistanceMaterial()}set customDistanceMaterial(t){}_prepareForRender(t){const r=t.isTextOutlineMaterial,l=t.uniforms,n=this.textRenderInfo;if(n){const{sdfTexture:c,blockBounds:s}=n;l.uTroikaSDFTexture.value=c,l.uTroikaSDFTextureSize.value.set(c.image.width,c.image.height),l.uTroikaSDFGlyphSize.value=n.sdfGlyphSize,l.uTroikaSDFExponent.value=n.sdfExponent,l.uTroikaTotalBounds.value.fromArray(s),l.uTroikaUseGlyphColors.value=!r&&!!n.glyphColors;let i=0,u=0,f=0,d,h,m,g=0,b=0;if(r){let{outlineWidth:p,outlineOffsetX:x,outlineOffsetY:y,outlineBlur:_,outlineOpacity:M}=this;i=this._parsePercent(p)||0,u=Math.max(0,this._parsePercent(_)||0),d=M,g=this._parsePercent(x)||0,b=this._parsePercent(y)||0}else f=Math.max(0,this._parsePercent(this.strokeWidth)||0),f&&(m=this.strokeColor,l.uTroikaStrokeColor.value.set(m??$a),h=this.strokeOpacity,h==null&&(h=1)),d=this.fillOpacity;l.uTroikaEdgeOffset.value=i,l.uTroikaPositionOffset.value.set(g,b),l.uTroikaBlurRadius.value=u,l.uTroikaStrokeWidth.value=f,l.uTroikaStrokeOpacity.value=h,l.uTroikaFillOpacity.value=d??1,l.uTroikaCurveRadius.value=this.curveRadius||0;let v=this.clipRect;if(v&&Array.isArray(v)&&v.length===4)l.uTroikaClipRect.value.fromArray(v);else{const p=(this.fontSize||.1)*100;l.uTroikaClipRect.value.set(s[0]-p,s[1]-p,s[2]+p,s[3]+p)}this.geometry.applyClipRect(l.uTroikaClipRect.value)}l.uTroikaSDFDebug.value=!!this.debugSDF,t.polygonOffset=!!this.depthOffset,t.polygonOffsetFactor=t.polygonOffsetUnits=this.depthOffset||0;const e=r?this.outlineColor||0:this.color;if(e==null)delete t.color;else{const c=t.hasOwnProperty("color")?t.color:t.color=new et;(e!==c._input||typeof e=="object")&&c.set(c._input=e)}let a=this.orientation||tr;if(a!==t._orientation){let c=l.uTroikaOrient.value;a=a.replace(/[^-+xyz]/g,"");let s=a!==tr&&a.match(/^([-+])([xyz])([-+])([xyz])$/);if(s){let[,i,u,f,d]=s;$n.set(0,0,0)[u]=i==="-"?1:-1,er.set(0,0,0)[d]=f==="-"?-1:1,es.lookAt(Td,$n.cross(er),er),c.setFromMatrix4(es)}else c.identity();t._orientation=a}}_parsePercent(t){if(typeof t=="string"){let r=t.match(/^(-?[\d.]+)%$/),l=r?parseFloat(r[1]):NaN;t=(isNaN(l)?0:l/100)*this.fontSize}return t}localPositionToTextCoords(t,r=new te){r.copy(t);const l=this.curveRadius;return l&&(r.x=Math.atan2(t.x,Math.abs(l)-Math.abs(t.z))*Math.abs(l)),r}worldPositionToTextCoords(t,r=new te){return $n.copy(t),this.localPositionToTextCoords(this.worldToLocal($n),r)}raycast(t,r){const{textRenderInfo:l,curveRadius:n}=this;if(l){const e=l.blockBounds,a=n?ri():oi(),c=a.geometry,{position:s,uv:i}=c.attributes;for(let u=0;u<i.count;u++){let f=e[0]+i.getX(u)*(e[2]-e[0]);const d=e[1]+i.getY(u)*(e[3]-e[1]);let h=0;n&&(h=n-Math.cos(f/n)*n,f=Math.sin(f/n)*n),s.setXYZ(u,f,d,h)}c.boundingSphere=this.geometry.boundingSphere,c.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,Mn.length=0,a.raycast(t,Mn);for(let u=0;u<Mn.length;u++)Mn[u].object=this,r.push(Mn[u])}}copy(t){const r=this.geometry;return super.copy(t),this.geometry=r,Ud.forEach(l=>{this[l]=t[l]}),this}clone(){return new this.constructor().copy(this)}}ai.forEach(o=>{const t="_private_"+o;Object.defineProperty(vo.prototype,o,{get(){return this[t]},set(r){r!==this[t]&&(this[t]=r,this._needsSync=!0)}})});new It;new et;function ns(o,t,r){const l=t.geometry;l.computeBoundingBox();const n=l.getAttribute("position");if(!n)throw new Error("Pane mesh has no position attribute");const e=[],a=new C,c=Q=>`${Q.x.toFixed(6)},${Q.y.toFixed(6)},${Q.z.toFixed(6)}`,s=new Set;for(let Q=0;Q<n.count;Q++){a.set(n.getX(Q),n.getY(Q),n.getZ(Q));const ge=c(a);s.has(ge)||(e.push(a.clone()),s.add(ge))}e.length!==4&&console.warn(`[GLBInfoPaneSplit] Expected 4 unique verts, got ${e.length}. Proceeding anyway.`);const i=e.reduce((Q,ge)=>Q.add(ge),new C).multiplyScalar(1/e.length),u=Q=>Math.atan2(Q.y-i.y,Q.x-i.x);e.sort((Q,ge)=>u(Q)-u(ge));const f=e[0]??new C,d=e[1]??new C(1,0,0),h=e[2]??new C(1,1,0),m=e[3]??new C(0,1,0),g=new C().subVectors(d,f),b=new C().subVectors(h,d),v=new C().subVectors(m,h),p=new C().subVectors(f,m);function x(Q,ge){const Se=Q.clone().normalize().add(ge.clone().normalize());return Se.lengthSq()<1e-10?Q.clone().normalize():Se.normalize()}const y=x(g,v),_=x(b,p),M=new C(0,1,0),w=new vs().getNormalMatrix(t.matrixWorld),A=y.clone().applyMatrix3(w).normalize(),F=_.clone().applyMatrix3(w).normalize(),k=Math.abs(A.dot(M)),D=Math.abs(F.dot(M)),T=(k<=D?y:_).clone(),R=new C().crossVectors(g,b);R.lengthSq()<1e-10&&R.set(0,0,1),R.normalize();const U=new C().crossVectors(R,T);U.lengthSq()<1e-10?(T.set(1,0,0),U.set(0,1,0),R.set(0,0,1)):U.normalize();let H=-1/0;for(const Q of e){const ge=new C().subVectors(Q,i);H=Math.max(H,ge.dot(U))}const G=T.clone(),X=U.clone(),V=R.clone();H<0&&(G.multiplyScalar(-1),X.multiplyScalar(-1));const P=new _t().makeBasis(G,X,V),O=new je().setFromRotationMatrix(P),S=new pt;S.name="ContentRoot"+r,t.add(S),S.position.copy(i).add(V.clone().multiplyScalar(.0015)),S.quaternion.copy(O),S.renderOrder=10;const L=new pt;L.name="ContentGroup"+r,S.add(L);let I=1/0,B=-1/0,E=1/0,q=-1/0;for(const Q of e){const ge=new C().subVectors(Q,i),Se=ge.dot(G),Ae=ge.dot(X);Se<I&&(I=Se),Se>B&&(B=Se),Ae<E&&(E=Ae),Ae>q&&(q=Ae)}const z=B-I,Y=q-E,ue=.02,ie=q-ue,ne=E+ue,Z=ie-ne,Ce=(ie+ne)*.5,ve=new vo;ve.anchorX="center",ve.anchorY="top",ve.color=0,ve.maxWidth=z*.84,ve.overflowWrap="break-word",ve.depthOffset=-1,L.add(ve);const re=new vo;re.anchorX="center",re.anchorY="top",re.color=0,re.maxWidth=z*.84,re.overflowWrap="break-word",re.depthOffset=-1,re.textAlign="center",L.add(re);const he=()=>{const Q=ge=>{const Se=ge.material;Se&&(Se.depthWrite=!1,Se.depthTest=!0,Se.transparent=!0,Se.toneMapped=!1,Se.needsUpdate=!0)};Q(ve),Q(re)},de=new pt;de.name=`Scrollbar${r}`,S.add(de);const $=new yt(.01,Z),ae=new mt({color:9349805,transparent:!0,opacity:.2,depthTest:!0,depthWrite:!1}),W=new Xe($,ae);W.name=`ScrollRail${r}`;const j=.5*Math.min(.02,z*.06);W.position.set(B-j,Ce,.001),de.add(W);const N=new yt(.038,.2),oe=new mt({color:0,transparent:!0,opacity:.55,depthTest:!0,depthWrite:!1}),K=new Xe(N,oe);K.name=`ScrollThumb${r}`,K.position.set(W.position.x,W.position.y,.0011),de.add(K);const J=new pt;J.name=`ScrollbarLeft${r}`,S.add(J);const we=new Xe($.clone(),ae.clone());we.name=`ScrollRailLeft${r}`,we.position.set(I+j,Ce,.001),J.add(we);const pe=new Xe(N.clone(),oe.clone());pe.name=`ScrollThumbLeft${r}`,pe.position.set(we.position.x,we.position.y,.0011),J.add(pe);function me(Q){return new Pr({uniforms:{map:{value:Q},uClipTop:{value:1e6},uClipBottom:{value:-1e6},uUseClip:{value:1}},vertexShader:`
        varying vec2 vUv; varying float vY;
        void main(){ vUv=uv; vY=position.y; gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0); }`,fragmentShader:`
        uniform sampler2D map; uniform float uClipTop; uniform float uClipBottom; uniform float uUseClip;
        varying vec2 vUv; varying float vY;
        void main(){ vec4 c=texture2D(map,vUv); if(c.a<0.01) discard; if(uUseClip>0.5&&(vY>uClipTop||vY<uClipBottom)) discard; gl_FragColor=c; }`,transparent:!0,depthTest:!0,depthWrite:!1,toneMapped:!1})}const ce=[];let fe=0,Pe=1,Oe=!1;function ee(){const Q=Math.min(1,Z/Math.max(Z,Pe)),ge=Math.max(Z*Q,Z*.08);return(Z-ge)*.5}function le(Q,ge){const Se=ie-(ge+Q.position.y),Ae=ne-(ge+Q.position.y),Ue=Math.min(Ae,Se),He=Math.max(Ae,Se);Q.clipRect=[-1e6,Ue,1e6,He]}function se(Q,ge){const Se=ie-(ge+Q.position.y),Ae=ne-(ge+Q.position.y),Ue=Q.material.uniforms;Ue?.uClipTop&&Ue?.uClipBottom&&(Ue.uClipTop.value=Math.max(Se,Ae),Ue.uClipBottom.value=Math.min(Se,Ae),Q.material.needsUpdate=!0)}function be(){const Q=L.position.y;le(ve,Q),le(re,Q);for(const ge of ce)se(ge.mesh,Q);ve.sync(),re.sync()}function ke(Q){fe=De.clamp(Q,0,1);const ge=Math.max(0,Pe-Z),Ae=(Oe?1:-1)*fe*ge;L.position.set(0,Ae,0),be();const Ue=ee(),He=Z-2*Ue,Te=De.lerp(+Ue,-Ue,fe);K.scale.set(1,Math.max(1e-4,He/.2),1),K.position.y=W.position.y+Te,pe.scale.set(1,Math.max(1e-4,He/.2),1),pe.position.y=we.position.y+Te}function Ge(Q){ke(fe+Q)}function xe(){return fe}function Me(Q){Oe=!!Q,ke(fe)}function Fe(Q,ge){const Se=ee(),Ae=Q.position.y,He=(De.clamp(ge-Ae,-Se,+Se)-+Se)/(-Se-+Se);ke(He)}function Be(Q){Fe(W,Q)}async function ye(Q,ge,Se){const Ae=await new io().loadAsync(Q);Ae.colorSpace=it,Ae.wrapS=Ae.wrapT=sn,Ae.minFilter=ia,Ae.magFilter=co,Ae.generateMipmaps=!0;const Ue=Ae.image,He=Math.max(1,Ue.width??Ue.bitmap?.width??1),Te=Math.max(1,Ue.height??Ue.bitmap?.height??1),qe=He/Te,We=z*.84,Ee=Y*.18;let Le=ge==="single"?We:We*.5,Ne=Le/qe;Ne>Ee&&(Ne=Ee,Le=Ne*qe);const at=new yt(Le,Ne),Ke=me(Ae),rt=new Xe(at,Ke);return rt.name=(ge==="single"?"LogoPlaneSingle":ge==="left"?"LogoPlaneLeft":"LogoPlaneRight")+r,Se&&(rt.userData.href=Se),rt.position.set(0,0,0),L.add(rt),{mesh:rt,drawW:Le,drawH:Ne}}async function _e(Q){fe=0,L.position.set(0,0,0),Pe=1;for(const Le of ce)Le.mesh.parent&&Le.mesh.parent.remove(Le.mesh),Le.mesh.material.dispose(),Le.mesh.geometry.dispose();ce.length=0;let ge=0;if(Q.logoUrlLeft&&Q.logoUrlRight){const Le=await ye(Q.logoUrlLeft,"left",Q.logoHrefLeft),Ne=await ye(Q.logoUrlRight,"right",Q.logoHrefRight),at=z*.84*.5,Ke=Math.min(Le.mesh.geometry.parameters.width,Ne.mesh.geometry.parameters.width,at),rt=Math.min(Le.mesh.geometry.parameters.height,Ne.mesh.geometry.parameters.height);Le.mesh.geometry.dispose(),Ne.mesh.geometry.dispose(),Le.mesh.geometry=new yt(Ke,rt),Ne.mesh.geometry=new yt(Ke,rt),Le.mesh.position.x=-Ke*.5,Ne.mesh.position.x=+Ke*.5,Q.logoHrefLeft?ce.push({mesh:Le.mesh,id:"left",href:Q.logoHrefLeft}):ce.push({mesh:Le.mesh,id:"left"}),Q.logoHrefRight?ce.push({mesh:Ne.mesh,id:"right",href:Q.logoHrefRight}):ce.push({mesh:Ne.mesh,id:"right"}),ge=rt}else if(Q.logoUrl){const Le=await ye(Q.logoUrl,"single");ce.push({mesh:Le.mesh,id:"single"}),ge=Le.drawH}const Se=Y*.08,Ae=Y*.04;Q.title&&(ve.text=(Q.title??"Info").trim(),ve.fontSize=Se,ve.lineHeight=1.05,ve.maxWidth=z*.84,await new Promise(Le=>ve.sync(()=>{he(),Le()}))),re.text=Q.body??"",re.fontSize=Ae,re.lineHeight=1.25,re.maxWidth=z*.84,await new Promise(Le=>re.sync(()=>{he(),Le()}));const Ue=ve.textRenderInfo,He=re.textRenderInfo,Te=Ue.blockBounds[3]-Ue.blockBounds[1],qe=He.blockBounds[3]-He.blockBounds[1],We=Se*.35,Ee=Y*.02;let Ve=ie;if(ve.position.set(0,Ve,0),Ve-=Te+We,ce.length>0){for(const Le of ce){Le.mesh.geometry.computeBoundingBox();const Ne=Le.mesh.geometry.boundingBox,at=Math.max(0,Ne.max.y-Ne.min.y);Le.mesh.position.y=Ve-at*.5}Ve-=ge+Ee}re.position.set(0,Ve,0),Ve-=qe,console.log("innerW, innerH",z,Y),console.log("xAxisLocal",G.toArray(),"yAxisLocal",X.toArray()),await Promise.all([Ie(K,Q.thumbImageUrl),Ie(pe,Q.thumbImageUrl)]),Pe=ie-Ve,ke(0)}async function Ie(Q,ge){if(!ge)return;const Se=await new io().loadAsync(ge);Se.colorSpace=it,Se.wrapS=Se.wrapT=sn,Se.minFilter=ia,Se.magFilter=co,Se.generateMipmaps=!0;const Ae=Q.material;Ae.map=Se,Ae.color.set(16777215),Ae.opacity=1,Ae.transparent=!0,Ae.alphaTest=.1,Ae.depthWrite=!1,Ae.depthTest=!0,Ae.toneMapped=!1,Ae.needsUpdate=!0,Se.needsUpdate=!0}function ze(){ve.dispose(),re.dispose();for(const Q of ce)Q.mesh.material.dispose(),Q.mesh.geometry.dispose();W.material.dispose(),K.material.dispose(),we.material.dispose(),pe.material.dispose(),W.geometry.dispose(),K.geometry.dispose(),we.geometry.dispose(),pe.geometry.dispose()}return{viewportH:Z,open:_e,setScroll01:ke,scrollBy:Ge,getScroll01:xe,setInvertScroll:Me,setScrollFromThumbLocalY:Be,setScrollFromThumbLocalYFor:Fe,getViewportHeight:()=>Z,getScrollbarMeshesBoth:()=>({right:{rail:W,thumb:K},left:{rail:we,thumb:pe}}),getLogoTargets:()=>ce.map(Q=>({mesh:Q.mesh,id:Q.id,href:Q.href})),dispose:ze}}async function Ld(o){o.localClippingEnabled=!1;const t=await Pn(Qs);yr(t);const{pivot:r}=wr(t),l=r.getObjectByName("Pane_TextSurface_L"),n=r.getObjectByName("Pane_TextSurface_R");(!l||!n)&&console.warn("[GLBInfoPaneSplit] Pane_TextSurface_L/R not found in GLB.");const e=ns(o,l,"_L"),a=ns(o,n,"_R"),c=new pt;c.name="GLBInfoPane3D_Split",c.add(r);async function s(d){await Promise.all([e.open(d.left),a.open(d.right)])}function i(d){e.setInvertScroll(d),a.setInvertScroll(d)}function u(){e.dispose(),a.dispose()}const f=d=>({setScroll01:d.setScroll01,scrollBy:d.scrollBy,getScroll01:d.getScroll01,setInvertScroll:d.setInvertScroll,getViewportHeight:d.getViewportHeight,getLogoTargets:()=>d.getLogoTargets().map(h=>({mesh:h.mesh,id:h.id,href:h.href??void 0}))});return{group:c,left:f(e),right:f(a),open:s,setInvertScroll:i,dispose:u,getScrollbarMeshesBoth:()=>{const d=e,h=a,m=d.getScrollbarMeshesBoth?.(),g=h.getScrollbarMeshesBoth?.(),b=m?.left??d.getScrollbarMeshes?.(),v=g?.right??h.getScrollbarMeshes?.();if(!b||!v)throw new Error("Scrollbar meshes not available on split panes");return{left:b,right:v}},setScrollFromThumbLocalYFor:(d,h)=>{if((d?.name??"").endsWith("_L")){const g=e;g.setScrollFromThumbLocalYFor?g.setScrollFromThumbLocalYFor(d,h):g.setScrollFromThumbLocalY&&g.setScrollFromThumbLocalY(h)}else{const g=a;g.setScrollFromThumbLocalYFor?g.setScrollFromThumbLocalYFor(d,h):g.setScrollFromThumbLocalY&&g.setScrollFromThumbLocalY(h)}}}}let Tt=null,Dt=null,qt=null;function si(){Dt!=null&&(cancelAnimationFrame(Dt),Dt=null),qt=null}const Rd=o=>o*o*o;let rn=null;const Fr=.8;function ii(o,t){const l=o.material;l&&(Array.isArray(l)?l.forEach(t):t(l))}function ao(o,t,r=!0){o.traverse(l=>{if(!l.isMesh)return;let n=l.parent;for(;n;){if(typeof n.name=="string"&&n.name.startsWith("ContentRoot"))return;n=n.parent}ii(l,e=>{typeof e.opacity=="number"&&(e.opacity=De.clamp(t,0,1),e.transparent=!0,e.depthWrite=t>=.999),e.depthTest=!r,e.toneMapped=!1,e.premultipliedAlpha=!1,e.needsUpdate=!0})})}function ci(o){const t=[];return o.traverse(r=>{typeof r.name=="string"&&r.name.startsWith("ContentRoot")&&t.push(r)}),t}function so(o,t,r=!0){o.traverse(l=>{const n=l.isMesh&&l.material&&l.geometry&&l.isTextMesh||l instanceof vo;if(l.isMesh&&(ii(l,e=>{typeof e.opacity=="number"&&(e.opacity=De.clamp(t,0,1),e.transparent=!0,e.depthWrite=!1),e.depthTest=!r,e.toneMapped=!1,e.premultipliedAlpha=!1,e.needsUpdate=!0}),l.renderOrder=r?100:10),n){const a=l.material;a&&typeof a.opacity=="number"&&(a.opacity=De.clamp(t,0,1),a.transparent=!0,a.depthWrite=!1,a.depthTest=!r,a.needsUpdate=!0)}})}function Dd(o,t,r,l,n,e=.04){const{viewW:a,viewH:c}=Or(t,r),s=a*e,i=c*e,u=Math.max(0,(a-l)*.5-s),f=Math.max(0,(c-n)*.5-i);o.position.x=De.clamp(o.position.x,-u,+u),o.position.y=De.clamp(o.position.y,-f,+f)}function Pd(o){const t=new It().setFromObject(o),r=new C;return t.getSize(r),{w:r.x,h:r.y}}function Ed(o,t,r,l){si(),qt="in";const n=1200,e=.86*t,a=1.5*t;ao(o.group,0,!0);const c=ci(o.group);c.forEach(v=>so(v,0,!0));const s=new C().setFromMatrixPosition(o.group.matrixWorld),i=new je().setFromRotationMatrix(o.group.matrixWorld),u=new C,f=new je;rn.updateMatrixWorld(!0),rn.getWorldPosition(u),rn.getWorldQuaternion(f);const d=gr(s,u),h={t:0,dur:n/1e3,curve:d,fromQuat:i.clone(),toQuat:f.clone(),fromScale:e,toScale:a},m=o.group;let g=performance.now();const b=v=>{if(qt!=="in")return;const p=(v-g)/1e3;g=v;const x=Gs(m,h,p),y=Math.min(1,h.t/h.dur),_=zs(y);if(ao(m,_,!x),c.forEach(M=>so(M,_,!x)),!x)Dt=requestAnimationFrame(b);else{m.position.copy(u),m.quaternion.copy(f),m.scale.setScalar(a),ao(m,1,!1),c.forEach(k=>so(k,1,!1)),Os(rn,m);const M=1.408,w=1.008/1.408,A=M*a,F=M*w*a;Dd(m,r,Fr,F,A),Dt=null,qt=null,l()}};Dt=requestAnimationFrame(b)}function os(o,t){si(),qt="out";const r=o.group.scale.x||1,l=Math.max(1e-4,r*.1),n=1200,e=performance.now(),a=ci(o.group),c=s=>{if(qt!=="out")return;const i=Math.min(1,(s-e)/n),u=Rd(i);o.group.scale.setScalar(r+(l-r)*u);const f=1-u;if(ao(o.group,f,i<1),a.forEach(d=>so(d,f,i<1)),i<1)Dt=requestAnimationFrame(c);else{Dt=null,qt=null;const d=o.group.parent;d&&d.remove(o.group),o.dispose(),t()}};Dt=requestAnimationFrame(c)}let Vt=null;function eo(o){return o.left!==void 0&&o.right!==void 0}function Bd(o,t,r){const l=new fs,n=new te,e={dragging:!1,dragMode:null,railMesh:null,lastHitYLocal:0,paneMeshForContent:null,pointerId:-1},a=r.style.touchAction;r.style.touchAction="none";const c=6e-4,s=1,i=0;function u(v){const p=r.getBoundingClientRect(),x="clientX"in v?v.clientX:p.left+p.width/2,y="clientY"in v?v.clientY:p.top+p.height/2;n.x=(x-p.left)/p.width*2-1,n.y=-((y-p.top)/p.height*2-1)}function f(v){return u(v),l.setFromCamera(n,t),l.intersectObject(o.group,!0)}function d(){if(o.pane.getScrollbarMeshesBoth)return o.pane.getScrollbarMeshesBoth();const v=o.pane.getScrollbarMeshes?.();return v?{right:v,left:null}:{right:null,left:null}}function h(v){const p=f(v);let x=!1;if(!eo(o.pane))p.some(_=>_.object.name==="Pane_TextSurface"||_.object.parent?.name==="Scrollbar"||_.object.name==="LogoPlaneLeft"||_.object.name==="LogoPlaneRight"||_.object.name==="LogoPlaneSingle")&&(v.preventDefault(),o.pane.scrollBy(v.deltaY*c),x=!0);else{const y=p.some(M=>M.object.name==="Pane_TextSurface_L"||M.object.parent?.name==="Scrollbar_L"||typeof M.object.name=="string"&&M.object.name.endsWith("_L")),_=p.some(M=>M.object.name==="Pane_TextSurface_R"||M.object.parent?.name==="Scrollbar_R"||typeof M.object.name=="string"&&M.object.name.endsWith("_R"));y?(v.preventDefault(),o.pane.left.scrollBy(v.deltaY*c),x=!0):_&&(v.preventDefault(),o.pane.right.scrollBy(v.deltaY*c),x=!0)}}function m(v){const p=f(v);if(p.length===0)return;const x=d(),y=x.right?.rail??null,_=x.left?.rail??null,M=p.find(D=>D.object===y||D.object===_),w=p.find(D=>{const T=D.object;return T===(x.right?.thumb??null)||T===(x.left?.thumb??null)});if(M||w){if(e.dragging=!0,e.dragMode="rail",e.railMesh=M?.object??(w?.object===(x.right?.thumb??null)?y:w?.object===(x.left?.thumb??null)?_:null),e.railMesh){r.setPointerCapture(v.pointerId),e.pointerId=v.pointerId,v.preventDefault();const D=M?.point??w?.point;if(D){const T=e.railMesh.worldToLocal(D.clone());o.pane.setScrollFromThumbLocalYFor?o.pane.setScrollFromThumbLocalYFor(e.railMesh,T.y):o.pane.setScrollFromThumbLocalY?.(T.y)}}return}const A=p.find(D=>typeof D.object.name=="string"&&(D.object.name==="Pane_TextSurface"||D.object.name==="Pane_TextSurface_L"||D.object.name==="Pane_TextSurface_R")),F=p.find(D=>D.object.isTextMesh||typeof D.object.name=="string"&&D.object.name.startsWith("LogoPlane")),k=A??F;if(k){e.dragging=!0,e.dragMode="content",e.paneMeshForContent=k.object,e.pointerId=v.pointerId,r.setPointerCapture(v.pointerId),v.preventDefault();const D=e.paneMeshForContent.worldToLocal(k.point.clone());e.lastHitYLocal=D.y}}function g(v){if(!(!e.dragging||v.pointerId!==e.pointerId)&&!(Math.abs(v.movementY)<i&&Math.abs(v.movementX)<i)){if(e.dragMode==="rail"&&e.railMesh){u(v),l.setFromCamera(n,t);const p=l.intersectObject(e.railMesh,!0);if(p.length){v.preventDefault();const x=e.railMesh.worldToLocal(p[0].point.clone()).y;o.pane.setScrollFromThumbLocalYFor?o.pane.setScrollFromThumbLocalYFor(e.railMesh,x):o.pane.setScrollFromThumbLocalY?.(x)}return}if(e.dragMode==="content"&&e.paneMeshForContent){u(v),l.setFromCamera(n,t);const p=l.intersectObject(e.paneMeshForContent,!0);if(p.length){v.preventDefault();const x=e.paneMeshForContent.worldToLocal(p[0].point.clone()).y,y=x-e.lastHitYLocal;e.lastHitYLocal=x;const _=eo(o.pane)?e.paneMeshForContent.name.endsWith("_L")?o.pane.left.getViewportHeight():o.pane.right.getViewportHeight():o.pane.getViewportHeight?.()??1,M=-(y/Math.max(1e-6,_))*s;eo(o.pane)?e.paneMeshForContent.name.endsWith("_L")?o.pane.left.scrollBy(M):o.pane.right.scrollBy(M):o.pane.scrollBy(M)}}}}function b(v){if(e.dragging&&v.pointerId===e.pointerId){try{r.releasePointerCapture(v.pointerId)}catch{}e.dragging=!1,e.dragMode=null,e.railMesh=null,e.paneMeshForContent=null,e.pointerId=-1}const p=f(v);if(!eo(o.pane)){const y=p.find(_=>_.object.name==="LogoPlaneLeft"||_.object.name==="LogoPlaneRight"||_.object.name==="LogoPlaneSingle");if(y){const _=y.object.userData?.href;_&&window.open(_,"_blank","noopener")}return}const x=p.find(y=>typeof y.object.name=="string"&&y.object.name.startsWith("LogoPlane")&&(y.object.name.endsWith("_L")||y.object.name.endsWith("_R")));if(x){const y=x.object.userData?.href;y&&window.open(y,"_blank","noopener")}}return r.addEventListener("wheel",h,{passive:!1}),r.addEventListener("pointerdown",m,{passive:!1}),r.addEventListener("pointermove",g,{passive:!1}),r.addEventListener("pointerup",b,{passive:!0}),r.addEventListener("pointercancel",b,{passive:!0}),r.addEventListener("lostpointercapture",b,{passive:!0}),()=>{r.removeEventListener("wheel",h),r.removeEventListener("pointerdown",m),r.removeEventListener("pointermove",g),r.removeEventListener("pointerup",b),r.removeEventListener("pointercancel",b),r.removeEventListener("lostpointercapture",b),r.style.touchAction=a??""}}async function Id(o,t,r,l){const n=new pt;n.name="InfoOverlay3D";let e;const a=await Ld(o);a.setInvertScroll(!0);const{left:c,right:s}=l;return await a.open({left:c,right:s}),e=a,n.add(a.group),Vt&&(Vt(),Vt=null),Vt=Bd({group:n,pane:e},t,r),{group:n,pane:e,dispose(){Vt&&(Vt(),Vt=null),e.dispose()}}}async function Od(o,t){const{scene:r,camera:l,renderer:n,dom:e,interactions:a}=o;if(Tt){const b=Tt;return new Promise(v=>{os(b,()=>{a.endModal(b.group),Tt===b&&(Tt=null),v()})})}const c=await Id(n,l,e,t);rn||(rn=Is(l,Fr)),r.add(c.group),Tt=c;const s=a.registerObject(c.group,()=>{},100);a.startModal(c.group,()=>{if(!Tt)return;const b=Tt;os(b,()=>{s?.(),a.endModal(b.group),Tt===b&&(Tt=null)})});const i=Pd(c.group),u=.04,{viewW:f,viewH:d}=Or(l,Fr),h=f*u,m=d*u;let g=1;if(i.w>0&&i.h>0){const b=(f-2*h)/i.w,v=(d-2*m)/i.h;g=Math.max(1e-6,Math.min(b,v))}else g=ht();return new Promise(b=>{Ed(c,g,l,()=>b())})}function zd(o,t=815){let r=!1,l=null;const n="/emptyoracle/",e=i=>`${n.replace(/\/+$/,"")}/${i.replace(/^\/+/,"")}`;function a(i,u,f){u&&u.traverse(d=>{d.isMesh&&i.registerObject(d,f)})}function c(i){const u=i?.material,f=d=>{d.depthWrite=!0,d.depthTest=!0,d.transparent=!0,d.needsUpdate=!0};Array.isArray(u)?u.forEach(d=>f(d)):u&&f(u)}function s(i){const u=mo(i);for(const f of u)f.layers.enable(1)}return{id:"ui.infoButton",priority:t,async init(i){if(r)return;const u=o.getOverlayTB(),f=o.getInteractions();if(!u?.group||!f)return;const d=u.group.getObjectByName("info_btn");if(!d||d.__wired)return;const h=d.getObjectByName("mech");c(h),l=new Xs(mo(h)),s(h),a(f,d,async()=>{try{l?.pulseRed(),l?.setActive(!0),await Od({scene:i.scene,camera:i.camera,renderer:i.renderer,dom:i.renderer.domElement,interactions:f},{left:{body:`★ Angel Kether ★
 (Eliška Jahelková) 
   (based in Vienna) moves between painting, writing, music and film. Her works are rooted under the sun of gnosis. Each painting is a search for light. 
https://angelkether.neocities.org/.

★ c_hristian ★
 is a California - based artist and curator searching for ecstasy in the chance encounter with opaque and unnamed forms.

★
𝟕𝖙𝖜𝖉𝖎𝟐𝟗𝖔𝖙𝟓𝖞𝟖𝖔𝖌𝟔𝖓𝖉𝖟𝖊𝟕𝖒𝟕𝖜𝖊𝖝𝖓𝟐𝟗𝖈𝖒𝟐𝟒
★
 Resonance chamber operating within the Interior West.

★ angel mantis ★
 has unstable locations between port cities in extreme opposites. they are global places of connection where angel is just a vessel, a generic soul that seeks to bridge incompatible realms.

★ BRG Rain ★
 is an underground producer from Latvia who primarily makes trap and electronic pop music. They prioritize ethereal / atmospheric soundscapes with dreamy vocals. Their online presence has a deep-internet vibe—incorporating glowing, colorful visuals that reflect their musical sensibilities and a custom brand of meta-ironic meme videos.

★ Pentarasm ★
 is an artist from Internet, Romania, currently working in Timișoara. Working across software, CGI, drawing, painting, sculpture, and film, he transforms video games and fragments of online spaces into new forms.

★ mariyasha ★
 is a level 15 hikki doll (haunted) currently praying for the solar storm in Belgrade.

★ Motka Ambu ★
 (they/them) is a multidisciplinary artist with an applied research of digital spaces and memory, and of one's ostracization through textile, mediatic, and illustrative methods. Ambu reflects on the shut-in culture of mental isolation that melds into the physical, secluding oneself from society, and feelings of self-inflicted hurt and alienation. Motka Ambu is currently existing and pursuing a bachelor's degree in Visual Communications in Berlin, Germany.

★ VargoRg ★
 London, England. A multi-faceted being. Whether through music, visuals and beyond, to create beauty is to breathe. From the remixing of existing creations or a vision planted through her mind via the spiritual network. Through differing states of consciousness she navigates the online state melding it together with the real life environment. Mixed media is the way she communicates with the world. A collaboration of new and old methods is the only way you can stay connected forever.

★ anticatharis (em) ★
 is an online artist/graphic designer/vessel located in bucharest ; currently working with found internet images.

★ Jasmin Nolan ★
 (Tasmania) is a girl who likes to dream and one day she found aemmonia in her dream world and the two held hands and braided their hair together. Aemmonia is the frequency humming through her wifi router… the ramification of both worlds. shes the only one who can wake everyone up from this dream.

★ sneeze ★
  based in portugal painting/sculpture/digital.

★ sixtoesss ★
 is a 24-year-old Romanian digital artist whose work diverses between nostalgia and futurism. Specializing in digital collages, 3D art, and immersive visuals created with paint or even plasticine, they weave dreamy textures with a bold, playful edge of a Y2K retro style. She loves the color pink and is enamored by early 2000s transparent tech and trinkets to where she became a collector, or rather, a hoarder. sixtoesss turns personal passions into an eclectic, candy-colored universe for those who resonate and want to feel seen for representing something so awesome.`,thumbImageUrl:e("images/scroll.png")},right:{title:"𝕰𝖒𝖕𝖙𝖞 𝕺𝖗𝖆𝖈𝖑𝖊",body:"Where each image ends a new one begins. Intelligence relapses on itself while trying to grow an image that holds faeries. Each image is already a playing card when generated through language with a character in mind. Yet the presence of the character can be reshaped by a new descriptor similarly to the transformation of oneself in reality. Transmutation of energy. The oracle is empty precisely because the emptiness of randomness made it, yet nothing is ever really random. The process was organic with a goal that was unclear, which is where faith came in. Faeries exist, elves exist and other beings exist within the oracle. That is possible through our intrinsic knowledge of their absolute existence. Since the internet is writing its own mythology and we are part of its folklore, we can reach the absolute when we let faith guide us. Yet the oracle itself isn’t a clear tool for magick. Or maybe it is not for us. Knowledge is held by language, language holds a structure. When you are guided by images instead of language, you will be entering the unconscious, a dream realm. Where pure clarity loses itself and purity enters. An aesthetic value is what guided our selection, that was an objective selection of beauty. What unites all of our different beings and characters is that they are beautiful, beautiful elementals. And beauty is empty in the oracle, but through its emptiness it guides angels.",logoUrlLeft:e("images/wrong_logo.png"),logoUrlRight:e("images/arcana_logo.png"),logoHrefLeft:"https://thewrong.org/",logoHrefRight:"https://a-r-c-a-n-a.moe/",thumbImageUrl:e("images/scroll.png")}})}catch(g){console.error("[info_btn] presentInfoOverlay error:",g)}finally{l?.setActive(!1)}}),d.__wired=!0,r=!0},update(i){l?.tick(i)},dispose(){}}}async function Gd(o,t){const{scene:r,renderer:l}=o,{hdrUrl:n,showBackground:e=!1,addLightRig:a=!0,exposure:c=1,rotation:s={},cubeSize:i=256}=t;l.toneMappingExposure=c;const u=await new Promise((y,_)=>{new Bi().load(n,M=>y(M),void 0,_)});u.mapping=Ii;const f=new Ur,d=new ca(1,64,32),h=new mt({map:u,side:Oi}),m=new Xe(d,h);f.add(m);const g=y=>(y??0)*Math.PI/180;m.rotation.set(g(s.pitch),g(s.yaw),g(s.roll),"YXZ");const b=new zi(i,{type:l.capabilities.isWebGL2?Gi:Wi,generateMipmaps:!0});new Vi(.01,10,b).update(l,f);const p=new Hi(l);p.compileCubemapShader();const x=p.fromCubemap(b.texture).texture;if(r.environment=x,e){const y=h.clone(),_=new Xe(new ca(50,64,32),y);_.name="HDRBackgroundSkysphere",_.frustumCulled=!1,_.onBeforeRender=(M,w,A)=>{_.position.copy(A.position)},_.rotation.copy(m.rotation),r.getObjectByName("HDRBackgroundSkysphere")?.removeFromParent(),r.add(_)}if(u.dispose(),p.dispose(),b.dispose(),a){const y=new us(16777215,2);y.position.set(3,4,2),y.name="KeyLight",r.getObjectByName("KeyLight")?.removeFromParent(),r.add(y);const _=new ls(16777215,2236979,.6);_.name="HemiFill",r.getObjectByName("HemiFill")?.removeFromParent(),r.add(_)}}function Wd(o,t=50){return{id:"scene.environment",priority:t,async init(r){await Gd(r,o)},update(){},dispose(){}}}function Vd(o,t=750){const r=De.degToRad(o.deadbandDeg??1.25),l={active:!1,qTo:new je},n={armReturnNow:()=>{l.active=!0},isReturningActive:()=>l.active},e={id:"camera.return",priority:t,init(){},update(c,s){const i=s.camera,u=o.getIsFocusing(),f=o.spinner.isActive();if(!u&&!f){const d=o.makeFrameQuatFacingCamera(i,!0),h=a(o.cardGroupFrame.quaternion,d);if(!l.active&&h>r&&(l.active=!0,l.qTo.copy(d)),l.active){const m=1-Math.exp(-8*c);o.cardGroupFrame.quaternion.slerp(l.qTo,m),a(o.cardGroupFrame.quaternion,l.qTo)<.001&&(l.active=!1)}}else l.active=!1},dispose(){}};function a(c,s){const i=Math.abs(De.clamp(c.dot(s),-1,1));return 2*Math.acos(i)}return{system:e,get:()=>n}}function Hd(o){const t=new Map;o.forEach(a=>t.set(a.id,a));const r=new Set,l=new Set,n=[],e=a=>{if(l.has(a))return;if(r.has(a))throw new Error(`Cyclic dependency detected involving ${a}`);r.add(a);const c=t.get(a);if(!c)throw new Error(`Unknown dependency id: ${a}`);const s=c.dependsOn||[];for(const i of s)e(i);r.delete(a),l.add(a),n.push(c)};for(const a of o)l.has(a.id)||e(a.id);return n}class Nd{systems=[];rafId=null;running=!1;app;clock=null;ro=null;vvHandler=null;register(t){if(this.running)throw new Error("Cannot register systems after start");if(this.systems.find(r=>r.id===t.id))throw new Error(`System id already registered: ${t.id}`);return this.systems.push(t),this}async start(t){if(this.running)return;this.running=!0,this.app=t,t.clock?this.clock||(this.clock=t.clock):(this.clock=new Ni,this.app.clock=this.clock);const r=Hd(this.systems);for(const n of r)await n.init(this.app);this.systems.sort((n,e)=>n.priority-e.priority);const l=()=>{if(!this.running)return;const n=Math.min(.033,this.clock?.getDelta?.()??1/60);for(const e of this.systems)e.update(n,this.app);this.rafId=requestAnimationFrame(l)};if(this.rafId=requestAnimationFrame(l),typeof window<"u"){window.addEventListener("resize",this.handleResize,{passive:!0});const n=window.visualViewport;n&&(this.vvHandler=()=>this.handleResize(),n.addEventListener("resize",this.vvHandler,{passive:!0}));const e=this.app.container??this.app.renderer.domElement.parentElement;if(typeof ResizeObserver<"u"&&e){this.ro=new ResizeObserver(()=>{queueMicrotask(()=>this.handleResize())});try{this.ro.observe(e)}catch{}}this.handleResize()}}stop(){if(this.running){if(this.running=!1,this.rafId!=null&&cancelAnimationFrame(this.rafId),typeof window<"u"){window.removeEventListener("resize",this.handleResize);const t=window.visualViewport;if(this.vvHandler&&t)try{t.removeEventListener("resize",this.vvHandler)}catch{}this.vvHandler=null}if(this.ro){try{this.ro.disconnect()}catch{}this.ro=null}}}dispose(){this.stop();for(const t of this.systems)try{t.dispose()}catch{}this.systems=[]}handleResize=()=>{const{renderer:t,camera:r}=this.app,l=typeof window<"u"?Math.max(1,window.innerWidth):1,n=typeof window<"u"?Math.max(1,window.innerHeight):1;typeof window<"u"&&typeof t.setPixelRatio=="function"&&t.setPixelRatio(window.devicePixelRatio||1),t.setSize(l,n,!0);const e=r;e&&typeof e.aspect=="number"&&(e.aspect=l/n,e.updateProjectionMatrix?.());for(const a of this.systems)a.onResize?.(l,n,this.app)}}function jd(){return new Nd}function qd(o,t=700){return{id:"cards.core",priority:t,init(){},update(r,l){o.director.update(r);const{layoutChanged:n}=uc(r);n&&!o.isLayoutLocked()&&o.system?.prepareHeartTargets?.(),o.system?.step?.(r,o.getUIValues(),l.camera,{billboard:o.getBillboardMode()})},dispose(){}}}function Yd(o,t=720){const r=Ys(),l=r.viewport.outerMarginX??.15,n=r.viewport.outerMarginY??.22,e=r.viewport.padFudge??.3,a=.02,c=.3,s=20;let i=!1;const u=new C,f=new C;function d(x){x.getWorldPosition(u),x.getWorldDirection(f).normalize();const y=new C().subVectors(o.cardGroupCenter,u);return{dist:Math.abs(f.dot(y))}}function h(x){const y=o.getOverlayBounds?.();if(!y)return null;const{dist:_}=d(x);if(_<1e-6)return null;const M=De.degToRad(x.fov),w=2*Math.tan(M/2)*_,F=w*x.aspect*(1-2*l),k=w*(1-2*n),D=e*.38,T=y.w+2*D,R=y.h+2*D;if(T<=0||R<=0)return null;const U=Math.min(F/T,k/R);return!isFinite(U)||U<=0?null:U}function m(x){if(i)return;const y=h(x);if(y==null)return;const _=o.getCardScale(),M=De.clamp(_*y*.98,c,s);o.snapScales(M,M),i=!0}function g(x){const y=h(x);if(y==null)return;const _=o.getCardScale();if(_*y*.98>=c)return;const w=c/Math.max(1e-6,_*.98);if(w<=y)return;const{dist:A}=d(x),F=A*(w/Math.max(1e-6,y))*1.02;o.controls.minDistance=Math.max(o.controls.minDistance??0,F);const k=new C().subVectors(x.position,o.controls.target);if(k.length()<F){const T=k.normalize();x.position.copy(o.controls.target).addScaledVector(T,F),x.updateProjectionMatrix()}}function b(x){const y=h(x);if(y==null||Math.abs(y-1)<a)return;const _=o.getCardScale(),M=De.clamp(_*y*.98,c,s);o.setLayoutScale(M),o.setCardScale(M)}function v(x){!o.isFlying()&&!o.isFocusing()&&!o.isSpinning()&&!o.isScaleHeld()&&(m(x),g(x),b(x))}return{id:"camera.viewport",priority:t,init(){},onResize(x,y,_){const M=_.camera;M.aspect=x/Math.max(1,y),M.updateProjectionMatrix(),o.overlayCanvas&&(o.overlayCanvas.width=x,o.overlayCanvas.height=y)},update(x,y){const _=y.camera;v(_)},dispose(){}}}function Xd(o){const{renderer:t,camera:r,damp:l=6,radius:n=4.5,maxVel:e=400}=o;let a=!1,c=new C,s=0;const i=new C(0,0,0),u=new je;let f=!1;const d=new je,h=new je,m=new C,g=new C;function b(F,k){const D=t.domElement.getBoundingClientRect(),T=(F-D.left)/D.width*2-1,R=-((k-D.top)/D.height)*2+1;return new te(T,R)}function v(F){const k=new te(F.x,F.y),D=k.length(),T=Math.max(1e-6,n);D>T&&k.multiplyScalar(T/D);const R=Math.sqrt(Math.max(0,T*T-k.x*k.x-k.y*k.y));return new C(k.x,k.y,R)}function p(){a=!1,f=!1,i.set(0,0,0)}function x(F){bt.isModalActive()||F.button===0&&(a=!0,s=performance.now(),c.copy(v(b(F.clientX,F.clientY))),f=!1,i.set(0,0,0),F.target.setPointerCapture?.(F.pointerId))}function y(F){if(!a)return;if(bt.isModalActive()){p();return}const k=performance.now(),D=Math.max(.001,(k-s)/1e3),T=v(b(F.clientX,F.clientY));m.copy(c).cross(T);const R=De.clamp(c.dot(T)/(n*n),-1,1);let U=Math.atan2(m.length(),R);if(isFinite(U)&&U>1e-6){m.normalize(),r.matrixWorld.decompose(new C,d,new C),g.copy(m).applyQuaternion(d).normalize(),u.setFromAxisAngle(g,U),f=!0;const H=Math.min(e,U/D),G=g.clone().multiplyScalar(H);i.lerp(G,.8)}c.copy(T),s=k}function _(F){a&&(a=!1,F.target.releasePointerCapture?.(F.pointerId))}t.domElement.addEventListener("pointerdown",x),window.addEventListener("pointermove",y),window.addEventListener("pointerup",_),window.addEventListener("pointercancel",_);function M(F,k){if(bt.isModalActive()){const T=Math.exp(-Math.max(l,12)*k);i.multiplyScalar(T),a&&(a=!1),f=!1;return}if(f&&(F.quaternion.premultiply(u),F.updateMatrixWorld(),f=!1),!a){const T=Math.exp(-l*k);i.multiplyScalar(T),i.lengthSq()<1e-8&&i.set(0,0,0)}const D=a?0:i.length();D>0&&(h.setFromAxisAngle(i.clone().multiplyScalar(1/D),D*k),F.quaternion.premultiply(h),F.updateMatrixWorld())}function w(){return(a||i.lengthSq()>1e-6||f)&&!bt.isModalActive()}function A(){t.domElement.removeEventListener("pointerdown",x),window.removeEventListener("pointermove",y),window.removeEventListener("pointerup",_),window.removeEventListener("pointercancel",_)}return{update:M,dispose:A,isActive:w}}function Qd(o=300){let t=null;const r={isActive:()=>!!t?.isActive()};return{system:{id:"io.spinner",priority:o,init(n){t=Xd({renderer:n.renderer,camera:n.camera})},update(n){t?.update(wt,n)},dispose(){t=null}},get:()=>r}}const Kd="/emptyoracle/assets/AccessPoint-Baboe_5R.wav",Zd="/emptyoracle/assets/Select-CGDdYP4o.wav";function Jd(o=50){let t=null,r=null;return{id:"app.audio",priority:o,init(l){t=new Audio(Kd),t.preload="auto",t.volume=.7,Ir(()=>{try{t&&(t.currentTime=0,t.play())}catch(n){console.warn("[audio] failed to play AccessPoint.wav:",n)}}),r=new Audio(Zd),r.preload="auto",r.volume=.7,Cu(()=>{try{r&&(r.currentTime=0,r.play())}catch(n){console.warn("[audio] failed to play Select.wav:",n)}})},update(){},dispose(){t=null,r=null}}}function $d(o=1e3){return{id:"render.final",priority:o,init(){},onResize(){},update(t,r){r.renderer.clear(!0,!0,!0),r.renderer.render(r.scene,r.camera)},dispose(){}}}const li=1,ui=new ji;ui.set(li);const eh=.79,nr={uniforms:{tBloom:{value:null}},vertexShader:`
    varying vec2 vUv;
    void main(){ vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0); }
  `,fragmentShader:`
    uniform sampler2D tBloom;
    varying vec2 vUv;
    void main(){
      vec3 b = texture2D(tBloom, vUv).rgb;
      // alpha from average intensity for hue-agnostic glow (k = 1.0)
      float avg = (b.r + b.g + b.b) / 3.0;
      float a = clamp(avg * 1.0, 0.0, 1.0);
      gl_FragColor = vec4(b, a);
    }
  `};function th(o=995){let t=null,r=null,l=null,n=null,e=null;const a=new Map;function c(u,f){if(!t||!r||!l||!n)return;const d=Math.max(1,Math.floor(u*.6)),h=Math.max(1,Math.floor(f*.6));t.setSize(u,f,!1),t.setPixelRatio(1),r.setSize(d,h),r.setPixelRatio(1),n.setSize(d,h),l.setSize(u,f)}function s(u){const f=u;if(!f.isMesh||!f.layers.test(ui)||a.has(f))return;const d=f.material;a.set(f,d);const h=new et(1,1,1),m=d;let g=1;m.emissive?(h.copy(m.emissive),g=typeof m.emissiveIntensity=="number"?m.emissiveIntensity:1):h.set(1572718);{const p=Math.max(0,g)*eh,x=.2126*h.r+.7152*h.g+.0722*h.b,y=p/Math.max(x,1e-4);h.multiplyScalar(y)}const b=f.userData||(f.userData={});let v=b.__bloomBright;v?(v.color.copy(h),v.needsUpdate=!0):(v=new mt({color:h,toneMapped:!1,depthTest:!0,depthWrite:!1}),b.__bloomBright=v),f.material=v}function i(u){const f=u;if(!f.isMesh)return;const d=a.get(f);d&&(f.material=d,a.delete(f))}return{id:"render.buttonsBloomOverlay",priority:o,init(u){t=new ss({antialias:!0,alpha:!0,premultipliedAlpha:!1});const f=t.domElement;f.style.position="fixed",f.style.inset="0",f.style.pointerEvents="none",f.style.zIndex="10",document.body.appendChild(f),t.setClearColor(0,0),t.setPixelRatio(1),r=new la(t),r.renderToScreen=!1,r.addPass(new qi(u.scene,u.camera)),n=new Yi(new te(256,256),.65,.1,.7),r.addPass(n),l=new la(t);const d=new Pr({uniforms:gs.clone(nr.uniforms),vertexShader:nr.vertexShader,fragmentShader:nr.fragmentShader,transparent:!0});e=new Xi(d);const h=r.renderTarget2?.texture??r.renderTarget1.texture,m=d.uniforms;m.tBloom=m.tBloom||{value:null},m.tBloom.value=h,l.addPass(e);const g=u.renderer.getSize(new te);c(g.x,g.y)},onResize(u,f){c(u,f)},update(u,f){if(!t||!r||!l)return;const d=f.camera,h=d.layers.mask;d.layers.set(li),f.scene.traverse(s),r.render(),f.scene.traverse(i),d.layers.mask=h,l.render()},dispose(){if(t)try{t.domElement.remove()}catch{}a.clear(),t=null,r=null,l=null,n=null,e=null}}}const nh=new Map;function oh(o,t){nh.set(o,t)}const rh=async({renderer:o})=>{const t=kc();for(const{id:r}of t)try{const l=await Dn(r);await go(o,l,{allFronts:!0}),oh(r,l)}catch(l){console.warn("[prewarmAllDecks] failed",r,l)}return{prewarmed:!0}},ah=async()=>{try{await Pn(Qs),console.debug("[prewarmOverlay] info_split_card.glb preloaded")}catch(o){console.warn("[prewarmOverlay] failed to preload info GLB",o)}return{overlayPrewarmed:!0}};function sh(o,t=90){let r=!0,l=0,n=0;function e(){const c=o.getCardsSystem?.()?.cards??[];if(c.length===0)return!1;if(!c.some(f=>f?.state==="flying"))return!0;const i=performance.now()-n,u=Math.max(600,Math.min(4e3,o.maxWaitMs??1800));return i>u}return{id:"cards.reveal-gate",priority:t,init(){r=!0,l=0,n=performance.now(),o.onPatternChange(()=>{if(r){l++;try{o.growNow?.()}catch{}}else o.handlePatternChange()})},update(){if(r&&e()){r=!1;try{ks("homing")}catch{}l>0&&o.handlePatternChange(),l=0;try{o.onFountainEnd?.()}catch{}}},dispose(){}}}const fi=document.getElementById("renderer"),ih=document.getElementById("overlay");if(!fi)throw new Error("#renderer element not found in DOM");const{scene:In,camera:Ut,renderer:En,controls:fn}=Qi(fi);fn.enableRotate=!1;fn.enableZoom=!1;fn.enablePan=!1;const ut=jd();Ec(In,En);function Bn(){const o=Je.cards;if(!o)return!1;for(let t=0;t<o.length;t++){const r=o[t]?.mode;if(r==="focus_in"||r==="focused"||r==="focus_out")return!0}return!1}function ch(){const o=Je.cards;if(!o)return!1;for(let t=0;t<o.length;t++){const r=o[t]?.state;if(r==="flying"||r==="initialHoming")return!0}return!1}function lh(o,t){const r=st,l=new C(0,1,0).applyQuaternion(o.quaternion).normalize(),n=new _t().lookAt(r,o.getWorldPosition(new C),l),e=new je().setFromRotationMatrix(n);if(t){const a=new je().setFromAxisAngle(new C(0,1,0),Math.PI);e.multiply(a)}return e}const di=new pt;In.add(di);const{deck:rs}=await wu({THREE:is,scene:In,renderer:En},{extras:[rh,ah],autoReveal:!0}),Je=Pc(In,di,{fronts:rs.fronts,back:rs.back}),yo=Xu({system:Je,camera:Ut,getDeckLength:()=>Je.getDeckLength()}),an=Uu({system:Je,getDeckLength:()=>Je.getDeckLength(),camera:Ut,morphDuration:.75});an.sync({morph:!1});const uh={values:()=>{const o=an.getDesiredCount(),t=Je.cards?.length??o;return{count:yo.isActive()?Math.max(t,o):o,power:1e4,showPaths:!0,spin:!0}}};function fh(o=.6){const t=Je.getHeartBoundsWorld?.();if(!t)return;const{center:r,size:l,minY:n,maxY:e}=t,a=Je.getHeartBottomWorld?.(),c=a?a.x:r.x,s=a?a.y:n,i=a?a.z:r.z,f=.1*Math.max(l.y,1e-4)+.008*Math.sqrt(Math.max(1,Je.getDeckLength()))*tt,d=De.degToRad(Ut.fov),h=Math.tan(d/2),m=e-(s-f),g=Math.max(l.x,1e-4),b=m/(2*h*o),v=g/(2*h*Ut.aspect*o),p=Math.max(b,v)*1.05;fn.target.copy(r),Ut.position.set(c,r.y,i+p),Ut.up.set(0,1,0),Ut.updateProjectionMatrix()}fh(.6);dc({camera:Ut,forwardTimeToCamera:.01,spreadRight:.05,spreadUp:.01,upMin:10,upMax:200,homingDelay:[50,700.5]});ks("flying");const Gr=Fu({getSystem:()=>Je},200),ln=Qd(300),hi=Vd({cardGroupFrame:wt,makeFrameQuatFacingCamera:(o,t)=>lh(o,t),getIsFocusing:()=>Bn(),spinner:{isActive:()=>ln.get().isActive()},damp:8,deadbandDeg:1.25},750),So=Df({getSystem:()=>Je,isMoving:()=>ln.get().isActive()||Bn()||xs()},710),dh=Yd({system:Je,cardGroupCenter:st,cardGroupFrame:wt,controls:fn,overlayCanvas:ih,CARD_H:tt,isFocusing:()=>Bn(),isSpinning:()=>ln.get().isActive(),isScaleHeld:()=>xs(),isFlying:()=>ch(),getCardScale:()=>ht(),setCardScale:o=>lc(o),setLayoutScale:o=>cc(o),snapScales:(o,t)=>fc(o,t),getOverlayBounds:()=>So.get().tubeOutline?.getLastPlaneBounds?.()||null},720),hh=Ef({getOverlayTB:()=>So.get().overlayTB,getInteractions:()=>Gr.get(),getCardsSystem:()=>({setImageDeck:(o,t)=>Je.setImageDeck(o,t)})},810),ph=zd({getOverlayTB:()=>So.get().overlayTB,getInteractions:()=>Gr.get()},815);ut.register(Gr.system);ut.register(ln.system);ut.register(Wd({hdrUrl:new URL("/emptyoracle/assets/studio-BwZMNpPC.hdr",import.meta.url).toString(),showBackground:!1,exposure:1,addLightRig:!0,rotation:{pitch:0,yaw:0,roll:0},cubeSize:256},50));ut.register(qd({director:{update:o=>yo.update(o)},system:Je,getUIValues:()=>uh.values(),getBillboardMode:()=>{const o=ln.get().isActive();return Bn()?"frame":hi.get().isReturningActive()?"camera":o?"frame":"camera"},isLayoutLocked:()=>ln.get().isActive()||Bn()},700));ut.register(hi.system);ut.register(dh);ut.register(So.system);ut.register(hh);ut.register(ph);ut.register(Jd(820));ut.register(th(995));ut.register($d(1e3));ut.register(sh({getCardsSystem:()=>Je,onPatternChange:o=>Ir(o),handlePatternChange:async()=>{try{const o=Rn?.()??null;if(o){const r=await Dn(o).catch(()=>null);r&&(await go(En,r),Je.setImageDeck?.(r.fronts,r.back))}an.onPatternChanged?.();const t=an.getDesiredCount();Je.ensureCardCount?.(t),yo.preallocate?.(t),yo.start?.()}catch(o){console.error("[reveal-gate] director.start failed:",o)}},growNow:async()=>{try{const o=Rn?.()??null;if(o){const r=await Dn(o).catch(()=>null);r&&(await go(En,r),Je.setImageDeck?.(r.fronts,r.back))}an.onPatternChanged?.();const t=an.getDesiredCount();Je.ensureCardCount?.(t,{quiet:!0})}catch(o){console.error("[reveal-gate] growNow failed:",o)}},maxWaitMs:3e3},90));function mh(o){if(window.__APP_READY__){o();return}const t=()=>{document.removeEventListener("appready",t),o()};document.addEventListener("appready",t)}mh(()=>{ut.start({scene:In,camera:Ut,renderer:En,controls:fn})});
